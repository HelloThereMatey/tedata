<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 15.0.1"/>
    <title>tedata.scraper API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:.75rem center;margin-bottom:1rem;}.pdoc .alert > em{display:none;}.pdoc .alert > *:last-child{margin-bottom:0;}.pdoc .alert.note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .alert.warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .alert.danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .decorator-deprecated{color:#842029;}.pdoc .decorator-deprecated ~ span{filter:grayscale(1) opacity(0.8);}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../tedata.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;tedata</a>


            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="variable" href="#fdel">fdel</a>
            </li>
            <li>
                    <a class="variable" href="#wd">wd</a>
            </li>
            <li>
                    <a class="variable" href="#logger">logger</a>
            </li>
            <li>
                    <a class="function" href="#find_element_header_match">find_element_header_match</a>
            </li>
            <li>
                    <a class="class" href="#TE_Scraper">TE_Scraper</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#TE_Scraper.__init__">TE_Scraper</a>
                        </li>
                        <li>
                                <a class="variable" href="#TE_Scraper.BrowserType">BrowserType</a>
                        </li>
                        <li>
                                <a class="function" href="#TE_Scraper.load_page">load_page</a>
                        </li>
                        <li>
                                <a class="function" href="#TE_Scraper.click_button">click_button</a>
                        </li>
                        <li>
                                <a class="function" href="#TE_Scraper.find_max_button">find_max_button</a>
                        </li>
                        <li>
                                <a class="function" href="#TE_Scraper.click_max_button">click_max_button</a>
                        </li>
                        <li>
                                <a class="function" href="#TE_Scraper.determine_date_span">determine_date_span</a>
                        </li>
                        <li>
                                <a class="function" href="#TE_Scraper.update_chart">update_chart</a>
                        </li>
                        <li>
                                <a class="function" href="#TE_Scraper.set_date_span">set_date_span</a>
                        </li>
                        <li>
                                <a class="function" href="#TE_Scraper.set_max_date_span_viaCalendar">set_max_date_span_viaCalendar</a>
                        </li>
                        <li>
                                <a class="function" href="#TE_Scraper.update_date_span">update_date_span</a>
                        </li>
                        <li>
                                <a class="function" href="#TE_Scraper.create_chart_types_dict">create_chart_types_dict</a>
                        </li>
                        <li>
                                <a class="function" href="#TE_Scraper.select_chart_type">select_chart_type</a>
                        </li>
                        <li>
                                <a class="function" href="#TE_Scraper.set_chartType_js">set_chartType_js</a>
                        </li>
                        <li>
                                <a class="function" href="#TE_Scraper.get_element">get_element</a>
                        </li>
                        <li>
                                <a class="function" href="#TE_Scraper.series_from_chart_soup">series_from_chart_soup</a>
                        </li>
                        <li>
                                <a class="function" href="#TE_Scraper.custom_date_span">custom_date_span</a>
                        </li>
                        <li>
                                <a class="function" href="#TE_Scraper.custom_date_span_js">custom_date_span_js</a>
                        </li>
                        <li>
                                <a class="function" href="#TE_Scraper.get_datamax_min">get_datamax_min</a>
                        </li>
                        <li>
                                <a class="function" href="#TE_Scraper.scale_series">scale_series</a>
                        </li>
                        <li>
                                <a class="function" href="#TE_Scraper.get_chart_dims">get_chart_dims</a>
                        </li>
                        <li>
                                <a class="function" href="#TE_Scraper.get_xlims_from_tooltips">get_xlims_from_tooltips</a>
                        </li>
                        <li>
                                <a class="function" href="#TE_Scraper.make_x_index">make_x_index</a>
                        </li>
                        <li>
                                <a class="function" href="#TE_Scraper.get_earliest_points">get_earliest_points</a>
                        </li>
                        <li>
                                <a class="function" href="#TE_Scraper.full_series_fromTooltips">full_series_fromTooltips</a>
                        </li>
                        <li>
                                <a class="function" href="#TE_Scraper.tooltip_multiScrape">tooltip_multiScrape</a>
                        </li>
                        <li>
                                <a class="function" href="#TE_Scraper.series_from_highcharts">series_from_highcharts</a>
                        </li>
                        <li>
                                <a class="function" href="#TE_Scraper.get_chart_type_from_highcharts">get_chart_type_from_highcharts</a>
                        </li>
                        <li>
                                <a class="function" href="#TE_Scraper.set_chartType_highcharts">set_chartType_highcharts</a>
                        </li>
                        <li>
                                <a class="function" href="#TE_Scraper.get_y_axis">get_y_axis</a>
                        </li>
                        <li>
                                <a class="function" href="#TE_Scraper.init_tooltipScraper">init_tooltipScraper</a>
                        </li>
                        <li>
                                <a class="function" href="#TE_Scraper.dtIndex">dtIndex</a>
                        </li>
                        <li>
                                <a class="function" href="#TE_Scraper.apply_x_index">apply_x_index</a>
                        </li>
                        <li>
                                <a class="function" href="#TE_Scraper.extract_axis_limits">extract_axis_limits</a>
                        </li>
                        <li>
                                <a class="function" href="#TE_Scraper.plot_series">plot_series</a>
                        </li>
                        <li>
                                <a class="function" href="#TE_Scraper.save_plot">save_plot</a>
                        </li>
                        <li>
                                <a class="function" href="#TE_Scraper.scrape_metadata">scrape_metadata</a>
                        </li>
                        <li>
                                <a class="function" href="#TE_Scraper.export_data">export_data</a>
                        </li>
                        <li>
                                <a class="function" href="#TE_Scraper.get_page_source">get_page_source</a>
                        </li>
                        <li>
                                <a class="function" href="#TE_Scraper.close">close</a>
                        </li>
                </ul>

            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
<a href="./../tedata.html">tedata</a><wbr>.scraper    </h1>

                
                        <input id="mod-scraper-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-scraper-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">   1</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Literal</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">   2</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">collections</span><span class="w"> </span><span class="kn">import</span> <span class="n">OrderedDict</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">   3</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">bs4</span><span class="w"> </span><span class="kn">import</span> <span class="n">BeautifulSoup</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos">   4</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">selenium.webdriver.common.by</span><span class="w"> </span><span class="kn">import</span> <span class="n">By</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">   5</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">selenium.webdriver.support</span><span class="w"> </span><span class="kn">import</span> <span class="n">expected_conditions</span> <span class="k">as</span> <span class="n">EC</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">   6</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">selenium.common.exceptions</span><span class="w"> </span><span class="kn">import</span> <span class="n">TimeoutException</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">   7</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">selenium.webdriver.common.keys</span><span class="w"> </span><span class="kn">import</span> <span class="n">Keys</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">   8</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">   9</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">datetime</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos">  10</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos">  11</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">os</span> 
</span><span id="L-12"><a href="#L-12"><span class="linenos">  12</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">plotly.graph_objects</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">go</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos">  13</span></a>
</span><span id="L-14"><a href="#L-14"><span class="linenos">  14</span></a><span class="n">fdel</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos">  15</span></a><span class="n">wd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos">  16</span></a>
</span><span id="L-17"><a href="#L-17"><span class="linenos">  17</span></a><span class="c1"># tedata related imports</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos">  18</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.</span><span class="w"> </span><span class="kn">import</span> <span class="n">utils</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos">  19</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.base</span><span class="w"> </span><span class="kn">import</span> <span class="n">Generic_Webdriver</span><span class="p">,</span> <span class="n">SharedWebDriverState</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos">  20</span></a>
</span><span id="L-21"><a href="#L-21"><span class="linenos">  21</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos">  22</span></a><span class="c1"># Get the logger from the parent package</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos">  23</span></a><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;tedata.scraper&#39;</span><span class="p">)</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos">  24</span></a>
</span><span id="L-25"><a href="#L-25"><span class="linenos">  25</span></a><span class="c1">## Standalone functions  ########################################</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos">  26</span></a><span class="k">def</span><span class="w"> </span><span class="nf">find_element_header_match</span><span class="p">(</span><span class="n">soup</span><span class="p">:</span> <span class="n">BeautifulSoup</span><span class="p">,</span> <span class="n">selector</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">match_text</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos">  27</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Find .card-header element with text matching search_text&quot;&quot;&quot;</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos">  28</span></a>    <span class="n">elements</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">selector</span><span class="p">)</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos">  29</span></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Elements found from selector, number of them: &quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">elements</span><span class="p">))</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos">  30</span></a>    <span class="k">for</span> <span class="n">ele</span> <span class="ow">in</span> <span class="n">elements</span><span class="p">:</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos">  31</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">ele</span><span class="p">),</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos">  32</span></a>        <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">ele</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">match_text</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos">  33</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Match found: &quot;</span><span class="p">,</span> <span class="n">ele</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos">  34</span></a>            <span class="k">return</span> <span class="n">ele</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos">  35</span></a>    <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos">  36</span></a>
</span><span id="L-37"><a href="#L-37"><span class="linenos">  37</span></a><span class="c1">### Main workhorse class for scraping data from Trading Economics website.</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos">  38</span></a><span class="k">class</span><span class="w"> </span><span class="nc">TE_Scraper</span><span class="p">(</span><span class="n">Generic_Webdriver</span><span class="p">,</span> <span class="n">SharedWebDriverState</span><span class="p">):</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos">  39</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Class for scraping data from Trading Economics website. This is the main workhorse of the module.</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos">  40</span></a><span class="sd">    It is designed to scrape data from the Trading Economics website using Selenium and BeautifulSoup.</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos">  41</span></a><span class="sd">    It can load a page, click buttons, extract data from elements, and plot the extracted data. Uses multiple inheritance</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos">  42</span></a><span class="sd">    from the Generic_Webdriver and SharedWebDriverState classes. This enables creation of TooltipScraper child classes that have </span>
</span><span id="L-43"><a href="#L-43"><span class="linenos">  43</span></a><span class="sd">    synced atributes such as &quot;chart_soup&quot;, &quot;chart_type&quot; &amp; &quot;date_span&quot; &amp; share the same webdriver object. This is useful for scraping.</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos">  44</span></a>
</span><span id="L-45"><a href="#L-45"><span class="linenos">  45</span></a><span class="sd">    **Init Parameters:** </span>
</span><span id="L-46"><a href="#L-46"><span class="linenos">  46</span></a><span class="sd">    - **kwargs (dict): Keyword  arguments to pass to the Generic_Webdriver class. These are the same as the Generic_Webdriver class.</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos">  47</span></a><span class="sd">    These are:</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos">  48</span></a><span class="sd">        - driver (webdriver): A Selenium WebDriver object, can put in an active one or make a new one for a new URL.</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos">  49</span></a><span class="sd">        - use_existing_driver (bool): Whether to use an existing driver in the namespace. If True, the driver parameter is ignored. Default is False.</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos">  50</span></a><span class="sd">        - browser (str): The browser to use for scraping, either &#39;chrome&#39; or &#39;firefox&#39;.</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos">  51</span></a><span class="sd">        - headless (bool): Whether to run the browser in headless mode (show no window).</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos">  52</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos">  53</span></a>
</span><span id="L-54"><a href="#L-54"><span class="linenos">  54</span></a>    <span class="c1"># Define browser type with allowed values</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos">  55</span></a>    <span class="n">BrowserType</span> <span class="o">=</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;chrome&quot;</span><span class="p">,</span> <span class="s2">&quot;firefox&quot;</span><span class="p">]</span>  <span class="c1">#Chrome still not working as of v0.3.0..</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos">  56</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos">  57</span></a>        <span class="n">Generic_Webdriver</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos">  58</span></a>        <span class="n">SharedWebDriverState</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos">  59</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">observers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>  <span class="c1"># Register self as observer</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos">  60</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_shared_state</span> <span class="o">=</span> <span class="bp">self</span>  <span class="c1"># Since we inherit SharedWebDriverState, we are our own shared state</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos">  61</span></a>
</span><span id="L-62"><a href="#L-62"><span class="linenos">  62</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">load_page</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">extra_wait_time</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos">  63</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Load page and wait for it to be ready&quot;&quot;&quot;</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos">  64</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">last_url</span> <span class="o">=</span> <span class="n">url</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos">  65</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">series_name</span> <span class="o">=</span> <span class="n">url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos">  66</span></a>        
</span><span id="L-67"><a href="#L-67"><span class="linenos">  67</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos">  68</span></a>            <span class="c1"># This waits for initial page load</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos">  69</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos">  70</span></a>            
</span><span id="L-71"><a href="#L-71"><span class="linenos">  71</span></a>            <span class="c1"># Now explicitly wait for your critical elements</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos">  72</span></a>            <span class="n">chart_element</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wait</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos">  73</span></a>                <span class="n">EC</span><span class="o">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">ID</span><span class="p">,</span> <span class="s2">&quot;chart&quot;</span><span class="p">)),</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos">  74</span></a>                <span class="n">message</span><span class="o">=</span><span class="s2">&quot;Chart element not found after page load&quot;</span><span class="p">)</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos">  75</span></a>            
</span><span id="L-76"><a href="#L-76"><span class="linenos">  76</span></a>            <span class="c1"># Scroll chart into view to ensure it&#39;s visible for interactions</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos">  77</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">execute_script</span><span class="p">(</span><span class="s2">&quot;arguments[0].scrollIntoView({behavior: &#39;auto&#39;, block: &#39;center&#39;});&quot;</span><span class="p">,</span> <span class="n">chart_element</span><span class="p">)</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos">  78</span></a>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>  <span class="c1"># Small delay to let scrolling complete</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos">  79</span></a>            
</span><span id="L-80"><a href="#L-80"><span class="linenos">  80</span></a>            <span class="c1"># Wait for the chart content to be loaded</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos">  81</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">wait</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos">  82</span></a>                <span class="n">EC</span><span class="o">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">CLASS_NAME</span><span class="p">,</span> <span class="s2">&quot;highcharts-series-group&quot;</span><span class="p">)),</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos">  83</span></a>                <span class="n">message</span><span class="o">=</span><span class="s2">&quot;Chart series not loaded&quot;</span><span class="p">)</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos">  84</span></a>            
</span><span id="L-85"><a href="#L-85"><span class="linenos">  85</span></a>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">extra_wait_time</span><span class="p">)</span>  <span class="c1"># Extra wait time after page load just to be sure...</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos">  86</span></a>            
</span><span id="L-87"><a href="#L-87"><span class="linenos">  87</span></a>            <span class="c1"># Now it&#39;s safe to get the page source</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos">  88</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">full_page</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_page_source</span><span class="p">()</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos">  89</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">page_soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">full_page</span><span class="p">,</span> <span class="s1">&#39;html.parser&#39;</span><span class="p">)</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos">  90</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">chart_soup</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">page_soup</span><span class="o">.</span><span class="n">select_one</span><span class="p">(</span><span class="s2">&quot;#chart&quot;</span><span class="p">)</span>  <span class="c1">#Make a bs4 object from the #chart element of the page.</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos">  91</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">full_chart</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_soup</span><span class="o">.</span><span class="n">contents</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos">  92</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos">  93</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error loading page: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos">  94</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error loading page: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos">  95</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos">  96</span></a>        
</span><span id="L-97"><a href="#L-97"><span class="linenos">  97</span></a>        <span class="n">retries</span> <span class="o">=</span> <span class="mi">4</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos">  98</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">retries</span><span class="p">):</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos">  99</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_chart_types_dict</span><span class="p">():</span> <span class="c1"># Create the chart types dictionary for the chart.</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos"> 100</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Chart types dictionary created successfully.&quot;</span><span class="p">)</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos"> 101</span></a>                <span class="k">break</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos"> 102</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos"> 103</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Error creating chart types dictionary. Retrying, attempt: &quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos"> 104</span></a>            
</span><span id="L-105"><a href="#L-105"><span class="linenos"> 105</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">update_date_span</span><span class="p">()</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos"> 106</span></a>        <span class="k">return</span> <span class="kc">True</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos"> 107</span></a>        
</span><span id="L-108"><a href="#L-108"><span class="linenos"> 108</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">click_button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">selector</span><span class="p">,</span> <span class="n">selector_type</span><span class="o">=</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">):</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos"> 109</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Click button using webdriver and wait for response.</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos"> 110</span></a><span class="sd">        **Parameters:**</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos"> 111</span></a><span class="sd">        - selector (str): The CSS selector for the button to click.</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos"> 112</span></a><span class="sd">        - selector_type (By): The type of selector to use, By.CSS_SELECTOR by default.&quot;&quot;&quot;</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos"> 113</span></a>
</span><span id="L-114"><a href="#L-114"><span class="linenos"> 114</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos"> 115</span></a>            <span class="c1"># Wait for element to be clickable</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos"> 116</span></a>            <span class="n">button</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wait</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos"> 117</span></a>                <span class="n">EC</span><span class="o">.</span><span class="n">element_to_be_clickable</span><span class="p">((</span><span class="n">selector_type</span><span class="p">,</span> <span class="n">selector</span><span class="p">)))</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos"> 118</span></a>            
</span><span id="L-119"><a href="#L-119"><span class="linenos"> 119</span></a>            <span class="n">button</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos"> 120</span></a>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.25</span><span class="p">)</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos"> 121</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos"> 122</span></a>        <span class="k">except</span> <span class="n">TimeoutException</span><span class="p">:</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos"> 123</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Button not found or not clickable: </span><span class="si">{</span><span class="n">selector</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos"> 124</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos"> 125</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos"> 126</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error clicking button: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos"> 127</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos"> 128</span></a>
</span><span id="L-129"><a href="#L-129"><span class="linenos"> 129</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">find_max_button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">selector</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;#dateSpansDiv&quot;</span><span class="p">):</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos"> 130</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Find the button on the chart that selects the maximum date range and return the CSS selector for it.</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos"> 131</span></a><span class="sd">        The button is usually labelled &#39;MAX&#39; and is used to select the maximum date range for the chart. The selector for the button is</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos"> 132</span></a><span class="sd">        usually &#39;#dateSpansDiv&#39; but can be changed if the button is not found. The method will return the CSS selector for the button.</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos"> 133</span></a><span class="sd">        This will also create an atrribute &#39;date_spans&#39; which is a dictionary containing the text of the date span buttons and their CSS selectors.&quot;&quot;&quot;</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos"> 134</span></a>
</span><span id="L-135"><a href="#L-135"><span class="linenos"> 135</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos"> 136</span></a>            <span class="n">buts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">page_soup</span><span class="o">.</span><span class="n">select_one</span><span class="p">(</span><span class="n">selector</span><span class="p">)</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos"> 137</span></a>            <span class="n">datebut</span> <span class="o">=</span> <span class="n">buts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">buts</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="n">buts</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos"> 138</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">date_spans</span> <span class="o">=</span> <span class="p">{</span><span class="n">child</span><span class="o">.</span><span class="n">text</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;a.</span><span class="si">{</span><span class="n">child</span><span class="p">[</span><span class="s1">&#39;class&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nb">isinstance</span><span class="p">(</span><span class="n">child</span><span class="p">[</span><span class="s1">&#39;class&#39;</span><span class="p">],</span><span class="w"> </span><span class="nb">list</span><span class="p">)</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="n">child</span><span class="p">[</span><span class="s1">&#39;class&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">:nth-child(</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">)&quot;</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">child</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">datebut</span><span class="o">.</span><span class="n">children</span><span class="p">)}</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos"> 139</span></a>
</span><span id="L-140"><a href="#L-140"><span class="linenos"> 140</span></a>            <span class="k">if</span> <span class="s2">&quot;MAX&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">date_spans</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos"> 141</span></a>                <span class="n">max_selector</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">date_spans</span><span class="p">[</span><span class="s2">&quot;MAX&quot;</span><span class="p">]</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos"> 142</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos"> 143</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;MAX button not found.&quot;</span><span class="p">)</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos"> 144</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;MAX button found for chart at URL: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">last_url</span><span class="si">}</span><span class="s2">, selector: </span><span class="si">{</span><span class="n">max_selector</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos"> 145</span></a>            
</span><span id="L-146"><a href="#L-146"><span class="linenos"> 146</span></a>            <span class="k">return</span> <span class="n">max_selector</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos"> 147</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-148"><a href="#L-148"><span class="linenos"> 148</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error finding date spans buttons: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos"> 149</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error finding date spans buttons: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos"> 150</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos"> 151</span></a>    
</span><span id="L-152"><a href="#L-152"><span class="linenos"> 152</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">click_max_button</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos"> 153</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Click the button that selects the maximum date range on the chart. This is usually the &#39;MAX&#39; button and is used to select the maximum date range for the chart.</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos"> 154</span></a><span class="sd">        The method will find the button and click it. It will also wait for the chart to update after clicking the button.&quot;&quot;&quot;</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos"> 155</span></a>        <span class="n">max_selector</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_max_button</span><span class="p">()</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos"> 156</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">click_button</span><span class="p">(</span><span class="n">max_selector</span><span class="p">):</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos"> 157</span></a>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos"> 158</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;MAX button clicked successfully.&quot;</span><span class="p">)</span>
</span><span id="L-159"><a href="#L-159"><span class="linenos"> 159</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">date_span</span> <span class="o">=</span> <span class="s2">&quot;MAX&quot;</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos"> 160</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">update_chart</span><span class="p">()</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos"> 161</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos"> 162</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Error clicking MAX button.&quot;</span><span class="p">)</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos"> 163</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos"> 164</span></a>        
</span><span id="L-165"><a href="#L-165"><span class="linenos"> 165</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">determine_date_span</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">update_chart</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos"> 166</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Determine the selected date span from the Trading Economics chart currently displayed in webdriver.&quot;&quot;&quot;</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos"> 167</span></a>    
</span><span id="L-168"><a href="#L-168"><span class="linenos"> 168</span></a>        <span class="k">if</span> <span class="n">update_chart</span><span class="p">:</span> 
</span><span id="L-169"><a href="#L-169"><span class="linenos"> 169</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">update_chart</span><span class="p">()</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos"> 170</span></a>        <span class="c1">## Populate the date spans dictionary</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos"> 171</span></a>        <span class="n">buts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_soup</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;#dateSpansDiv&quot;</span><span class="p">)</span>
</span><span id="L-172"><a href="#L-172"><span class="linenos"> 172</span></a>        <span class="n">datebut</span> <span class="o">=</span> <span class="n">buts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">buts</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="n">buts</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos"> 173</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">date_spans</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos"> 174</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">child</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">datebut</span><span class="o">.</span><span class="n">children</span><span class="p">):</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos"> 175</span></a>            <span class="n">selector</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;a.</span><span class="si">{</span><span class="n">child</span><span class="p">[</span><span class="s1">&#39;class&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nb">isinstance</span><span class="p">(</span><span class="n">child</span><span class="p">[</span><span class="s1">&#39;class&#39;</span><span class="p">],</span><span class="w"> </span><span class="nb">list</span><span class="p">)</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="n">child</span><span class="p">[</span><span class="s1">&#39;class&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">:nth-child(</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">)&quot;</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos"> 176</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">date_spans</span><span class="p">[</span><span class="n">child</span><span class="o">.</span><span class="n">text</span><span class="p">]</span> <span class="o">=</span> <span class="n">selector</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos"> 177</span></a>
</span><span id="L-178"><a href="#L-178"><span class="linenos"> 178</span></a>        <span class="c1">## Find the selected date span</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos"> 179</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">buts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos"> 180</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="n">buts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">children</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos"> 181</span></a>        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">buts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos"> 182</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Multiple date spans found&quot;</span><span class="p">)</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos"> 183</span></a>            <span class="k">return</span> <span class="n">buts</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos"> 184</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos"> 185</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No date spans found&quot;</span><span class="p">)</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos"> 186</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos"> 187</span></a>
</span><span id="L-188"><a href="#L-188"><span class="linenos"> 188</span></a>        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos"> 189</span></a>            <span class="c1">#print(&quot;Date span element: &quot;, r)</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos"> 190</span></a>            <span class="k">if</span> <span class="s2">&quot;selected&quot;</span> <span class="ow">in</span> <span class="n">r</span><span class="p">[</span><span class="s2">&quot;class&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">r</span><span class="o">.</span><span class="n">text</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">date_spans</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos"> 191</span></a>                <span class="n">date_span</span> <span class="o">=</span> <span class="p">{</span><span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">:</span> <span class="n">r</span><span class="p">}</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos"> 192</span></a>                <span class="k">return</span> <span class="n">date_span</span>
</span><span id="L-193"><a href="#L-193"><span class="linenos"> 193</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos"> 194</span></a>                <span class="c1"># No button has been slected already in this case.</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos"> 195</span></a>                <span class="n">shortest_span</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">date_spans</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos"> 196</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">set_date_span</span><span class="p">(</span><span class="n">shortest_span</span><span class="p">)</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos"> 197</span></a>                <span class="k">return</span> <span class="n">shortest_span</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos"> 198</span></a>
</span><span id="L-199"><a href="#L-199"><span class="linenos"> 199</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">update_chart</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-200"><a href="#L-200"><span class="linenos"> 200</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Update the chart attributes after loading a new page or clicking a button. This will check the page source and update the </span>
</span><span id="L-201"><a href="#L-201"><span class="linenos"> 201</span></a><span class="sd">        beautiful soup objects such as chart_soup, from which most other methods derive their functionality. It will also update the full_chart attribute</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos"> 202</span></a><span class="sd">        which is the full HTML of the chart element on the page. This method should be run after changing something on the webpage via driver such</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos"> 203</span></a><span class="sd">        as clicking a button to change the date span or chart type.&quot;&quot;&quot;</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos"> 204</span></a>
</span><span id="L-205"><a href="#L-205"><span class="linenos"> 205</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos"> 206</span></a>            <span class="c1"># Since we inherit from SharedWebDriverState, we can directly set the page_source property</span>
</span><span id="L-207"><a href="#L-207"><span class="linenos"> 207</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">page_source</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">page_source</span>
</span><span id="L-208"><a href="#L-208"><span class="linenos"> 208</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="L-209"><a href="#L-209"><span class="linenos"> 209</span></a>
</span><span id="L-210"><a href="#L-210"><span class="linenos"> 210</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos"> 211</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to update chart: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-212"><a href="#L-212"><span class="linenos"> 212</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-213"><a href="#L-213"><span class="linenos"> 213</span></a>
</span><span id="L-214"><a href="#L-214"><span class="linenos"> 214</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_date_span</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">date_span</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-215"><a href="#L-215"><span class="linenos"> 215</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the date span on the Trading Economics chart. This is done by clicking the date span button on the chart. The date span is a button on the chart</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos"> 216</span></a><span class="sd">        that allows you to change the date range of the chart. This method will click the button for the date span specified in the date_span parameter.</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos"> 217</span></a><span class="sd">        The date_span parameter should be a string that matches one of the date span buttons on the chart. The method will also update the date_span attribute</span>
</span><span id="L-218"><a href="#L-218"><span class="linenos"> 218</span></a><span class="sd">        of the class to reflect the new date span.&quot;&quot;&quot;</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos"> 219</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;date_spans&quot;</span><span class="p">):</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos"> 220</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">determine_date_span</span><span class="p">()</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos"> 221</span></a>        <span class="k">if</span> <span class="n">date_span</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">date_spans</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos"> 222</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">click_button</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">date_spans</span><span class="p">[</span><span class="n">date_span</span><span class="p">]):</span>
</span><span id="L-223"><a href="#L-223"><span class="linenos"> 223</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">date_span</span> <span class="o">=</span> <span class="n">date_span</span>
</span><span id="L-224"><a href="#L-224"><span class="linenos"> 224</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Date span set to: </span><span class="si">{</span><span class="n">date_span</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos"> 225</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">update_chart</span><span class="p">()</span>
</span><span id="L-226"><a href="#L-226"><span class="linenos"> 226</span></a>                <span class="k">return</span> <span class="kc">True</span>
</span><span id="L-227"><a href="#L-227"><span class="linenos"> 227</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos"> 228</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error setting date span: </span><span class="si">{</span><span class="n">date_span</span><span class="si">}</span><span class="s2">, check that the date span button is clickable.&quot;</span><span class="p">)</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos"> 229</span></a>                <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-230"><a href="#L-230"><span class="linenos"> 230</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos"> 231</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error setting date span: </span><span class="si">{</span><span class="n">date_span</span><span class="si">}</span><span class="s2">, check that the supplied date span matches one of the keys in the self.date_spans attribute (dict).&quot;</span><span class="p">)</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos"> 232</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos"> 233</span></a>        
</span><span id="L-234"><a href="#L-234"><span class="linenos"> 234</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_max_date_span_viaCalendar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos"> 235</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; Looks like Trading Economics have gone ahead and made the &quot;MAX&quot; button on charts a subscriber only feature. No problem, we can still set the max date range</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos"> 236</span></a><span class="sd">        by using the calendar widget on the chart. This method will click the calendar button and then enter an arbitrary date far in the past as start date and the </span>
</span><span id="L-237"><a href="#L-237"><span class="linenos"> 237</span></a><span class="sd">        current date as the end date.&quot;&quot;&quot;</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos"> 238</span></a>
</span><span id="L-239"><a href="#L-239"><span class="linenos"> 239</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">custom_date_span_js</span><span class="p">(</span><span class="n">start_date</span><span class="o">=</span><span class="s2">&quot;1850-01-01&quot;</span><span class="p">,</span> <span class="n">end_date</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">))</span>
</span><span id="L-240"><a href="#L-240"><span class="linenos"> 240</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">date_span</span> <span class="o">=</span> <span class="s2">&quot;MAX&quot;</span>
</span><span id="L-241"><a href="#L-241"><span class="linenos"> 241</span></a>
</span><span id="L-242"><a href="#L-242"><span class="linenos"> 242</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">update_date_span</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">update_chart</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos"> 243</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Update the date span after clicking a button. This will check the page source and update the date span attribute.</span>
</span><span id="L-244"><a href="#L-244"><span class="linenos"> 244</span></a><span class="sd">        This method can be used t check that the curret date span is correct after clicking a button to change it. </span>
</span><span id="L-245"><a href="#L-245"><span class="linenos"> 245</span></a><span class="sd">        It will update the date_span attribute. It is not necessary after running set_date_span though as that method already updates the date span attribute.</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos"> 246</span></a>
</span><span id="L-247"><a href="#L-247"><span class="linenos"> 247</span></a><span class="sd">        **Parameters:**</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos"> 248</span></a><span class="sd">        - update_chart (bool): Whether to update the chart before determining the date span. Default is False.</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos"> 249</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-250"><a href="#L-250"><span class="linenos"> 250</span></a>
</span><span id="L-251"><a href="#L-251"><span class="linenos"> 251</span></a>        <span class="k">if</span> <span class="n">update_chart</span><span class="p">:</span>
</span><span id="L-252"><a href="#L-252"><span class="linenos"> 252</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">update_chart</span><span class="p">()</span>
</span><span id="L-253"><a href="#L-253"><span class="linenos"> 253</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">date_span_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">determine_date_span</span><span class="p">()</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos"> 254</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">date_span</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">date_spans</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-255"><a href="#L-255"><span class="linenos"> 255</span></a>    
</span><span id="L-256"><a href="#L-256"><span class="linenos"> 256</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_chart_types_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos"> 257</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a dictionary of chart types and their CSS selectors. This is used to select the chart type on the Trading Economics chart.</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos"> 258</span></a><span class="sd">        The dictionary is stored in the chart_types attribute of the class. The keys are the names of the chart types and the values are the CSS selectors</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos"> 259</span></a><span class="sd">        for the chart type buttons on the chart.&quot;&quot;&quot;</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos"> 260</span></a>
</span><span id="L-261"><a href="#L-261"><span class="linenos"> 261</span></a>        <span class="n">hart_types</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_soup</span><span class="o">.</span><span class="n">select_one</span><span class="p">(</span><span class="s2">&quot;.chartTypesWrapper&quot;</span><span class="p">)</span>
</span><span id="L-262"><a href="#L-262"><span class="linenos"> 262</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">chart_types</span> <span class="o">=</span> <span class="p">{</span><span class="n">child</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">]:</span> <span class="s2">&quot;.&quot;</span><span class="o">+</span><span class="n">child</span><span class="p">[</span><span class="s2">&quot;class&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot; .&quot;</span><span class="o">+</span> <span class="n">child</span><span class="o">.</span><span class="n">button</span><span class="p">[</span><span class="s2">&quot;class&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">hart_types</span><span class="o">.</span><span class="n">children</span><span class="p">}</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos"> 263</span></a>        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_types</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos"> 264</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">chart_types</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-265"><a href="#L-265"><span class="linenos"> 265</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Chart types dictionary created successfully: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">chart_types</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-266"><a href="#L-266"><span class="linenos"> 266</span></a>        <span class="k">return</span> <span class="kc">True</span>
</span><span id="L-267"><a href="#L-267"><span class="linenos"> 267</span></a>
</span><span id="L-268"><a href="#L-268"><span class="linenos"> 268</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">select_chart_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chart_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-269"><a href="#L-269"><span class="linenos"> 269</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Select a chart type on the Trading Economics chart. This is done by clicking the chart type button and then selecting the specified chart type.</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos"> 270</span></a><span class="sd">        The chart type should be a string that matches one of the chart types in the chart_types dictionary. The method will click the chart type button</span>
</span><span id="L-271"><a href="#L-271"><span class="linenos"> 271</span></a><span class="sd">        and then select the specified chart type. It will also update the chart_type attribute of the class to reflect the new chart type.</span>
</span><span id="L-272"><a href="#L-272"><span class="linenos"> 272</span></a>
</span><span id="L-273"><a href="#L-273"><span class="linenos"> 273</span></a><span class="sd">        **Parameters:**</span>
</span><span id="L-274"><a href="#L-274"><span class="linenos"> 274</span></a><span class="sd">        - chart_type (str): The chart type to select on the chart. This must be one of the keys of the chart_types dictionary attribute of the class.</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos"> 275</span></a><span class="sd">        List the options by printing self.chart_types.keys()</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos"> 276</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-277"><a href="#L-277"><span class="linenos"> 277</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;chart_types&quot;</span><span class="p">):</span>
</span><span id="L-278"><a href="#L-278"><span class="linenos"> 278</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">create_chart_types_dict</span><span class="p">()</span>
</span><span id="L-279"><a href="#L-279"><span class="linenos"> 279</span></a>        
</span><span id="L-280"><a href="#L-280"><span class="linenos"> 280</span></a>        <span class="n">selector</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;#chart.chart_module.chart1.undertaker-section div.chart_preview.undertaker_chart.logic-new-charts-no div.hawk-totalWrapper div.hawk-header</span><span class="se">\</span>
</span><span id="L-281"><a href="#L-281"><span class="linenos"> 281</span></a><span class="s2">          div.topnav-flex-container div.pickChartTypes div.PREselectedChartType div.chartTypesWrapper.dropDownStyle div</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">chart_types</span><span class="p">[</span><span class="n">chart_type</span><span class="p">]</span><span class="si">}</span><span class="s2"> button.dkLabels-label-btn&quot;</span>
</span><span id="L-282"><a href="#L-282"><span class="linenos"> 282</span></a>        
</span><span id="L-283"><a href="#L-283"><span class="linenos"> 283</span></a>        <span class="k">if</span> <span class="n">chart_type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_types</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos"> 284</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">click_button</span><span class="p">(</span><span class="s2">&quot;#chart &gt; div &gt; div &gt; div.hawk-header &gt; div &gt; div.pickChartTypes &gt; div &gt; button&quot;</span><span class="p">):</span>
</span><span id="L-285"><a href="#L-285"><span class="linenos"> 285</span></a>                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">1.5</span><span class="p">)</span>
</span><span id="L-286"><a href="#L-286"><span class="linenos"> 286</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">click_button</span><span class="p">(</span><span class="n">selector</span><span class="p">):</span>
</span><span id="L-287"><a href="#L-287"><span class="linenos"> 287</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_types</span><span class="p">[</span><span class="n">chart_type</span><span class="p">]</span>
</span><span id="L-288"><a href="#L-288"><span class="linenos"> 288</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Chart type set to: </span><span class="si">{</span><span class="n">chart_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-289"><a href="#L-289"><span class="linenos"> 289</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">update_chart</span><span class="p">()</span>
</span><span id="L-290"><a href="#L-290"><span class="linenos"> 290</span></a>                    <span class="k">return</span> <span class="kc">True</span>
</span><span id="L-291"><a href="#L-291"><span class="linenos"> 291</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-292"><a href="#L-292"><span class="linenos"> 292</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error selecting chart type: </span><span class="si">{</span><span class="n">chart_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos"> 293</span></a>                    <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-294"><a href="#L-294"><span class="linenos"> 294</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos"> 295</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error selecting chart type: </span><span class="si">{</span><span class="n">chart_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-296"><a href="#L-296"><span class="linenos"> 296</span></a>                <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-297"><a href="#L-297"><span class="linenos"> 297</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-298"><a href="#L-298"><span class="linenos"> 298</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Chart type not found: </span><span class="si">{</span><span class="n">chart_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos"> 299</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-300"><a href="#L-300"><span class="linenos"> 300</span></a>
</span><span id="L-301"><a href="#L-301"><span class="linenos"> 301</span></a>    <span class="c1">## Determine chart type from the chart displayed in the webdriver. This is not working yet,</span>
</span><span id="L-302"><a href="#L-302"><span class="linenos"> 302</span></a>    <span class="c1"># the buttons are not easi;y distinguishable, leave for now. chart_type will have to bve remembered and</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos"> 303</span></a>    <span class="c1"># only set via the select_chart_type or select_line chart methods.  </span>
</span><span id="L-304"><a href="#L-304"><span class="linenos"> 304</span></a>    <span class="c1"># def determine_chart_type(self, update_chart: bool = True):</span>
</span><span id="L-305"><a href="#L-305"><span class="linenos"> 305</span></a>    <span class="c1">#     &quot;&quot;&quot; Determine the chart type from the Trading Economics chart currently displayed in webdriver.</span>
</span><span id="L-306"><a href="#L-306"><span class="linenos"> 306</span></a>    <span class="c1">#     This is done by checking the class of the selected chart type button in the chart. The chart type is determined by the class of the SVG element</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos"> 307</span></a>    <span class="c1">#     in the chart. This method will return the chart type as a string. </span>
</span><span id="L-308"><a href="#L-308"><span class="linenos"> 308</span></a>
</span><span id="L-309"><a href="#L-309"><span class="linenos"> 309</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_chartType_js</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chart_type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;Column&#39;</span><span class="p">,</span> <span class="s1">&#39;Spline&#39;</span><span class="p">,</span> <span class="s1">&#39;Areaspline&#39;</span><span class="p">,</span> <span class="s1">&#39;Stepline&#39;</span><span class="p">,</span> <span class="s1">&#39;Line&#39;</span><span class="p">,</span> <span class="s1">&#39;Area&#39;</span><span class="p">]):</span>
</span><span id="L-310"><a href="#L-310"><span class="linenos"> 310</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the chart type using javascript. This is a more robust method of setting the chart type than using the click_button method.</span>
</span><span id="L-311"><a href="#L-311"><span class="linenos"> 311</span></a><span class="sd">        The click_button method can sometimes fail to click the chart type button. This method will set the chart type using javascript and will</span>
</span><span id="L-312"><a href="#L-312"><span class="linenos"> 312</span></a><span class="sd">        update the chart_type attribute of the class to reflect the new chart type.</span>
</span><span id="L-313"><a href="#L-313"><span class="linenos"> 313</span></a>
</span><span id="L-314"><a href="#L-314"><span class="linenos"> 314</span></a><span class="sd">        **Parameters:**</span>
</span><span id="L-315"><a href="#L-315"><span class="linenos"> 315</span></a><span class="sd">        - chart_type (Literal): The chart type to set. This should be one of the keys of the chart_types dictionary attribute of the class. The </span>
</span><span id="L-316"><a href="#L-316"><span class="linenos"> 316</span></a><span class="sd">        options are &#39;Column&#39;, &#39;Spline&#39;, &#39;Areaspline&#39;, &#39;Stepline&#39;, &#39;Line&#39;, &#39;Area&#39;.</span>
</span><span id="L-317"><a href="#L-317"><span class="linenos"> 317</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-318"><a href="#L-318"><span class="linenos"> 318</span></a>        
</span><span id="L-319"><a href="#L-319"><span class="linenos"> 319</span></a>        <span class="n">success</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">execute_script</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="L-320"><a href="#L-320"><span class="linenos"> 320</span></a><span class="s2">                var chartType = &quot;</span><span class="si">{</span><span class="n">chart_type</span><span class="si">}</span><span class="s2">&quot;;</span>
</span><span id="L-321"><a href="#L-321"><span class="linenos"> 321</span></a><span class="s2">                var buttons = document.querySelectorAll(&#39;.chartTypesWrapper button&#39;);</span>
</span><span id="L-322"><a href="#L-322"><span class="linenos"> 322</span></a><span class="s2">                for (var i = 0; i &lt; buttons.length; i++) </span><span class="se">{{</span>
</span><span id="L-323"><a href="#L-323"><span class="linenos"> 323</span></a><span class="s2">                    if (buttons[i].textContent.trim() === chartType || </span>
</span><span id="L-324"><a href="#L-324"><span class="linenos"> 324</span></a><span class="s2">                        buttons[i].getAttribute(&#39;title&#39;) === chartType ||</span>
</span><span id="L-325"><a href="#L-325"><span class="linenos"> 325</span></a><span class="s2">                        buttons[i].parentElement.getAttribute(&#39;title&#39;) === chartType) </span><span class="se">{{</span>
</span><span id="L-326"><a href="#L-326"><span class="linenos"> 326</span></a><span class="s2">                        buttons[i].click();</span>
</span><span id="L-327"><a href="#L-327"><span class="linenos"> 327</span></a><span class="s2">                        return true;</span>
</span><span id="L-328"><a href="#L-328"><span class="linenos"> 328</span></a><span class="s2">                    </span><span class="se">}}</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos"> 329</span></a><span class="s2">                </span><span class="se">}}</span>
</span><span id="L-330"><a href="#L-330"><span class="linenos"> 330</span></a><span class="s2">                return false;</span>
</span><span id="L-331"><a href="#L-331"><span class="linenos"> 331</span></a><span class="s2">            &quot;&quot;&quot;</span><span class="p">)</span>
</span><span id="L-332"><a href="#L-332"><span class="linenos"> 332</span></a>            
</span><span id="L-333"><a href="#L-333"><span class="linenos"> 333</span></a>        <span class="k">if</span> <span class="n">success</span><span class="p">:</span>
</span><span id="L-334"><a href="#L-334"><span class="linenos"> 334</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_types</span><span class="p">[</span><span class="n">chart_type</span><span class="p">]</span>
</span><span id="L-335"><a href="#L-335"><span class="linenos"> 335</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Chart type set to: </span><span class="si">{</span><span class="n">chart_type</span><span class="si">}</span><span class="s2"> (using JavaScript)&quot;</span><span class="p">)</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos"> 336</span></a>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
</span><span id="L-337"><a href="#L-337"><span class="linenos"> 337</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">update_chart</span><span class="p">()</span>
</span><span id="L-338"><a href="#L-338"><span class="linenos"> 338</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="L-339"><a href="#L-339"><span class="linenos"> 339</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos"> 340</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error setting chart type: </span><span class="si">{</span><span class="n">chart_type</span><span class="si">}</span><span class="s2"> (using JavaScript)&quot;</span><span class="p">)</span>
</span><span id="L-341"><a href="#L-341"><span class="linenos"> 341</span></a>            <span class="k">return</span> <span class="kc">False</span>   
</span><span id="L-342"><a href="#L-342"><span class="linenos"> 342</span></a>    
</span><span id="L-343"><a href="#L-343"><span class="linenos"> 343</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_element</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">selector</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;.highcharts-series path&quot;</span><span class="p">,</span> <span class="n">selector_type</span><span class="o">=</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">):</span>
</span><span id="L-344"><a href="#L-344"><span class="linenos"> 344</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Find element by selector. The data trace displayed on a Trading Economics chart is a PATH element in the SVG chart.</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos"> 345</span></a><span class="sd">        This is selected using the CSS selector &quot;.highcharts-series path&quot; by default. The element is stored in the &#39;current_element&#39; attribute.</span>
</span><span id="L-346"><a href="#L-346"><span class="linenos"> 346</span></a><span class="sd">        It can be used to select other elements on the chart as well and assign that to current element attribute.</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos"> 347</span></a><span class="sd">        </span>
</span><span id="L-348"><a href="#L-348"><span class="linenos"> 348</span></a><span class="sd">        **Parameters:**</span>
</span><span id="L-349"><a href="#L-349"><span class="linenos"> 349</span></a><span class="sd">        - selector (str): The CSS selector for the element to find.</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos"> 350</span></a><span class="sd">        - selector_type (By): The type of selector to use, By.CSS_SELECTOR by default.</span>
</span><span id="L-351"><a href="#L-351"><span class="linenos"> 351</span></a>
</span><span id="L-352"><a href="#L-352"><span class="linenos"> 352</span></a><span class="sd">        **Returns:**</span>
</span><span id="L-353"><a href="#L-353"><span class="linenos"> 353</span></a><span class="sd">        - element: The found element or None if not found.</span>
</span><span id="L-354"><a href="#L-354"><span class="linenos"> 354</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos"> 355</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-356"><a href="#L-356"><span class="linenos"> 356</span></a>            <span class="n">element</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wait</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
</span><span id="L-357"><a href="#L-357"><span class="linenos"> 357</span></a>                <span class="n">EC</span><span class="o">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">selector_type</span><span class="p">,</span> <span class="n">selector</span><span class="p">))</span>
</span><span id="L-358"><a href="#L-358"><span class="linenos"> 358</span></a>            <span class="p">)</span>
</span><span id="L-359"><a href="#L-359"><span class="linenos"> 359</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">current_element</span> <span class="o">=</span> <span class="n">element</span>
</span><span id="L-360"><a href="#L-360"><span class="linenos"> 360</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Element found and assigned to current_element attribute: </span><span class="si">{</span><span class="n">selector</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-361"><a href="#L-361"><span class="linenos"> 361</span></a>            <span class="k">return</span> <span class="n">element</span>
</span><span id="L-362"><a href="#L-362"><span class="linenos"> 362</span></a>        <span class="k">except</span> <span class="n">TimeoutException</span><span class="p">:</span>
</span><span id="L-363"><a href="#L-363"><span class="linenos"> 363</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Element not found: </span><span class="si">{</span><span class="n">selector</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-364"><a href="#L-364"><span class="linenos"> 364</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Element not found: </span><span class="si">{</span><span class="n">selector</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos"> 365</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-366"><a href="#L-366"><span class="linenos"> 366</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-367"><a href="#L-367"><span class="linenos"> 367</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error finding element: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-368"><a href="#L-368"><span class="linenos"> 368</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error finding element: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-369"><a href="#L-369"><span class="linenos"> 369</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-370"><a href="#L-370"><span class="linenos"> 370</span></a>        
</span><span id="L-371"><a href="#L-371"><span class="linenos"> 371</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">series_from_chart_soup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">selector</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;.highcharts-graph&quot;</span><span class="p">,</span> 
</span><span id="L-372"><a href="#L-372"><span class="linenos"> 372</span></a>                               <span class="n">invert_the_series</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> 
</span><span id="L-373"><a href="#L-373"><span class="linenos"> 373</span></a>                               <span class="n">set_max_datespan</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos"> 374</span></a>                               <span class="n">local_run</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-375"><a href="#L-375"><span class="linenos"> 375</span></a>                               <span class="n">use_chart_type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;Line&quot;</span><span class="p">,</span> <span class="s2">&quot;Spline&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Spline&quot;</span><span class="p">):</span>  
</span><span id="L-376"><a href="#L-376"><span class="linenos"> 376</span></a><span class="w">          </span>
</span><span id="L-377"><a href="#L-377"><span class="linenos"> 377</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract series data from element text. This extracts the plotted series from the svg chart by taking the PATH </span>
</span><span id="L-378"><a href="#L-378"><span class="linenos"> 378</span></a><span class="sd">        element of the data tarace on the chart. Series values are pixel co-ordinates on the chart.</span>
</span><span id="L-379"><a href="#L-379"><span class="linenos"> 379</span></a>
</span><span id="L-380"><a href="#L-380"><span class="linenos"> 380</span></a><span class="sd">        **Parameters:**</span>
</span><span id="L-381"><a href="#L-381"><span class="linenos"> 381</span></a><span class="sd">        - invert_the_series (bool): Whether to invert the series values.</span>
</span><span id="L-382"><a href="#L-382"><span class="linenos"> 382</span></a><span class="sd">        - return_series (bool): whether or not to return the series at end. Series is assigned to self.series always.</span>
</span><span id="L-383"><a href="#L-383"><span class="linenos"> 383</span></a><span class="sd">        - set_max_datespan (bool): Whether to set the date span to MAX before extracting the series data. Default is False.</span>
</span><span id="L-384"><a href="#L-384"><span class="linenos"> 384</span></a><span class="sd">        - local_run (bool): Whether the method is being run to get the full date_span series or just extacting part of the series</span>
</span><span id="L-385"><a href="#L-385"><span class="linenos"> 385</span></a><span class="sd">        to then aggregate together the full series. Default is False.</span>
</span><span id="L-386"><a href="#L-386"><span class="linenos"> 386</span></a><span class="sd">        - use_chart_type (str): The chart type to use for the extraction of the series data. Default is &quot;Spline&quot;. This is used to set the chart type before extracting the series data.</span>
</span><span id="L-387"><a href="#L-387"><span class="linenos"> 387</span></a><span class="sd">        CUATION: This method may fail with certain types of charts. It is best to use Spline unless you have a reason to use another type.</span>
</span><span id="L-388"><a href="#L-388"><span class="linenos"> 388</span></a>
</span><span id="L-389"><a href="#L-389"><span class="linenos"> 389</span></a><span class="sd">        **Returns:**</span>
</span><span id="L-390"><a href="#L-390"><span class="linenos"> 390</span></a>
</span><span id="L-391"><a href="#L-391"><span class="linenos"> 391</span></a><span class="sd">        - series (pd.Series): The extracted series data that is the raw pixel co-ordinate values of the data trace on the svg chart.</span>
</span><span id="L-392"><a href="#L-392"><span class="linenos"> 392</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-393"><a href="#L-393"><span class="linenos"> 393</span></a>
</span><span id="L-394"><a href="#L-394"><span class="linenos"> 394</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">update_chart</span><span class="p">()</span> <span class="c1"># Update chart..</span>
</span><span id="L-395"><a href="#L-395"><span class="linenos"> 395</span></a>
</span><span id="L-396"><a href="#L-396"><span class="linenos"> 396</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_types</span><span class="p">[</span><span class="n">use_chart_type</span><span class="p">]:</span>
</span><span id="L-397"><a href="#L-397"><span class="linenos"> 397</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">set_chartType_js</span><span class="p">(</span><span class="n">use_chart_type</span><span class="p">)</span> <span class="c1">## Use a certain chart type for the extraction of the series data. May fail with certain types of charts.</span>
</span><span id="L-398"><a href="#L-398"><span class="linenos"> 398</span></a>
</span><span id="L-399"><a href="#L-399"><span class="linenos"> 399</span></a>        <span class="k">if</span> <span class="n">set_max_datespan</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">date_span</span> <span class="o">!=</span> <span class="s2">&quot;MAX&quot;</span><span class="p">:</span>
</span><span id="L-400"><a href="#L-400"><span class="linenos"> 400</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">set_date_span</span><span class="p">(</span><span class="s2">&quot;MAX&quot;</span><span class="p">)</span>
</span><span id="L-401"><a href="#L-401"><span class="linenos"> 401</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Series path extraction method: Extracting series data from chart soup.&quot;</span><span class="p">)</span> 
</span><span id="L-402"><a href="#L-402"><span class="linenos"> 402</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Date span: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">date_span</span><span class="si">}</span><span class="s2">. Chart type: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span><span class="si">}</span><span class="s2">, URL: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">last_url</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
</span><span id="L-403"><a href="#L-403"><span class="linenos"> 403</span></a>    
</span><span id="L-404"><a href="#L-404"><span class="linenos"> 404</span></a>        <span class="n">datastrlist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_soup</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">selector</span><span class="p">)</span>
</span><span id="L-405"><a href="#L-405"><span class="linenos"> 405</span></a>        
</span><span id="L-406"><a href="#L-406"><span class="linenos"> 406</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">datastrlist</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-407"><a href="#L-407"><span class="linenos"> 407</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Multiple series found in the chart. Got to figure out which one to use... work to do here... This will not work yet, please report error.&quot;</span><span class="p">)</span>
</span><span id="L-408"><a href="#L-408"><span class="linenos"> 408</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Multiple series found in the chart. Got to figure out which one to use... work to do here...&quot;</span><span class="p">)</span>
</span><span id="L-409"><a href="#L-409"><span class="linenos"> 409</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-410"><a href="#L-410"><span class="linenos"> 410</span></a>            <span class="n">raw_series</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_soup</span><span class="o">.</span><span class="n">select_one</span><span class="p">(</span><span class="s2">&quot;.highcharts-graph&quot;</span><span class="p">)[</span><span class="s2">&quot;d&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
</span><span id="L-411"><a href="#L-411"><span class="linenos"> 411</span></a>    
</span><span id="L-412"><a href="#L-412"><span class="linenos"> 412</span></a>        <span class="n">ser</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">raw_series</span><span class="p">)</span>
</span><span id="L-413"><a href="#L-413"><span class="linenos"> 413</span></a>        <span class="n">ser_num</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">ser</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
</span><span id="L-414"><a href="#L-414"><span class="linenos"> 414</span></a>
</span><span id="L-415"><a href="#L-415"><span class="linenos"> 415</span></a>        <span class="n">exvals</span> <span class="o">=</span> <span class="n">ser_num</span><span class="p">[::</span><span class="mi">2</span><span class="p">];</span> <span class="n">yvals</span> <span class="o">=</span> <span class="n">ser_num</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
</span><span id="L-416"><a href="#L-416"><span class="linenos"> 416</span></a>        <span class="n">exvals</span> <span class="o">=</span> <span class="n">exvals</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
</span><span id="L-417"><a href="#L-417"><span class="linenos"> 417</span></a>        <span class="n">yvals</span> <span class="o">=</span> <span class="n">yvals</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
</span><span id="L-418"><a href="#L-418"><span class="linenos"> 418</span></a>        <span class="n">series</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">yvals</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="n">exvals</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Extracted Series&quot;</span><span class="p">)</span>
</span><span id="L-419"><a href="#L-419"><span class="linenos"> 419</span></a>
</span><span id="L-420"><a href="#L-420"><span class="linenos"> 420</span></a>        <span class="k">if</span> <span class="n">local_run</span><span class="p">:</span>
</span><span id="L-421"><a href="#L-421"><span class="linenos"> 421</span></a>            <span class="n">y_axis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_y_axis</span><span class="p">()</span>
</span><span id="L-422"><a href="#L-422"><span class="linenos"> 422</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-423"><a href="#L-423"><span class="linenos"> 423</span></a>            <span class="n">y_axis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_axis</span>
</span><span id="L-424"><a href="#L-424"><span class="linenos"> 424</span></a>
</span><span id="L-425"><a href="#L-425"><span class="linenos"> 425</span></a>        <span class="k">if</span> <span class="n">invert_the_series</span><span class="p">:</span>
</span><span id="L-426"><a href="#L-426"><span class="linenos"> 426</span></a>            <span class="n">series</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">invert_series</span><span class="p">(</span><span class="n">series</span><span class="p">,</span> <span class="n">max_val</span> <span class="o">=</span> <span class="n">y_axis</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
</span><span id="L-427"><a href="#L-427"><span class="linenos"> 427</span></a>        
</span><span id="L-428"><a href="#L-428"><span class="linenos"> 428</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">local_run</span><span class="p">:</span>
</span><span id="L-429"><a href="#L-429"><span class="linenos"> 429</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">trace_path_series_raw</span> <span class="o">=</span> <span class="n">series</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-430"><a href="#L-430"><span class="linenos"> 430</span></a>         <span class="c1"># Keep the raw pixel co-ordinate valued series extracted from the svg path element.</span>
</span><span id="L-431"><a href="#L-431"><span class="linenos"> 431</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Raw data series extracted successfully.&quot;</span><span class="p">)</span>
</span><span id="L-432"><a href="#L-432"><span class="linenos"> 432</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">series_extracted_from</span> <span class="o">=</span> <span class="n">use_chart_type</span>  <span class="c1">#Add this attribute so that the apply_x_index method knows which chart_type the series came from.</span>
</span><span id="L-433"><a href="#L-433"><span class="linenos"> 433</span></a>        
</span><span id="L-434"><a href="#L-434"><span class="linenos"> 434</span></a>        <span class="c1">#Add translate to the series to yield the proper y-values</span>
</span><span id="L-435"><a href="#L-435"><span class="linenos"> 435</span></a>        <span class="n">transform</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_soup</span><span class="o">.</span><span class="n">select_one</span><span class="p">(</span><span class="s2">&quot;.highcharts-graph&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="p">[</span><span class="s2">&quot;transform&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
</span><span id="L-436"><a href="#L-436"><span class="linenos"> 436</span></a>        <span class="n">translate</span> <span class="o">=</span> <span class="n">transform</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;translate(&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;)&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
</span><span id="L-437"><a href="#L-437"><span class="linenos"> 437</span></a>        <span class="n">translate</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">translate</span><span class="p">]</span>
</span><span id="L-438"><a href="#L-438"><span class="linenos"> 438</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">other_transforms</span> <span class="o">=</span> <span class="n">transform</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
</span><span id="L-439"><a href="#L-439"><span class="linenos"> 439</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">transform</span> <span class="o">=</span> <span class="n">translate</span>
</span><span id="L-440"><a href="#L-440"><span class="linenos"> 440</span></a>
</span><span id="L-441"><a href="#L-441"><span class="linenos"> 441</span></a>        <span class="n">series</span> <span class="o">=</span> <span class="n">series</span> <span class="o">+</span> <span class="n">translate</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-442"><a href="#L-442"><span class="linenos"> 442</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">series</span> <span class="o">=</span> <span class="n">series</span>
</span><span id="L-443"><a href="#L-443"><span class="linenos"> 443</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">raw_path_series</span> <span class="o">=</span> <span class="n">series</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-444"><a href="#L-444"><span class="linenos"> 444</span></a>        <span class="k">return</span> <span class="n">series</span>
</span><span id="L-445"><a href="#L-445"><span class="linenos"> 445</span></a>    
</span><span id="L-446"><a href="#L-446"><span class="linenos"> 446</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">custom_date_span</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_date</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;1900-01-01&quot;</span><span class="p">,</span> <span class="n">end_date</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">))</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="L-447"><a href="#L-447"><span class="linenos"> 447</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the date range on the active chart in the webdriver window. </span>
</span><span id="L-448"><a href="#L-448"><span class="linenos"> 448</span></a><span class="sd">        This is done by entering the start and end dates into the date range input boxes</span>
</span><span id="L-449"><a href="#L-449"><span class="linenos"> 449</span></a><span class="sd">        </span>
</span><span id="L-450"><a href="#L-450"><span class="linenos"> 450</span></a><span class="sd">        Args:</span>
</span><span id="L-451"><a href="#L-451"><span class="linenos"> 451</span></a><span class="sd">            start_date (str): Start date in format YYYY-MM-DD</span>
</span><span id="L-452"><a href="#L-452"><span class="linenos"> 452</span></a><span class="sd">            end_date (str): End date in format YYYY-MM-DD</span>
</span><span id="L-453"><a href="#L-453"><span class="linenos"> 453</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-454"><a href="#L-454"><span class="linenos"> 454</span></a>
</span><span id="L-455"><a href="#L-455"><span class="linenos"> 455</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">click_button</span><span class="p">(</span><span class="s2">&quot;#dateInputsToggle&quot;</span><span class="p">):</span>
</span><span id="L-456"><a href="#L-456"><span class="linenos"> 456</span></a>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
</span><span id="L-457"><a href="#L-457"><span class="linenos"> 457</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="L-458"><a href="#L-458"><span class="linenos"> 458</span></a>                <span class="c1"># Find elements</span>
</span><span id="L-459"><a href="#L-459"><span class="linenos"> 459</span></a>                <span class="n">start_input</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wait</span><span class="o">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="o">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">ID</span><span class="p">,</span> <span class="s2">&quot;d1&quot;</span><span class="p">)))</span>
</span><span id="L-460"><a href="#L-460"><span class="linenos"> 460</span></a>                <span class="n">end_input</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wait</span><span class="o">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="o">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">ID</span><span class="p">,</span> <span class="s2">&quot;d2&quot;</span><span class="p">)))</span>
</span><span id="L-461"><a href="#L-461"><span class="linenos"> 461</span></a>                
</span><span id="L-462"><a href="#L-462"><span class="linenos"> 462</span></a>                <span class="c1"># Clear existing text</span>
</span><span id="L-463"><a href="#L-463"><span class="linenos"> 463</span></a>                <span class="n">start_input</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</span><span id="L-464"><a href="#L-464"><span class="linenos"> 464</span></a>                <span class="n">end_input</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</span><span id="L-465"><a href="#L-465"><span class="linenos"> 465</span></a>                
</span><span id="L-466"><a href="#L-466"><span class="linenos"> 466</span></a>                <span class="c1"># Enter new dates</span>
</span><span id="L-467"><a href="#L-467"><span class="linenos"> 467</span></a>                <span class="n">start_input</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">start_date</span><span class="p">)</span>
</span><span id="L-468"><a href="#L-468"><span class="linenos"> 468</span></a>                <span class="n">end_input</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">end_date</span><span class="p">)</span>
</span><span id="L-469"><a href="#L-469"><span class="linenos"> 469</span></a>                
</span><span id="L-470"><a href="#L-470"><span class="linenos"> 470</span></a>                <span class="c1"># Press Enter to confirm</span>
</span><span id="L-471"><a href="#L-471"><span class="linenos"> 471</span></a>                <span class="n">end_input</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">Keys</span><span class="o">.</span><span class="n">RETURN</span><span class="p">)</span>
</span><span id="L-472"><a href="#L-472"><span class="linenos"> 472</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">date_span</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Custom&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;start_date&quot;</span><span class="p">:</span> <span class="n">start_date</span><span class="p">,</span> <span class="s2">&quot;end_date&quot;</span><span class="p">:</span> <span class="n">end_date</span><span class="p">}}</span>
</span><span id="L-473"><a href="#L-473"><span class="linenos"> 473</span></a>                <span class="k">return</span> <span class="kc">True</span>
</span><span id="L-474"><a href="#L-474"><span class="linenos"> 474</span></a>                
</span><span id="L-475"><a href="#L-475"><span class="linenos"> 475</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-476"><a href="#L-476"><span class="linenos"> 476</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to enter dates: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-477"><a href="#L-477"><span class="linenos"> 477</span></a>                <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-478"><a href="#L-478"><span class="linenos"> 478</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-479"><a href="#L-479"><span class="linenos"> 479</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Failed to open date range inputs&quot;</span><span class="p">)</span>
</span><span id="L-480"><a href="#L-480"><span class="linenos"> 480</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-481"><a href="#L-481"><span class="linenos"> 481</span></a>        
</span><span id="L-482"><a href="#L-482"><span class="linenos"> 482</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">custom_date_span_js</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_date</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;1900-01-01&quot;</span><span class="p">,</span> <span class="n">end_date</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">))</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="L-483"><a href="#L-483"><span class="linenos"> 483</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the date range on the active chart in the webdriver window using JavaScript.</span>
</span><span id="L-484"><a href="#L-484"><span class="linenos"> 484</span></a><span class="sd">        This is more reliable than using Selenium&#39;s send_keys and can avoid issues with focus.</span>
</span><span id="L-485"><a href="#L-485"><span class="linenos"> 485</span></a><span class="sd">        </span>
</span><span id="L-486"><a href="#L-486"><span class="linenos"> 486</span></a><span class="sd">        Args:</span>
</span><span id="L-487"><a href="#L-487"><span class="linenos"> 487</span></a><span class="sd">            start_date (str): Start date in format YYYY-MM-DD</span>
</span><span id="L-488"><a href="#L-488"><span class="linenos"> 488</span></a><span class="sd">            end_date (str): End date in format YYYY-MM-DD</span>
</span><span id="L-489"><a href="#L-489"><span class="linenos"> 489</span></a><span class="sd">            </span>
</span><span id="L-490"><a href="#L-490"><span class="linenos"> 490</span></a><span class="sd">        Returns:</span>
</span><span id="L-491"><a href="#L-491"><span class="linenos"> 491</span></a><span class="sd">            bool: True if successful, False otherwise</span>
</span><span id="L-492"><a href="#L-492"><span class="linenos"> 492</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-493"><a href="#L-493"><span class="linenos"> 493</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-494"><a href="#L-494"><span class="linenos"> 494</span></a>            <span class="c1"># Load JavaScript code from file</span>
</span><span id="L-495"><a href="#L-495"><span class="linenos"> 495</span></a>            <span class="n">js_file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">),</span> <span class="s1">&#39;custom_datespan.js&#39;</span><span class="p">)</span>
</span><span id="L-496"><a href="#L-496"><span class="linenos"> 496</span></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">js_file_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
</span><span id="L-497"><a href="#L-497"><span class="linenos"> 497</span></a>                <span class="n">js_code</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span><span id="L-498"><a href="#L-498"><span class="linenos"> 498</span></a>            
</span><span id="L-499"><a href="#L-499"><span class="linenos"> 499</span></a>            <span class="c1"># Execute the JavaScript with parameters</span>
</span><span id="L-500"><a href="#L-500"><span class="linenos"> 500</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">execute_async_script</span><span class="p">(</span><span class="n">js_code</span><span class="p">,</span> <span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">)</span>
</span><span id="L-501"><a href="#L-501"><span class="linenos"> 501</span></a>            
</span><span id="L-502"><a href="#L-502"><span class="linenos"> 502</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;success&#39;</span><span class="p">):</span>
</span><span id="L-503"><a href="#L-503"><span class="linenos"> 503</span></a>                <span class="c1"># Set date span in our object</span>
</span><span id="L-504"><a href="#L-504"><span class="linenos"> 504</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">date_span</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Custom&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;start_date&quot;</span><span class="p">:</span> <span class="n">start_date</span><span class="p">,</span> <span class="s2">&quot;end_date&quot;</span><span class="p">:</span> <span class="n">end_date</span><span class="p">}}</span>
</span><span id="L-505"><a href="#L-505"><span class="linenos"> 505</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">update_chart</span><span class="p">()</span>
</span><span id="L-506"><a href="#L-506"><span class="linenos"> 506</span></a>                
</span><span id="L-507"><a href="#L-507"><span class="linenos"> 507</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Date span set to custom range: </span><span class="si">{</span><span class="n">start_date</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">end_date</span><span class="si">}</span><span class="s2"> (using JavaScript)&quot;</span><span class="p">)</span>
</span><span id="L-508"><a href="#L-508"><span class="linenos"> 508</span></a>                <span class="k">return</span> <span class="kc">True</span>
</span><span id="L-509"><a href="#L-509"><span class="linenos"> 509</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-510"><a href="#L-510"><span class="linenos"> 510</span></a>                <span class="n">error_msg</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="s1">&#39;Unknown error&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="s1">&#39;Unknown error&#39;</span>
</span><span id="L-511"><a href="#L-511"><span class="linenos"> 511</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to set date span using JavaScript: </span><span class="si">{</span><span class="n">error_msg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-512"><a href="#L-512"><span class="linenos"> 512</span></a>                <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-513"><a href="#L-513"><span class="linenos"> 513</span></a>            
</span><span id="L-514"><a href="#L-514"><span class="linenos"> 514</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-515"><a href="#L-515"><span class="linenos"> 515</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error executing custom_date_span_js: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-516"><a href="#L-516"><span class="linenos"> 516</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-517"><a href="#L-517"><span class="linenos"> 517</span></a>    
</span><span id="L-518"><a href="#L-518"><span class="linenos"> 518</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_datamax_min</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-519"><a href="#L-519"><span class="linenos"> 519</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the max and min data values for the series using y-axis values... This is deprecated and not used in the current version of the code.&quot;&quot;&quot;</span>
</span><span id="L-520"><a href="#L-520"><span class="linenos"> 520</span></a>        
</span><span id="L-521"><a href="#L-521"><span class="linenos"> 521</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;get_datamax_min method, axisY0 = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">y_axis</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">, axisY1 = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">y_axis</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-522"><a href="#L-522"><span class="linenos"> 522</span></a>        <span class="n">px_range</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_axis</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_axis</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-523"><a href="#L-523"><span class="linenos"> 523</span></a>        <span class="n">labrange</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_axis</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_axis</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-524"><a href="#L-524"><span class="linenos"> 524</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">unit_per_pix_alt2</span> <span class="o">=</span> <span class="n">labrange</span><span class="o">/</span><span class="n">px_range</span>
</span><span id="L-525"><a href="#L-525"><span class="linenos"> 525</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;unit_per_pix: &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit_per_pix</span><span class="p">)</span>
</span><span id="L-526"><a href="#L-526"><span class="linenos"> 526</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;unit_per_pix: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">unit_per_pix</span><span class="si">}</span><span class="s2">, alt2: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">unit_per_pix_alt2</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-527"><a href="#L-527"><span class="linenos"> 527</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">datamax</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_axis</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_axis</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">max</span><span class="p">())</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">unit_per_pix</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</span><span id="L-528"><a href="#L-528"><span class="linenos"> 528</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">datamin</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_axis</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">y_axis</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">unit_per_pix</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</span><span id="L-529"><a href="#L-529"><span class="linenos"> 529</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;datamax: &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">datamax</span><span class="p">,</span> <span class="s2">&quot;datamin: &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">datamin</span><span class="p">)</span>
</span><span id="L-530"><a href="#L-530"><span class="linenos"> 530</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;datamax: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">datamax</span><span class="si">}</span><span class="s2">, datamin: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">datamin</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-531"><a href="#L-531"><span class="linenos"> 531</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datamax</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">datamin</span>
</span><span id="L-532"><a href="#L-532"><span class="linenos"> 532</span></a>    
</span><span id="L-533"><a href="#L-533"><span class="linenos"> 533</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">scale_series</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">right_way_up</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
</span><span id="L-534"><a href="#L-534"><span class="linenos"> 534</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Scale the series using the first and last values from the series pulled from the tooltip box. Uses the y axis limits and the max and min of the y axis</span>
</span><span id="L-535"><a href="#L-535"><span class="linenos"> 535</span></a><span class="sd">        to determine the scaling factor to convert pixel co-ordinates to data values. The scaling factor is stored in the self.axlims_upp attribute.&quot;&quot;&quot;</span>
</span><span id="L-536"><a href="#L-536"><span class="linenos"> 536</span></a>
</span><span id="L-537"><a href="#L-537"><span class="linenos"> 537</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">right_way_up</span><span class="p">:</span>
</span><span id="L-538"><a href="#L-538"><span class="linenos"> 538</span></a>            <span class="n">max_val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_axis</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>  <span class="c1"># This should be the top pixel of the chart.</span>
</span><span id="L-539"><a href="#L-539"><span class="linenos"> 539</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">series</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">invert_series</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="p">,</span> <span class="n">max_val</span> <span class="o">=</span> <span class="n">max_val</span><span class="p">)</span>
</span><span id="L-540"><a href="#L-540"><span class="linenos"> 540</span></a>            
</span><span id="L-541"><a href="#L-541"><span class="linenos"> 541</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;axis_limits&quot;</span><span class="p">):</span>
</span><span id="L-542"><a href="#L-542"><span class="linenos"> 542</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">axis_limits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_axis_limits</span><span class="p">()</span>
</span><span id="L-543"><a href="#L-543"><span class="linenos"> 543</span></a>        <span class="n">ymin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis_limits</span><span class="p">[</span><span class="s1">&#39;y_min&#39;</span><span class="p">];</span> <span class="n">ymax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis_limits</span><span class="p">[</span><span class="s1">&#39;y_max&#39;</span><span class="p">]</span>
</span><span id="L-544"><a href="#L-544"><span class="linenos"> 544</span></a>        <span class="c1">## Turns out that this formulation below is the best way to calculate the scaling factor for the chart.</span>
</span><span id="L-545"><a href="#L-545"><span class="linenos"> 545</span></a>        <span class="n">unit_range</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_axis</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_axis</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-546"><a href="#L-546"><span class="linenos"> 546</span></a>        <span class="n">pxrange</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_axis</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_axis</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-547"><a href="#L-547"><span class="linenos"> 547</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">axlims_upp</span> <span class="o">=</span> <span class="n">unit_range</span><span class="o">/</span><span class="n">pxrange</span>
</span><span id="L-548"><a href="#L-548"><span class="linenos"> 548</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unit per pix forumlation, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">y_axis</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">y_axis</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">unit_range</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">pxrange</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">ymax</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">ymin</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">axlims_upp</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-549"><a href="#L-549"><span class="linenos"> 549</span></a>
</span><span id="L-550"><a href="#L-550"><span class="linenos"> 550</span></a>        <span class="c1"># if the start and end points are at similar values this will be problematic though. </span>
</span><span id="L-551"><a href="#L-551"><span class="linenos"> 551</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Scale series method:  </span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="L-552"><a href="#L-552"><span class="linenos"> 552</span></a>                        <span class="sa">f</span><span class="s2">&quot;unit_per_pix calculated from the y axis ticks: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">unit_per_pix</span><span class="si">}</span><span class="s2">, </span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="L-553"><a href="#L-553"><span class="linenos"> 553</span></a>                        <span class="sa">f</span><span class="s2">&quot;unit_per_pix from axis limits and self.y_axis (probably best way): </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">axlims_upp</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="L-554"><a href="#L-554"><span class="linenos"> 554</span></a>                        <span class="sa">f</span><span class="s2">&quot;yaxis top tick: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">y_axis</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">, yaxis bot tick: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">y_axis</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="L-555"><a href="#L-555"><span class="linenos"> 555</span></a>                        <span class="sa">f</span><span class="s2">&quot;axis_limits: </span><span class="si">{</span><span class="n">ymin</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">ymax</span><span class="si">}</span><span class="s2">, y-axis series min &amp; max pixel values: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">y_axis</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">y_axis</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-556"><a href="#L-556"><span class="linenos"> 556</span></a>
</span><span id="L-557"><a href="#L-557"><span class="linenos"> 557</span></a>        <span class="c1">##Does the Y axis cross zero? Where is the zero point??</span>
</span><span id="L-558"><a href="#L-558"><span class="linenos"> 558</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">x_intercept_px</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">find_zero_crossing</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_axis</span><span class="p">)</span>
</span><span id="L-559"><a href="#L-559"><span class="linenos"> 559</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Series crosses zero, x-axis should be at about pixel y-cordinate: &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_intercept_px</span><span class="p">)</span>
</span><span id="L-560"><a href="#L-560"><span class="linenos"> 560</span></a>
</span><span id="L-561"><a href="#L-561"><span class="linenos"> 561</span></a>        <span class="n">unscaled</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unscaled_series</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-562"><a href="#L-562"><span class="linenos"> 562</span></a>        <span class="c1"># Calculate the series in vector fashion</span>
</span><span id="L-563"><a href="#L-563"><span class="linenos"> 563</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">series</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_axis</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">unscaled</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">axlims_upp</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_axis</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-564"><a href="#L-564"><span class="linenos"> 564</span></a>
</span><span id="L-565"><a href="#L-565"><span class="linenos"> 565</span></a>        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;metadata&quot;</span><span class="p">):</span>
</span><span id="L-566"><a href="#L-566"><span class="linenos"> 566</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;start_date&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-567"><a href="#L-567"><span class="linenos"> 567</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;end_date&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-568"><a href="#L-568"><span class="linenos"> 568</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;min_value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
</span><span id="L-569"><a href="#L-569"><span class="linenos"> 569</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;max_value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
</span><span id="L-570"><a href="#L-570"><span class="linenos"> 570</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;length&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="p">)</span>
</span><span id="L-571"><a href="#L-571"><span class="linenos"> 571</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">series_metadata</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">)</span>
</span><span id="L-572"><a href="#L-572"><span class="linenos"> 572</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-573"><a href="#L-573"><span class="linenos"> 573</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;start_end not found, run get_datamax_min() first.&quot;</span><span class="p">)</span>
</span><span id="L-574"><a href="#L-574"><span class="linenos"> 574</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;start_end not found, run get_datamax_min() first.&quot;</span><span class="p">)</span>
</span><span id="L-575"><a href="#L-575"><span class="linenos"> 575</span></a>            <span class="k">return</span>
</span><span id="L-576"><a href="#L-576"><span class="linenos"> 576</span></a>
</span><span id="L-577"><a href="#L-577"><span class="linenos"> 577</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">series</span>
</span><span id="L-578"><a href="#L-578"><span class="linenos"> 578</span></a>    
</span><span id="L-579"><a href="#L-579"><span class="linenos"> 579</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_chart_dims</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-580"><a href="#L-580"><span class="linenos"> 580</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get dimensions of chart and plotting area&quot;&quot;&quot;</span>
</span><span id="L-581"><a href="#L-581"><span class="linenos"> 581</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-582"><a href="#L-582"><span class="linenos"> 582</span></a>            <span class="c1"># Ensure full_chart is WebElement</span>
</span><span id="L-583"><a href="#L-583"><span class="linenos"> 583</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">chart_element</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s2">&quot;#chart&quot;</span><span class="p">)</span>
</span><span id="L-584"><a href="#L-584"><span class="linenos"> 584</span></a>            <span class="c1"># Get overall chart dimensions</span>
</span><span id="L-585"><a href="#L-585"><span class="linenos"> 585</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">chart_rect</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">v</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_element</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
</span><span id="L-586"><a href="#L-586"><span class="linenos"> 586</span></a>            
</span><span id="L-587"><a href="#L-587"><span class="linenos"> 587</span></a>            <span class="c1"># Get plot area dimensions</span>
</span><span id="L-588"><a href="#L-588"><span class="linenos"> 588</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">plot_background</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s1">&#39;.highcharts-plot-background&#39;</span><span class="p">)</span>
</span><span id="L-589"><a href="#L-589"><span class="linenos"> 589</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">axes_rect</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">v</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_background</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
</span><span id="L-590"><a href="#L-590"><span class="linenos"> 590</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">chart_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes_rect</span><span class="p">[</span><span class="s2">&quot;width&quot;</span><span class="p">]</span>
</span><span id="L-591"><a href="#L-591"><span class="linenos"> 591</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">chart_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes_rect</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">]</span>
</span><span id="L-592"><a href="#L-592"><span class="linenos"> 592</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="L-593"><a href="#L-593"><span class="linenos"> 593</span></a>        
</span><span id="L-594"><a href="#L-594"><span class="linenos"> 594</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-595"><a href="#L-595"><span class="linenos"> 595</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to get chart dimensions: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-596"><a href="#L-596"><span class="linenos"> 596</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to get chart dimensions: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-597"><a href="#L-597"><span class="linenos"> 597</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-598"><a href="#L-598"><span class="linenos"> 598</span></a>    
</span><span id="L-599"><a href="#L-599"><span class="linenos"> 599</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_xlims_from_tooltips</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">set_max_datespan</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
</span><span id="L-600"><a href="#L-600"><span class="linenos"> 600</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; Use the TooltipScraper class to get the start and end dates and some other points of the time series using the tooltip box displayed on the chart.</span>
</span><span id="L-601"><a href="#L-601"><span class="linenos"> 601</span></a><span class="sd">        Takes the latest num_points points from the chart and uses them to determine the frequency of the time series. The latest data is used</span>
</span><span id="L-602"><a href="#L-602"><span class="linenos"> 602</span></a><span class="sd">        in case the earlier data is of lower frequency which can sometimes occurr.</span>
</span><span id="L-603"><a href="#L-603"><span class="linenos"> 603</span></a><span class="sd">        </span>
</span><span id="L-604"><a href="#L-604"><span class="linenos"> 604</span></a><span class="sd">        **Parameters:**</span>
</span><span id="L-605"><a href="#L-605"><span class="linenos"> 605</span></a><span class="sd">        </span>
</span><span id="L-606"><a href="#L-606"><span class="linenos"> 606</span></a><span class="sd">        - force_rerun (bool): Whether to force a rerun of the method to get the start and end dates and frequency of the time series again. The method</span>
</span><span id="L-607"><a href="#L-607"><span class="linenos"> 607</span></a><span class="sd">        will not run again by default if done a second time and start_end and frequency attributes are already set. If the first run resulted in erroneous</span>
</span><span id="L-608"><a href="#L-608"><span class="linenos"> 608</span></a><span class="sd">        assignation of these attributes, set this to True to rerun the method. However, something may need to be changed if it is not working...&quot;&quot;&quot;</span>
</span><span id="L-609"><a href="#L-609"><span class="linenos"> 609</span></a>
</span><span id="L-610"><a href="#L-610"><span class="linenos"> 610</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;get_xlims_from_tooltips method: date_span: &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">date_span</span><span class="p">,</span> <span class="s2">&quot;, chart_type:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span><span class="p">)</span>
</span><span id="L-611"><a href="#L-611"><span class="linenos"> 611</span></a>
</span><span id="L-612"><a href="#L-612"><span class="linenos"> 612</span></a>        <span class="k">if</span> <span class="n">set_max_datespan</span><span class="p">:</span>
</span><span id="L-613"><a href="#L-613"><span class="linenos"> 613</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">set_max_date_span_viaCalendar</span><span class="p">()</span>  <span class="c1">##Set date_span to MAX for start and end date pull...</span>
</span><span id="L-614"><a href="#L-614"><span class="linenos"> 614</span></a>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
</span><span id="L-615"><a href="#L-615"><span class="linenos"> 615</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">update_chart</span><span class="p">()</span>
</span><span id="L-616"><a href="#L-616"><span class="linenos"> 616</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">set_chartType_js</span><span class="p">(</span><span class="s2">&quot;Spline&quot;</span><span class="p">)</span> <span class="c1">#Force spline chart selection - very important. I still have no way to determine if the chart type has changed when it changes automatically.</span>
</span><span id="L-617"><a href="#L-617"><span class="linenos"> 617</span></a>        <span class="c1">#Chart type must be spline or line for this to work. Sometimes the chart_type chnages automatically when datespan is altered.</span>
</span><span id="L-618"><a href="#L-618"><span class="linenos"> 618</span></a>
</span><span id="L-619"><a href="#L-619"><span class="linenos"> 619</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;tooltip_scraper&quot;</span><span class="p">):</span>
</span><span id="L-620"><a href="#L-620"><span class="linenos"> 620</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">tooltip_scraper</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">TooltipScraper</span><span class="p">(</span><span class="n">parent_instance</span> <span class="o">=</span> <span class="bp">self</span><span class="p">)</span> <span class="c1"># Create a tooltip scraper child object</span>
</span><span id="L-621"><a href="#L-621"><span class="linenos"> 621</span></a>        
</span><span id="L-622"><a href="#L-622"><span class="linenos"> 622</span></a>        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-623"><a href="#L-623"><span class="linenos"> 623</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">start_end</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tooltip_scraper</span><span class="o">.</span><span class="n">first_last_dates</span><span class="p">()</span>
</span><span id="L-624"><a href="#L-624"><span class="linenos"> 624</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_end</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">pd</span><span class="o">.</span><span class="n">isna</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_end</span><span class="p">[</span><span class="s2">&quot;start_date&quot;</span><span class="p">])</span> <span class="ow">or</span> <span class="n">pd</span><span class="o">.</span><span class="n">isna</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_end</span><span class="p">[</span><span class="s2">&quot;end_date&quot;</span><span class="p">]):</span>
</span><span id="L-625"><a href="#L-625"><span class="linenos"> 625</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">start_end</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tooltip_scraper</span><span class="o">.</span><span class="n">first_last_dates</span><span class="p">()</span>
</span><span id="L-626"><a href="#L-626"><span class="linenos"> 626</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Start and end dates scraped from tooltips: &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_end</span><span class="p">)</span>
</span><span id="L-627"><a href="#L-627"><span class="linenos"> 627</span></a>        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;metadata&quot;</span><span class="p">):</span>
</span><span id="L-628"><a href="#L-628"><span class="linenos"> 628</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;unit_tooltips&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_end</span><span class="p">[</span><span class="s2">&quot;unit_str&quot;</span><span class="p">]</span>
</span><span id="L-629"><a href="#L-629"><span class="linenos"> 629</span></a>
</span><span id="L-630"><a href="#L-630"><span class="linenos"> 630</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">make_x_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
</span><span id="L-631"><a href="#L-631"><span class="linenos"> 631</span></a>                     <span class="n">force_rerun_xlims</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-632"><a href="#L-632"><span class="linenos"> 632</span></a>                     <span class="n">force_rerun_freqdet</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
</span><span id="L-633"><a href="#L-633"><span class="linenos"> 633</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Make the DateTime Index for the series using the start and end dates scraped from the tooltips. </span>
</span><span id="L-634"><a href="#L-634"><span class="linenos"> 634</span></a><span class="sd">        This uses Selenium and also scrapes the some of the latest datapoints from the tooltips on the chart in order to determine</span>
</span><span id="L-635"><a href="#L-635"><span class="linenos"> 635</span></a><span class="sd">        the frequency of the time series. It will take a bit of time to run.</span>
</span><span id="L-636"><a href="#L-636"><span class="linenos"> 636</span></a>
</span><span id="L-637"><a href="#L-637"><span class="linenos"> 637</span></a><span class="sd">        **Parameters:**</span>
</span><span id="L-638"><a href="#L-638"><span class="linenos"> 638</span></a><span class="sd">        - force_rerun_xlims (bool): Whether to force a rerun of the method to get the start and end dates and frequency of the time series again. The method</span>
</span><span id="L-639"><a href="#L-639"><span class="linenos"> 639</span></a><span class="sd">        will not run again by default if done a second time and start_end and frequency attributes are already set. </span>
</span><span id="L-640"><a href="#L-640"><span class="linenos"> 640</span></a><span class="sd">        - force_rerun_freqdet (bool): Whether to force a rerun of the method to get the frequency of the time series again. The method</span>
</span><span id="L-641"><a href="#L-641"><span class="linenos"> 641</span></a><span class="sd">        will not run again by default if done a second time and frequency attribute is already set. </span>
</span><span id="L-642"><a href="#L-642"><span class="linenos"> 642</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-643"><a href="#L-643"><span class="linenos"> 643</span></a>        
</span><span id="L-644"><a href="#L-644"><span class="linenos"> 644</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;tooltip_scraper&quot;</span><span class="p">):</span>  <span class="c1"># If the tooltip scraper object is not already created, create it.</span>
</span><span id="L-645"><a href="#L-645"><span class="linenos"> 645</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">tooltip_scraper</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">TooltipScraper</span><span class="p">(</span><span class="n">parent_instance</span> <span class="o">=</span> <span class="bp">self</span><span class="p">)</span> <span class="c1"># Create a tooltip scraper child object</span>
</span><span id="L-646"><a href="#L-646"><span class="linenos"> 646</span></a>
</span><span id="L-647"><a href="#L-647"><span class="linenos"> 647</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Using selenium and tooltip scraping to construct the date time index for the time-series, this&#39;ll take a bit...&quot;</span><span class="p">)</span>
</span><span id="L-648"><a href="#L-648"><span class="linenos"> 648</span></a>        <span class="c1">## Get the latest 10 or so points from the chart, date and value from tooltips, in order to determine the frequency of the time series.</span>
</span><span id="L-649"><a href="#L-649"><span class="linenos"> 649</span></a>        <span class="k">if</span> <span class="n">force_rerun_freqdet</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;latest_points&quot;</span><span class="p">):</span>
</span><span id="L-650"><a href="#L-650"><span class="linenos"> 650</span></a>            <span class="c1">#datapoints = self.tooltip_scraper.get_latest_points(num_points = 5)  # Python version, slow</span>
</span><span id="L-651"><a href="#L-651"><span class="linenos"> 651</span></a>            <span class="n">datapoints</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tooltip_scraper</span><span class="o">.</span><span class="n">latest_points_js</span><span class="p">(</span><span class="n">num_points</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>  <span class="c1"># js version, faster</span>
</span><span id="L-652"><a href="#L-652"><span class="linenos"> 652</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">latest_points</span> <span class="o">=</span> <span class="n">datapoints</span>
</span><span id="L-653"><a href="#L-653"><span class="linenos"> 653</span></a>            <span class="c1"># Convert metric prefixes for the values in each datapoint</span>
</span><span id="L-654"><a href="#L-654"><span class="linenos"> 654</span></a>            <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">latest_points</span><span class="p">:</span>
</span><span id="L-655"><a href="#L-655"><span class="linenos"> 655</span></a>                <span class="n">point</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">extract_and_convert_value</span><span class="p">(</span><span class="n">point</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-656"><a href="#L-656"><span class="linenos"> 656</span></a>                <span class="n">point</span><span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">ready_datestr</span><span class="p">(</span><span class="n">point</span><span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">])</span>
</span><span id="L-657"><a href="#L-657"><span class="linenos"> 657</span></a>            <span class="n">latest_dates</span> <span class="o">=</span> <span class="p">[</span><span class="n">point</span><span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">datapoints</span><span class="p">]</span>
</span><span id="L-658"><a href="#L-658"><span class="linenos"> 658</span></a>            <span class="c1">#print(&quot;Latest dates: &quot;, latest_dates)</span>
</span><span id="L-659"><a href="#L-659"><span class="linenos"> 659</span></a>
</span><span id="L-660"><a href="#L-660"><span class="linenos"> 660</span></a>            <span class="c1">## Get the frequency of the time series</span>
</span><span id="L-661"><a href="#L-661"><span class="linenos"> 661</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">date_series</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">latest_dates</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;datetime64[ns]&quot;</span><span class="p">)</span>
</span><span id="L-662"><a href="#L-662"><span class="linenos"> 662</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">get_date_frequency</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">date_series</span><span class="p">)</span>
</span><span id="L-663"><a href="#L-663"><span class="linenos"> 663</span></a>            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;metadata&quot;</span><span class="p">):</span>
</span><span id="L-664"><a href="#L-664"><span class="linenos"> 664</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;frequency&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span>
</span><span id="L-665"><a href="#L-665"><span class="linenos"> 665</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Frequency of time-series: &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="p">)</span>
</span><span id="L-666"><a href="#L-666"><span class="linenos"> 666</span></a>
</span><span id="L-667"><a href="#L-667"><span class="linenos"> 667</span></a>        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.25</span><span class="p">)</span>
</span><span id="L-668"><a href="#L-668"><span class="linenos"> 668</span></a>
</span><span id="L-669"><a href="#L-669"><span class="linenos"> 669</span></a>        <span class="k">if</span> <span class="n">force_rerun_xlims</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;start_end&quot;</span><span class="p">):</span>
</span><span id="L-670"><a href="#L-670"><span class="linenos"> 670</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">start_end</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-671"><a href="#L-671"><span class="linenos"> 671</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">set_max_date_span_viaCalendar</span><span class="p">()</span>  <span class="c1">##Set date_span to MAX for start and end date pull...</span>
</span><span id="L-672"><a href="#L-672"><span class="linenos"> 672</span></a>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.25</span><span class="p">)</span>
</span><span id="L-673"><a href="#L-673"><span class="linenos"> 673</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">set_chartType_js</span><span class="p">(</span><span class="s2">&quot;Spline&quot;</span><span class="p">)</span> <span class="c1">#Force spline chart selection - very important. I still have no way to determine if the chart type has changed when it changes automatically.</span>
</span><span id="L-674"><a href="#L-674"><span class="linenos"> 674</span></a>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.25</span><span class="p">)</span>
</span><span id="L-675"><a href="#L-675"><span class="linenos"> 675</span></a>            <span class="n">retries</span> <span class="o">=</span> <span class="mi">3</span>
</span><span id="L-676"><a href="#L-676"><span class="linenos"> 676</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">retries</span><span class="p">):</span>
</span><span id="L-677"><a href="#L-677"><span class="linenos"> 677</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">start_end</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tooltip_scraper</span><span class="o">.</span><span class="n">first_last_dates_js</span><span class="p">()</span>
</span><span id="L-678"><a href="#L-678"><span class="linenos"> 678</span></a>                <span class="c1"># Check if start_end is None or if any of the four essential keys have None/NaN values</span>
</span><span id="L-679"><a href="#L-679"><span class="linenos"> 679</span></a>                <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_end</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> 
</span><span id="L-680"><a href="#L-680"><span class="linenos"> 680</span></a>                    <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_end</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;start_date&quot;</span><span class="p">,</span> <span class="s2">&quot;end_date&quot;</span><span class="p">])</span> <span class="ow">or</span>
</span><span id="L-681"><a href="#L-681"><span class="linenos"> 681</span></a>                    <span class="nb">any</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">isna</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_end</span><span class="p">[</span><span class="n">key</span><span class="p">])</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;start_date&quot;</span><span class="p">,</span> <span class="s2">&quot;end_date&quot;</span><span class="p">]))</span>\
</span><span id="L-682"><a href="#L-682"><span class="linenos"> 682</span></a>                    <span class="ow">or</span> <span class="nb">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_end</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;start_date&quot;</span><span class="p">,</span> <span class="s2">&quot;end_date&quot;</span><span class="p">]):</span>
</span><span id="L-683"><a href="#L-683"><span class="linenos"> 683</span></a>                    <span class="c1">#print(&quot;Retrying start_end extraction...&quot;)</span>
</span><span id="L-684"><a href="#L-684"><span class="linenos"> 684</span></a>                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.25</span><span class="p">)</span>
</span><span id="L-685"><a href="#L-685"><span class="linenos"> 685</span></a>                    <span class="k">pass</span>
</span><span id="L-686"><a href="#L-686"><span class="linenos"> 686</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-687"><a href="#L-687"><span class="linenos"> 687</span></a>                    <span class="k">break</span>
</span><span id="L-688"><a href="#L-688"><span class="linenos"> 688</span></a>            <span class="c1">#For some reason running it twice seems to work better...</span>
</span><span id="L-689"><a href="#L-689"><span class="linenos"> 689</span></a>
</span><span id="L-690"><a href="#L-690"><span class="linenos"> 690</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_end</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-691"><a href="#L-691"><span class="linenos"> 691</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Start and end values scraped from tooltips: </span><span class="se">\n</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">start_end</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-692"><a href="#L-692"><span class="linenos"> 692</span></a>                <span class="n">start_date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_end</span><span class="p">[</span><span class="s2">&quot;start_date&quot;</span><span class="p">];</span> <span class="n">end_date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_end</span><span class="p">[</span><span class="s2">&quot;end_date&quot;</span><span class="p">]</span>
</span><span id="L-693"><a href="#L-693"><span class="linenos"> 693</span></a>                <span class="n">dtIndex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtIndex</span><span class="p">(</span><span class="n">start_date</span><span class="o">=</span><span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="o">=</span><span class="n">end_date</span><span class="p">,</span> <span class="n">ser_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">])</span>
</span><span id="L-694"><a href="#L-694"><span class="linenos"> 694</span></a>                <span class="k">if</span> <span class="n">dtIndex</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-695"><a href="#L-695"><span class="linenos"> 695</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DateTimeIndex created successfully for the time-series.&quot;</span><span class="p">)</span>
</span><span id="L-696"><a href="#L-696"><span class="linenos"> 696</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">x_index</span> <span class="o">=</span> <span class="n">dtIndex</span>
</span><span id="L-697"><a href="#L-697"><span class="linenos"> 697</span></a>                    <span class="k">return</span> <span class="n">dtIndex</span>  
</span><span id="L-698"><a href="#L-698"><span class="linenos"> 698</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-699"><a href="#L-699"><span class="linenos"> 699</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error creating DateTimeIndex for the time-series.&quot;</span><span class="p">)</span>
</span><span id="L-700"><a href="#L-700"><span class="linenos"> 700</span></a>                    <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-701"><a href="#L-701"><span class="linenos"> 701</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-702"><a href="#L-702"><span class="linenos"> 702</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error: Start and end values not found...pulling out....&quot;</span><span class="p">)</span>
</span><span id="L-703"><a href="#L-703"><span class="linenos"> 703</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error: Start and end values not found...pulling out....&quot;</span><span class="p">)</span>
</span><span id="L-704"><a href="#L-704"><span class="linenos"> 704</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-705"><a href="#L-705"><span class="linenos"> 705</span></a>    
</span><span id="L-706"><a href="#L-706"><span class="linenos"> 706</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_earliest_points</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_points</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;all&quot;</span><span class="p">,</span> <span class="n">num_years</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">):</span>
</span><span id="L-707"><a href="#L-707"><span class="linenos"> 707</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the earliest data points from the chart using the cursor, use this to check for series that have differing frequency</span>
</span><span id="L-708"><a href="#L-708"><span class="linenos"> 708</span></a><span class="sd">        at start and end.&quot;&quot;&quot;</span>
</span><span id="L-709"><a href="#L-709"><span class="linenos"> 709</span></a>
</span><span id="L-710"><a href="#L-710"><span class="linenos"> 710</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;start_end&quot;</span><span class="p">):</span>
</span><span id="L-711"><a href="#L-711"><span class="linenos"> 711</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">get_xlims_from_tooltips</span><span class="p">()</span>
</span><span id="L-712"><a href="#L-712"><span class="linenos"> 712</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;tooltip_scraper&quot;</span><span class="p">):</span>
</span><span id="L-713"><a href="#L-713"><span class="linenos"> 713</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">tooltip_scraper</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">TooltipScraper</span><span class="p">(</span><span class="n">parent_instance</span> <span class="o">=</span> <span class="bp">self</span><span class="p">)</span>
</span><span id="L-714"><a href="#L-714"><span class="linenos"> 714</span></a>        
</span><span id="L-715"><a href="#L-715"><span class="linenos"> 715</span></a>        <span class="n">yearslater</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">n_years_later</span><span class="p">(</span><span class="n">date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_end</span><span class="p">[</span><span class="s2">&quot;start_date&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">),</span> <span class="n">n_years</span> <span class="o">=</span> <span class="n">num_years</span><span class="p">)</span>
</span><span id="L-716"><a href="#L-716"><span class="linenos"> 716</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">custom_date_span_js</span><span class="p">(</span><span class="n">start_date</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">start_end</span><span class="p">[</span><span class="s2">&quot;start_date&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">),</span> <span class="n">end_date</span> <span class="o">=</span> <span class="n">yearslater</span><span class="p">)</span>
</span><span id="L-717"><a href="#L-717"><span class="linenos"> 717</span></a>
</span><span id="L-718"><a href="#L-718"><span class="linenos"> 718</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-719"><a href="#L-719"><span class="linenos"> 719</span></a>            <span class="n">datapoints</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tooltip_scraper</span><span class="o">.</span><span class="n">latest_points_js</span><span class="p">(</span><span class="n">num_points</span><span class="o">=</span><span class="n">num_points</span><span class="p">,</span> <span class="n">force_shortest_span</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">wait_time</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</span><span id="L-720"><a href="#L-720"><span class="linenos"> 720</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">early_series</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="n">utils</span><span class="o">.</span><span class="n">extract_and_convert_value</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">datapoints</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> \
</span><span id="L-721"><a href="#L-721"><span class="linenos"> 721</span></a>                                    <span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">([</span><span class="n">utils</span><span class="o">.</span><span class="n">ready_datestr</span><span class="p">(</span><span class="n">date</span><span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">])</span> <span class="k">for</span> <span class="n">date</span> <span class="ow">in</span> <span class="n">datapoints</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
</span><span id="L-722"><a href="#L-722"><span class="linenos"> 722</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-723"><a href="#L-723"><span class="linenos"> 723</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Error getting earliest points: &quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="L-724"><a href="#L-724"><span class="linenos"> 724</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-725"><a href="#L-725"><span class="linenos"> 725</span></a>
</span><span id="L-726"><a href="#L-726"><span class="linenos"> 726</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">early_series</span>
</span><span id="L-727"><a href="#L-727"><span class="linenos"> 727</span></a>
</span><span id="L-728"><a href="#L-728"><span class="linenos"> 728</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">full_series_fromTooltips</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">set_max_datespan</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="L-729"><a href="#L-729"><span class="linenos"> 729</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Scrape the full series from the dates and values displayed on the tooltips as the cursor is dragged across the chart. Uses javscript to handle the cursor </span>
</span><span id="L-730"><a href="#L-730"><span class="linenos"> 730</span></a><span class="sd">        movement and tooltip retrieval and parsing. This is way faster than using a python loop. I suspect this may end up missing some points for series that </span>
</span><span id="L-731"><a href="#L-731"><span class="linenos"> 731</span></a><span class="sd">        have many datapoints. However, it has worked for all series tested thus far. Assigns the resultant series to the series attribute.</span>
</span><span id="L-732"><a href="#L-732"><span class="linenos"> 732</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-733"><a href="#L-733"><span class="linenos"> 733</span></a>
</span><span id="L-734"><a href="#L-734"><span class="linenos"> 734</span></a>        <span class="k">if</span> <span class="n">set_max_datespan</span><span class="p">:</span>
</span><span id="L-735"><a href="#L-735"><span class="linenos"> 735</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Setting max date span using calendar...&quot;</span><span class="p">)</span>
</span><span id="L-736"><a href="#L-736"><span class="linenos"> 736</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">set_max_date_span_viaCalendar</span><span class="p">()</span>
</span><span id="L-737"><a href="#L-737"><span class="linenos"> 737</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">set_chartType_js</span><span class="p">(</span><span class="s2">&quot;Spline&quot;</span><span class="p">)</span> <span class="c1"># Force spline chart type so that Y position of cursor does not matter for tooltip retrieval.</span>
</span><span id="L-738"><a href="#L-738"><span class="linenos"> 738</span></a>
</span><span id="L-739"><a href="#L-739"><span class="linenos"> 739</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;tooltip_scraper&quot;</span><span class="p">):</span>
</span><span id="L-740"><a href="#L-740"><span class="linenos"> 740</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">init_tooltipScraper</span><span class="p">()</span>  <span class="c1">## Initialize the tooltip scraper.</span>
</span><span id="L-741"><a href="#L-741"><span class="linenos"> 741</span></a>        <span class="c1">## Javascript based method here.</span>
</span><span id="L-742"><a href="#L-742"><span class="linenos"> 742</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-743"><a href="#L-743"><span class="linenos"> 743</span></a>            <span class="n">datapoints</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tooltip_scraper</span><span class="o">.</span><span class="n">latest_points_js</span><span class="p">(</span><span class="n">num_points</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">,</span> <span class="n">force_shortest_span</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">wait_time</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</span><span id="L-744"><a href="#L-744"><span class="linenos"> 744</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-745"><a href="#L-745"><span class="linenos"> 745</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Tooltip scraping of full series has failed, error: &quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="L-746"><a href="#L-746"><span class="linenos"> 746</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-747"><a href="#L-747"><span class="linenos"> 747</span></a>        <span class="c1">#Powerful one line pandas connversion...</span>
</span><span id="L-748"><a href="#L-748"><span class="linenos"> 748</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">series</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="n">utils</span><span class="o">.</span><span class="n">extract_and_convert_value</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">datapoints</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> \
</span><span id="L-749"><a href="#L-749"><span class="linenos"> 749</span></a>                                <span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">([</span><span class="n">utils</span><span class="o">.</span><span class="n">ready_datestr</span><span class="p">(</span><span class="n">date</span><span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">])</span> <span class="k">for</span> <span class="n">date</span> <span class="ow">in</span> <span class="n">datapoints</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
</span><span id="L-750"><a href="#L-750"><span class="linenos"> 750</span></a>
</span><span id="L-751"><a href="#L-751"><span class="linenos"> 751</span></a>        <span class="c1"># Add some more metadata about the series. </span>
</span><span id="L-752"><a href="#L-752"><span class="linenos"> 752</span></a>        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;metadata&quot;</span><span class="p">):</span>
</span><span id="L-753"><a href="#L-753"><span class="linenos"> 753</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;start_date&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-754"><a href="#L-754"><span class="linenos"> 754</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;end_date&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-755"><a href="#L-755"><span class="linenos"> 755</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;min_value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
</span><span id="L-756"><a href="#L-756"><span class="linenos"> 756</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;max_value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
</span><span id="L-757"><a href="#L-757"><span class="linenos"> 757</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;length&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="p">)</span>
</span><span id="L-758"><a href="#L-758"><span class="linenos"> 758</span></a>            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;frequency&quot;</span><span class="p">):</span>
</span><span id="L-759"><a href="#L-759"><span class="linenos"> 759</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;frequency&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span>
</span><span id="L-760"><a href="#L-760"><span class="linenos"> 760</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-761"><a href="#L-761"><span class="linenos"> 761</span></a>                <span class="n">freq</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">infer_freq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="c1"># Infer the frequency of the series.</span>
</span><span id="L-762"><a href="#L-762"><span class="linenos"> 762</span></a>                <span class="k">if</span> <span class="n">freq</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-763"><a href="#L-763"><span class="linenos"> 763</span></a>                    <span class="n">freq</span> <span class="o">=</span> <span class="s2">&quot;Unknown/irregular&quot;</span>
</span><span id="L-764"><a href="#L-764"><span class="linenos"> 764</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;frequency&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">freq</span>
</span><span id="L-765"><a href="#L-765"><span class="linenos"> 765</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">series_metadata</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">)</span>
</span><span id="L-766"><a href="#L-766"><span class="linenos"> 766</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully scraped full series from tooltips.&quot;</span><span class="p">)</span>
</span><span id="L-767"><a href="#L-767"><span class="linenos"> 767</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;frequency&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Unknown/irregular&quot;</span><span class="p">:</span>
</span><span id="L-768"><a href="#L-768"><span class="linenos"> 768</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Frequency of the series is unknown or irregular, the tooltip scraping may have missed points. Retry scraping using &#39;path&#39; method instead of &#39;tooltips&#39;.&quot;</span><span class="p">)</span>
</span><span id="L-769"><a href="#L-769"><span class="linenos"> 769</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">series</span>
</span><span id="L-770"><a href="#L-770"><span class="linenos"> 770</span></a>
</span><span id="L-771"><a href="#L-771"><span class="linenos"> 771</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">tooltip_multiScrape</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-772"><a href="#L-772"><span class="linenos"> 772</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; Use the TooltipScraper object to scrape the full series from the chart. This is the most accurate method of scraping the full</span>
</span><span id="L-773"><a href="#L-773"><span class="linenos"> 773</span></a><span class="sd">        series but s the slowest. The x_index attribute must be set before running this method. The method will use multiple runs</span>
</span><span id="L-774"><a href="#L-774"><span class="linenos"> 774</span></a><span class="sd">        of the javascript tooltip scraping script. It will be done in multiple runs to prevent points being missed. Number of runs</span>
</span><span id="L-775"><a href="#L-775"><span class="linenos"> 775</span></a><span class="sd">        will depend upon the length of the x_index attribute. &quot;&quot;&quot;</span>
</span><span id="L-776"><a href="#L-776"><span class="linenos"> 776</span></a>
</span><span id="L-777"><a href="#L-777"><span class="linenos"> 777</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;tooltip_scraper&quot;</span><span class="p">):</span>
</span><span id="L-778"><a href="#L-778"><span class="linenos"> 778</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">init_tooltipScraper</span><span class="p">()</span>
</span><span id="L-779"><a href="#L-779"><span class="linenos"> 779</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;x_index&quot;</span><span class="p">):</span>
</span><span id="L-780"><a href="#L-780"><span class="linenos"> 780</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">make_x_index</span><span class="p">(</span><span class="n">force_rerun_freqdet</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">force_rerun_xlims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-781"><a href="#L-781"><span class="linenos"> 781</span></a>
</span><span id="L-782"><a href="#L-782"><span class="linenos"> 782</span></a>        <span class="n">max_chunk_size</span> <span class="o">=</span> <span class="mi">500</span>  <span class="c1"># Maximum number of points to scrape in one go. This is deterined by the density of datapoints on the chart. </span>
</span><span id="L-783"><a href="#L-783"><span class="linenos"> 783</span></a>        <span class="n">total_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_index</span><span class="p">)</span> <span class="c1"># Total number of points in the x_index attribute.</span>
</span><span id="L-784"><a href="#L-784"><span class="linenos"> 784</span></a>        <span class="n">numscrapes</span> <span class="o">=</span> <span class="p">(</span><span class="n">total_len</span> <span class="o">+</span> <span class="n">max_chunk_size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="n">max_chunk_size</span>  <span class="c1"># Ceiling division</span>
</span><span id="L-785"><a href="#L-785"><span class="linenos"> 785</span></a>        <span class="n">sub_indexes</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1">#The index will be brken up into this list of subIndexes.</span>
</span><span id="L-786"><a href="#L-786"><span class="linenos"> 786</span></a>        <span class="n">base_size</span> <span class="o">=</span> <span class="n">total_len</span> <span class="o">//</span> <span class="n">numscrapes</span>
</span><span id="L-787"><a href="#L-787"><span class="linenos"> 787</span></a>        <span class="n">remainder</span> <span class="o">=</span> <span class="n">total_len</span> <span class="o">%</span> <span class="n">numscrapes</span>
</span><span id="L-788"><a href="#L-788"><span class="linenos"> 788</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; Using mixed scraping approach, slowest, highest accuracy. Splitting x_index into subIndexes</span><span class="se">\</span>
</span><span id="L-789"><a href="#L-789"><span class="linenos"> 789</span></a><span class="s2">        Total points: </span><span class="si">{</span><span class="n">total_len</span><span class="si">}</span><span class="s2">, Max chunk size: </span><span class="si">{</span><span class="n">max_chunk_size</span><span class="si">}</span><span class="s2">, Number of chunks: </span><span class="si">{</span><span class="n">numscrapes</span><span class="si">}</span><span class="s2">, remainder: </span><span class="si">{</span><span class="n">remainder</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-790"><a href="#L-790"><span class="linenos"> 790</span></a>
</span><span id="L-791"><a href="#L-791"><span class="linenos"> 791</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numscrapes</span><span class="p">):</span>
</span><span id="L-792"><a href="#L-792"><span class="linenos"> 792</span></a>            <span class="n">start_idx</span> <span class="o">=</span> <span class="n">i</span> <span class="o">*</span> <span class="n">base_size</span>
</span><span id="L-793"><a href="#L-793"><span class="linenos"> 793</span></a>            <span class="c1"># For last chunk, include all remaining points</span>
</span><span id="L-794"><a href="#L-794"><span class="linenos"> 794</span></a>            <span class="n">end_idx</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">base_size</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">numscrapes</span> <span class="o">-</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">total_len</span>
</span><span id="L-795"><a href="#L-795"><span class="linenos"> 795</span></a>            <span class="n">sub_indexes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_index</span><span class="p">[</span><span class="n">start_idx</span><span class="p">:</span><span class="n">end_idx</span><span class="p">])</span>
</span><span id="L-796"><a href="#L-796"><span class="linenos"> 796</span></a>
</span><span id="L-797"><a href="#L-797"><span class="linenos"> 797</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;x_index Start date: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">x_index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">, End date: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">x_index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-798"><a href="#L-798"><span class="linenos"> 798</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sub_indexes</span><span class="p">):</span> <span class="c1">#Chec</span>
</span><span id="L-799"><a href="#L-799"><span class="linenos"> 799</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SubIndex </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span><span class="si">}</span><span class="s2"> points, from </span><span class="si">{</span><span class="n">idx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">idx</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">, frequency: </span><span class="si">{</span><span class="n">pd</span><span class="o">.</span><span class="n">infer_freq</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-800"><a href="#L-800"><span class="linenos"> 800</span></a>            <span class="c1">#Set the date span on the chart to cover the subIndex.</span>
</span><span id="L-801"><a href="#L-801"><span class="linenos"> 801</span></a>            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">sub_indexes</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-802"><a href="#L-802"><span class="linenos"> 802</span></a>                <span class="n">end_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-803"><a href="#L-803"><span class="linenos"> 803</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-804"><a href="#L-804"><span class="linenos"> 804</span></a>                <span class="n">end_date</span> <span class="o">=</span> <span class="n">idx</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-805"><a href="#L-805"><span class="linenos"> 805</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">custom_date_span_js</span><span class="p">(</span><span class="n">start_date</span><span class="o">=</span><span class="n">idx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">),</span> <span class="n">end_date</span> <span class="o">=</span> <span class="n">end_date</span><span class="p">)</span>
</span><span id="L-806"><a href="#L-806"><span class="linenos"> 806</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">set_chartType_js</span><span class="p">(</span><span class="s2">&quot;Spline&quot;</span><span class="p">)</span> <span class="c1">#Force spline chart selection - needed for tootip capture</span>
</span><span id="L-807"><a href="#L-807"><span class="linenos"> 807</span></a>
</span><span id="L-808"><a href="#L-808"><span class="linenos"> 808</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="L-809"><a href="#L-809"><span class="linenos"> 809</span></a>                <span class="n">datapoints</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tooltip_scraper</span><span class="o">.</span><span class="n">latest_points_js</span><span class="p">(</span><span class="n">num_points</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">,</span> <span class="n">force_shortest_span</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">wait_time</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-810"><a href="#L-810"><span class="linenos"> 810</span></a>                <span class="c1">#Powerful one line pandas connversion...</span>
</span><span id="L-811"><a href="#L-811"><span class="linenos"> 811</span></a>                <span class="n">series</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="n">utils</span><span class="o">.</span><span class="n">extract_and_convert_value</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">datapoints</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> \
</span><span id="L-812"><a href="#L-812"><span class="linenos"> 812</span></a>                                    <span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">([</span><span class="n">utils</span><span class="o">.</span><span class="n">ready_datestr</span><span class="p">(</span><span class="n">date</span><span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">])</span> <span class="k">for</span> <span class="n">date</span> <span class="ow">in</span> <span class="n">datapoints</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
</span><span id="L-813"><a href="#L-813"><span class="linenos"> 813</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-814"><a href="#L-814"><span class="linenos"> 814</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Tooltip scraping of full series has failed, error: &quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="L-815"><a href="#L-815"><span class="linenos"> 815</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-816"><a href="#L-816"><span class="linenos"> 816</span></a>            
</span><span id="L-817"><a href="#L-817"><span class="linenos"> 817</span></a>            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-818"><a href="#L-818"><span class="linenos"> 818</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">series</span> <span class="o">=</span> <span class="n">series</span>
</span><span id="L-819"><a href="#L-819"><span class="linenos"> 819</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-820"><a href="#L-820"><span class="linenos"> 820</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">series</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="p">,</span> <span class="n">series</span><span class="p">],</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">])</span>
</span><span id="L-821"><a href="#L-821"><span class="linenos"> 821</span></a>
</span><span id="L-822"><a href="#L-822"><span class="linenos"> 822</span></a>        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;metadata&quot;</span><span class="p">):</span>
</span><span id="L-823"><a href="#L-823"><span class="linenos"> 823</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;start_date&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-824"><a href="#L-824"><span class="linenos"> 824</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;end_date&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-825"><a href="#L-825"><span class="linenos"> 825</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;min_value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
</span><span id="L-826"><a href="#L-826"><span class="linenos"> 826</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;max_value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
</span><span id="L-827"><a href="#L-827"><span class="linenos"> 827</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;length&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="p">)</span>
</span><span id="L-828"><a href="#L-828"><span class="linenos"> 828</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">series_metadata</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">)</span>
</span><span id="L-829"><a href="#L-829"><span class="linenos"> 829</span></a>
</span><span id="L-830"><a href="#L-830"><span class="linenos"> 830</span></a>        <span class="c1">##Sometimes the first and last data points seem to be missed, luckily we have them already in the start_end attribute.</span>
</span><span id="L-831"><a href="#L-831"><span class="linenos"> 831</span></a>        <span class="c1"># Overwrite the first and last points with the start_end values.</span>
</span><span id="L-832"><a href="#L-832"><span class="linenos"> 832</span></a>        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;start_end&quot;</span><span class="p">):</span>
</span><span id="L-833"><a href="#L-833"><span class="linenos"> 833</span></a>            <span class="c1"># Convert start_date and end_date to datetime objects</span>
</span><span id="L-834"><a href="#L-834"><span class="linenos"> 834</span></a>            <span class="n">start_date</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_end</span><span class="p">[</span><span class="s2">&quot;start_date&quot;</span><span class="p">])</span>
</span><span id="L-835"><a href="#L-835"><span class="linenos"> 835</span></a>            <span class="n">end_date</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_end</span><span class="p">[</span><span class="s2">&quot;end_date&quot;</span><span class="p">])</span>
</span><span id="L-836"><a href="#L-836"><span class="linenos"> 836</span></a>            <span class="c1"># Create Series objects for the start and end values</span>
</span><span id="L-837"><a href="#L-837"><span class="linenos"> 837</span></a>            <span class="n">start_series</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">({</span><span class="n">start_date</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_end</span><span class="p">[</span><span class="s2">&quot;start_value&quot;</span><span class="p">]})</span>
</span><span id="L-838"><a href="#L-838"><span class="linenos"> 838</span></a>            <span class="n">end_series</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">({</span><span class="n">end_date</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_end</span><span class="p">[</span><span class="s2">&quot;end_value&quot;</span><span class="p">]})</span>
</span><span id="L-839"><a href="#L-839"><span class="linenos"> 839</span></a>            <span class="c1"># Concatenate with the existing series</span>
</span><span id="L-840"><a href="#L-840"><span class="linenos"> 840</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">series</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">start_series</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="p">,</span> <span class="n">end_series</span><span class="p">])</span>
</span><span id="L-841"><a href="#L-841"><span class="linenos"> 841</span></a>            <span class="c1"># Drop duplicates keeping the last occurrence (which would be from start_end if dates already exist)</span>
</span><span id="L-842"><a href="#L-842"><span class="linenos"> 842</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">series</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="p">[</span><span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">duplicated</span><span class="p">(</span><span class="n">keep</span><span class="o">=</span><span class="s1">&#39;last&#39;</span><span class="p">)]</span>
</span><span id="L-843"><a href="#L-843"><span class="linenos"> 843</span></a>            <span class="c1"># Sort by index to ensure the datetime index is in ascending order</span>
</span><span id="L-844"><a href="#L-844"><span class="linenos"> 844</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">series</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">])</span>
</span><span id="L-845"><a href="#L-845"><span class="linenos"> 845</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully scraped full series from tooltips.&quot;</span><span class="p">)</span>
</span><span id="L-846"><a href="#L-846"><span class="linenos"> 846</span></a>        <span class="k">return</span> <span class="kc">True</span>
</span><span id="L-847"><a href="#L-847"><span class="linenos"> 847</span></a>    
</span><span id="L-848"><a href="#L-848"><span class="linenos"> 848</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">series_from_highcharts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-849"><a href="#L-849"><span class="linenos"> 849</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the series data from the Highcharts JavaScript object. This is the fastest method of getting the series data from the chart.</span>
</span><span id="L-850"><a href="#L-850"><span class="linenos"> 850</span></a><span class="sd">        The series data is stored in the &quot;series&quot; attribute of the class. The method</span>
</span><span id="L-851"><a href="#L-851"><span class="linenos"> 851</span></a><span class="sd">        will return the series data as well. &quot;&quot;&quot;</span>
</span><span id="L-852"><a href="#L-852"><span class="linenos"> 852</span></a>
</span><span id="L-853"><a href="#L-853"><span class="linenos"> 853</span></a>        <span class="n">js_file_path</span> <span class="o">=</span> <span class="n">wd</span> <span class="o">+</span> <span class="n">fdel</span> <span class="o">+</span> <span class="s1">&#39;check_highcharts.js&#39;</span>
</span><span id="L-854"><a href="#L-854"><span class="linenos"> 854</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">js_file_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
</span><span id="L-855"><a href="#L-855"><span class="linenos"> 855</span></a>            <span class="n">script</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span><span id="L-856"><a href="#L-856"><span class="linenos"> 856</span></a>
</span><span id="L-857"><a href="#L-857"><span class="linenos"> 857</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-858"><a href="#L-858"><span class="linenos"> 858</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">execute_script</span><span class="p">(</span><span class="n">script</span><span class="p">)</span>
</span><span id="L-859"><a href="#L-859"><span class="linenos"> 859</span></a>            <span class="c1"># Extract the data points</span>
</span><span id="L-860"><a href="#L-860"><span class="linenos"> 860</span></a>            <span class="n">data_points</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;seriesData&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;points&#39;</span><span class="p">]</span>
</span><span id="L-861"><a href="#L-861"><span class="linenos"> 861</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="p">[(</span><span class="n">point</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">],</span> <span class="n">point</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">])</span> <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">data_points</span><span class="p">]</span>
</span><span id="L-862"><a href="#L-862"><span class="linenos"> 862</span></a>            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">])</span>
</span><span id="L-863"><a href="#L-863"><span class="linenos"> 863</span></a>            <span class="c1"># Convert timestamp to datetime</span>
</span><span id="L-864"><a href="#L-864"><span class="linenos"> 864</span></a>            <span class="n">df</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">],</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;ms&#39;</span><span class="p">)</span>
</span><span id="L-865"><a href="#L-865"><span class="linenos"> 865</span></a>            <span class="c1"># Set date as index</span>
</span><span id="L-866"><a href="#L-866"><span class="linenos"> 866</span></a>            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">)</span>
</span><span id="L-867"><a href="#L-867"><span class="linenos"> 867</span></a>
</span><span id="L-868"><a href="#L-868"><span class="linenos"> 868</span></a>            <span class="n">series</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">])</span>
</span><span id="L-869"><a href="#L-869"><span class="linenos"> 869</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">series</span> <span class="o">=</span> <span class="n">series</span>
</span><span id="L-870"><a href="#L-870"><span class="linenos"> 870</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully extracted series data from Highcharts.&quot;</span><span class="p">)</span>
</span><span id="L-871"><a href="#L-871"><span class="linenos"> 871</span></a>            <span class="n">freq</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">infer_freq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="c1"># Infer the frequency of the series.</span>
</span><span id="L-872"><a href="#L-872"><span class="linenos"> 872</span></a>            <span class="k">if</span> <span class="n">freq</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-873"><a href="#L-873"><span class="linenos"> 873</span></a>                <span class="n">freq</span> <span class="o">=</span> <span class="s2">&quot;Unknown/irregular&quot;</span>
</span><span id="L-874"><a href="#L-874"><span class="linenos"> 874</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;frequency&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">freq</span>
</span><span id="L-875"><a href="#L-875"><span class="linenos"> 875</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;start_date&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-876"><a href="#L-876"><span class="linenos"> 876</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;end_date&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-877"><a href="#L-877"><span class="linenos"> 877</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;min_value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
</span><span id="L-878"><a href="#L-878"><span class="linenos"> 878</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;max_value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
</span><span id="L-879"><a href="#L-879"><span class="linenos"> 879</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;length&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="p">)</span>
</span><span id="L-880"><a href="#L-880"><span class="linenos"> 880</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">series_metadata</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">)</span>
</span><span id="L-881"><a href="#L-881"><span class="linenos"> 881</span></a>            
</span><span id="L-882"><a href="#L-882"><span class="linenos"> 882</span></a>            <span class="k">return</span> <span class="n">series</span>
</span><span id="L-883"><a href="#L-883"><span class="linenos"> 883</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-884"><a href="#L-884"><span class="linenos"> 884</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error extracting series from Highcharts: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-885"><a href="#L-885"><span class="linenos"> 885</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-886"><a href="#L-886"><span class="linenos"> 886</span></a>
</span><span id="L-887"><a href="#L-887"><span class="linenos"> 887</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_chart_type_from_highcharts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-888"><a href="#L-888"><span class="linenos"> 888</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-889"><a href="#L-889"><span class="linenos"> 889</span></a><span class="sd">        Get the chart type directly from the Highcharts API.</span>
</span><span id="L-890"><a href="#L-890"><span class="linenos"> 890</span></a><span class="sd">        This is the most reliable way to determine chart type.</span>
</span><span id="L-891"><a href="#L-891"><span class="linenos"> 891</span></a><span class="sd">        </span>
</span><span id="L-892"><a href="#L-892"><span class="linenos"> 892</span></a><span class="sd">        Returns:</span>
</span><span id="L-893"><a href="#L-893"><span class="linenos"> 893</span></a><span class="sd">            dict: Chart type information including main type, series types, and point count</span>
</span><span id="L-894"><a href="#L-894"><span class="linenos"> 894</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-895"><a href="#L-895"><span class="linenos"> 895</span></a>        <span class="n">script</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
</span><span id="L-896"><a href="#L-896"><span class="linenos"> 896</span></a><span class="s2">        try {</span>
</span><span id="L-897"><a href="#L-897"><span class="linenos"> 897</span></a><span class="s2">            if (typeof Highcharts === &#39;undefined&#39;) {</span>
</span><span id="L-898"><a href="#L-898"><span class="linenos"> 898</span></a><span class="s2">                return { error: &quot;Highcharts not found&quot;, success: false };</span>
</span><span id="L-899"><a href="#L-899"><span class="linenos"> 899</span></a><span class="s2">            }</span>
</span><span id="L-900"><a href="#L-900"><span class="linenos"> 900</span></a><span class="s2">            </span>
</span><span id="L-901"><a href="#L-901"><span class="linenos"> 901</span></a><span class="s2">            const chart = Highcharts.charts.find(c =&gt; c &amp;&amp; c.series &amp;&amp; c.series.length &gt; 0);</span>
</span><span id="L-902"><a href="#L-902"><span class="linenos"> 902</span></a><span class="s2">            if (!chart) {</span>
</span><span id="L-903"><a href="#L-903"><span class="linenos"> 903</span></a><span class="s2">                return { error: &quot;No valid chart found&quot;, success: false };</span>
</span><span id="L-904"><a href="#L-904"><span class="linenos"> 904</span></a><span class="s2">            }</span>
</span><span id="L-905"><a href="#L-905"><span class="linenos"> 905</span></a><span class="s2">            </span>
</span><span id="L-906"><a href="#L-906"><span class="linenos"> 906</span></a><span class="s2">            return {</span>
</span><span id="L-907"><a href="#L-907"><span class="linenos"> 907</span></a><span class="s2">                mainType: chart.options?.chart?.type || &quot;unknown&quot;,</span>
</span><span id="L-908"><a href="#L-908"><span class="linenos"> 908</span></a><span class="s2">                seriesTypes: chart.series.map(s =&gt; ({</span>
</span><span id="L-909"><a href="#L-909"><span class="linenos"> 909</span></a><span class="s2">                    name: s.name,</span>
</span><span id="L-910"><a href="#L-910"><span class="linenos"> 910</span></a><span class="s2">                    type: s.type || chart.options?.chart?.type</span>
</span><span id="L-911"><a href="#L-911"><span class="linenos"> 911</span></a><span class="s2">                })),</span>
</span><span id="L-912"><a href="#L-912"><span class="linenos"> 912</span></a><span class="s2">                pointCount: chart.series[0]?.points?.length || 0,</span>
</span><span id="L-913"><a href="#L-913"><span class="linenos"> 913</span></a><span class="s2">                success: true</span>
</span><span id="L-914"><a href="#L-914"><span class="linenos"> 914</span></a><span class="s2">            };</span>
</span><span id="L-915"><a href="#L-915"><span class="linenos"> 915</span></a><span class="s2">        } catch (e) {</span>
</span><span id="L-916"><a href="#L-916"><span class="linenos"> 916</span></a><span class="s2">            return { error: &quot;JavaScript error: &quot; + e.message, success: false };</span>
</span><span id="L-917"><a href="#L-917"><span class="linenos"> 917</span></a><span class="s2">        }</span>
</span><span id="L-918"><a href="#L-918"><span class="linenos"> 918</span></a><span class="s2">        &quot;&quot;&quot;</span>
</span><span id="L-919"><a href="#L-919"><span class="linenos"> 919</span></a>        
</span><span id="L-920"><a href="#L-920"><span class="linenos"> 920</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-921"><a href="#L-921"><span class="linenos"> 921</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">execute_script</span><span class="p">(</span><span class="n">script</span><span class="p">)</span>
</span><span id="L-922"><a href="#L-922"><span class="linenos"> 922</span></a>            <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-923"><a href="#L-923"><span class="linenos"> 923</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;JavaScript execution returned None - Highcharts API may not be accessible&quot;</span><span class="p">)</span>
</span><span id="L-924"><a href="#L-924"><span class="linenos"> 924</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-925"><a href="#L-925"><span class="linenos"> 925</span></a>                
</span><span id="L-926"><a href="#L-926"><span class="linenos"> 926</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Result: &#39;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
</span><span id="L-927"><a href="#L-927"><span class="linenos"> 927</span></a>            <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;success&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="L-928"><a href="#L-928"><span class="linenos"> 928</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span><span class="o">+</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;seriesTypes&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;Chart&quot;</span>
</span><span id="L-929"><a href="#L-929"><span class="linenos"> 929</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Chart type detected from Highcharts API: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-930"><a href="#L-930"><span class="linenos"> 930</span></a>                <span class="k">return</span> <span class="n">result</span>
</span><span id="L-931"><a href="#L-931"><span class="linenos"> 931</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-932"><a href="#L-932"><span class="linenos"> 932</span></a>                <span class="n">error_msg</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="s1">&#39;Unknown error&#39;</span><span class="p">)</span>
</span><span id="L-933"><a href="#L-933"><span class="linenos"> 933</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to detect chart type: </span><span class="si">{</span><span class="n">error_msg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-934"><a href="#L-934"><span class="linenos"> 934</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-935"><a href="#L-935"><span class="linenos"> 935</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-936"><a href="#L-936"><span class="linenos"> 936</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error detecting chart type: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-937"><a href="#L-937"><span class="linenos"> 937</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-938"><a href="#L-938"><span class="linenos"> 938</span></a>        
</span><span id="L-939"><a href="#L-939"><span class="linenos"> 939</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_chartType_highcharts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chart_type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;Column&#39;</span><span class="p">,</span> <span class="s1">&#39;Spline&#39;</span><span class="p">,</span> <span class="s1">&#39;Areaspline&#39;</span><span class="p">,</span> <span class="s1">&#39;Stepline&#39;</span><span class="p">,</span> <span class="s1">&#39;Line&#39;</span><span class="p">,</span> <span class="s1">&#39;Area&#39;</span><span class="p">]):</span>
</span><span id="L-940"><a href="#L-940"><span class="linenos"> 940</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Set chart type directly using Highcharts API, unsure if this is working properly yet. This should be the most reliable way to set the chart type.</span>
</span><span id="L-941"><a href="#L-941"><span class="linenos"> 941</span></a><span class="sd">        List chart types: &#39;Column&#39;, &#39;Spline&#39;, &#39;Areaspline&#39;, &#39;Stepline&#39;, &#39;Line&#39;, &#39;Area&#39;, list them by veiwing chart_types attribute of the TE_Scraper.&quot;&quot;&quot;</span>
</span><span id="L-942"><a href="#L-942"><span class="linenos"> 942</span></a>        
</span><span id="L-943"><a href="#L-943"><span class="linenos"> 943</span></a>        <span class="n">script</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="L-944"><a href="#L-944"><span class="linenos"> 944</span></a><span class="s2">        (() =&gt; </span><span class="se">{{</span>
</span><span id="L-945"><a href="#L-945"><span class="linenos"> 945</span></a><span class="s2">        if (typeof Highcharts === &#39;undefined&#39;) return false;</span>
</span><span id="L-946"><a href="#L-946"><span class="linenos"> 946</span></a><span class="s2">        </span>
</span><span id="L-947"><a href="#L-947"><span class="linenos"> 947</span></a><span class="s2">        const chart = Highcharts.charts.find(c =&gt; c &amp;&amp; c.series &amp;&amp; c.series.length &gt; 0);</span>
</span><span id="L-948"><a href="#L-948"><span class="linenos"> 948</span></a><span class="s2">        if (!chart) return false;</span>
</span><span id="L-949"><a href="#L-949"><span class="linenos"> 949</span></a><span class="s2">        </span>
</span><span id="L-950"><a href="#L-950"><span class="linenos"> 950</span></a><span class="s2">        // Store current type</span>
</span><span id="L-951"><a href="#L-951"><span class="linenos"> 951</span></a><span class="s2">        const currentType = chart.options?.chart?.type;</span>
</span><span id="L-952"><a href="#L-952"><span class="linenos"> 952</span></a><span class="s2">        </span>
</span><span id="L-953"><a href="#L-953"><span class="linenos"> 953</span></a><span class="s2">        // Set new type for all series</span>
</span><span id="L-954"><a href="#L-954"><span class="linenos"> 954</span></a><span class="s2">        chart.update(</span><span class="se">{{</span><span class="s2"> chart: </span><span class="se">{{</span><span class="s2"> type: &#39;</span><span class="si">{</span><span class="n">chart_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">&#39; </span><span class="se">}}</span><span class="s2"> </span><span class="se">}}</span><span class="s2">);</span>
</span><span id="L-955"><a href="#L-955"><span class="linenos"> 955</span></a><span class="s2">        </span>
</span><span id="L-956"><a href="#L-956"><span class="linenos"> 956</span></a><span class="s2">        return true;</span>
</span><span id="L-957"><a href="#L-957"><span class="linenos"> 957</span></a><span class="s2">        </span><span class="se">}}</span><span class="s2">)();</span>
</span><span id="L-958"><a href="#L-958"><span class="linenos"> 958</span></a><span class="s2">        &quot;&quot;&quot;</span>
</span><span id="L-959"><a href="#L-959"><span class="linenos"> 959</span></a>        
</span><span id="L-960"><a href="#L-960"><span class="linenos"> 960</span></a>        <span class="n">success</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">execute_script</span><span class="p">(</span><span class="n">script</span><span class="p">)</span>
</span><span id="L-961"><a href="#L-961"><span class="linenos"> 961</span></a>        
</span><span id="L-962"><a href="#L-962"><span class="linenos"> 962</span></a>        <span class="k">if</span> <span class="n">success</span><span class="p">:</span>
</span><span id="L-963"><a href="#L-963"><span class="linenos"> 963</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span> <span class="o">=</span> <span class="n">chart_type</span>
</span><span id="L-964"><a href="#L-964"><span class="linenos"> 964</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Chart type set to: </span><span class="si">{</span><span class="n">chart_type</span><span class="si">}</span><span class="s2"> (using Highcharts API)&quot;</span><span class="p">)</span>
</span><span id="L-965"><a href="#L-965"><span class="linenos"> 965</span></a>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
</span><span id="L-966"><a href="#L-966"><span class="linenos"> 966</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">update_chart</span><span class="p">()</span>
</span><span id="L-967"><a href="#L-967"><span class="linenos"> 967</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="L-968"><a href="#L-968"><span class="linenos"> 968</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-969"><a href="#L-969"><span class="linenos"> 969</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error setting chart type: </span><span class="si">{</span><span class="n">chart_type</span><span class="si">}</span><span class="s2"> (using Highcharts API)&quot;</span><span class="p">)</span>
</span><span id="L-970"><a href="#L-970"><span class="linenos"> 970</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-971"><a href="#L-971"><span class="linenos"> 971</span></a>    
</span><span id="L-972"><a href="#L-972"><span class="linenos"> 972</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_y_axis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">update_chart</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">set_global_y_axis</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="L-973"><a href="#L-973"><span class="linenos"> 973</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get y-axis values from chart to make a y-axis series with tick labels and positions (pixel positions).</span>
</span><span id="L-974"><a href="#L-974"><span class="linenos"> 974</span></a><span class="sd">        Also gets the limits of both axis in pixel co-ordinates. A series containing the y-axis values and their pixel positions (as index) is assigned</span>
</span><span id="L-975"><a href="#L-975"><span class="linenos"> 975</span></a><span class="sd">        to the &quot;y_axis&quot; attribute. The &quot;axis_limits&quot; attribute is made too &amp; is  dictionary containing the pixel co-ordinates of the max and min for both x and y axis.</span>
</span><span id="L-976"><a href="#L-976"><span class="linenos"> 976</span></a>
</span><span id="L-977"><a href="#L-977"><span class="linenos"> 977</span></a><span class="sd">        **Parameters:**</span>
</span><span id="L-978"><a href="#L-978"><span class="linenos"> 978</span></a><span class="sd">        - update_chart (bool): Whether to update the chart before scraping the y-axis values. Default is False.</span>
</span><span id="L-979"><a href="#L-979"><span class="linenos"> 979</span></a><span class="sd">        - set_global_y_axis (bool): Whether to set the y-axis series as a global attribute of the class. Default is False.</span>
</span><span id="L-980"><a href="#L-980"><span class="linenos"> 980</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-981"><a href="#L-981"><span class="linenos"> 981</span></a>
</span><span id="L-982"><a href="#L-982"><span class="linenos"> 982</span></a>        <span class="c1">##Get positions of y-axis gridlines</span>
</span><span id="L-983"><a href="#L-983"><span class="linenos"> 983</span></a>        <span class="n">y_heights</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-984"><a href="#L-984"><span class="linenos"> 984</span></a>        <span class="k">if</span> <span class="n">update_chart</span><span class="p">:</span>
</span><span id="L-985"><a href="#L-985"><span class="linenos"> 985</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">update_chart</span><span class="p">()</span>
</span><span id="L-986"><a href="#L-986"><span class="linenos"> 986</span></a>        <span class="k">if</span> <span class="n">set_global_y_axis</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">date_span</span> <span class="o">!=</span> <span class="s2">&quot;MAX&quot;</span><span class="p">:</span>
</span><span id="L-987"><a href="#L-987"><span class="linenos"> 987</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">set_date_span</span><span class="p">(</span><span class="s2">&quot;MAX&quot;</span><span class="p">)</span>
</span><span id="L-988"><a href="#L-988"><span class="linenos"> 988</span></a>
</span><span id="L-989"><a href="#L-989"><span class="linenos"> 989</span></a>        <span class="c1">## First get the pixel values of the max and min for both x and y axis.</span>
</span><span id="L-990"><a href="#L-990"><span class="linenos"> 990</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">axis_limits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_axis_limits</span><span class="p">()</span>
</span><span id="L-991"><a href="#L-991"><span class="linenos"> 991</span></a>
</span><span id="L-992"><a href="#L-992"><span class="linenos"> 992</span></a>        <span class="n">ygrid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_soup</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;g.highcharts-grid.highcharts-yaxis-grid&#39;</span><span class="p">)</span>
</span><span id="L-993"><a href="#L-993"><span class="linenos"> 993</span></a>        <span class="n">gridlines</span> <span class="o">=</span> <span class="n">ygrid</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">findAll</span><span class="p">(</span><span class="s1">&#39;path&#39;</span><span class="p">)</span>
</span><span id="L-994"><a href="#L-994"><span class="linenos"> 994</span></a>        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">gridlines</span><span class="p">:</span>
</span><span id="L-995"><a href="#L-995"><span class="linenos"> 995</span></a>            <span class="n">y_heights</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
</span><span id="L-996"><a href="#L-996"><span class="linenos"> 996</span></a>        <span class="n">y_heights</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">y_heights</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-997"><a href="#L-997"><span class="linenos"> 997</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;y_heights: &quot;</span><span class="p">,</span> <span class="n">y_heights</span><span class="p">)</span>
</span><span id="L-998"><a href="#L-998"><span class="linenos"> 998</span></a>
</span><span id="L-999"><a href="#L-999"><span class="linenos"> 999</span></a>        <span class="c1">##Get y-axis labels</span>
</span><span id="L-1000"><a href="#L-1000"><span class="linenos">1000</span></a>        <span class="n">yax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_soup</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;g.highcharts-axis-labels.highcharts-yaxis-labels&#39;</span><span class="p">)</span>
</span><span id="L-1001"><a href="#L-1001"><span class="linenos">1001</span></a>        <span class="n">textels</span> <span class="o">=</span> <span class="n">yax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s1">&#39;text&#39;</span><span class="p">)</span>
</span><span id="L-1002"><a href="#L-1002"><span class="linenos">1002</span></a>
</span><span id="L-1003"><a href="#L-1003"><span class="linenos">1003</span></a>        <span class="c1"># Replace metrc prefixes:</span>
</span><span id="L-1004"><a href="#L-1004"><span class="linenos">1004</span></a>        <span class="n">yaxlabs</span> <span class="o">=</span> <span class="p">[</span><span class="n">utils</span><span class="o">.</span><span class="n">extract_and_convert_value</span><span class="p">(</span><span class="n">text</span><span class="o">.</span><span class="n">get_text</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">text</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">isalnum</span><span class="p">()</span> <span class="k">else</span> <span class="n">text</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span> <span class="k">for</span> <span class="n">text</span> <span class="ow">in</span> <span class="n">textels</span><span class="p">]</span>
</span><span id="L-1005"><a href="#L-1005"><span class="linenos">1005</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;y-axis labels: </span><span class="si">{</span><span class="n">yaxlabs</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1006"><a href="#L-1006"><span class="linenos">1006</span></a>
</span><span id="L-1007"><a href="#L-1007"><span class="linenos">1007</span></a>        <span class="c1"># convert to float...</span>
</span><span id="L-1008"><a href="#L-1008"><span class="linenos">1008</span></a>        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">yaxlabs</span><span class="p">):</span>
</span><span id="L-1009"><a href="#L-1009"><span class="linenos">1009</span></a>            <span class="n">yaxlabs</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="nb">str</span><span class="o">.</span><span class="n">isdigit</span><span class="p">,</span> <span class="n">i</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))))</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">yaxlabs</span><span class="p">]</span>
</span><span id="L-1010"><a href="#L-1010"><span class="linenos">1010</span></a>        <span class="n">pixheights</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">height</span><span class="p">)</span> <span class="k">for</span> <span class="n">height</span> <span class="ow">in</span> <span class="n">y_heights</span><span class="p">]</span>
</span><span id="L-1011"><a href="#L-1011"><span class="linenos">1011</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;pixheights: &quot;</span><span class="p">,</span> <span class="n">pixheights</span><span class="p">)</span>
</span><span id="L-1012"><a href="#L-1012"><span class="linenos">1012</span></a>
</span><span id="L-1013"><a href="#L-1013"><span class="linenos">1013</span></a>        <span class="c1">##Get px per unit for y-axis</span>
</span><span id="L-1014"><a href="#L-1014"><span class="linenos">1014</span></a>        <span class="n">pxPerUnit</span> <span class="o">=</span> <span class="p">[</span><span class="nb">abs</span><span class="p">((</span><span class="n">yaxlabs</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span> <span class="n">yaxlabs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="n">pixheights</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span> <span class="n">pixheights</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pixheights</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)]</span>
</span><span id="L-1015"><a href="#L-1015"><span class="linenos">1015</span></a>        <span class="n">average</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">pxPerUnit</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">pxPerUnit</span><span class="p">)</span>
</span><span id="L-1016"><a href="#L-1016"><span class="linenos">1016</span></a>        <span class="k">if</span> <span class="n">set_global_y_axis</span><span class="p">:</span>
</span><span id="L-1017"><a href="#L-1017"><span class="linenos">1017</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">unit_per_pix</span> <span class="o">=</span> <span class="n">average</span>
</span><span id="L-1018"><a href="#L-1018"><span class="linenos">1018</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Average px per unit for y-axis: </span><span class="si">{</span><span class="n">average</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>  <span class="c1">#Calculate the scaling for the chart so we can convert pixel co-ordinates to data values.</span>
</span><span id="L-1019"><a href="#L-1019"><span class="linenos">1019</span></a>
</span><span id="L-1020"><a href="#L-1020"><span class="linenos">1020</span></a>        <span class="n">yaxis</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">yaxlabs</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="n">pixheights</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;ytick_label&quot;</span><span class="p">)</span>
</span><span id="L-1021"><a href="#L-1021"><span class="linenos">1021</span></a>        <span class="n">yaxis</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s2">&quot;pixheight&quot;</span><span class="p">,</span> <span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</span><span id="L-1022"><a href="#L-1022"><span class="linenos">1022</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-1023"><a href="#L-1023"><span class="linenos">1023</span></a>            <span class="n">yaxis</span> <span class="o">=</span> <span class="n">yaxis</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
</span><span id="L-1024"><a href="#L-1024"><span class="linenos">1024</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="L-1025"><a href="#L-1025"><span class="linenos">1025</span></a>            <span class="k">pass</span>
</span><span id="L-1026"><a href="#L-1026"><span class="linenos">1026</span></a>
</span><span id="L-1027"><a href="#L-1027"><span class="linenos">1027</span></a>        <span class="k">if</span> <span class="n">yaxis</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1028"><a href="#L-1028"><span class="linenos">1028</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Y-axis values scraped successfully.&quot;</span><span class="p">)</span>
</span><span id="L-1029"><a href="#L-1029"><span class="linenos">1029</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1030"><a href="#L-1030"><span class="linenos">1030</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Y-axis values not scraped successfully, yaxis is None.&quot;</span><span class="p">)</span>
</span><span id="L-1031"><a href="#L-1031"><span class="linenos">1031</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-1032"><a href="#L-1032"><span class="linenos">1032</span></a>        
</span><span id="L-1033"><a href="#L-1033"><span class="linenos">1033</span></a>        <span class="k">if</span> <span class="n">set_global_y_axis</span><span class="p">:</span>
</span><span id="L-1034"><a href="#L-1034"><span class="linenos">1034</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">y_axis</span> <span class="o">=</span> <span class="n">yaxis</span>
</span><span id="L-1035"><a href="#L-1035"><span class="linenos">1035</span></a>
</span><span id="L-1036"><a href="#L-1036"><span class="linenos">1036</span></a>        <span class="k">return</span> <span class="n">yaxis</span>
</span><span id="L-1037"><a href="#L-1037"><span class="linenos">1037</span></a>     
</span><span id="L-1038"><a href="#L-1038"><span class="linenos">1038</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">init_tooltipScraper</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1039"><a href="#L-1039"><span class="linenos">1039</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialise the TooltipScraper object for the class. This is used to scrape the tooltip box on the chart to get the start and end dates of the time series.</span>
</span><span id="L-1040"><a href="#L-1040"><span class="linenos">1040</span></a><span class="sd">        The tooltip scraper is a child object of the class and is used</span>
</span><span id="L-1041"><a href="#L-1041"><span class="linenos">1041</span></a><span class="sd">        to scrape the tooltip box on the chart to get the start and end dates of the time series. The tooltip scraper is a child object of the class an shares some synced </span>
</span><span id="L-1042"><a href="#L-1042"><span class="linenos">1042</span></a><span class="sd">        attributes with the parent class. &quot;&quot;&quot;</span>
</span><span id="L-1043"><a href="#L-1043"><span class="linenos">1043</span></a>
</span><span id="L-1044"><a href="#L-1044"><span class="linenos">1044</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;tooltip_scraper&quot;</span><span class="p">):</span>
</span><span id="L-1045"><a href="#L-1045"><span class="linenos">1045</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">tooltip_scraper</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">TooltipScraper</span><span class="p">(</span><span class="n">parent_instance</span> <span class="o">=</span> <span class="bp">self</span><span class="p">)</span>
</span><span id="L-1046"><a href="#L-1046"><span class="linenos">1046</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;TooltipScraper object initialised successfully.&quot;</span><span class="p">)</span>
</span><span id="L-1047"><a href="#L-1047"><span class="linenos">1047</span></a>        <span class="k">else</span><span class="p">:</span>    
</span><span id="L-1048"><a href="#L-1048"><span class="linenos">1048</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;TooltipScraper object already initialised.&quot;</span><span class="p">)</span>
</span><span id="L-1049"><a href="#L-1049"><span class="linenos">1049</span></a>
</span><span id="L-1050"><a href="#L-1050"><span class="linenos">1050</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">dtIndex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_date</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">end_date</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">ser_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Time-series&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">:</span>
</span><span id="L-1051"><a href="#L-1051"><span class="linenos">1051</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1052"><a href="#L-1052"><span class="linenos">1052</span></a>
</span><span id="L-1053"><a href="#L-1053"><span class="linenos">1053</span></a><span class="sd">        Create a date index for your series in self.series. Will first make an index to cover the full length of your series </span>
</span><span id="L-1054"><a href="#L-1054"><span class="linenos">1054</span></a><span class="sd">        and then resample to month start freq to match the format on Trading Economics.</span>
</span><span id="L-1055"><a href="#L-1055"><span class="linenos">1055</span></a><span class="sd">        </span>
</span><span id="L-1056"><a href="#L-1056"><span class="linenos">1056</span></a><span class="sd">        **Parameters:**</span>
</span><span id="L-1057"><a href="#L-1057"><span class="linenos">1057</span></a><span class="sd">        - start_date (str) YYYY-MM-DD: The start date of your series</span>
</span><span id="L-1058"><a href="#L-1058"><span class="linenos">1058</span></a><span class="sd">        - end_date (str) YYYY-MM-DD: The end date of your series</span>
</span><span id="L-1059"><a href="#L-1059"><span class="linenos">1059</span></a><span class="sd">        - ser_name (str): The name TO GIVE the series</span>
</span><span id="L-1060"><a href="#L-1060"><span class="linenos">1060</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1061"><a href="#L-1061"><span class="linenos">1061</span></a>        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;x_index&quot;</span><span class="p">):</span>
</span><span id="L-1062"><a href="#L-1062"><span class="linenos">1062</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Overwriting existing x_index attribute.&quot;</span><span class="p">)</span>
</span><span id="L-1063"><a href="#L-1063"><span class="linenos">1063</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">x_index</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-1064"><a href="#L-1064"><span class="linenos">1064</span></a>        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;series&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;frequency&quot;</span><span class="p">):</span>
</span><span id="L-1065"><a href="#L-1065"><span class="linenos">1065</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Series found but frequency not known. Creating a datetime x-index for series with frequency determined by length of series.</span><span class="se">\</span>
</span><span id="L-1066"><a href="#L-1066"><span class="linenos">1066</span></a><span class="s2">                        Returning dtIndex only.&quot;</span><span class="p">)</span>
</span><span id="L-1067"><a href="#L-1067"><span class="linenos">1067</span></a>            <span class="n">dtIndex</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span> <span class="o">=</span> <span class="n">start_date</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">end_date</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="p">),</span> <span class="n">inclusive</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">)</span>
</span><span id="L-1068"><a href="#L-1068"><span class="linenos">1068</span></a>            <span class="k">return</span> <span class="n">dtIndex</span>
</span><span id="L-1069"><a href="#L-1069"><span class="linenos">1069</span></a>        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;series&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;frequency&quot;</span><span class="p">):</span>
</span><span id="L-1070"><a href="#L-1070"><span class="linenos">1070</span></a>            <span class="n">dtIndex</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span> <span class="o">=</span> <span class="n">start_date</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">end_date</span><span class="p">,</span> <span class="n">freq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="p">)</span>
</span><span id="L-1071"><a href="#L-1071"><span class="linenos">1071</span></a>            <span class="n">new_ser</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">to_list</span><span class="p">(),</span> <span class="n">index</span> <span class="o">=</span> <span class="n">dtIndex</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">ser_name</span><span class="p">)</span>
</span><span id="L-1072"><a href="#L-1072"><span class="linenos">1072</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">trace_path_series</span> <span class="o">=</span> <span class="n">new_ser</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-1073"><a href="#L-1073"><span class="linenos">1073</span></a>            <span class="n">new_ser</span> <span class="o">=</span> <span class="n">new_ser</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
</span><span id="L-1074"><a href="#L-1074"><span class="linenos">1074</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">series</span> <span class="o">=</span> <span class="n">new_ser</span>
</span><span id="L-1075"><a href="#L-1075"><span class="linenos">1075</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Series is already scraped, frequency and start, end dates are known. DatetimeIndex created</span><span class="se">\</span>
</span><span id="L-1076"><a href="#L-1076"><span class="linenos">1076</span></a><span class="s2">                        for series, set as index and series resampled at the frequency: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="si">}</span><span class="s2">. series attribute updated.&quot;</span><span class="p">)</span>
</span><span id="L-1077"><a href="#L-1077"><span class="linenos">1077</span></a>            <span class="k">return</span> <span class="n">dtIndex</span>
</span><span id="L-1078"><a href="#L-1078"><span class="linenos">1078</span></a>        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;series&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;frequency&quot;</span><span class="p">):</span>
</span><span id="L-1079"><a href="#L-1079"><span class="linenos">1079</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;No series found, using frequency and start and end dates to create a datetime x-index.&quot;</span><span class="p">)</span>
</span><span id="L-1080"><a href="#L-1080"><span class="linenos">1080</span></a>            <span class="n">dtIndex</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span> <span class="o">=</span> <span class="n">start_date</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">end_date</span><span class="p">,</span> <span class="n">freq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="p">)</span>
</span><span id="L-1081"><a href="#L-1081"><span class="linenos">1081</span></a>            <span class="k">return</span> <span class="n">dtIndex</span>
</span><span id="L-1082"><a href="#L-1082"><span class="linenos">1082</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1083"><a href="#L-1083"><span class="linenos">1083</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;No series found, frequenc unknown get the series or frequency first. Returning None&quot;</span><span class="p">)</span>
</span><span id="L-1084"><a href="#L-1084"><span class="linenos">1084</span></a>            <span class="k">return</span> <span class="kc">None</span> 
</span><span id="L-1085"><a href="#L-1085"><span class="linenos">1085</span></a>        
</span><span id="L-1086"><a href="#L-1086"><span class="linenos">1086</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">apply_x_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x_index</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">use_rounded_tempIndex</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">redo_series</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="L-1087"><a href="#L-1087"><span class="linenos">1087</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Apply a datetime index to the series. This will set the datetime index as the index of the series and resample the series to the frequency</span>
</span><span id="L-1088"><a href="#L-1088"><span class="linenos">1088</span></a><span class="sd">        of the datetime index. The series attribute of the class will be updated with the new series.</span>
</span><span id="L-1089"><a href="#L-1089"><span class="linenos">1089</span></a>
</span><span id="L-1090"><a href="#L-1090"><span class="linenos">1090</span></a><span class="sd">        **Parameters:**</span>
</span><span id="L-1091"><a href="#L-1091"><span class="linenos">1091</span></a><span class="sd">        - x_index (pd.DatetimeIndex): The datetime index to apply to the series. If None, the x_index attribute of the class will be used.</span>
</span><span id="L-1092"><a href="#L-1092"><span class="linenos">1092</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1093"><a href="#L-1093"><span class="linenos">1093</span></a>        <span class="k">if</span> <span class="n">x_index</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;x_index&quot;</span><span class="p">):</span>
</span><span id="L-1094"><a href="#L-1094"><span class="linenos">1094</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No datetime x-index found. Run make_x_index() first.&quot;</span><span class="p">)</span>
</span><span id="L-1095"><a href="#L-1095"><span class="linenos">1095</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-1096"><a href="#L-1096"><span class="linenos">1096</span></a>        <span class="k">elif</span> <span class="n">x_index</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1097"><a href="#L-1097"><span class="linenos">1097</span></a>            <span class="n">x_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_index</span>
</span><span id="L-1098"><a href="#L-1098"><span class="linenos">1098</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1099"><a href="#L-1099"><span class="linenos">1099</span></a>            <span class="k">pass</span>
</span><span id="L-1100"><a href="#L-1100"><span class="linenos">1100</span></a>
</span><span id="L-1101"><a href="#L-1101"><span class="linenos">1101</span></a>        <span class="k">if</span> <span class="n">redo_series</span><span class="p">:</span>
</span><span id="L-1102"><a href="#L-1102"><span class="linenos">1102</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">series</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trace_path_series_raw</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-1103"><a href="#L-1103"><span class="linenos">1103</span></a>
</span><span id="L-1104"><a href="#L-1104"><span class="linenos">1104</span></a>        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;series&quot;</span><span class="p">):</span>
</span><span id="L-1105"><a href="#L-1105"><span class="linenos">1105</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">series_extracted_from</span> <span class="o">==</span> <span class="s2">&quot;Line&quot;</span><span class="p">:</span>
</span><span id="L-1106"><a href="#L-1106"><span class="linenos">1106</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x_index</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="p">):</span>
</span><span id="L-1107"><a href="#L-1107"><span class="linenos">1107</span></a>                    <span class="n">new_ser</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">to_list</span><span class="p">(),</span> <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_index</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">series_name</span><span class="p">)</span>
</span><span id="L-1108"><a href="#L-1108"><span class="linenos">1108</span></a>                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">x_index</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="p">):</span>
</span><span id="L-1109"><a href="#L-1109"><span class="linenos">1109</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Length of x_index is greater than length of series. This is unfortunate, dunno what to do here...&quot;</span><span class="p">)</span>
</span><span id="L-1110"><a href="#L-1110"><span class="linenos">1110</span></a>                    <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-1111"><a href="#L-1111"><span class="linenos">1111</span></a>                <span class="k">else</span><span class="p">:</span> <span class="c1"># use_rounded_tempIndex:</span>
</span><span id="L-1112"><a href="#L-1112"><span class="linenos">1112</span></a>                    <span class="n">temp_index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span> <span class="o">=</span> <span class="n">x_index</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">end</span> <span class="o">=</span> <span class="n">x_index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">periods</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="p">))</span>
</span><span id="L-1113"><a href="#L-1113"><span class="linenos">1113</span></a>                    <span class="n">temp_index</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">round_to_freq</span><span class="p">(</span><span class="n">temp_index</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="p">)</span>
</span><span id="L-1114"><a href="#L-1114"><span class="linenos">1114</span></a>                    <span class="n">new_ser</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">to_list</span><span class="p">(),</span> <span class="n">index</span> <span class="o">=</span> <span class="n">temp_index</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">series_name</span><span class="p">)</span>
</span><span id="L-1115"><a href="#L-1115"><span class="linenos">1115</span></a>                    <span class="n">new_ser</span> <span class="o">=</span> <span class="n">new_ser</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
</span><span id="L-1116"><a href="#L-1116"><span class="linenos">1116</span></a>            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">series_extracted_from</span> <span class="o">==</span> <span class="s2">&quot;Spline&quot;</span><span class="p">:</span>
</span><span id="L-1117"><a href="#L-1117"><span class="linenos">1117</span></a>                <span class="n">temp_index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span> <span class="o">=</span> <span class="n">x_index</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">end</span> <span class="o">=</span> <span class="n">x_index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">periods</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="p">))</span>
</span><span id="L-1118"><a href="#L-1118"><span class="linenos">1118</span></a>                <span class="c1">#print(&quot;temp_index: &quot;, temp_index, &quot;len series: &quot;, len(self.series), &quot;len x_index: &quot;, len(x_index))</span>
</span><span id="L-1119"><a href="#L-1119"><span class="linenos">1119</span></a>                <span class="n">new_ser</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">to_list</span><span class="p">(),</span> <span class="n">index</span> <span class="o">=</span> <span class="n">temp_index</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">series_name</span><span class="p">)</span>
</span><span id="L-1120"><a href="#L-1120"><span class="linenos">1120</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">trace_path_series</span> <span class="o">=</span> <span class="n">new_ser</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-1121"><a href="#L-1121"><span class="linenos">1121</span></a>                <span class="n">new_ser</span> <span class="o">=</span> <span class="n">new_ser</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
</span><span id="L-1122"><a href="#L-1122"><span class="linenos">1122</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-1123"><a href="#L-1123"><span class="linenos">1123</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Series not extracted from Line or Spline chart. Cannot apply datetime index, go back and run the series_from_chart_soup method.&quot;</span><span class="p">)</span>
</span><span id="L-1124"><a href="#L-1124"><span class="linenos">1124</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-1125"><a href="#L-1125"><span class="linenos">1125</span></a>            
</span><span id="L-1126"><a href="#L-1126"><span class="linenos">1126</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">series</span> <span class="o">=</span> <span class="n">new_ser</span>  <span class="c1"># Update the series attribute with the new series.</span>
</span><span id="L-1127"><a href="#L-1127"><span class="linenos">1127</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">unscaled_series</span> <span class="o">=</span> <span class="n">new_ser</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-1128"><a href="#L-1128"><span class="linenos">1128</span></a>            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;metadata&quot;</span><span class="p">):</span>
</span><span id="L-1129"><a href="#L-1129"><span class="linenos">1129</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;frequency&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span>  <span class="c1"># Update the frequency in the metadata.</span>
</span><span id="L-1130"><a href="#L-1130"><span class="linenos">1130</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DateTimeIndex applied to series, series attribute updated.&quot;</span><span class="p">)</span>
</span><span id="L-1131"><a href="#L-1131"><span class="linenos">1131</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1132"><a href="#L-1132"><span class="linenos">1132</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;No series found, get the series first.&quot;</span><span class="p">)</span>
</span><span id="L-1133"><a href="#L-1133"><span class="linenos">1133</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-1134"><a href="#L-1134"><span class="linenos">1134</span></a>
</span><span id="L-1135"><a href="#L-1135"><span class="linenos">1135</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">extract_axis_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1136"><a href="#L-1136"><span class="linenos">1136</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract axis limits from the chart in terms of pixel co-ordinates.&quot;&quot;&quot;</span>
</span><span id="L-1137"><a href="#L-1137"><span class="linenos">1137</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Extracting axis limits from the chart...&quot;</span><span class="p">)</span>
</span><span id="L-1138"><a href="#L-1138"><span class="linenos">1138</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-1139"><a href="#L-1139"><span class="linenos">1139</span></a>            <span class="c1"># Extract axis elements</span>
</span><span id="L-1140"><a href="#L-1140"><span class="linenos">1140</span></a>            <span class="n">yax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_soup</span><span class="o">.</span><span class="n">select_one</span><span class="p">(</span><span class="s2">&quot;g.highcharts-axis.highcharts-yaxis path.highcharts-axis-line&quot;</span><span class="p">)</span>
</span><span id="L-1141"><a href="#L-1141"><span class="linenos">1141</span></a>            <span class="n">xax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_soup</span><span class="o">.</span><span class="n">select_one</span><span class="p">(</span><span class="s2">&quot;g.highcharts-axis.highcharts-xaxis path.highcharts-axis-line&quot;</span><span class="p">)</span>
</span><span id="L-1142"><a href="#L-1142"><span class="linenos">1142</span></a>            
</span><span id="L-1143"><a href="#L-1143"><span class="linenos">1143</span></a>            <span class="n">ylims</span> <span class="o">=</span> <span class="n">yax</span><span class="p">[</span><span class="s2">&quot;d&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;M&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;L&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
</span><span id="L-1144"><a href="#L-1144"><span class="linenos">1144</span></a>            <span class="n">ylims</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">num</span><span class="p">)</span> <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="n">ylims</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">num</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
</span><span id="L-1145"><a href="#L-1145"><span class="linenos">1145</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;yax: </span><span class="si">{</span><span class="n">ylims</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1146"><a href="#L-1146"><span class="linenos">1146</span></a>
</span><span id="L-1147"><a href="#L-1147"><span class="linenos">1147</span></a>            <span class="n">xlims</span> <span class="o">=</span> <span class="n">xax</span><span class="p">[</span><span class="s2">&quot;d&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;M&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;L&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
</span><span id="L-1148"><a href="#L-1148"><span class="linenos">1148</span></a>            <span class="n">xlims</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">num</span><span class="p">)</span> <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="n">xlims</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">num</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
</span><span id="L-1149"><a href="#L-1149"><span class="linenos">1149</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;xax: </span><span class="si">{</span><span class="n">xlims</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1150"><a href="#L-1150"><span class="linenos">1150</span></a>            
</span><span id="L-1151"><a href="#L-1151"><span class="linenos">1151</span></a>            <span class="n">axis_limits</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-1152"><a href="#L-1152"><span class="linenos">1152</span></a>                <span class="s1">&#39;x_min&#39;</span><span class="p">:</span> <span class="n">xlims</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span><span id="L-1153"><a href="#L-1153"><span class="linenos">1153</span></a>                <span class="s1">&#39;x_max&#39;</span><span class="p">:</span> <span class="n">xlims</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
</span><span id="L-1154"><a href="#L-1154"><span class="linenos">1154</span></a>                <span class="s1">&#39;y_min&#39;</span><span class="p">:</span> <span class="n">ylims</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
</span><span id="L-1155"><a href="#L-1155"><span class="linenos">1155</span></a>                <span class="s1">&#39;y_max&#39;</span><span class="p">:</span> <span class="n">ylims</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-1156"><a href="#L-1156"><span class="linenos">1156</span></a>            <span class="p">}</span>
</span><span id="L-1157"><a href="#L-1157"><span class="linenos">1157</span></a>            
</span><span id="L-1158"><a href="#L-1158"><span class="linenos">1158</span></a>            <span class="k">return</span> <span class="n">axis_limits</span>
</span><span id="L-1159"><a href="#L-1159"><span class="linenos">1159</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-1160"><a href="#L-1160"><span class="linenos">1160</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error extracting axis limits: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1161"><a href="#L-1161"><span class="linenos">1161</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error extracting axis limits: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1162"><a href="#L-1162"><span class="linenos">1162</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-1163"><a href="#L-1163"><span class="linenos">1163</span></a>    
</span><span id="L-1164"><a href="#L-1164"><span class="linenos">1164</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">plot_series</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">series</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
</span><span id="L-1165"><a href="#L-1165"><span class="linenos">1165</span></a>                    <span class="n">annotation_text</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
</span><span id="L-1166"><a href="#L-1166"><span class="linenos">1166</span></a>                    <span class="n">dpi</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">300</span><span class="p">,</span> 
</span><span id="L-1167"><a href="#L-1167"><span class="linenos">1167</span></a>                    <span class="n">ann_box_pos</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span> <span class="mf">0.2</span><span class="p">),</span>
</span><span id="L-1168"><a href="#L-1168"><span class="linenos">1168</span></a>                    <span class="n">show_fig</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-1169"><a href="#L-1169"><span class="linenos">1169</span></a>                    <span class="n">return_fig</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-1170"><a href="#L-1170"><span class="linenos">1170</span></a>                    <span class="n">invert_yaxis</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">layout_updates</span><span class="p">):</span>
</span><span id="L-1171"><a href="#L-1171"><span class="linenos">1171</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1172"><a href="#L-1172"><span class="linenos">1172</span></a><span class="sd">        Plots the time series data using pandas with plotly as the backend. Plotly is set as the pandas backend in __init__.py for tedata.</span>
</span><span id="L-1173"><a href="#L-1173"><span class="linenos">1173</span></a><span class="sd">        If you want to use matplotlib or other plotting library don&#39;t use this method, plot the series attribute data directly. If using jupyter</span>
</span><span id="L-1174"><a href="#L-1174"><span class="linenos">1174</span></a><span class="sd">        you can set </span>
</span><span id="L-1175"><a href="#L-1175"><span class="linenos">1175</span></a>
</span><span id="L-1176"><a href="#L-1176"><span class="linenos">1176</span></a><span class="sd">        **Parameters**</span>
</span><span id="L-1177"><a href="#L-1177"><span class="linenos">1177</span></a><span class="sd">        - series (pd.Series): The series to plot. Default is None. If None, the series attribute of the class will be plotted.</span>
</span><span id="L-1178"><a href="#L-1178"><span class="linenos">1178</span></a><span class="sd">        - annotation_text (str): Text to display in the annotation box at the bottom of the chart. Default is None. If None, the default annotation text</span>
</span><span id="L-1179"><a href="#L-1179"><span class="linenos">1179</span></a><span class="sd">        will be created from the metadata.</span>
</span><span id="L-1180"><a href="#L-1180"><span class="linenos">1180</span></a><span class="sd">        - dpi (int): The resolution of the plot in dots per inch. Default is 300.</span>
</span><span id="L-1181"><a href="#L-1181"><span class="linenos">1181</span></a><span class="sd">        - ann_box_pos (tuple): The position of the annotation box on the chart. Default is (0, -0.23) which is bottom left.</span>
</span><span id="L-1182"><a href="#L-1182"><span class="linenos">1182</span></a>
</span><span id="L-1183"><a href="#L-1183"><span class="linenos">1183</span></a><span class="sd">        **Returns** None</span>
</span><span id="L-1184"><a href="#L-1184"><span class="linenos">1184</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1185"><a href="#L-1185"><span class="linenos">1185</span></a>        
</span><span id="L-1186"><a href="#L-1186"><span class="linenos">1186</span></a>        <span class="k">if</span> <span class="n">series</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1187"><a href="#L-1187"><span class="linenos">1187</span></a>            <span class="n">series</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">series</span>
</span><span id="L-1188"><a href="#L-1188"><span class="linenos">1188</span></a>
</span><span id="L-1189"><a href="#L-1189"><span class="linenos">1189</span></a>        <span class="n">fig</span> <span class="o">=</span> <span class="n">series</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>  <span class="c1"># Plot the series using pandas, plotly needs to be set as the pandas plotting backend.</span>
</span><span id="L-1190"><a href="#L-1190"><span class="linenos">1190</span></a>
</span><span id="L-1191"><a href="#L-1191"><span class="linenos">1191</span></a>         <span class="c1"># Existing title and label logic</span>
</span><span id="L-1192"><a href="#L-1192"><span class="linenos">1192</span></a>        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;series_metadata&quot;</span><span class="p">):</span>
</span><span id="L-1193"><a href="#L-1193"><span class="linenos">1193</span></a>            <span class="n">title</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series_metadata</span><span class="p">[</span><span class="s2">&quot;country&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series_metadata</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span>
</span><span id="L-1194"><a href="#L-1194"><span class="linenos">1194</span></a>            <span class="n">ylabel</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series_metadata</span><span class="p">[</span><span class="s2">&quot;units&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span>
</span><span id="L-1195"><a href="#L-1195"><span class="linenos">1195</span></a>            
</span><span id="L-1196"><a href="#L-1196"><span class="linenos">1196</span></a>            <span class="c1"># Create default annotation text from metadata</span>
</span><span id="L-1197"><a href="#L-1197"><span class="linenos">1197</span></a>            <span class="n">frequency</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;frequency&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;frequency&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">else</span> <span class="s2">&quot;Unknown&quot;</span>
</span><span id="L-1198"><a href="#L-1198"><span class="linenos">1198</span></a>            <span class="k">if</span> <span class="n">annotation_text</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1199"><a href="#L-1199"><span class="linenos">1199</span></a>                <span class="n">annotation_text</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-1200"><a href="#L-1200"><span class="linenos">1200</span></a>                    <span class="sa">f</span><span class="s2">&quot;Source: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;source&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&lt;br&gt;&quot;</span>
</span><span id="L-1201"><a href="#L-1201"><span class="linenos">1201</span></a>                    <span class="sa">f</span><span class="s2">&quot;Original Source: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;original_source&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&lt;br&gt;&quot;</span>
</span><span id="L-1202"><a href="#L-1202"><span class="linenos">1202</span></a>                    <span class="sa">f</span><span class="s2">&quot;Frequency: </span><span class="si">{</span><span class="n">frequency</span><span class="si">}</span><span class="s2">&lt;br&gt;&quot;</span>
</span><span id="L-1203"><a href="#L-1203"><span class="linenos">1203</span></a>                <span class="p">)</span>
</span><span id="L-1204"><a href="#L-1204"><span class="linenos">1204</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1205"><a href="#L-1205"><span class="linenos">1205</span></a>            <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Time Series Plot&quot;</span>
</span><span id="L-1206"><a href="#L-1206"><span class="linenos">1206</span></a>            <span class="n">ylabel</span> <span class="o">=</span> <span class="s2">&quot;Value&quot;</span>
</span><span id="L-1207"><a href="#L-1207"><span class="linenos">1207</span></a>            <span class="n">annotation_text</span> <span class="o">=</span> <span class="n">annotation_text</span> <span class="ow">or</span> <span class="s2">&quot;Source: Trading Economics&quot;</span>
</span><span id="L-1208"><a href="#L-1208"><span class="linenos">1208</span></a>
</span><span id="L-1209"><a href="#L-1209"><span class="linenos">1209</span></a>        <span class="c1"># Add text annotation to bottom left</span>
</span><span id="L-1210"><a href="#L-1210"><span class="linenos">1210</span></a>        <span class="n">fig</span><span class="o">.</span><span class="n">add_annotation</span><span class="p">(</span>
</span><span id="L-1211"><a href="#L-1211"><span class="linenos">1211</span></a>            <span class="n">text</span><span class="o">=</span><span class="n">annotation_text</span><span class="p">,</span>
</span><span id="L-1212"><a href="#L-1212"><span class="linenos">1212</span></a>            <span class="n">xref</span><span class="o">=</span><span class="s2">&quot;paper&quot;</span><span class="p">,</span> <span class="n">yref</span><span class="o">=</span><span class="s2">&quot;paper&quot;</span><span class="p">,</span>
</span><span id="L-1213"><a href="#L-1213"><span class="linenos">1213</span></a>            <span class="n">x</span><span class="o">=</span><span class="n">ann_box_pos</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">ann_box_pos</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
</span><span id="L-1214"><a href="#L-1214"><span class="linenos">1214</span></a>            <span class="n">showarrow</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">),</span>
</span><span id="L-1215"><a href="#L-1215"><span class="linenos">1215</span></a>            <span class="n">align</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>  <span class="n">xanchor</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
</span><span id="L-1216"><a href="#L-1216"><span class="linenos">1216</span></a>            <span class="n">yanchor</span><span class="o">=</span><span class="s2">&quot;bottom&quot;</span><span class="p">,</span> <span class="n">bgcolor</span><span class="o">=</span><span class="s2">&quot;rgba(255, 255, 255, 0.8)&quot;</span><span class="p">,</span>
</span><span id="L-1217"><a href="#L-1217"><span class="linenos">1217</span></a>            <span class="n">bordercolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">borderwidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-1218"><a href="#L-1218"><span class="linenos">1218</span></a>
</span><span id="L-1219"><a href="#L-1219"><span class="linenos">1219</span></a>           <span class="c1"># Add y-axis inversion if requested</span>
</span><span id="L-1220"><a href="#L-1220"><span class="linenos">1220</span></a>        <span class="k">if</span> <span class="n">invert_yaxis</span><span class="p">:</span>
</span><span id="L-1221"><a href="#L-1221"><span class="linenos">1221</span></a>            <span class="n">layout_updates</span><span class="p">[</span><span class="s1">&#39;yaxis&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
</span><span id="L-1222"><a href="#L-1222"><span class="linenos">1222</span></a>                <span class="n">autorange</span><span class="o">=</span><span class="s1">&#39;reversed&#39;</span>  <span class="c1"># This inverts the y-axis</span>
</span><span id="L-1223"><a href="#L-1223"><span class="linenos">1223</span></a>            <span class="p">)</span>
</span><span id="L-1224"><a href="#L-1224"><span class="linenos">1224</span></a>
</span><span id="L-1225"><a href="#L-1225"><span class="linenos">1225</span></a>        <span class="c1"># Label x and y axis</span>
</span><span id="L-1226"><a href="#L-1226"><span class="linenos">1226</span></a>        <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
</span><span id="L-1227"><a href="#L-1227"><span class="linenos">1227</span></a>            <span class="n">legend</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
</span><span id="L-1228"><a href="#L-1228"><span class="linenos">1228</span></a>            <span class="n">title_text</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>  <span class="c1"># Remove legend title</span>
</span><span id="L-1229"><a href="#L-1229"><span class="linenos">1229</span></a>            <span class="n">orientation</span><span class="o">=</span><span class="s2">&quot;h&quot;</span><span class="p">,</span>
</span><span id="L-1230"><a href="#L-1230"><span class="linenos">1230</span></a>            <span class="n">yanchor</span><span class="o">=</span><span class="s2">&quot;bottom&quot;</span><span class="p">,</span>
</span><span id="L-1231"><a href="#L-1231"><span class="linenos">1231</span></a>            <span class="n">y</span><span class="o">=-</span><span class="mf">0.2</span><span class="p">,</span>  <span class="c1"># Adjust this value to move the legend further down</span>
</span><span id="L-1232"><a href="#L-1232"><span class="linenos">1232</span></a>            <span class="n">xanchor</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
</span><span id="L-1233"><a href="#L-1233"><span class="linenos">1233</span></a>            <span class="n">x</span><span class="o">=</span><span class="mf">0.5</span>
</span><span id="L-1234"><a href="#L-1234"><span class="linenos">1234</span></a>            <span class="p">),</span>
</span><span id="L-1235"><a href="#L-1235"><span class="linenos">1235</span></a>            <span class="n">yaxis_title</span><span class="o">=</span><span class="n">ylabel</span><span class="p">,</span>
</span><span id="L-1236"><a href="#L-1236"><span class="linenos">1236</span></a>            <span class="n">xaxis_title</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="L-1237"><a href="#L-1237"><span class="linenos">1237</span></a>            <span class="n">title</span> <span class="o">=</span> <span class="n">title</span><span class="p">)</span>
</span><span id="L-1238"><a href="#L-1238"><span class="linenos">1238</span></a>        
</span><span id="L-1239"><a href="#L-1239"><span class="linenos">1239</span></a>            <span class="c1"># Update the layout</span>
</span><span id="L-1240"><a href="#L-1240"><span class="linenos">1240</span></a>        <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="o">**</span><span class="n">layout_updates</span><span class="p">)</span>
</span><span id="L-1241"><a href="#L-1241"><span class="linenos">1241</span></a>
</span><span id="L-1242"><a href="#L-1242"><span class="linenos">1242</span></a>        <span class="c1"># Show the figure</span>
</span><span id="L-1243"><a href="#L-1243"><span class="linenos">1243</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">plot</span> <span class="o">=</span> <span class="n">fig</span>
</span><span id="L-1244"><a href="#L-1244"><span class="linenos">1244</span></a>        <span class="k">if</span> <span class="n">show_fig</span><span class="p">:</span>
</span><span id="L-1245"><a href="#L-1245"><span class="linenos">1245</span></a>            <span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="L-1246"><a href="#L-1246"><span class="linenos">1246</span></a>        <span class="k">if</span> <span class="n">return_fig</span><span class="p">:</span>
</span><span id="L-1247"><a href="#L-1247"><span class="linenos">1247</span></a>            <span class="k">return</span> <span class="n">fig</span>
</span><span id="L-1248"><a href="#L-1248"><span class="linenos">1248</span></a>
</span><span id="L-1249"><a href="#L-1249"><span class="linenos">1249</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">save_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;plot&quot;</span><span class="p">,</span> <span class="n">save_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="n">dpi</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">300</span><span class="p">,</span> <span class="nb">format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;png&quot;</span><span class="p">):</span>
</span><span id="L-1250"><a href="#L-1250"><span class="linenos">1250</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Save the plot to a file. The plot must be created using the plot_series method. This method will save the plot as a PNG image file.</span>
</span><span id="L-1251"><a href="#L-1251"><span class="linenos">1251</span></a>
</span><span id="L-1252"><a href="#L-1252"><span class="linenos">1252</span></a><span class="sd">        **Parameters**</span>
</span><span id="L-1253"><a href="#L-1253"><span class="linenos">1253</span></a><span class="sd">        - filename (str): The name of the file to save the plot to. Default is &#39;plot.png&#39;.</span>
</span><span id="L-1254"><a href="#L-1254"><span class="linenos">1254</span></a><span class="sd">        - save_path (str): The directory to save the plot to. Default is the current working directory.</span>
</span><span id="L-1255"><a href="#L-1255"><span class="linenos">1255</span></a><span class="sd">        - dpi (int): The resolution of the plot in dots per inch. Default is 300.</span>
</span><span id="L-1256"><a href="#L-1256"><span class="linenos">1256</span></a><span class="sd">        - format (str): The format to save the plot in. Default is &#39;png&#39;. Other options are: &quot;html&quot;, &quot;bmp&quot;, &quot;jpeg&quot;, &quot;jpg&quot;.</span>
</span><span id="L-1257"><a href="#L-1257"><span class="linenos">1257</span></a><span class="sd">        Use &quot;html&quot; to save as an interactive plotly plot.</span>
</span><span id="L-1258"><a href="#L-1258"><span class="linenos">1258</span></a>
</span><span id="L-1259"><a href="#L-1259"><span class="linenos">1259</span></a><span class="sd">        :Returns: None</span>
</span><span id="L-1260"><a href="#L-1260"><span class="linenos">1260</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1261"><a href="#L-1261"><span class="linenos">1261</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;plot&quot;</span><span class="p">):</span>
</span><span id="L-1262"><a href="#L-1262"><span class="linenos">1262</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Error: Plot not found. Run plot_series() method to create a plot.&quot;</span><span class="p">)</span>
</span><span id="L-1263"><a href="#L-1263"><span class="linenos">1263</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-1264"><a href="#L-1264"><span class="linenos">1264</span></a>
</span><span id="L-1265"><a href="#L-1265"><span class="linenos">1265</span></a>        <span class="k">if</span> <span class="nb">format</span> <span class="o">==</span> <span class="s2">&quot;html&quot;</span><span class="p">:</span>
</span><span id="L-1266"><a href="#L-1266"><span class="linenos">1266</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">write_html</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">save_path</span><span class="si">}{</span><span class="n">fdel</span><span class="si">}{</span><span class="n">filename</span><span class="si">}</span><span class="s2">.html&quot;</span><span class="p">)</span>
</span><span id="L-1267"><a href="#L-1267"><span class="linenos">1267</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Plot saved as </span><span class="si">{</span><span class="n">save_path</span><span class="si">}{</span><span class="n">fdel</span><span class="si">}{</span><span class="n">filename</span><span class="si">}</span><span class="s2">.html&quot;</span><span class="p">)</span>
</span><span id="L-1268"><a href="#L-1268"><span class="linenos">1268</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1269"><a href="#L-1269"><span class="linenos">1269</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">write_image</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">save_path</span><span class="si">}{</span><span class="n">fdel</span><span class="si">}{</span><span class="n">filename</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="nb">format</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="nb">format</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">dpi</span><span class="o">/</span><span class="mi">100</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="mi">1400</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="mi">500</span><span class="p">)</span>
</span><span id="L-1270"><a href="#L-1270"><span class="linenos">1270</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Plot saved as </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1271"><a href="#L-1271"><span class="linenos">1271</span></a>        <span class="k">return</span> <span class="kc">True</span>
</span><span id="L-1272"><a href="#L-1272"><span class="linenos">1272</span></a>
</span><span id="L-1273"><a href="#L-1273"><span class="linenos">1273</span></a>
</span><span id="L-1274"><a href="#L-1274"><span class="linenos">1274</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">scrape_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1275"><a href="#L-1275"><span class="linenos">1275</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Scrape metadata from the page. This method scrapes metadata from the page and stores it in the &#39;metadata&#39; attribute. The metadata</span>
</span><span id="L-1276"><a href="#L-1276"><span class="linenos">1276</span></a><span class="sd">        includes the title, indicator, country, length, frequency, source, , original source, id, start date, end date, min value, and max value of the series.</span>
</span><span id="L-1277"><a href="#L-1277"><span class="linenos">1277</span></a><span class="sd">        It also scrapes a description of the series if available and stores it in the &#39;description&#39; attribute.</span>
</span><span id="L-1278"><a href="#L-1278"><span class="linenos">1278</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1279"><a href="#L-1279"><span class="linenos">1279</span></a>
</span><span id="L-1280"><a href="#L-1280"><span class="linenos">1280</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-1281"><a href="#L-1281"><span class="linenos">1281</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Scraping metadata for the series from the page...&quot;</span><span class="p">)</span>
</span><span id="L-1282"><a href="#L-1282"><span class="linenos">1282</span></a>
</span><span id="L-1283"><a href="#L-1283"><span class="linenos">1283</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-1284"><a href="#L-1284"><span class="linenos">1284</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;units&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_soup</span><span class="o">.</span><span class="n">select_one</span><span class="p">(</span><span class="s1">&#39;#singleIndChartUnit2&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
</span><span id="L-1285"><a href="#L-1285"><span class="linenos">1285</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-1286"><a href="#L-1286"><span class="linenos">1286</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Units label not found: &quot;</span><span class="p">,</span> <span class="p">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)})</span>
</span><span id="L-1287"><a href="#L-1287"><span class="linenos">1287</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;units&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;a.u&quot;</span>
</span><span id="L-1288"><a href="#L-1288"><span class="linenos">1288</span></a>        
</span><span id="L-1289"><a href="#L-1289"><span class="linenos">1289</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-1290"><a href="#L-1290"><span class="linenos">1290</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;original_source&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_soup</span><span class="o">.</span><span class="n">select_one</span><span class="p">(</span><span class="s1">&#39;#singleIndChartUnit&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
</span><span id="L-1291"><a href="#L-1291"><span class="linenos">1291</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-1292"><a href="#L-1292"><span class="linenos">1292</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;original_source label not found: &quot;</span><span class="p">,</span> <span class="p">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)})</span>
</span><span id="L-1293"><a href="#L-1293"><span class="linenos">1293</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;original_source&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;unknown&quot;</span>
</span><span id="L-1294"><a href="#L-1294"><span class="linenos">1294</span></a>
</span><span id="L-1295"><a href="#L-1295"><span class="linenos">1295</span></a>        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;page_soup&quot;</span><span class="p">):</span>
</span><span id="L-1296"><a href="#L-1296"><span class="linenos">1296</span></a>            <span class="n">heads</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">page_soup</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;#ctl00_Head1&quot;</span><span class="p">)</span>
</span><span id="L-1297"><a href="#L-1297"><span class="linenos">1297</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">heads</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="L-1298"><a href="#L-1298"><span class="linenos">1298</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1299"><a href="#L-1299"><span class="linenos">1299</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span>  <span class="c1"># Use URL if can&#39;t find the title</span>
</span><span id="L-1300"><a href="#L-1300"><span class="linenos">1300</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;indicator&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span>  
</span><span id="L-1301"><a href="#L-1301"><span class="linenos">1301</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;country&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span> 
</span><span id="L-1302"><a href="#L-1302"><span class="linenos">1302</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;source&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Trading Economics&quot;</span> 
</span><span id="L-1303"><a href="#L-1303"><span class="linenos">1303</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">last_url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">:])</span>
</span><span id="L-1304"><a href="#L-1304"><span class="linenos">1304</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Series metadata: </span><span class="se">\n</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1305"><a href="#L-1305"><span class="linenos">1305</span></a>
</span><span id="L-1306"><a href="#L-1306"><span class="linenos">1306</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-1307"><a href="#L-1307"><span class="linenos">1307</span></a>            <span class="n">desc_card</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">page_soup</span><span class="o">.</span><span class="n">select_one</span><span class="p">(</span><span class="s2">&quot;#item_definition&quot;</span><span class="p">)</span>
</span><span id="L-1308"><a href="#L-1308"><span class="linenos">1308</span></a>            <span class="n">header_text</span> <span class="o">=</span> <span class="n">desc_card</span><span class="o">.</span><span class="n">select_one</span><span class="p">(</span><span class="s1">&#39;.card-header&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="L-1309"><a href="#L-1309"><span class="linenos">1309</span></a>            <span class="k">if</span> <span class="n">header_text</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
</span><span id="L-1310"><a href="#L-1310"><span class="linenos">1310</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;description&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">desc_card</span><span class="o">.</span><span class="n">select_one</span><span class="p">(</span><span class="s1">&#39;.card-body&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="L-1311"><a href="#L-1311"><span class="linenos">1311</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-1312"><a href="#L-1312"><span class="linenos">1312</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Description card title does not match series title.&quot;</span><span class="p">)</span>
</span><span id="L-1313"><a href="#L-1313"><span class="linenos">1313</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;description&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Description not found.&quot;</span>
</span><span id="L-1314"><a href="#L-1314"><span class="linenos">1314</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-1315"><a href="#L-1315"><span class="linenos">1315</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Description card not found: &quot;</span><span class="p">,</span> <span class="p">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)})</span>
</span><span id="L-1316"><a href="#L-1316"><span class="linenos">1316</span></a>
</span><span id="L-1317"><a href="#L-1317"><span class="linenos">1317</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">series_metadata</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">)</span>
</span><span id="L-1318"><a href="#L-1318"><span class="linenos">1318</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1319"><a href="#L-1319"><span class="linenos">1319</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Metadata scraped successfully: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1320"><a href="#L-1320"><span class="linenos">1320</span></a>
</span><span id="L-1321"><a href="#L-1321"><span class="linenos">1321</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">export_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">savePath</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="L-1322"><a href="#L-1322"><span class="linenos">1322</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; Export the series data to an excel .xlsx file. The series and metadata attributes must be set before running this method.</span>
</span><span id="L-1323"><a href="#L-1323"><span class="linenos">1323</span></a><span class="sd">        Only do it after scraping the series data. The metadata will be saved in a separate sheet in the same file.</span>
</span><span id="L-1324"><a href="#L-1324"><span class="linenos">1324</span></a><span class="sd">        </span>
</span><span id="L-1325"><a href="#L-1325"><span class="linenos">1325</span></a><span class="sd">        **Parameters**</span>
</span><span id="L-1326"><a href="#L-1326"><span class="linenos">1326</span></a><span class="sd">        - savePath (str): The directory to save the file to. Default is the current working directory.</span>
</span><span id="L-1327"><a href="#L-1327"><span class="linenos">1327</span></a><span class="sd">        - filename (str): The name of the file to save the data to. Default is the name of the series. &quot;&quot;&quot;</span>
</span><span id="L-1328"><a href="#L-1328"><span class="linenos">1328</span></a>        
</span><span id="L-1329"><a href="#L-1329"><span class="linenos">1329</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;series&quot;</span><span class="p">):</span>
</span><span id="L-1330"><a href="#L-1330"><span class="linenos">1330</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No series found. Run the series_from_chart_soup method first.&quot;</span><span class="p">)</span>
</span><span id="L-1331"><a href="#L-1331"><span class="linenos">1331</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-1332"><a href="#L-1332"><span class="linenos">1332</span></a>        <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1333"><a href="#L-1333"><span class="linenos">1333</span></a>            <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">series_name</span>
</span><span id="L-1334"><a href="#L-1334"><span class="linenos">1334</span></a>
</span><span id="L-1335"><a href="#L-1335"><span class="linenos">1335</span></a>        <span class="k">with</span> <span class="n">pd</span><span class="o">.</span><span class="n">ExcelWriter</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">savePath</span><span class="si">}{</span><span class="n">fdel</span><span class="si">}{</span><span class="n">filename</span><span class="si">}</span><span class="s2">.xlsx&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">writer</span><span class="p">:</span>
</span><span id="L-1336"><a href="#L-1336"><span class="linenos">1336</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="s1">&#39;Data&#39;</span><span class="p">)</span>
</span><span id="L-1337"><a href="#L-1337"><span class="linenos">1337</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">series_metadata</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="s1">&#39;Metadata&#39;</span><span class="p">)</span>
</span><span id="L-1338"><a href="#L-1338"><span class="linenos">1338</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Data exported to </span><span class="si">{</span><span class="n">savePath</span><span class="si">}{</span><span class="n">fdel</span><span class="si">}{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1339"><a href="#L-1339"><span class="linenos">1339</span></a>
</span><span id="L-1340"><a href="#L-1340"><span class="linenos">1340</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_page_source</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1341"><a href="#L-1341"><span class="linenos">1341</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get current page source after interactions&quot;&quot;&quot;</span>
</span><span id="L-1342"><a href="#L-1342"><span class="linenos">1342</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">page_source</span>
</span><span id="L-1343"><a href="#L-1343"><span class="linenos">1343</span></a>    
</span><span id="L-1344"><a href="#L-1344"><span class="linenos">1344</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1345"><a href="#L-1345"><span class="linenos">1345</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Clean up resources completely by closing the WebDriver and removing references&quot;&quot;&quot;</span>
</span><span id="L-1346"><a href="#L-1346"><span class="linenos">1346</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-1347"><a href="#L-1347"><span class="linenos">1347</span></a>            <span class="c1"># First try graceful close with quitting the driver</span>
</span><span id="L-1348"><a href="#L-1348"><span class="linenos">1348</span></a>            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;driver&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="p">:</span>
</span><span id="L-1349"><a href="#L-1349"><span class="linenos">1349</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="L-1350"><a href="#L-1350"><span class="linenos">1350</span></a>                    <span class="c1"># Close all windows/tabs first</span>
</span><span id="L-1351"><a href="#L-1351"><span class="linenos">1351</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="L-1352"><a href="#L-1352"><span class="linenos">1352</span></a>                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-1353"><a href="#L-1353"><span class="linenos">1353</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error closing window: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1354"><a href="#L-1354"><span class="linenos">1354</span></a>                    <span class="k">pass</span>
</span><span id="L-1355"><a href="#L-1355"><span class="linenos">1355</span></a>                
</span><span id="L-1356"><a href="#L-1356"><span class="linenos">1356</span></a>                <span class="c1"># Then quit the driver completely with error handling for connection issues</span>
</span><span id="L-1357"><a href="#L-1357"><span class="linenos">1357</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="L-1358"><a href="#L-1358"><span class="linenos">1358</span></a>                    <span class="kn">from</span><span class="w"> </span><span class="nn">selenium.common.exceptions</span><span class="w"> </span><span class="kn">import</span> <span class="n">WebDriverException</span>
</span><span id="L-1359"><a href="#L-1359"><span class="linenos">1359</span></a>                    <span class="kn">from</span><span class="w"> </span><span class="nn">urllib3.exceptions</span><span class="w"> </span><span class="kn">import</span> <span class="n">MaxRetryError</span><span class="p">,</span> <span class="n">NewConnectionError</span>
</span><span id="L-1360"><a href="#L-1360"><span class="linenos">1360</span></a>                    
</span><span id="L-1361"><a href="#L-1361"><span class="linenos">1361</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="L-1362"><a href="#L-1362"><span class="linenos">1362</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
</span><span id="L-1363"><a href="#L-1363"><span class="linenos">1363</span></a>                    <span class="k">except</span> <span class="p">(</span><span class="n">WebDriverException</span><span class="p">,</span> <span class="n">MaxRetryError</span><span class="p">,</span> <span class="n">NewConnectionError</span><span class="p">,</span> <span class="ne">ConnectionRefusedError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-1364"><a href="#L-1364"><span class="linenos">1364</span></a>                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Connection error when quitting driver (this is normal if browser crashed): </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1365"><a href="#L-1365"><span class="linenos">1365</span></a>                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-1366"><a href="#L-1366"><span class="linenos">1366</span></a>                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error quitting driver: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1367"><a href="#L-1367"><span class="linenos">1367</span></a>                <span class="k">finally</span><span class="p">:</span>
</span><span id="L-1368"><a href="#L-1368"><span class="linenos">1368</span></a>                    <span class="c1"># Clear the reference regardless of success</span>
</span><span id="L-1369"><a href="#L-1369"><span class="linenos">1369</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">driver</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-1370"><a href="#L-1370"><span class="linenos">1370</span></a>            
</span><span id="L-1371"><a href="#L-1371"><span class="linenos">1371</span></a>            <span class="c1"># Also close any tooltip_scraper drivers if they exist</span>
</span><span id="L-1372"><a href="#L-1372"><span class="linenos">1372</span></a>            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;tooltip_scraper&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">tooltip_scraper</span><span class="p">:</span>
</span><span id="L-1373"><a href="#L-1373"><span class="linenos">1373</span></a>                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tooltip_scraper</span><span class="p">,</span> <span class="s2">&quot;driver&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">tooltip_scraper</span><span class="o">.</span><span class="n">driver</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">tooltip_scraper</span><span class="o">.</span><span class="n">driver</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="p">:</span>
</span><span id="L-1374"><a href="#L-1374"><span class="linenos">1374</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="L-1375"><a href="#L-1375"><span class="linenos">1375</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">tooltip_scraper</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
</span><span id="L-1376"><a href="#L-1376"><span class="linenos">1376</span></a>                    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="L-1377"><a href="#L-1377"><span class="linenos">1377</span></a>                        <span class="k">pass</span>
</span><span id="L-1378"><a href="#L-1378"><span class="linenos">1378</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">tooltip_scraper</span><span class="o">.</span><span class="n">driver</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-1379"><a href="#L-1379"><span class="linenos">1379</span></a>            
</span><span id="L-1380"><a href="#L-1380"><span class="linenos">1380</span></a>            <span class="c1"># Clear any large data attributes to help garbage collection</span>
</span><span id="L-1381"><a href="#L-1381"><span class="linenos">1381</span></a>            <span class="n">large_attributes</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;series&quot;</span><span class="p">,</span> <span class="s2">&quot;trace_path_series&quot;</span><span class="p">,</span> <span class="s2">&quot;full_page&quot;</span><span class="p">,</span> <span class="s2">&quot;page_soup&quot;</span><span class="p">,</span> 
</span><span id="L-1382"><a href="#L-1382"><span class="linenos">1382</span></a>                            <span class="s2">&quot;chart_soup&quot;</span><span class="p">,</span> <span class="s2">&quot;full_chart&quot;</span><span class="p">,</span> <span class="s2">&quot;plot&quot;</span><span class="p">]</span>
</span><span id="L-1383"><a href="#L-1383"><span class="linenos">1383</span></a>            
</span><span id="L-1384"><a href="#L-1384"><span class="linenos">1384</span></a>            <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">large_attributes</span><span class="p">:</span>
</span><span id="L-1385"><a href="#L-1385"><span class="linenos">1385</span></a>                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
</span><span id="L-1386"><a href="#L-1386"><span class="linenos">1386</span></a>                    <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="L-1387"><a href="#L-1387"><span class="linenos">1387</span></a>                    
</span><span id="L-1388"><a href="#L-1388"><span class="linenos">1388</span></a>            <span class="c1"># Force garbage collection</span>
</span><span id="L-1389"><a href="#L-1389"><span class="linenos">1389</span></a>            <span class="kn">import</span><span class="w"> </span><span class="nn">gc</span>
</span><span id="L-1390"><a href="#L-1390"><span class="linenos">1390</span></a>            <span class="n">gc</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
</span><span id="L-1391"><a href="#L-1391"><span class="linenos">1391</span></a>            
</span><span id="L-1392"><a href="#L-1392"><span class="linenos">1392</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Scraper resources successfully released&quot;</span><span class="p">)</span>
</span><span id="L-1393"><a href="#L-1393"><span class="linenos">1393</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-1394"><a href="#L-1394"><span class="linenos">1394</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error during cleanup: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1395"><a href="#L-1395"><span class="linenos">1395</span></a>    
</span><span id="L-1396"><a href="#L-1396"><span class="linenos">1396</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1397"><a href="#L-1397"><span class="linenos">1397</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span><span id="L-1398"><a href="#L-1398"><span class="linenos">1398</span></a>    
</span><span id="L-1399"><a href="#L-1399"><span class="linenos">1399</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_val</span><span class="p">,</span> <span class="n">exc_tb</span><span class="p">):</span>
</span><span id="L-1400"><a href="#L-1400"><span class="linenos">1400</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></pre></div>


            </section>
                <section id="fdel">
                    <div class="attr variable">
            <span class="name">fdel</span>        =
<span class="default_value">&#39;/&#39;</span>

        
    </div>
    <a class="headerlink" href="#fdel"></a>
    
    

                </section>
                <section id="wd">
                    <div class="attr variable">
            <span class="name">wd</span>        =
<span class="default_value">&#39;/Users/jamesbishop/Documents/Python/Scraping/tedata/src/tedata&#39;</span>

        
    </div>
    <a class="headerlink" href="#wd"></a>
    
    

                </section>
                <section id="logger">
                    <div class="attr variable">
            <span class="name">logger</span>        =
<span class="default_value">&lt;Logger <a href="">tedata.scraper</a> (DEBUG)&gt;</span>

        
    </div>
    <a class="headerlink" href="#logger"></a>
    
    

                </section>
                <section id="find_element_header_match">
                            <input id="find_element_header_match-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">find_element_header_match</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">soup</span><span class="p">:</span> <span class="n">bs4</span><span class="o">.</span><span class="n">BeautifulSoup</span>, </span><span class="param"><span class="n">selector</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">match_text</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="find_element_header_match-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#find_element_header_match"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="find_element_header_match-27"><a href="#find_element_header_match-27"><span class="linenos">27</span></a><span class="k">def</span><span class="w"> </span><span class="nf">find_element_header_match</span><span class="p">(</span><span class="n">soup</span><span class="p">:</span> <span class="n">BeautifulSoup</span><span class="p">,</span> <span class="n">selector</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">match_text</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="find_element_header_match-28"><a href="#find_element_header_match-28"><span class="linenos">28</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Find .card-header element with text matching search_text&quot;&quot;&quot;</span>
</span><span id="find_element_header_match-29"><a href="#find_element_header_match-29"><span class="linenos">29</span></a>    <span class="n">elements</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">selector</span><span class="p">)</span>
</span><span id="find_element_header_match-30"><a href="#find_element_header_match-30"><span class="linenos">30</span></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Elements found from selector, number of them: &quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">elements</span><span class="p">))</span>
</span><span id="find_element_header_match-31"><a href="#find_element_header_match-31"><span class="linenos">31</span></a>    <span class="k">for</span> <span class="n">ele</span> <span class="ow">in</span> <span class="n">elements</span><span class="p">:</span>
</span><span id="find_element_header_match-32"><a href="#find_element_header_match-32"><span class="linenos">32</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">ele</span><span class="p">),</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="find_element_header_match-33"><a href="#find_element_header_match-33"><span class="linenos">33</span></a>        <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">ele</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">match_text</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
</span><span id="find_element_header_match-34"><a href="#find_element_header_match-34"><span class="linenos">34</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Match found: &quot;</span><span class="p">,</span> <span class="n">ele</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</span><span id="find_element_header_match-35"><a href="#find_element_header_match-35"><span class="linenos">35</span></a>            <span class="k">return</span> <span class="n">ele</span>
</span><span id="find_element_header_match-36"><a href="#find_element_header_match-36"><span class="linenos">36</span></a>    <span class="k">return</span> <span class="kc">None</span>
</span></pre></div>


            <div class="docstring"><p>Find .card-header element with text matching search_text</p>
</div>


                </section>
                <section id="TE_Scraper">
                            <input id="TE_Scraper-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">TE_Scraper</span><wbr>(<span class="base"><a href="base.html#Generic_Webdriver">tedata.base.Generic_Webdriver</a></span>, <span class="base"><a href="base.html#SharedWebDriverState">tedata.base.SharedWebDriverState</a></span>):

                <label class="view-source-button" for="TE_Scraper-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TE_Scraper"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TE_Scraper-39"><a href="#TE_Scraper-39"><span class="linenos">  39</span></a><span class="k">class</span><span class="w"> </span><span class="nc">TE_Scraper</span><span class="p">(</span><span class="n">Generic_Webdriver</span><span class="p">,</span> <span class="n">SharedWebDriverState</span><span class="p">):</span>
</span><span id="TE_Scraper-40"><a href="#TE_Scraper-40"><span class="linenos">  40</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Class for scraping data from Trading Economics website. This is the main workhorse of the module.</span>
</span><span id="TE_Scraper-41"><a href="#TE_Scraper-41"><span class="linenos">  41</span></a><span class="sd">    It is designed to scrape data from the Trading Economics website using Selenium and BeautifulSoup.</span>
</span><span id="TE_Scraper-42"><a href="#TE_Scraper-42"><span class="linenos">  42</span></a><span class="sd">    It can load a page, click buttons, extract data from elements, and plot the extracted data. Uses multiple inheritance</span>
</span><span id="TE_Scraper-43"><a href="#TE_Scraper-43"><span class="linenos">  43</span></a><span class="sd">    from the Generic_Webdriver and SharedWebDriverState classes. This enables creation of TooltipScraper child classes that have </span>
</span><span id="TE_Scraper-44"><a href="#TE_Scraper-44"><span class="linenos">  44</span></a><span class="sd">    synced atributes such as &quot;chart_soup&quot;, &quot;chart_type&quot; &amp; &quot;date_span&quot; &amp; share the same webdriver object. This is useful for scraping.</span>
</span><span id="TE_Scraper-45"><a href="#TE_Scraper-45"><span class="linenos">  45</span></a>
</span><span id="TE_Scraper-46"><a href="#TE_Scraper-46"><span class="linenos">  46</span></a><span class="sd">    **Init Parameters:** </span>
</span><span id="TE_Scraper-47"><a href="#TE_Scraper-47"><span class="linenos">  47</span></a><span class="sd">    - **kwargs (dict): Keyword  arguments to pass to the Generic_Webdriver class. These are the same as the Generic_Webdriver class.</span>
</span><span id="TE_Scraper-48"><a href="#TE_Scraper-48"><span class="linenos">  48</span></a><span class="sd">    These are:</span>
</span><span id="TE_Scraper-49"><a href="#TE_Scraper-49"><span class="linenos">  49</span></a><span class="sd">        - driver (webdriver): A Selenium WebDriver object, can put in an active one or make a new one for a new URL.</span>
</span><span id="TE_Scraper-50"><a href="#TE_Scraper-50"><span class="linenos">  50</span></a><span class="sd">        - use_existing_driver (bool): Whether to use an existing driver in the namespace. If True, the driver parameter is ignored. Default is False.</span>
</span><span id="TE_Scraper-51"><a href="#TE_Scraper-51"><span class="linenos">  51</span></a><span class="sd">        - browser (str): The browser to use for scraping, either &#39;chrome&#39; or &#39;firefox&#39;.</span>
</span><span id="TE_Scraper-52"><a href="#TE_Scraper-52"><span class="linenos">  52</span></a><span class="sd">        - headless (bool): Whether to run the browser in headless mode (show no window).</span>
</span><span id="TE_Scraper-53"><a href="#TE_Scraper-53"><span class="linenos">  53</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="TE_Scraper-54"><a href="#TE_Scraper-54"><span class="linenos">  54</span></a>
</span><span id="TE_Scraper-55"><a href="#TE_Scraper-55"><span class="linenos">  55</span></a>    <span class="c1"># Define browser type with allowed values</span>
</span><span id="TE_Scraper-56"><a href="#TE_Scraper-56"><span class="linenos">  56</span></a>    <span class="n">BrowserType</span> <span class="o">=</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;chrome&quot;</span><span class="p">,</span> <span class="s2">&quot;firefox&quot;</span><span class="p">]</span>  <span class="c1">#Chrome still not working as of v0.3.0..</span>
</span><span id="TE_Scraper-57"><a href="#TE_Scraper-57"><span class="linenos">  57</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="TE_Scraper-58"><a href="#TE_Scraper-58"><span class="linenos">  58</span></a>        <span class="n">Generic_Webdriver</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="TE_Scraper-59"><a href="#TE_Scraper-59"><span class="linenos">  59</span></a>        <span class="n">SharedWebDriverState</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="TE_Scraper-60"><a href="#TE_Scraper-60"><span class="linenos">  60</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">observers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>  <span class="c1"># Register self as observer</span>
</span><span id="TE_Scraper-61"><a href="#TE_Scraper-61"><span class="linenos">  61</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_shared_state</span> <span class="o">=</span> <span class="bp">self</span>  <span class="c1"># Since we inherit SharedWebDriverState, we are our own shared state</span>
</span><span id="TE_Scraper-62"><a href="#TE_Scraper-62"><span class="linenos">  62</span></a>
</span><span id="TE_Scraper-63"><a href="#TE_Scraper-63"><span class="linenos">  63</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">load_page</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">extra_wait_time</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>
</span><span id="TE_Scraper-64"><a href="#TE_Scraper-64"><span class="linenos">  64</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Load page and wait for it to be ready&quot;&quot;&quot;</span>
</span><span id="TE_Scraper-65"><a href="#TE_Scraper-65"><span class="linenos">  65</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">last_url</span> <span class="o">=</span> <span class="n">url</span>
</span><span id="TE_Scraper-66"><a href="#TE_Scraper-66"><span class="linenos">  66</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">series_name</span> <span class="o">=</span> <span class="n">url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-67"><a href="#TE_Scraper-67"><span class="linenos">  67</span></a>        
</span><span id="TE_Scraper-68"><a href="#TE_Scraper-68"><span class="linenos">  68</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="TE_Scraper-69"><a href="#TE_Scraper-69"><span class="linenos">  69</span></a>            <span class="c1"># This waits for initial page load</span>
</span><span id="TE_Scraper-70"><a href="#TE_Scraper-70"><span class="linenos">  70</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</span><span id="TE_Scraper-71"><a href="#TE_Scraper-71"><span class="linenos">  71</span></a>            
</span><span id="TE_Scraper-72"><a href="#TE_Scraper-72"><span class="linenos">  72</span></a>            <span class="c1"># Now explicitly wait for your critical elements</span>
</span><span id="TE_Scraper-73"><a href="#TE_Scraper-73"><span class="linenos">  73</span></a>            <span class="n">chart_element</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wait</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
</span><span id="TE_Scraper-74"><a href="#TE_Scraper-74"><span class="linenos">  74</span></a>                <span class="n">EC</span><span class="o">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">ID</span><span class="p">,</span> <span class="s2">&quot;chart&quot;</span><span class="p">)),</span>
</span><span id="TE_Scraper-75"><a href="#TE_Scraper-75"><span class="linenos">  75</span></a>                <span class="n">message</span><span class="o">=</span><span class="s2">&quot;Chart element not found after page load&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-76"><a href="#TE_Scraper-76"><span class="linenos">  76</span></a>            
</span><span id="TE_Scraper-77"><a href="#TE_Scraper-77"><span class="linenos">  77</span></a>            <span class="c1"># Scroll chart into view to ensure it&#39;s visible for interactions</span>
</span><span id="TE_Scraper-78"><a href="#TE_Scraper-78"><span class="linenos">  78</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">execute_script</span><span class="p">(</span><span class="s2">&quot;arguments[0].scrollIntoView({behavior: &#39;auto&#39;, block: &#39;center&#39;});&quot;</span><span class="p">,</span> <span class="n">chart_element</span><span class="p">)</span>
</span><span id="TE_Scraper-79"><a href="#TE_Scraper-79"><span class="linenos">  79</span></a>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>  <span class="c1"># Small delay to let scrolling complete</span>
</span><span id="TE_Scraper-80"><a href="#TE_Scraper-80"><span class="linenos">  80</span></a>            
</span><span id="TE_Scraper-81"><a href="#TE_Scraper-81"><span class="linenos">  81</span></a>            <span class="c1"># Wait for the chart content to be loaded</span>
</span><span id="TE_Scraper-82"><a href="#TE_Scraper-82"><span class="linenos">  82</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">wait</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
</span><span id="TE_Scraper-83"><a href="#TE_Scraper-83"><span class="linenos">  83</span></a>                <span class="n">EC</span><span class="o">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">CLASS_NAME</span><span class="p">,</span> <span class="s2">&quot;highcharts-series-group&quot;</span><span class="p">)),</span>
</span><span id="TE_Scraper-84"><a href="#TE_Scraper-84"><span class="linenos">  84</span></a>                <span class="n">message</span><span class="o">=</span><span class="s2">&quot;Chart series not loaded&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-85"><a href="#TE_Scraper-85"><span class="linenos">  85</span></a>            
</span><span id="TE_Scraper-86"><a href="#TE_Scraper-86"><span class="linenos">  86</span></a>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">extra_wait_time</span><span class="p">)</span>  <span class="c1"># Extra wait time after page load just to be sure...</span>
</span><span id="TE_Scraper-87"><a href="#TE_Scraper-87"><span class="linenos">  87</span></a>            
</span><span id="TE_Scraper-88"><a href="#TE_Scraper-88"><span class="linenos">  88</span></a>            <span class="c1"># Now it&#39;s safe to get the page source</span>
</span><span id="TE_Scraper-89"><a href="#TE_Scraper-89"><span class="linenos">  89</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">full_page</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_page_source</span><span class="p">()</span>
</span><span id="TE_Scraper-90"><a href="#TE_Scraper-90"><span class="linenos">  90</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">page_soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">full_page</span><span class="p">,</span> <span class="s1">&#39;html.parser&#39;</span><span class="p">)</span>
</span><span id="TE_Scraper-91"><a href="#TE_Scraper-91"><span class="linenos">  91</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">chart_soup</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">page_soup</span><span class="o">.</span><span class="n">select_one</span><span class="p">(</span><span class="s2">&quot;#chart&quot;</span><span class="p">)</span>  <span class="c1">#Make a bs4 object from the #chart element of the page.</span>
</span><span id="TE_Scraper-92"><a href="#TE_Scraper-92"><span class="linenos">  92</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">full_chart</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_soup</span><span class="o">.</span><span class="n">contents</span>
</span><span id="TE_Scraper-93"><a href="#TE_Scraper-93"><span class="linenos">  93</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="TE_Scraper-94"><a href="#TE_Scraper-94"><span class="linenos">  94</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error loading page: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-95"><a href="#TE_Scraper-95"><span class="linenos">  95</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error loading page: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-96"><a href="#TE_Scraper-96"><span class="linenos">  96</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="TE_Scraper-97"><a href="#TE_Scraper-97"><span class="linenos">  97</span></a>        
</span><span id="TE_Scraper-98"><a href="#TE_Scraper-98"><span class="linenos">  98</span></a>        <span class="n">retries</span> <span class="o">=</span> <span class="mi">4</span>
</span><span id="TE_Scraper-99"><a href="#TE_Scraper-99"><span class="linenos">  99</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">retries</span><span class="p">):</span>
</span><span id="TE_Scraper-100"><a href="#TE_Scraper-100"><span class="linenos"> 100</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_chart_types_dict</span><span class="p">():</span> <span class="c1"># Create the chart types dictionary for the chart.</span>
</span><span id="TE_Scraper-101"><a href="#TE_Scraper-101"><span class="linenos"> 101</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Chart types dictionary created successfully.&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-102"><a href="#TE_Scraper-102"><span class="linenos"> 102</span></a>                <span class="k">break</span>
</span><span id="TE_Scraper-103"><a href="#TE_Scraper-103"><span class="linenos"> 103</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="TE_Scraper-104"><a href="#TE_Scraper-104"><span class="linenos"> 104</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Error creating chart types dictionary. Retrying, attempt: &quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
</span><span id="TE_Scraper-105"><a href="#TE_Scraper-105"><span class="linenos"> 105</span></a>            
</span><span id="TE_Scraper-106"><a href="#TE_Scraper-106"><span class="linenos"> 106</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">update_date_span</span><span class="p">()</span>
</span><span id="TE_Scraper-107"><a href="#TE_Scraper-107"><span class="linenos"> 107</span></a>        <span class="k">return</span> <span class="kc">True</span>
</span><span id="TE_Scraper-108"><a href="#TE_Scraper-108"><span class="linenos"> 108</span></a>        
</span><span id="TE_Scraper-109"><a href="#TE_Scraper-109"><span class="linenos"> 109</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">click_button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">selector</span><span class="p">,</span> <span class="n">selector_type</span><span class="o">=</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">):</span>
</span><span id="TE_Scraper-110"><a href="#TE_Scraper-110"><span class="linenos"> 110</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Click button using webdriver and wait for response.</span>
</span><span id="TE_Scraper-111"><a href="#TE_Scraper-111"><span class="linenos"> 111</span></a><span class="sd">        **Parameters:**</span>
</span><span id="TE_Scraper-112"><a href="#TE_Scraper-112"><span class="linenos"> 112</span></a><span class="sd">        - selector (str): The CSS selector for the button to click.</span>
</span><span id="TE_Scraper-113"><a href="#TE_Scraper-113"><span class="linenos"> 113</span></a><span class="sd">        - selector_type (By): The type of selector to use, By.CSS_SELECTOR by default.&quot;&quot;&quot;</span>
</span><span id="TE_Scraper-114"><a href="#TE_Scraper-114"><span class="linenos"> 114</span></a>
</span><span id="TE_Scraper-115"><a href="#TE_Scraper-115"><span class="linenos"> 115</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="TE_Scraper-116"><a href="#TE_Scraper-116"><span class="linenos"> 116</span></a>            <span class="c1"># Wait for element to be clickable</span>
</span><span id="TE_Scraper-117"><a href="#TE_Scraper-117"><span class="linenos"> 117</span></a>            <span class="n">button</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wait</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
</span><span id="TE_Scraper-118"><a href="#TE_Scraper-118"><span class="linenos"> 118</span></a>                <span class="n">EC</span><span class="o">.</span><span class="n">element_to_be_clickable</span><span class="p">((</span><span class="n">selector_type</span><span class="p">,</span> <span class="n">selector</span><span class="p">)))</span>
</span><span id="TE_Scraper-119"><a href="#TE_Scraper-119"><span class="linenos"> 119</span></a>            
</span><span id="TE_Scraper-120"><a href="#TE_Scraper-120"><span class="linenos"> 120</span></a>            <span class="n">button</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
</span><span id="TE_Scraper-121"><a href="#TE_Scraper-121"><span class="linenos"> 121</span></a>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.25</span><span class="p">)</span>
</span><span id="TE_Scraper-122"><a href="#TE_Scraper-122"><span class="linenos"> 122</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="TE_Scraper-123"><a href="#TE_Scraper-123"><span class="linenos"> 123</span></a>        <span class="k">except</span> <span class="n">TimeoutException</span><span class="p">:</span>
</span><span id="TE_Scraper-124"><a href="#TE_Scraper-124"><span class="linenos"> 124</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Button not found or not clickable: </span><span class="si">{</span><span class="n">selector</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-125"><a href="#TE_Scraper-125"><span class="linenos"> 125</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="TE_Scraper-126"><a href="#TE_Scraper-126"><span class="linenos"> 126</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="TE_Scraper-127"><a href="#TE_Scraper-127"><span class="linenos"> 127</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error clicking button: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-128"><a href="#TE_Scraper-128"><span class="linenos"> 128</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="TE_Scraper-129"><a href="#TE_Scraper-129"><span class="linenos"> 129</span></a>
</span><span id="TE_Scraper-130"><a href="#TE_Scraper-130"><span class="linenos"> 130</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">find_max_button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">selector</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;#dateSpansDiv&quot;</span><span class="p">):</span>
</span><span id="TE_Scraper-131"><a href="#TE_Scraper-131"><span class="linenos"> 131</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Find the button on the chart that selects the maximum date range and return the CSS selector for it.</span>
</span><span id="TE_Scraper-132"><a href="#TE_Scraper-132"><span class="linenos"> 132</span></a><span class="sd">        The button is usually labelled &#39;MAX&#39; and is used to select the maximum date range for the chart. The selector for the button is</span>
</span><span id="TE_Scraper-133"><a href="#TE_Scraper-133"><span class="linenos"> 133</span></a><span class="sd">        usually &#39;#dateSpansDiv&#39; but can be changed if the button is not found. The method will return the CSS selector for the button.</span>
</span><span id="TE_Scraper-134"><a href="#TE_Scraper-134"><span class="linenos"> 134</span></a><span class="sd">        This will also create an atrribute &#39;date_spans&#39; which is a dictionary containing the text of the date span buttons and their CSS selectors.&quot;&quot;&quot;</span>
</span><span id="TE_Scraper-135"><a href="#TE_Scraper-135"><span class="linenos"> 135</span></a>
</span><span id="TE_Scraper-136"><a href="#TE_Scraper-136"><span class="linenos"> 136</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="TE_Scraper-137"><a href="#TE_Scraper-137"><span class="linenos"> 137</span></a>            <span class="n">buts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">page_soup</span><span class="o">.</span><span class="n">select_one</span><span class="p">(</span><span class="n">selector</span><span class="p">)</span>
</span><span id="TE_Scraper-138"><a href="#TE_Scraper-138"><span class="linenos"> 138</span></a>            <span class="n">datebut</span> <span class="o">=</span> <span class="n">buts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">buts</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="n">buts</span>
</span><span id="TE_Scraper-139"><a href="#TE_Scraper-139"><span class="linenos"> 139</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">date_spans</span> <span class="o">=</span> <span class="p">{</span><span class="n">child</span><span class="o">.</span><span class="n">text</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;a.</span><span class="si">{</span><span class="n">child</span><span class="p">[</span><span class="s1">&#39;class&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nb">isinstance</span><span class="p">(</span><span class="n">child</span><span class="p">[</span><span class="s1">&#39;class&#39;</span><span class="p">],</span><span class="w"> </span><span class="nb">list</span><span class="p">)</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="n">child</span><span class="p">[</span><span class="s1">&#39;class&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">:nth-child(</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">)&quot;</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">child</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">datebut</span><span class="o">.</span><span class="n">children</span><span class="p">)}</span>
</span><span id="TE_Scraper-140"><a href="#TE_Scraper-140"><span class="linenos"> 140</span></a>
</span><span id="TE_Scraper-141"><a href="#TE_Scraper-141"><span class="linenos"> 141</span></a>            <span class="k">if</span> <span class="s2">&quot;MAX&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">date_spans</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="TE_Scraper-142"><a href="#TE_Scraper-142"><span class="linenos"> 142</span></a>                <span class="n">max_selector</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">date_spans</span><span class="p">[</span><span class="s2">&quot;MAX&quot;</span><span class="p">]</span>
</span><span id="TE_Scraper-143"><a href="#TE_Scraper-143"><span class="linenos"> 143</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="TE_Scraper-144"><a href="#TE_Scraper-144"><span class="linenos"> 144</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;MAX button not found.&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-145"><a href="#TE_Scraper-145"><span class="linenos"> 145</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;MAX button found for chart at URL: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">last_url</span><span class="si">}</span><span class="s2">, selector: </span><span class="si">{</span><span class="n">max_selector</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-146"><a href="#TE_Scraper-146"><span class="linenos"> 146</span></a>            
</span><span id="TE_Scraper-147"><a href="#TE_Scraper-147"><span class="linenos"> 147</span></a>            <span class="k">return</span> <span class="n">max_selector</span>
</span><span id="TE_Scraper-148"><a href="#TE_Scraper-148"><span class="linenos"> 148</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="TE_Scraper-149"><a href="#TE_Scraper-149"><span class="linenos"> 149</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error finding date spans buttons: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-150"><a href="#TE_Scraper-150"><span class="linenos"> 150</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error finding date spans buttons: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-151"><a href="#TE_Scraper-151"><span class="linenos"> 151</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="TE_Scraper-152"><a href="#TE_Scraper-152"><span class="linenos"> 152</span></a>    
</span><span id="TE_Scraper-153"><a href="#TE_Scraper-153"><span class="linenos"> 153</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">click_max_button</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="TE_Scraper-154"><a href="#TE_Scraper-154"><span class="linenos"> 154</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Click the button that selects the maximum date range on the chart. This is usually the &#39;MAX&#39; button and is used to select the maximum date range for the chart.</span>
</span><span id="TE_Scraper-155"><a href="#TE_Scraper-155"><span class="linenos"> 155</span></a><span class="sd">        The method will find the button and click it. It will also wait for the chart to update after clicking the button.&quot;&quot;&quot;</span>
</span><span id="TE_Scraper-156"><a href="#TE_Scraper-156"><span class="linenos"> 156</span></a>        <span class="n">max_selector</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_max_button</span><span class="p">()</span>
</span><span id="TE_Scraper-157"><a href="#TE_Scraper-157"><span class="linenos"> 157</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">click_button</span><span class="p">(</span><span class="n">max_selector</span><span class="p">):</span>
</span><span id="TE_Scraper-158"><a href="#TE_Scraper-158"><span class="linenos"> 158</span></a>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span id="TE_Scraper-159"><a href="#TE_Scraper-159"><span class="linenos"> 159</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;MAX button clicked successfully.&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-160"><a href="#TE_Scraper-160"><span class="linenos"> 160</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">date_span</span> <span class="o">=</span> <span class="s2">&quot;MAX&quot;</span>
</span><span id="TE_Scraper-161"><a href="#TE_Scraper-161"><span class="linenos"> 161</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">update_chart</span><span class="p">()</span>
</span><span id="TE_Scraper-162"><a href="#TE_Scraper-162"><span class="linenos"> 162</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="TE_Scraper-163"><a href="#TE_Scraper-163"><span class="linenos"> 163</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Error clicking MAX button.&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-164"><a href="#TE_Scraper-164"><span class="linenos"> 164</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="TE_Scraper-165"><a href="#TE_Scraper-165"><span class="linenos"> 165</span></a>        
</span><span id="TE_Scraper-166"><a href="#TE_Scraper-166"><span class="linenos"> 166</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">determine_date_span</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">update_chart</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
</span><span id="TE_Scraper-167"><a href="#TE_Scraper-167"><span class="linenos"> 167</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Determine the selected date span from the Trading Economics chart currently displayed in webdriver.&quot;&quot;&quot;</span>
</span><span id="TE_Scraper-168"><a href="#TE_Scraper-168"><span class="linenos"> 168</span></a>    
</span><span id="TE_Scraper-169"><a href="#TE_Scraper-169"><span class="linenos"> 169</span></a>        <span class="k">if</span> <span class="n">update_chart</span><span class="p">:</span> 
</span><span id="TE_Scraper-170"><a href="#TE_Scraper-170"><span class="linenos"> 170</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">update_chart</span><span class="p">()</span>
</span><span id="TE_Scraper-171"><a href="#TE_Scraper-171"><span class="linenos"> 171</span></a>        <span class="c1">## Populate the date spans dictionary</span>
</span><span id="TE_Scraper-172"><a href="#TE_Scraper-172"><span class="linenos"> 172</span></a>        <span class="n">buts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_soup</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;#dateSpansDiv&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-173"><a href="#TE_Scraper-173"><span class="linenos"> 173</span></a>        <span class="n">datebut</span> <span class="o">=</span> <span class="n">buts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">buts</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="n">buts</span>
</span><span id="TE_Scraper-174"><a href="#TE_Scraper-174"><span class="linenos"> 174</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">date_spans</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
</span><span id="TE_Scraper-175"><a href="#TE_Scraper-175"><span class="linenos"> 175</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">child</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">datebut</span><span class="o">.</span><span class="n">children</span><span class="p">):</span>
</span><span id="TE_Scraper-176"><a href="#TE_Scraper-176"><span class="linenos"> 176</span></a>            <span class="n">selector</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;a.</span><span class="si">{</span><span class="n">child</span><span class="p">[</span><span class="s1">&#39;class&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nb">isinstance</span><span class="p">(</span><span class="n">child</span><span class="p">[</span><span class="s1">&#39;class&#39;</span><span class="p">],</span><span class="w"> </span><span class="nb">list</span><span class="p">)</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="n">child</span><span class="p">[</span><span class="s1">&#39;class&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">:nth-child(</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">)&quot;</span>
</span><span id="TE_Scraper-177"><a href="#TE_Scraper-177"><span class="linenos"> 177</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">date_spans</span><span class="p">[</span><span class="n">child</span><span class="o">.</span><span class="n">text</span><span class="p">]</span> <span class="o">=</span> <span class="n">selector</span>
</span><span id="TE_Scraper-178"><a href="#TE_Scraper-178"><span class="linenos"> 178</span></a>
</span><span id="TE_Scraper-179"><a href="#TE_Scraper-179"><span class="linenos"> 179</span></a>        <span class="c1">## Find the selected date span</span>
</span><span id="TE_Scraper-180"><a href="#TE_Scraper-180"><span class="linenos"> 180</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">buts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="TE_Scraper-181"><a href="#TE_Scraper-181"><span class="linenos"> 181</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="n">buts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">children</span>
</span><span id="TE_Scraper-182"><a href="#TE_Scraper-182"><span class="linenos"> 182</span></a>        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">buts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="TE_Scraper-183"><a href="#TE_Scraper-183"><span class="linenos"> 183</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Multiple date spans found&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-184"><a href="#TE_Scraper-184"><span class="linenos"> 184</span></a>            <span class="k">return</span> <span class="n">buts</span>
</span><span id="TE_Scraper-185"><a href="#TE_Scraper-185"><span class="linenos"> 185</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="TE_Scraper-186"><a href="#TE_Scraper-186"><span class="linenos"> 186</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No date spans found&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-187"><a href="#TE_Scraper-187"><span class="linenos"> 187</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="TE_Scraper-188"><a href="#TE_Scraper-188"><span class="linenos"> 188</span></a>
</span><span id="TE_Scraper-189"><a href="#TE_Scraper-189"><span class="linenos"> 189</span></a>        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
</span><span id="TE_Scraper-190"><a href="#TE_Scraper-190"><span class="linenos"> 190</span></a>            <span class="c1">#print(&quot;Date span element: &quot;, r)</span>
</span><span id="TE_Scraper-191"><a href="#TE_Scraper-191"><span class="linenos"> 191</span></a>            <span class="k">if</span> <span class="s2">&quot;selected&quot;</span> <span class="ow">in</span> <span class="n">r</span><span class="p">[</span><span class="s2">&quot;class&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">r</span><span class="o">.</span><span class="n">text</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">date_spans</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
</span><span id="TE_Scraper-192"><a href="#TE_Scraper-192"><span class="linenos"> 192</span></a>                <span class="n">date_span</span> <span class="o">=</span> <span class="p">{</span><span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">:</span> <span class="n">r</span><span class="p">}</span>
</span><span id="TE_Scraper-193"><a href="#TE_Scraper-193"><span class="linenos"> 193</span></a>                <span class="k">return</span> <span class="n">date_span</span>
</span><span id="TE_Scraper-194"><a href="#TE_Scraper-194"><span class="linenos"> 194</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="TE_Scraper-195"><a href="#TE_Scraper-195"><span class="linenos"> 195</span></a>                <span class="c1"># No button has been slected already in this case.</span>
</span><span id="TE_Scraper-196"><a href="#TE_Scraper-196"><span class="linenos"> 196</span></a>                <span class="n">shortest_span</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">date_spans</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="TE_Scraper-197"><a href="#TE_Scraper-197"><span class="linenos"> 197</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">set_date_span</span><span class="p">(</span><span class="n">shortest_span</span><span class="p">)</span>
</span><span id="TE_Scraper-198"><a href="#TE_Scraper-198"><span class="linenos"> 198</span></a>                <span class="k">return</span> <span class="n">shortest_span</span>
</span><span id="TE_Scraper-199"><a href="#TE_Scraper-199"><span class="linenos"> 199</span></a>
</span><span id="TE_Scraper-200"><a href="#TE_Scraper-200"><span class="linenos"> 200</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">update_chart</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="TE_Scraper-201"><a href="#TE_Scraper-201"><span class="linenos"> 201</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Update the chart attributes after loading a new page or clicking a button. This will check the page source and update the </span>
</span><span id="TE_Scraper-202"><a href="#TE_Scraper-202"><span class="linenos"> 202</span></a><span class="sd">        beautiful soup objects such as chart_soup, from which most other methods derive their functionality. It will also update the full_chart attribute</span>
</span><span id="TE_Scraper-203"><a href="#TE_Scraper-203"><span class="linenos"> 203</span></a><span class="sd">        which is the full HTML of the chart element on the page. This method should be run after changing something on the webpage via driver such</span>
</span><span id="TE_Scraper-204"><a href="#TE_Scraper-204"><span class="linenos"> 204</span></a><span class="sd">        as clicking a button to change the date span or chart type.&quot;&quot;&quot;</span>
</span><span id="TE_Scraper-205"><a href="#TE_Scraper-205"><span class="linenos"> 205</span></a>
</span><span id="TE_Scraper-206"><a href="#TE_Scraper-206"><span class="linenos"> 206</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="TE_Scraper-207"><a href="#TE_Scraper-207"><span class="linenos"> 207</span></a>            <span class="c1"># Since we inherit from SharedWebDriverState, we can directly set the page_source property</span>
</span><span id="TE_Scraper-208"><a href="#TE_Scraper-208"><span class="linenos"> 208</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">page_source</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">page_source</span>
</span><span id="TE_Scraper-209"><a href="#TE_Scraper-209"><span class="linenos"> 209</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="TE_Scraper-210"><a href="#TE_Scraper-210"><span class="linenos"> 210</span></a>
</span><span id="TE_Scraper-211"><a href="#TE_Scraper-211"><span class="linenos"> 211</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="TE_Scraper-212"><a href="#TE_Scraper-212"><span class="linenos"> 212</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to update chart: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-213"><a href="#TE_Scraper-213"><span class="linenos"> 213</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="TE_Scraper-214"><a href="#TE_Scraper-214"><span class="linenos"> 214</span></a>
</span><span id="TE_Scraper-215"><a href="#TE_Scraper-215"><span class="linenos"> 215</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_date_span</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">date_span</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="TE_Scraper-216"><a href="#TE_Scraper-216"><span class="linenos"> 216</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the date span on the Trading Economics chart. This is done by clicking the date span button on the chart. The date span is a button on the chart</span>
</span><span id="TE_Scraper-217"><a href="#TE_Scraper-217"><span class="linenos"> 217</span></a><span class="sd">        that allows you to change the date range of the chart. This method will click the button for the date span specified in the date_span parameter.</span>
</span><span id="TE_Scraper-218"><a href="#TE_Scraper-218"><span class="linenos"> 218</span></a><span class="sd">        The date_span parameter should be a string that matches one of the date span buttons on the chart. The method will also update the date_span attribute</span>
</span><span id="TE_Scraper-219"><a href="#TE_Scraper-219"><span class="linenos"> 219</span></a><span class="sd">        of the class to reflect the new date span.&quot;&quot;&quot;</span>
</span><span id="TE_Scraper-220"><a href="#TE_Scraper-220"><span class="linenos"> 220</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;date_spans&quot;</span><span class="p">):</span>
</span><span id="TE_Scraper-221"><a href="#TE_Scraper-221"><span class="linenos"> 221</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">determine_date_span</span><span class="p">()</span>
</span><span id="TE_Scraper-222"><a href="#TE_Scraper-222"><span class="linenos"> 222</span></a>        <span class="k">if</span> <span class="n">date_span</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">date_spans</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="TE_Scraper-223"><a href="#TE_Scraper-223"><span class="linenos"> 223</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">click_button</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">date_spans</span><span class="p">[</span><span class="n">date_span</span><span class="p">]):</span>
</span><span id="TE_Scraper-224"><a href="#TE_Scraper-224"><span class="linenos"> 224</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">date_span</span> <span class="o">=</span> <span class="n">date_span</span>
</span><span id="TE_Scraper-225"><a href="#TE_Scraper-225"><span class="linenos"> 225</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Date span set to: </span><span class="si">{</span><span class="n">date_span</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-226"><a href="#TE_Scraper-226"><span class="linenos"> 226</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">update_chart</span><span class="p">()</span>
</span><span id="TE_Scraper-227"><a href="#TE_Scraper-227"><span class="linenos"> 227</span></a>                <span class="k">return</span> <span class="kc">True</span>
</span><span id="TE_Scraper-228"><a href="#TE_Scraper-228"><span class="linenos"> 228</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="TE_Scraper-229"><a href="#TE_Scraper-229"><span class="linenos"> 229</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error setting date span: </span><span class="si">{</span><span class="n">date_span</span><span class="si">}</span><span class="s2">, check that the date span button is clickable.&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-230"><a href="#TE_Scraper-230"><span class="linenos"> 230</span></a>                <span class="k">return</span> <span class="kc">False</span>
</span><span id="TE_Scraper-231"><a href="#TE_Scraper-231"><span class="linenos"> 231</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="TE_Scraper-232"><a href="#TE_Scraper-232"><span class="linenos"> 232</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error setting date span: </span><span class="si">{</span><span class="n">date_span</span><span class="si">}</span><span class="s2">, check that the supplied date span matches one of the keys in the self.date_spans attribute (dict).&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-233"><a href="#TE_Scraper-233"><span class="linenos"> 233</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="TE_Scraper-234"><a href="#TE_Scraper-234"><span class="linenos"> 234</span></a>        
</span><span id="TE_Scraper-235"><a href="#TE_Scraper-235"><span class="linenos"> 235</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_max_date_span_viaCalendar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="TE_Scraper-236"><a href="#TE_Scraper-236"><span class="linenos"> 236</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; Looks like Trading Economics have gone ahead and made the &quot;MAX&quot; button on charts a subscriber only feature. No problem, we can still set the max date range</span>
</span><span id="TE_Scraper-237"><a href="#TE_Scraper-237"><span class="linenos"> 237</span></a><span class="sd">        by using the calendar widget on the chart. This method will click the calendar button and then enter an arbitrary date far in the past as start date and the </span>
</span><span id="TE_Scraper-238"><a href="#TE_Scraper-238"><span class="linenos"> 238</span></a><span class="sd">        current date as the end date.&quot;&quot;&quot;</span>
</span><span id="TE_Scraper-239"><a href="#TE_Scraper-239"><span class="linenos"> 239</span></a>
</span><span id="TE_Scraper-240"><a href="#TE_Scraper-240"><span class="linenos"> 240</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">custom_date_span_js</span><span class="p">(</span><span class="n">start_date</span><span class="o">=</span><span class="s2">&quot;1850-01-01&quot;</span><span class="p">,</span> <span class="n">end_date</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">))</span>
</span><span id="TE_Scraper-241"><a href="#TE_Scraper-241"><span class="linenos"> 241</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">date_span</span> <span class="o">=</span> <span class="s2">&quot;MAX&quot;</span>
</span><span id="TE_Scraper-242"><a href="#TE_Scraper-242"><span class="linenos"> 242</span></a>
</span><span id="TE_Scraper-243"><a href="#TE_Scraper-243"><span class="linenos"> 243</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">update_date_span</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">update_chart</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="TE_Scraper-244"><a href="#TE_Scraper-244"><span class="linenos"> 244</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Update the date span after clicking a button. This will check the page source and update the date span attribute.</span>
</span><span id="TE_Scraper-245"><a href="#TE_Scraper-245"><span class="linenos"> 245</span></a><span class="sd">        This method can be used t check that the curret date span is correct after clicking a button to change it. </span>
</span><span id="TE_Scraper-246"><a href="#TE_Scraper-246"><span class="linenos"> 246</span></a><span class="sd">        It will update the date_span attribute. It is not necessary after running set_date_span though as that method already updates the date span attribute.</span>
</span><span id="TE_Scraper-247"><a href="#TE_Scraper-247"><span class="linenos"> 247</span></a>
</span><span id="TE_Scraper-248"><a href="#TE_Scraper-248"><span class="linenos"> 248</span></a><span class="sd">        **Parameters:**</span>
</span><span id="TE_Scraper-249"><a href="#TE_Scraper-249"><span class="linenos"> 249</span></a><span class="sd">        - update_chart (bool): Whether to update the chart before determining the date span. Default is False.</span>
</span><span id="TE_Scraper-250"><a href="#TE_Scraper-250"><span class="linenos"> 250</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TE_Scraper-251"><a href="#TE_Scraper-251"><span class="linenos"> 251</span></a>
</span><span id="TE_Scraper-252"><a href="#TE_Scraper-252"><span class="linenos"> 252</span></a>        <span class="k">if</span> <span class="n">update_chart</span><span class="p">:</span>
</span><span id="TE_Scraper-253"><a href="#TE_Scraper-253"><span class="linenos"> 253</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">update_chart</span><span class="p">()</span>
</span><span id="TE_Scraper-254"><a href="#TE_Scraper-254"><span class="linenos"> 254</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">date_span_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">determine_date_span</span><span class="p">()</span>
</span><span id="TE_Scraper-255"><a href="#TE_Scraper-255"><span class="linenos"> 255</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">date_span</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">date_spans</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="TE_Scraper-256"><a href="#TE_Scraper-256"><span class="linenos"> 256</span></a>    
</span><span id="TE_Scraper-257"><a href="#TE_Scraper-257"><span class="linenos"> 257</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_chart_types_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="TE_Scraper-258"><a href="#TE_Scraper-258"><span class="linenos"> 258</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a dictionary of chart types and their CSS selectors. This is used to select the chart type on the Trading Economics chart.</span>
</span><span id="TE_Scraper-259"><a href="#TE_Scraper-259"><span class="linenos"> 259</span></a><span class="sd">        The dictionary is stored in the chart_types attribute of the class. The keys are the names of the chart types and the values are the CSS selectors</span>
</span><span id="TE_Scraper-260"><a href="#TE_Scraper-260"><span class="linenos"> 260</span></a><span class="sd">        for the chart type buttons on the chart.&quot;&quot;&quot;</span>
</span><span id="TE_Scraper-261"><a href="#TE_Scraper-261"><span class="linenos"> 261</span></a>
</span><span id="TE_Scraper-262"><a href="#TE_Scraper-262"><span class="linenos"> 262</span></a>        <span class="n">hart_types</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_soup</span><span class="o">.</span><span class="n">select_one</span><span class="p">(</span><span class="s2">&quot;.chartTypesWrapper&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-263"><a href="#TE_Scraper-263"><span class="linenos"> 263</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">chart_types</span> <span class="o">=</span> <span class="p">{</span><span class="n">child</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">]:</span> <span class="s2">&quot;.&quot;</span><span class="o">+</span><span class="n">child</span><span class="p">[</span><span class="s2">&quot;class&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot; .&quot;</span><span class="o">+</span> <span class="n">child</span><span class="o">.</span><span class="n">button</span><span class="p">[</span><span class="s2">&quot;class&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">hart_types</span><span class="o">.</span><span class="n">children</span><span class="p">}</span>
</span><span id="TE_Scraper-264"><a href="#TE_Scraper-264"><span class="linenos"> 264</span></a>        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_types</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="TE_Scraper-265"><a href="#TE_Scraper-265"><span class="linenos"> 265</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">chart_types</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="TE_Scraper-266"><a href="#TE_Scraper-266"><span class="linenos"> 266</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Chart types dictionary created successfully: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">chart_types</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-267"><a href="#TE_Scraper-267"><span class="linenos"> 267</span></a>        <span class="k">return</span> <span class="kc">True</span>
</span><span id="TE_Scraper-268"><a href="#TE_Scraper-268"><span class="linenos"> 268</span></a>
</span><span id="TE_Scraper-269"><a href="#TE_Scraper-269"><span class="linenos"> 269</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">select_chart_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chart_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="TE_Scraper-270"><a href="#TE_Scraper-270"><span class="linenos"> 270</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Select a chart type on the Trading Economics chart. This is done by clicking the chart type button and then selecting the specified chart type.</span>
</span><span id="TE_Scraper-271"><a href="#TE_Scraper-271"><span class="linenos"> 271</span></a><span class="sd">        The chart type should be a string that matches one of the chart types in the chart_types dictionary. The method will click the chart type button</span>
</span><span id="TE_Scraper-272"><a href="#TE_Scraper-272"><span class="linenos"> 272</span></a><span class="sd">        and then select the specified chart type. It will also update the chart_type attribute of the class to reflect the new chart type.</span>
</span><span id="TE_Scraper-273"><a href="#TE_Scraper-273"><span class="linenos"> 273</span></a>
</span><span id="TE_Scraper-274"><a href="#TE_Scraper-274"><span class="linenos"> 274</span></a><span class="sd">        **Parameters:**</span>
</span><span id="TE_Scraper-275"><a href="#TE_Scraper-275"><span class="linenos"> 275</span></a><span class="sd">        - chart_type (str): The chart type to select on the chart. This must be one of the keys of the chart_types dictionary attribute of the class.</span>
</span><span id="TE_Scraper-276"><a href="#TE_Scraper-276"><span class="linenos"> 276</span></a><span class="sd">        List the options by printing self.chart_types.keys()</span>
</span><span id="TE_Scraper-277"><a href="#TE_Scraper-277"><span class="linenos"> 277</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TE_Scraper-278"><a href="#TE_Scraper-278"><span class="linenos"> 278</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;chart_types&quot;</span><span class="p">):</span>
</span><span id="TE_Scraper-279"><a href="#TE_Scraper-279"><span class="linenos"> 279</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">create_chart_types_dict</span><span class="p">()</span>
</span><span id="TE_Scraper-280"><a href="#TE_Scraper-280"><span class="linenos"> 280</span></a>        
</span><span id="TE_Scraper-281"><a href="#TE_Scraper-281"><span class="linenos"> 281</span></a>        <span class="n">selector</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;#chart.chart_module.chart1.undertaker-section div.chart_preview.undertaker_chart.logic-new-charts-no div.hawk-totalWrapper div.hawk-header</span><span class="se">\</span>
</span><span id="TE_Scraper-282"><a href="#TE_Scraper-282"><span class="linenos"> 282</span></a><span class="s2">          div.topnav-flex-container div.pickChartTypes div.PREselectedChartType div.chartTypesWrapper.dropDownStyle div</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">chart_types</span><span class="p">[</span><span class="n">chart_type</span><span class="p">]</span><span class="si">}</span><span class="s2"> button.dkLabels-label-btn&quot;</span>
</span><span id="TE_Scraper-283"><a href="#TE_Scraper-283"><span class="linenos"> 283</span></a>        
</span><span id="TE_Scraper-284"><a href="#TE_Scraper-284"><span class="linenos"> 284</span></a>        <span class="k">if</span> <span class="n">chart_type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_types</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="TE_Scraper-285"><a href="#TE_Scraper-285"><span class="linenos"> 285</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">click_button</span><span class="p">(</span><span class="s2">&quot;#chart &gt; div &gt; div &gt; div.hawk-header &gt; div &gt; div.pickChartTypes &gt; div &gt; button&quot;</span><span class="p">):</span>
</span><span id="TE_Scraper-286"><a href="#TE_Scraper-286"><span class="linenos"> 286</span></a>                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">1.5</span><span class="p">)</span>
</span><span id="TE_Scraper-287"><a href="#TE_Scraper-287"><span class="linenos"> 287</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">click_button</span><span class="p">(</span><span class="n">selector</span><span class="p">):</span>
</span><span id="TE_Scraper-288"><a href="#TE_Scraper-288"><span class="linenos"> 288</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_types</span><span class="p">[</span><span class="n">chart_type</span><span class="p">]</span>
</span><span id="TE_Scraper-289"><a href="#TE_Scraper-289"><span class="linenos"> 289</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Chart type set to: </span><span class="si">{</span><span class="n">chart_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-290"><a href="#TE_Scraper-290"><span class="linenos"> 290</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">update_chart</span><span class="p">()</span>
</span><span id="TE_Scraper-291"><a href="#TE_Scraper-291"><span class="linenos"> 291</span></a>                    <span class="k">return</span> <span class="kc">True</span>
</span><span id="TE_Scraper-292"><a href="#TE_Scraper-292"><span class="linenos"> 292</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="TE_Scraper-293"><a href="#TE_Scraper-293"><span class="linenos"> 293</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error selecting chart type: </span><span class="si">{</span><span class="n">chart_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-294"><a href="#TE_Scraper-294"><span class="linenos"> 294</span></a>                    <span class="k">return</span> <span class="kc">False</span>
</span><span id="TE_Scraper-295"><a href="#TE_Scraper-295"><span class="linenos"> 295</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="TE_Scraper-296"><a href="#TE_Scraper-296"><span class="linenos"> 296</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error selecting chart type: </span><span class="si">{</span><span class="n">chart_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-297"><a href="#TE_Scraper-297"><span class="linenos"> 297</span></a>                <span class="k">return</span> <span class="kc">False</span>
</span><span id="TE_Scraper-298"><a href="#TE_Scraper-298"><span class="linenos"> 298</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="TE_Scraper-299"><a href="#TE_Scraper-299"><span class="linenos"> 299</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Chart type not found: </span><span class="si">{</span><span class="n">chart_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-300"><a href="#TE_Scraper-300"><span class="linenos"> 300</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="TE_Scraper-301"><a href="#TE_Scraper-301"><span class="linenos"> 301</span></a>
</span><span id="TE_Scraper-302"><a href="#TE_Scraper-302"><span class="linenos"> 302</span></a>    <span class="c1">## Determine chart type from the chart displayed in the webdriver. This is not working yet,</span>
</span><span id="TE_Scraper-303"><a href="#TE_Scraper-303"><span class="linenos"> 303</span></a>    <span class="c1"># the buttons are not easi;y distinguishable, leave for now. chart_type will have to bve remembered and</span>
</span><span id="TE_Scraper-304"><a href="#TE_Scraper-304"><span class="linenos"> 304</span></a>    <span class="c1"># only set via the select_chart_type or select_line chart methods.  </span>
</span><span id="TE_Scraper-305"><a href="#TE_Scraper-305"><span class="linenos"> 305</span></a>    <span class="c1"># def determine_chart_type(self, update_chart: bool = True):</span>
</span><span id="TE_Scraper-306"><a href="#TE_Scraper-306"><span class="linenos"> 306</span></a>    <span class="c1">#     &quot;&quot;&quot; Determine the chart type from the Trading Economics chart currently displayed in webdriver.</span>
</span><span id="TE_Scraper-307"><a href="#TE_Scraper-307"><span class="linenos"> 307</span></a>    <span class="c1">#     This is done by checking the class of the selected chart type button in the chart. The chart type is determined by the class of the SVG element</span>
</span><span id="TE_Scraper-308"><a href="#TE_Scraper-308"><span class="linenos"> 308</span></a>    <span class="c1">#     in the chart. This method will return the chart type as a string. </span>
</span><span id="TE_Scraper-309"><a href="#TE_Scraper-309"><span class="linenos"> 309</span></a>
</span><span id="TE_Scraper-310"><a href="#TE_Scraper-310"><span class="linenos"> 310</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_chartType_js</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chart_type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;Column&#39;</span><span class="p">,</span> <span class="s1">&#39;Spline&#39;</span><span class="p">,</span> <span class="s1">&#39;Areaspline&#39;</span><span class="p">,</span> <span class="s1">&#39;Stepline&#39;</span><span class="p">,</span> <span class="s1">&#39;Line&#39;</span><span class="p">,</span> <span class="s1">&#39;Area&#39;</span><span class="p">]):</span>
</span><span id="TE_Scraper-311"><a href="#TE_Scraper-311"><span class="linenos"> 311</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the chart type using javascript. This is a more robust method of setting the chart type than using the click_button method.</span>
</span><span id="TE_Scraper-312"><a href="#TE_Scraper-312"><span class="linenos"> 312</span></a><span class="sd">        The click_button method can sometimes fail to click the chart type button. This method will set the chart type using javascript and will</span>
</span><span id="TE_Scraper-313"><a href="#TE_Scraper-313"><span class="linenos"> 313</span></a><span class="sd">        update the chart_type attribute of the class to reflect the new chart type.</span>
</span><span id="TE_Scraper-314"><a href="#TE_Scraper-314"><span class="linenos"> 314</span></a>
</span><span id="TE_Scraper-315"><a href="#TE_Scraper-315"><span class="linenos"> 315</span></a><span class="sd">        **Parameters:**</span>
</span><span id="TE_Scraper-316"><a href="#TE_Scraper-316"><span class="linenos"> 316</span></a><span class="sd">        - chart_type (Literal): The chart type to set. This should be one of the keys of the chart_types dictionary attribute of the class. The </span>
</span><span id="TE_Scraper-317"><a href="#TE_Scraper-317"><span class="linenos"> 317</span></a><span class="sd">        options are &#39;Column&#39;, &#39;Spline&#39;, &#39;Areaspline&#39;, &#39;Stepline&#39;, &#39;Line&#39;, &#39;Area&#39;.</span>
</span><span id="TE_Scraper-318"><a href="#TE_Scraper-318"><span class="linenos"> 318</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TE_Scraper-319"><a href="#TE_Scraper-319"><span class="linenos"> 319</span></a>        
</span><span id="TE_Scraper-320"><a href="#TE_Scraper-320"><span class="linenos"> 320</span></a>        <span class="n">success</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">execute_script</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="TE_Scraper-321"><a href="#TE_Scraper-321"><span class="linenos"> 321</span></a><span class="s2">                var chartType = &quot;</span><span class="si">{</span><span class="n">chart_type</span><span class="si">}</span><span class="s2">&quot;;</span>
</span><span id="TE_Scraper-322"><a href="#TE_Scraper-322"><span class="linenos"> 322</span></a><span class="s2">                var buttons = document.querySelectorAll(&#39;.chartTypesWrapper button&#39;);</span>
</span><span id="TE_Scraper-323"><a href="#TE_Scraper-323"><span class="linenos"> 323</span></a><span class="s2">                for (var i = 0; i &lt; buttons.length; i++) </span><span class="se">{{</span>
</span><span id="TE_Scraper-324"><a href="#TE_Scraper-324"><span class="linenos"> 324</span></a><span class="s2">                    if (buttons[i].textContent.trim() === chartType || </span>
</span><span id="TE_Scraper-325"><a href="#TE_Scraper-325"><span class="linenos"> 325</span></a><span class="s2">                        buttons[i].getAttribute(&#39;title&#39;) === chartType ||</span>
</span><span id="TE_Scraper-326"><a href="#TE_Scraper-326"><span class="linenos"> 326</span></a><span class="s2">                        buttons[i].parentElement.getAttribute(&#39;title&#39;) === chartType) </span><span class="se">{{</span>
</span><span id="TE_Scraper-327"><a href="#TE_Scraper-327"><span class="linenos"> 327</span></a><span class="s2">                        buttons[i].click();</span>
</span><span id="TE_Scraper-328"><a href="#TE_Scraper-328"><span class="linenos"> 328</span></a><span class="s2">                        return true;</span>
</span><span id="TE_Scraper-329"><a href="#TE_Scraper-329"><span class="linenos"> 329</span></a><span class="s2">                    </span><span class="se">}}</span>
</span><span id="TE_Scraper-330"><a href="#TE_Scraper-330"><span class="linenos"> 330</span></a><span class="s2">                </span><span class="se">}}</span>
</span><span id="TE_Scraper-331"><a href="#TE_Scraper-331"><span class="linenos"> 331</span></a><span class="s2">                return false;</span>
</span><span id="TE_Scraper-332"><a href="#TE_Scraper-332"><span class="linenos"> 332</span></a><span class="s2">            &quot;&quot;&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-333"><a href="#TE_Scraper-333"><span class="linenos"> 333</span></a>            
</span><span id="TE_Scraper-334"><a href="#TE_Scraper-334"><span class="linenos"> 334</span></a>        <span class="k">if</span> <span class="n">success</span><span class="p">:</span>
</span><span id="TE_Scraper-335"><a href="#TE_Scraper-335"><span class="linenos"> 335</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_types</span><span class="p">[</span><span class="n">chart_type</span><span class="p">]</span>
</span><span id="TE_Scraper-336"><a href="#TE_Scraper-336"><span class="linenos"> 336</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Chart type set to: </span><span class="si">{</span><span class="n">chart_type</span><span class="si">}</span><span class="s2"> (using JavaScript)&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-337"><a href="#TE_Scraper-337"><span class="linenos"> 337</span></a>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
</span><span id="TE_Scraper-338"><a href="#TE_Scraper-338"><span class="linenos"> 338</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">update_chart</span><span class="p">()</span>
</span><span id="TE_Scraper-339"><a href="#TE_Scraper-339"><span class="linenos"> 339</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="TE_Scraper-340"><a href="#TE_Scraper-340"><span class="linenos"> 340</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="TE_Scraper-341"><a href="#TE_Scraper-341"><span class="linenos"> 341</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error setting chart type: </span><span class="si">{</span><span class="n">chart_type</span><span class="si">}</span><span class="s2"> (using JavaScript)&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-342"><a href="#TE_Scraper-342"><span class="linenos"> 342</span></a>            <span class="k">return</span> <span class="kc">False</span>   
</span><span id="TE_Scraper-343"><a href="#TE_Scraper-343"><span class="linenos"> 343</span></a>    
</span><span id="TE_Scraper-344"><a href="#TE_Scraper-344"><span class="linenos"> 344</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_element</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">selector</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;.highcharts-series path&quot;</span><span class="p">,</span> <span class="n">selector_type</span><span class="o">=</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">):</span>
</span><span id="TE_Scraper-345"><a href="#TE_Scraper-345"><span class="linenos"> 345</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Find element by selector. The data trace displayed on a Trading Economics chart is a PATH element in the SVG chart.</span>
</span><span id="TE_Scraper-346"><a href="#TE_Scraper-346"><span class="linenos"> 346</span></a><span class="sd">        This is selected using the CSS selector &quot;.highcharts-series path&quot; by default. The element is stored in the &#39;current_element&#39; attribute.</span>
</span><span id="TE_Scraper-347"><a href="#TE_Scraper-347"><span class="linenos"> 347</span></a><span class="sd">        It can be used to select other elements on the chart as well and assign that to current element attribute.</span>
</span><span id="TE_Scraper-348"><a href="#TE_Scraper-348"><span class="linenos"> 348</span></a><span class="sd">        </span>
</span><span id="TE_Scraper-349"><a href="#TE_Scraper-349"><span class="linenos"> 349</span></a><span class="sd">        **Parameters:**</span>
</span><span id="TE_Scraper-350"><a href="#TE_Scraper-350"><span class="linenos"> 350</span></a><span class="sd">        - selector (str): The CSS selector for the element to find.</span>
</span><span id="TE_Scraper-351"><a href="#TE_Scraper-351"><span class="linenos"> 351</span></a><span class="sd">        - selector_type (By): The type of selector to use, By.CSS_SELECTOR by default.</span>
</span><span id="TE_Scraper-352"><a href="#TE_Scraper-352"><span class="linenos"> 352</span></a>
</span><span id="TE_Scraper-353"><a href="#TE_Scraper-353"><span class="linenos"> 353</span></a><span class="sd">        **Returns:**</span>
</span><span id="TE_Scraper-354"><a href="#TE_Scraper-354"><span class="linenos"> 354</span></a><span class="sd">        - element: The found element or None if not found.</span>
</span><span id="TE_Scraper-355"><a href="#TE_Scraper-355"><span class="linenos"> 355</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TE_Scraper-356"><a href="#TE_Scraper-356"><span class="linenos"> 356</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="TE_Scraper-357"><a href="#TE_Scraper-357"><span class="linenos"> 357</span></a>            <span class="n">element</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wait</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
</span><span id="TE_Scraper-358"><a href="#TE_Scraper-358"><span class="linenos"> 358</span></a>                <span class="n">EC</span><span class="o">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">selector_type</span><span class="p">,</span> <span class="n">selector</span><span class="p">))</span>
</span><span id="TE_Scraper-359"><a href="#TE_Scraper-359"><span class="linenos"> 359</span></a>            <span class="p">)</span>
</span><span id="TE_Scraper-360"><a href="#TE_Scraper-360"><span class="linenos"> 360</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">current_element</span> <span class="o">=</span> <span class="n">element</span>
</span><span id="TE_Scraper-361"><a href="#TE_Scraper-361"><span class="linenos"> 361</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Element found and assigned to current_element attribute: </span><span class="si">{</span><span class="n">selector</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-362"><a href="#TE_Scraper-362"><span class="linenos"> 362</span></a>            <span class="k">return</span> <span class="n">element</span>
</span><span id="TE_Scraper-363"><a href="#TE_Scraper-363"><span class="linenos"> 363</span></a>        <span class="k">except</span> <span class="n">TimeoutException</span><span class="p">:</span>
</span><span id="TE_Scraper-364"><a href="#TE_Scraper-364"><span class="linenos"> 364</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Element not found: </span><span class="si">{</span><span class="n">selector</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-365"><a href="#TE_Scraper-365"><span class="linenos"> 365</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Element not found: </span><span class="si">{</span><span class="n">selector</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-366"><a href="#TE_Scraper-366"><span class="linenos"> 366</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="TE_Scraper-367"><a href="#TE_Scraper-367"><span class="linenos"> 367</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="TE_Scraper-368"><a href="#TE_Scraper-368"><span class="linenos"> 368</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error finding element: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-369"><a href="#TE_Scraper-369"><span class="linenos"> 369</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error finding element: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-370"><a href="#TE_Scraper-370"><span class="linenos"> 370</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="TE_Scraper-371"><a href="#TE_Scraper-371"><span class="linenos"> 371</span></a>        
</span><span id="TE_Scraper-372"><a href="#TE_Scraper-372"><span class="linenos"> 372</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">series_from_chart_soup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">selector</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;.highcharts-graph&quot;</span><span class="p">,</span> 
</span><span id="TE_Scraper-373"><a href="#TE_Scraper-373"><span class="linenos"> 373</span></a>                               <span class="n">invert_the_series</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> 
</span><span id="TE_Scraper-374"><a href="#TE_Scraper-374"><span class="linenos"> 374</span></a>                               <span class="n">set_max_datespan</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="TE_Scraper-375"><a href="#TE_Scraper-375"><span class="linenos"> 375</span></a>                               <span class="n">local_run</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="TE_Scraper-376"><a href="#TE_Scraper-376"><span class="linenos"> 376</span></a>                               <span class="n">use_chart_type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;Line&quot;</span><span class="p">,</span> <span class="s2">&quot;Spline&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Spline&quot;</span><span class="p">):</span>  
</span><span id="TE_Scraper-377"><a href="#TE_Scraper-377"><span class="linenos"> 377</span></a><span class="w">          </span>
</span><span id="TE_Scraper-378"><a href="#TE_Scraper-378"><span class="linenos"> 378</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract series data from element text. This extracts the plotted series from the svg chart by taking the PATH </span>
</span><span id="TE_Scraper-379"><a href="#TE_Scraper-379"><span class="linenos"> 379</span></a><span class="sd">        element of the data tarace on the chart. Series values are pixel co-ordinates on the chart.</span>
</span><span id="TE_Scraper-380"><a href="#TE_Scraper-380"><span class="linenos"> 380</span></a>
</span><span id="TE_Scraper-381"><a href="#TE_Scraper-381"><span class="linenos"> 381</span></a><span class="sd">        **Parameters:**</span>
</span><span id="TE_Scraper-382"><a href="#TE_Scraper-382"><span class="linenos"> 382</span></a><span class="sd">        - invert_the_series (bool): Whether to invert the series values.</span>
</span><span id="TE_Scraper-383"><a href="#TE_Scraper-383"><span class="linenos"> 383</span></a><span class="sd">        - return_series (bool): whether or not to return the series at end. Series is assigned to self.series always.</span>
</span><span id="TE_Scraper-384"><a href="#TE_Scraper-384"><span class="linenos"> 384</span></a><span class="sd">        - set_max_datespan (bool): Whether to set the date span to MAX before extracting the series data. Default is False.</span>
</span><span id="TE_Scraper-385"><a href="#TE_Scraper-385"><span class="linenos"> 385</span></a><span class="sd">        - local_run (bool): Whether the method is being run to get the full date_span series or just extacting part of the series</span>
</span><span id="TE_Scraper-386"><a href="#TE_Scraper-386"><span class="linenos"> 386</span></a><span class="sd">        to then aggregate together the full series. Default is False.</span>
</span><span id="TE_Scraper-387"><a href="#TE_Scraper-387"><span class="linenos"> 387</span></a><span class="sd">        - use_chart_type (str): The chart type to use for the extraction of the series data. Default is &quot;Spline&quot;. This is used to set the chart type before extracting the series data.</span>
</span><span id="TE_Scraper-388"><a href="#TE_Scraper-388"><span class="linenos"> 388</span></a><span class="sd">        CUATION: This method may fail with certain types of charts. It is best to use Spline unless you have a reason to use another type.</span>
</span><span id="TE_Scraper-389"><a href="#TE_Scraper-389"><span class="linenos"> 389</span></a>
</span><span id="TE_Scraper-390"><a href="#TE_Scraper-390"><span class="linenos"> 390</span></a><span class="sd">        **Returns:**</span>
</span><span id="TE_Scraper-391"><a href="#TE_Scraper-391"><span class="linenos"> 391</span></a>
</span><span id="TE_Scraper-392"><a href="#TE_Scraper-392"><span class="linenos"> 392</span></a><span class="sd">        - series (pd.Series): The extracted series data that is the raw pixel co-ordinate values of the data trace on the svg chart.</span>
</span><span id="TE_Scraper-393"><a href="#TE_Scraper-393"><span class="linenos"> 393</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TE_Scraper-394"><a href="#TE_Scraper-394"><span class="linenos"> 394</span></a>
</span><span id="TE_Scraper-395"><a href="#TE_Scraper-395"><span class="linenos"> 395</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">update_chart</span><span class="p">()</span> <span class="c1"># Update chart..</span>
</span><span id="TE_Scraper-396"><a href="#TE_Scraper-396"><span class="linenos"> 396</span></a>
</span><span id="TE_Scraper-397"><a href="#TE_Scraper-397"><span class="linenos"> 397</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_types</span><span class="p">[</span><span class="n">use_chart_type</span><span class="p">]:</span>
</span><span id="TE_Scraper-398"><a href="#TE_Scraper-398"><span class="linenos"> 398</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">set_chartType_js</span><span class="p">(</span><span class="n">use_chart_type</span><span class="p">)</span> <span class="c1">## Use a certain chart type for the extraction of the series data. May fail with certain types of charts.</span>
</span><span id="TE_Scraper-399"><a href="#TE_Scraper-399"><span class="linenos"> 399</span></a>
</span><span id="TE_Scraper-400"><a href="#TE_Scraper-400"><span class="linenos"> 400</span></a>        <span class="k">if</span> <span class="n">set_max_datespan</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">date_span</span> <span class="o">!=</span> <span class="s2">&quot;MAX&quot;</span><span class="p">:</span>
</span><span id="TE_Scraper-401"><a href="#TE_Scraper-401"><span class="linenos"> 401</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">set_date_span</span><span class="p">(</span><span class="s2">&quot;MAX&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-402"><a href="#TE_Scraper-402"><span class="linenos"> 402</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Series path extraction method: Extracting series data from chart soup.&quot;</span><span class="p">)</span> 
</span><span id="TE_Scraper-403"><a href="#TE_Scraper-403"><span class="linenos"> 403</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Date span: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">date_span</span><span class="si">}</span><span class="s2">. Chart type: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span><span class="si">}</span><span class="s2">, URL: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">last_url</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-404"><a href="#TE_Scraper-404"><span class="linenos"> 404</span></a>    
</span><span id="TE_Scraper-405"><a href="#TE_Scraper-405"><span class="linenos"> 405</span></a>        <span class="n">datastrlist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_soup</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">selector</span><span class="p">)</span>
</span><span id="TE_Scraper-406"><a href="#TE_Scraper-406"><span class="linenos"> 406</span></a>        
</span><span id="TE_Scraper-407"><a href="#TE_Scraper-407"><span class="linenos"> 407</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">datastrlist</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="TE_Scraper-408"><a href="#TE_Scraper-408"><span class="linenos"> 408</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Multiple series found in the chart. Got to figure out which one to use... work to do here... This will not work yet, please report error.&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-409"><a href="#TE_Scraper-409"><span class="linenos"> 409</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Multiple series found in the chart. Got to figure out which one to use... work to do here...&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-410"><a href="#TE_Scraper-410"><span class="linenos"> 410</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="TE_Scraper-411"><a href="#TE_Scraper-411"><span class="linenos"> 411</span></a>            <span class="n">raw_series</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_soup</span><span class="o">.</span><span class="n">select_one</span><span class="p">(</span><span class="s2">&quot;.highcharts-graph&quot;</span><span class="p">)[</span><span class="s2">&quot;d&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-412"><a href="#TE_Scraper-412"><span class="linenos"> 412</span></a>    
</span><span id="TE_Scraper-413"><a href="#TE_Scraper-413"><span class="linenos"> 413</span></a>        <span class="n">ser</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">raw_series</span><span class="p">)</span>
</span><span id="TE_Scraper-414"><a href="#TE_Scraper-414"><span class="linenos"> 414</span></a>        <span class="n">ser_num</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">ser</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
</span><span id="TE_Scraper-415"><a href="#TE_Scraper-415"><span class="linenos"> 415</span></a>
</span><span id="TE_Scraper-416"><a href="#TE_Scraper-416"><span class="linenos"> 416</span></a>        <span class="n">exvals</span> <span class="o">=</span> <span class="n">ser_num</span><span class="p">[::</span><span class="mi">2</span><span class="p">];</span> <span class="n">yvals</span> <span class="o">=</span> <span class="n">ser_num</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
</span><span id="TE_Scraper-417"><a href="#TE_Scraper-417"><span class="linenos"> 417</span></a>        <span class="n">exvals</span> <span class="o">=</span> <span class="n">exvals</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
</span><span id="TE_Scraper-418"><a href="#TE_Scraper-418"><span class="linenos"> 418</span></a>        <span class="n">yvals</span> <span class="o">=</span> <span class="n">yvals</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
</span><span id="TE_Scraper-419"><a href="#TE_Scraper-419"><span class="linenos"> 419</span></a>        <span class="n">series</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">yvals</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="n">exvals</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Extracted Series&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-420"><a href="#TE_Scraper-420"><span class="linenos"> 420</span></a>
</span><span id="TE_Scraper-421"><a href="#TE_Scraper-421"><span class="linenos"> 421</span></a>        <span class="k">if</span> <span class="n">local_run</span><span class="p">:</span>
</span><span id="TE_Scraper-422"><a href="#TE_Scraper-422"><span class="linenos"> 422</span></a>            <span class="n">y_axis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_y_axis</span><span class="p">()</span>
</span><span id="TE_Scraper-423"><a href="#TE_Scraper-423"><span class="linenos"> 423</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="TE_Scraper-424"><a href="#TE_Scraper-424"><span class="linenos"> 424</span></a>            <span class="n">y_axis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_axis</span>
</span><span id="TE_Scraper-425"><a href="#TE_Scraper-425"><span class="linenos"> 425</span></a>
</span><span id="TE_Scraper-426"><a href="#TE_Scraper-426"><span class="linenos"> 426</span></a>        <span class="k">if</span> <span class="n">invert_the_series</span><span class="p">:</span>
</span><span id="TE_Scraper-427"><a href="#TE_Scraper-427"><span class="linenos"> 427</span></a>            <span class="n">series</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">invert_series</span><span class="p">(</span><span class="n">series</span><span class="p">,</span> <span class="n">max_val</span> <span class="o">=</span> <span class="n">y_axis</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
</span><span id="TE_Scraper-428"><a href="#TE_Scraper-428"><span class="linenos"> 428</span></a>        
</span><span id="TE_Scraper-429"><a href="#TE_Scraper-429"><span class="linenos"> 429</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">local_run</span><span class="p">:</span>
</span><span id="TE_Scraper-430"><a href="#TE_Scraper-430"><span class="linenos"> 430</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">trace_path_series_raw</span> <span class="o">=</span> <span class="n">series</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="TE_Scraper-431"><a href="#TE_Scraper-431"><span class="linenos"> 431</span></a>         <span class="c1"># Keep the raw pixel co-ordinate valued series extracted from the svg path element.</span>
</span><span id="TE_Scraper-432"><a href="#TE_Scraper-432"><span class="linenos"> 432</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Raw data series extracted successfully.&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-433"><a href="#TE_Scraper-433"><span class="linenos"> 433</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">series_extracted_from</span> <span class="o">=</span> <span class="n">use_chart_type</span>  <span class="c1">#Add this attribute so that the apply_x_index method knows which chart_type the series came from.</span>
</span><span id="TE_Scraper-434"><a href="#TE_Scraper-434"><span class="linenos"> 434</span></a>        
</span><span id="TE_Scraper-435"><a href="#TE_Scraper-435"><span class="linenos"> 435</span></a>        <span class="c1">#Add translate to the series to yield the proper y-values</span>
</span><span id="TE_Scraper-436"><a href="#TE_Scraper-436"><span class="linenos"> 436</span></a>        <span class="n">transform</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_soup</span><span class="o">.</span><span class="n">select_one</span><span class="p">(</span><span class="s2">&quot;.highcharts-graph&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="p">[</span><span class="s2">&quot;transform&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-437"><a href="#TE_Scraper-437"><span class="linenos"> 437</span></a>        <span class="n">translate</span> <span class="o">=</span> <span class="n">transform</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;translate(&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;)&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-438"><a href="#TE_Scraper-438"><span class="linenos"> 438</span></a>        <span class="n">translate</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">translate</span><span class="p">]</span>
</span><span id="TE_Scraper-439"><a href="#TE_Scraper-439"><span class="linenos"> 439</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">other_transforms</span> <span class="o">=</span> <span class="n">transform</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
</span><span id="TE_Scraper-440"><a href="#TE_Scraper-440"><span class="linenos"> 440</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">transform</span> <span class="o">=</span> <span class="n">translate</span>
</span><span id="TE_Scraper-441"><a href="#TE_Scraper-441"><span class="linenos"> 441</span></a>
</span><span id="TE_Scraper-442"><a href="#TE_Scraper-442"><span class="linenos"> 442</span></a>        <span class="n">series</span> <span class="o">=</span> <span class="n">series</span> <span class="o">+</span> <span class="n">translate</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="TE_Scraper-443"><a href="#TE_Scraper-443"><span class="linenos"> 443</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">series</span> <span class="o">=</span> <span class="n">series</span>
</span><span id="TE_Scraper-444"><a href="#TE_Scraper-444"><span class="linenos"> 444</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">raw_path_series</span> <span class="o">=</span> <span class="n">series</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="TE_Scraper-445"><a href="#TE_Scraper-445"><span class="linenos"> 445</span></a>        <span class="k">return</span> <span class="n">series</span>
</span><span id="TE_Scraper-446"><a href="#TE_Scraper-446"><span class="linenos"> 446</span></a>    
</span><span id="TE_Scraper-447"><a href="#TE_Scraper-447"><span class="linenos"> 447</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">custom_date_span</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_date</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;1900-01-01&quot;</span><span class="p">,</span> <span class="n">end_date</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">))</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="TE_Scraper-448"><a href="#TE_Scraper-448"><span class="linenos"> 448</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the date range on the active chart in the webdriver window. </span>
</span><span id="TE_Scraper-449"><a href="#TE_Scraper-449"><span class="linenos"> 449</span></a><span class="sd">        This is done by entering the start and end dates into the date range input boxes</span>
</span><span id="TE_Scraper-450"><a href="#TE_Scraper-450"><span class="linenos"> 450</span></a><span class="sd">        </span>
</span><span id="TE_Scraper-451"><a href="#TE_Scraper-451"><span class="linenos"> 451</span></a><span class="sd">        Args:</span>
</span><span id="TE_Scraper-452"><a href="#TE_Scraper-452"><span class="linenos"> 452</span></a><span class="sd">            start_date (str): Start date in format YYYY-MM-DD</span>
</span><span id="TE_Scraper-453"><a href="#TE_Scraper-453"><span class="linenos"> 453</span></a><span class="sd">            end_date (str): End date in format YYYY-MM-DD</span>
</span><span id="TE_Scraper-454"><a href="#TE_Scraper-454"><span class="linenos"> 454</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TE_Scraper-455"><a href="#TE_Scraper-455"><span class="linenos"> 455</span></a>
</span><span id="TE_Scraper-456"><a href="#TE_Scraper-456"><span class="linenos"> 456</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">click_button</span><span class="p">(</span><span class="s2">&quot;#dateInputsToggle&quot;</span><span class="p">):</span>
</span><span id="TE_Scraper-457"><a href="#TE_Scraper-457"><span class="linenos"> 457</span></a>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
</span><span id="TE_Scraper-458"><a href="#TE_Scraper-458"><span class="linenos"> 458</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="TE_Scraper-459"><a href="#TE_Scraper-459"><span class="linenos"> 459</span></a>                <span class="c1"># Find elements</span>
</span><span id="TE_Scraper-460"><a href="#TE_Scraper-460"><span class="linenos"> 460</span></a>                <span class="n">start_input</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wait</span><span class="o">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="o">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">ID</span><span class="p">,</span> <span class="s2">&quot;d1&quot;</span><span class="p">)))</span>
</span><span id="TE_Scraper-461"><a href="#TE_Scraper-461"><span class="linenos"> 461</span></a>                <span class="n">end_input</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wait</span><span class="o">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="o">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">ID</span><span class="p">,</span> <span class="s2">&quot;d2&quot;</span><span class="p">)))</span>
</span><span id="TE_Scraper-462"><a href="#TE_Scraper-462"><span class="linenos"> 462</span></a>                
</span><span id="TE_Scraper-463"><a href="#TE_Scraper-463"><span class="linenos"> 463</span></a>                <span class="c1"># Clear existing text</span>
</span><span id="TE_Scraper-464"><a href="#TE_Scraper-464"><span class="linenos"> 464</span></a>                <span class="n">start_input</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</span><span id="TE_Scraper-465"><a href="#TE_Scraper-465"><span class="linenos"> 465</span></a>                <span class="n">end_input</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</span><span id="TE_Scraper-466"><a href="#TE_Scraper-466"><span class="linenos"> 466</span></a>                
</span><span id="TE_Scraper-467"><a href="#TE_Scraper-467"><span class="linenos"> 467</span></a>                <span class="c1"># Enter new dates</span>
</span><span id="TE_Scraper-468"><a href="#TE_Scraper-468"><span class="linenos"> 468</span></a>                <span class="n">start_input</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">start_date</span><span class="p">)</span>
</span><span id="TE_Scraper-469"><a href="#TE_Scraper-469"><span class="linenos"> 469</span></a>                <span class="n">end_input</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">end_date</span><span class="p">)</span>
</span><span id="TE_Scraper-470"><a href="#TE_Scraper-470"><span class="linenos"> 470</span></a>                
</span><span id="TE_Scraper-471"><a href="#TE_Scraper-471"><span class="linenos"> 471</span></a>                <span class="c1"># Press Enter to confirm</span>
</span><span id="TE_Scraper-472"><a href="#TE_Scraper-472"><span class="linenos"> 472</span></a>                <span class="n">end_input</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">Keys</span><span class="o">.</span><span class="n">RETURN</span><span class="p">)</span>
</span><span id="TE_Scraper-473"><a href="#TE_Scraper-473"><span class="linenos"> 473</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">date_span</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Custom&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;start_date&quot;</span><span class="p">:</span> <span class="n">start_date</span><span class="p">,</span> <span class="s2">&quot;end_date&quot;</span><span class="p">:</span> <span class="n">end_date</span><span class="p">}}</span>
</span><span id="TE_Scraper-474"><a href="#TE_Scraper-474"><span class="linenos"> 474</span></a>                <span class="k">return</span> <span class="kc">True</span>
</span><span id="TE_Scraper-475"><a href="#TE_Scraper-475"><span class="linenos"> 475</span></a>                
</span><span id="TE_Scraper-476"><a href="#TE_Scraper-476"><span class="linenos"> 476</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="TE_Scraper-477"><a href="#TE_Scraper-477"><span class="linenos"> 477</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to enter dates: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-478"><a href="#TE_Scraper-478"><span class="linenos"> 478</span></a>                <span class="k">return</span> <span class="kc">False</span>
</span><span id="TE_Scraper-479"><a href="#TE_Scraper-479"><span class="linenos"> 479</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="TE_Scraper-480"><a href="#TE_Scraper-480"><span class="linenos"> 480</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Failed to open date range inputs&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-481"><a href="#TE_Scraper-481"><span class="linenos"> 481</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="TE_Scraper-482"><a href="#TE_Scraper-482"><span class="linenos"> 482</span></a>        
</span><span id="TE_Scraper-483"><a href="#TE_Scraper-483"><span class="linenos"> 483</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">custom_date_span_js</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_date</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;1900-01-01&quot;</span><span class="p">,</span> <span class="n">end_date</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">))</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="TE_Scraper-484"><a href="#TE_Scraper-484"><span class="linenos"> 484</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the date range on the active chart in the webdriver window using JavaScript.</span>
</span><span id="TE_Scraper-485"><a href="#TE_Scraper-485"><span class="linenos"> 485</span></a><span class="sd">        This is more reliable than using Selenium&#39;s send_keys and can avoid issues with focus.</span>
</span><span id="TE_Scraper-486"><a href="#TE_Scraper-486"><span class="linenos"> 486</span></a><span class="sd">        </span>
</span><span id="TE_Scraper-487"><a href="#TE_Scraper-487"><span class="linenos"> 487</span></a><span class="sd">        Args:</span>
</span><span id="TE_Scraper-488"><a href="#TE_Scraper-488"><span class="linenos"> 488</span></a><span class="sd">            start_date (str): Start date in format YYYY-MM-DD</span>
</span><span id="TE_Scraper-489"><a href="#TE_Scraper-489"><span class="linenos"> 489</span></a><span class="sd">            end_date (str): End date in format YYYY-MM-DD</span>
</span><span id="TE_Scraper-490"><a href="#TE_Scraper-490"><span class="linenos"> 490</span></a><span class="sd">            </span>
</span><span id="TE_Scraper-491"><a href="#TE_Scraper-491"><span class="linenos"> 491</span></a><span class="sd">        Returns:</span>
</span><span id="TE_Scraper-492"><a href="#TE_Scraper-492"><span class="linenos"> 492</span></a><span class="sd">            bool: True if successful, False otherwise</span>
</span><span id="TE_Scraper-493"><a href="#TE_Scraper-493"><span class="linenos"> 493</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TE_Scraper-494"><a href="#TE_Scraper-494"><span class="linenos"> 494</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="TE_Scraper-495"><a href="#TE_Scraper-495"><span class="linenos"> 495</span></a>            <span class="c1"># Load JavaScript code from file</span>
</span><span id="TE_Scraper-496"><a href="#TE_Scraper-496"><span class="linenos"> 496</span></a>            <span class="n">js_file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">),</span> <span class="s1">&#39;custom_datespan.js&#39;</span><span class="p">)</span>
</span><span id="TE_Scraper-497"><a href="#TE_Scraper-497"><span class="linenos"> 497</span></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">js_file_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
</span><span id="TE_Scraper-498"><a href="#TE_Scraper-498"><span class="linenos"> 498</span></a>                <span class="n">js_code</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span><span id="TE_Scraper-499"><a href="#TE_Scraper-499"><span class="linenos"> 499</span></a>            
</span><span id="TE_Scraper-500"><a href="#TE_Scraper-500"><span class="linenos"> 500</span></a>            <span class="c1"># Execute the JavaScript with parameters</span>
</span><span id="TE_Scraper-501"><a href="#TE_Scraper-501"><span class="linenos"> 501</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">execute_async_script</span><span class="p">(</span><span class="n">js_code</span><span class="p">,</span> <span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">)</span>
</span><span id="TE_Scraper-502"><a href="#TE_Scraper-502"><span class="linenos"> 502</span></a>            
</span><span id="TE_Scraper-503"><a href="#TE_Scraper-503"><span class="linenos"> 503</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;success&#39;</span><span class="p">):</span>
</span><span id="TE_Scraper-504"><a href="#TE_Scraper-504"><span class="linenos"> 504</span></a>                <span class="c1"># Set date span in our object</span>
</span><span id="TE_Scraper-505"><a href="#TE_Scraper-505"><span class="linenos"> 505</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">date_span</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Custom&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;start_date&quot;</span><span class="p">:</span> <span class="n">start_date</span><span class="p">,</span> <span class="s2">&quot;end_date&quot;</span><span class="p">:</span> <span class="n">end_date</span><span class="p">}}</span>
</span><span id="TE_Scraper-506"><a href="#TE_Scraper-506"><span class="linenos"> 506</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">update_chart</span><span class="p">()</span>
</span><span id="TE_Scraper-507"><a href="#TE_Scraper-507"><span class="linenos"> 507</span></a>                
</span><span id="TE_Scraper-508"><a href="#TE_Scraper-508"><span class="linenos"> 508</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Date span set to custom range: </span><span class="si">{</span><span class="n">start_date</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">end_date</span><span class="si">}</span><span class="s2"> (using JavaScript)&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-509"><a href="#TE_Scraper-509"><span class="linenos"> 509</span></a>                <span class="k">return</span> <span class="kc">True</span>
</span><span id="TE_Scraper-510"><a href="#TE_Scraper-510"><span class="linenos"> 510</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="TE_Scraper-511"><a href="#TE_Scraper-511"><span class="linenos"> 511</span></a>                <span class="n">error_msg</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="s1">&#39;Unknown error&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="s1">&#39;Unknown error&#39;</span>
</span><span id="TE_Scraper-512"><a href="#TE_Scraper-512"><span class="linenos"> 512</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to set date span using JavaScript: </span><span class="si">{</span><span class="n">error_msg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-513"><a href="#TE_Scraper-513"><span class="linenos"> 513</span></a>                <span class="k">return</span> <span class="kc">False</span>
</span><span id="TE_Scraper-514"><a href="#TE_Scraper-514"><span class="linenos"> 514</span></a>            
</span><span id="TE_Scraper-515"><a href="#TE_Scraper-515"><span class="linenos"> 515</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="TE_Scraper-516"><a href="#TE_Scraper-516"><span class="linenos"> 516</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error executing custom_date_span_js: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-517"><a href="#TE_Scraper-517"><span class="linenos"> 517</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="TE_Scraper-518"><a href="#TE_Scraper-518"><span class="linenos"> 518</span></a>    
</span><span id="TE_Scraper-519"><a href="#TE_Scraper-519"><span class="linenos"> 519</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_datamax_min</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="TE_Scraper-520"><a href="#TE_Scraper-520"><span class="linenos"> 520</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the max and min data values for the series using y-axis values... This is deprecated and not used in the current version of the code.&quot;&quot;&quot;</span>
</span><span id="TE_Scraper-521"><a href="#TE_Scraper-521"><span class="linenos"> 521</span></a>        
</span><span id="TE_Scraper-522"><a href="#TE_Scraper-522"><span class="linenos"> 522</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;get_datamax_min method, axisY0 = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">y_axis</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">, axisY1 = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">y_axis</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-523"><a href="#TE_Scraper-523"><span class="linenos"> 523</span></a>        <span class="n">px_range</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_axis</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_axis</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="TE_Scraper-524"><a href="#TE_Scraper-524"><span class="linenos"> 524</span></a>        <span class="n">labrange</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_axis</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_axis</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="TE_Scraper-525"><a href="#TE_Scraper-525"><span class="linenos"> 525</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">unit_per_pix_alt2</span> <span class="o">=</span> <span class="n">labrange</span><span class="o">/</span><span class="n">px_range</span>
</span><span id="TE_Scraper-526"><a href="#TE_Scraper-526"><span class="linenos"> 526</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;unit_per_pix: &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit_per_pix</span><span class="p">)</span>
</span><span id="TE_Scraper-527"><a href="#TE_Scraper-527"><span class="linenos"> 527</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;unit_per_pix: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">unit_per_pix</span><span class="si">}</span><span class="s2">, alt2: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">unit_per_pix_alt2</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-528"><a href="#TE_Scraper-528"><span class="linenos"> 528</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">datamax</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_axis</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_axis</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">max</span><span class="p">())</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">unit_per_pix</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</span><span id="TE_Scraper-529"><a href="#TE_Scraper-529"><span class="linenos"> 529</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">datamin</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_axis</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">y_axis</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">unit_per_pix</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</span><span id="TE_Scraper-530"><a href="#TE_Scraper-530"><span class="linenos"> 530</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;datamax: &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">datamax</span><span class="p">,</span> <span class="s2">&quot;datamin: &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">datamin</span><span class="p">)</span>
</span><span id="TE_Scraper-531"><a href="#TE_Scraper-531"><span class="linenos"> 531</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;datamax: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">datamax</span><span class="si">}</span><span class="s2">, datamin: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">datamin</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-532"><a href="#TE_Scraper-532"><span class="linenos"> 532</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datamax</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">datamin</span>
</span><span id="TE_Scraper-533"><a href="#TE_Scraper-533"><span class="linenos"> 533</span></a>    
</span><span id="TE_Scraper-534"><a href="#TE_Scraper-534"><span class="linenos"> 534</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">scale_series</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">right_way_up</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
</span><span id="TE_Scraper-535"><a href="#TE_Scraper-535"><span class="linenos"> 535</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Scale the series using the first and last values from the series pulled from the tooltip box. Uses the y axis limits and the max and min of the y axis</span>
</span><span id="TE_Scraper-536"><a href="#TE_Scraper-536"><span class="linenos"> 536</span></a><span class="sd">        to determine the scaling factor to convert pixel co-ordinates to data values. The scaling factor is stored in the self.axlims_upp attribute.&quot;&quot;&quot;</span>
</span><span id="TE_Scraper-537"><a href="#TE_Scraper-537"><span class="linenos"> 537</span></a>
</span><span id="TE_Scraper-538"><a href="#TE_Scraper-538"><span class="linenos"> 538</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">right_way_up</span><span class="p">:</span>
</span><span id="TE_Scraper-539"><a href="#TE_Scraper-539"><span class="linenos"> 539</span></a>            <span class="n">max_val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_axis</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>  <span class="c1"># This should be the top pixel of the chart.</span>
</span><span id="TE_Scraper-540"><a href="#TE_Scraper-540"><span class="linenos"> 540</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">series</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">invert_series</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="p">,</span> <span class="n">max_val</span> <span class="o">=</span> <span class="n">max_val</span><span class="p">)</span>
</span><span id="TE_Scraper-541"><a href="#TE_Scraper-541"><span class="linenos"> 541</span></a>            
</span><span id="TE_Scraper-542"><a href="#TE_Scraper-542"><span class="linenos"> 542</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;axis_limits&quot;</span><span class="p">):</span>
</span><span id="TE_Scraper-543"><a href="#TE_Scraper-543"><span class="linenos"> 543</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">axis_limits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_axis_limits</span><span class="p">()</span>
</span><span id="TE_Scraper-544"><a href="#TE_Scraper-544"><span class="linenos"> 544</span></a>        <span class="n">ymin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis_limits</span><span class="p">[</span><span class="s1">&#39;y_min&#39;</span><span class="p">];</span> <span class="n">ymax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis_limits</span><span class="p">[</span><span class="s1">&#39;y_max&#39;</span><span class="p">]</span>
</span><span id="TE_Scraper-545"><a href="#TE_Scraper-545"><span class="linenos"> 545</span></a>        <span class="c1">## Turns out that this formulation below is the best way to calculate the scaling factor for the chart.</span>
</span><span id="TE_Scraper-546"><a href="#TE_Scraper-546"><span class="linenos"> 546</span></a>        <span class="n">unit_range</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_axis</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_axis</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="TE_Scraper-547"><a href="#TE_Scraper-547"><span class="linenos"> 547</span></a>        <span class="n">pxrange</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_axis</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_axis</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="TE_Scraper-548"><a href="#TE_Scraper-548"><span class="linenos"> 548</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">axlims_upp</span> <span class="o">=</span> <span class="n">unit_range</span><span class="o">/</span><span class="n">pxrange</span>
</span><span id="TE_Scraper-549"><a href="#TE_Scraper-549"><span class="linenos"> 549</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unit per pix forumlation, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">y_axis</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">y_axis</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">unit_range</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">pxrange</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">ymax</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">ymin</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">axlims_upp</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-550"><a href="#TE_Scraper-550"><span class="linenos"> 550</span></a>
</span><span id="TE_Scraper-551"><a href="#TE_Scraper-551"><span class="linenos"> 551</span></a>        <span class="c1"># if the start and end points are at similar values this will be problematic though. </span>
</span><span id="TE_Scraper-552"><a href="#TE_Scraper-552"><span class="linenos"> 552</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Scale series method:  </span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="TE_Scraper-553"><a href="#TE_Scraper-553"><span class="linenos"> 553</span></a>                        <span class="sa">f</span><span class="s2">&quot;unit_per_pix calculated from the y axis ticks: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">unit_per_pix</span><span class="si">}</span><span class="s2">, </span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="TE_Scraper-554"><a href="#TE_Scraper-554"><span class="linenos"> 554</span></a>                        <span class="sa">f</span><span class="s2">&quot;unit_per_pix from axis limits and self.y_axis (probably best way): </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">axlims_upp</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="TE_Scraper-555"><a href="#TE_Scraper-555"><span class="linenos"> 555</span></a>                        <span class="sa">f</span><span class="s2">&quot;yaxis top tick: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">y_axis</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">, yaxis bot tick: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">y_axis</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="TE_Scraper-556"><a href="#TE_Scraper-556"><span class="linenos"> 556</span></a>                        <span class="sa">f</span><span class="s2">&quot;axis_limits: </span><span class="si">{</span><span class="n">ymin</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">ymax</span><span class="si">}</span><span class="s2">, y-axis series min &amp; max pixel values: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">y_axis</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">y_axis</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-557"><a href="#TE_Scraper-557"><span class="linenos"> 557</span></a>
</span><span id="TE_Scraper-558"><a href="#TE_Scraper-558"><span class="linenos"> 558</span></a>        <span class="c1">##Does the Y axis cross zero? Where is the zero point??</span>
</span><span id="TE_Scraper-559"><a href="#TE_Scraper-559"><span class="linenos"> 559</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">x_intercept_px</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">find_zero_crossing</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_axis</span><span class="p">)</span>
</span><span id="TE_Scraper-560"><a href="#TE_Scraper-560"><span class="linenos"> 560</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Series crosses zero, x-axis should be at about pixel y-cordinate: &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_intercept_px</span><span class="p">)</span>
</span><span id="TE_Scraper-561"><a href="#TE_Scraper-561"><span class="linenos"> 561</span></a>
</span><span id="TE_Scraper-562"><a href="#TE_Scraper-562"><span class="linenos"> 562</span></a>        <span class="n">unscaled</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unscaled_series</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="TE_Scraper-563"><a href="#TE_Scraper-563"><span class="linenos"> 563</span></a>        <span class="c1"># Calculate the series in vector fashion</span>
</span><span id="TE_Scraper-564"><a href="#TE_Scraper-564"><span class="linenos"> 564</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">series</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_axis</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">unscaled</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">axlims_upp</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_axis</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="TE_Scraper-565"><a href="#TE_Scraper-565"><span class="linenos"> 565</span></a>
</span><span id="TE_Scraper-566"><a href="#TE_Scraper-566"><span class="linenos"> 566</span></a>        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;metadata&quot;</span><span class="p">):</span>
</span><span id="TE_Scraper-567"><a href="#TE_Scraper-567"><span class="linenos"> 567</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;start_date&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-568"><a href="#TE_Scraper-568"><span class="linenos"> 568</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;end_date&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-569"><a href="#TE_Scraper-569"><span class="linenos"> 569</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;min_value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
</span><span id="TE_Scraper-570"><a href="#TE_Scraper-570"><span class="linenos"> 570</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;max_value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
</span><span id="TE_Scraper-571"><a href="#TE_Scraper-571"><span class="linenos"> 571</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;length&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="p">)</span>
</span><span id="TE_Scraper-572"><a href="#TE_Scraper-572"><span class="linenos"> 572</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">series_metadata</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">)</span>
</span><span id="TE_Scraper-573"><a href="#TE_Scraper-573"><span class="linenos"> 573</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="TE_Scraper-574"><a href="#TE_Scraper-574"><span class="linenos"> 574</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;start_end not found, run get_datamax_min() first.&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-575"><a href="#TE_Scraper-575"><span class="linenos"> 575</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;start_end not found, run get_datamax_min() first.&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-576"><a href="#TE_Scraper-576"><span class="linenos"> 576</span></a>            <span class="k">return</span>
</span><span id="TE_Scraper-577"><a href="#TE_Scraper-577"><span class="linenos"> 577</span></a>
</span><span id="TE_Scraper-578"><a href="#TE_Scraper-578"><span class="linenos"> 578</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">series</span>
</span><span id="TE_Scraper-579"><a href="#TE_Scraper-579"><span class="linenos"> 579</span></a>    
</span><span id="TE_Scraper-580"><a href="#TE_Scraper-580"><span class="linenos"> 580</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_chart_dims</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="TE_Scraper-581"><a href="#TE_Scraper-581"><span class="linenos"> 581</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get dimensions of chart and plotting area&quot;&quot;&quot;</span>
</span><span id="TE_Scraper-582"><a href="#TE_Scraper-582"><span class="linenos"> 582</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="TE_Scraper-583"><a href="#TE_Scraper-583"><span class="linenos"> 583</span></a>            <span class="c1"># Ensure full_chart is WebElement</span>
</span><span id="TE_Scraper-584"><a href="#TE_Scraper-584"><span class="linenos"> 584</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">chart_element</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s2">&quot;#chart&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-585"><a href="#TE_Scraper-585"><span class="linenos"> 585</span></a>            <span class="c1"># Get overall chart dimensions</span>
</span><span id="TE_Scraper-586"><a href="#TE_Scraper-586"><span class="linenos"> 586</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">chart_rect</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">v</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_element</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
</span><span id="TE_Scraper-587"><a href="#TE_Scraper-587"><span class="linenos"> 587</span></a>            
</span><span id="TE_Scraper-588"><a href="#TE_Scraper-588"><span class="linenos"> 588</span></a>            <span class="c1"># Get plot area dimensions</span>
</span><span id="TE_Scraper-589"><a href="#TE_Scraper-589"><span class="linenos"> 589</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">plot_background</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s1">&#39;.highcharts-plot-background&#39;</span><span class="p">)</span>
</span><span id="TE_Scraper-590"><a href="#TE_Scraper-590"><span class="linenos"> 590</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">axes_rect</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">v</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_background</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
</span><span id="TE_Scraper-591"><a href="#TE_Scraper-591"><span class="linenos"> 591</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">chart_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes_rect</span><span class="p">[</span><span class="s2">&quot;width&quot;</span><span class="p">]</span>
</span><span id="TE_Scraper-592"><a href="#TE_Scraper-592"><span class="linenos"> 592</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">chart_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes_rect</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">]</span>
</span><span id="TE_Scraper-593"><a href="#TE_Scraper-593"><span class="linenos"> 593</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="TE_Scraper-594"><a href="#TE_Scraper-594"><span class="linenos"> 594</span></a>        
</span><span id="TE_Scraper-595"><a href="#TE_Scraper-595"><span class="linenos"> 595</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="TE_Scraper-596"><a href="#TE_Scraper-596"><span class="linenos"> 596</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to get chart dimensions: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-597"><a href="#TE_Scraper-597"><span class="linenos"> 597</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to get chart dimensions: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-598"><a href="#TE_Scraper-598"><span class="linenos"> 598</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="TE_Scraper-599"><a href="#TE_Scraper-599"><span class="linenos"> 599</span></a>    
</span><span id="TE_Scraper-600"><a href="#TE_Scraper-600"><span class="linenos"> 600</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_xlims_from_tooltips</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">set_max_datespan</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
</span><span id="TE_Scraper-601"><a href="#TE_Scraper-601"><span class="linenos"> 601</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; Use the TooltipScraper class to get the start and end dates and some other points of the time series using the tooltip box displayed on the chart.</span>
</span><span id="TE_Scraper-602"><a href="#TE_Scraper-602"><span class="linenos"> 602</span></a><span class="sd">        Takes the latest num_points points from the chart and uses them to determine the frequency of the time series. The latest data is used</span>
</span><span id="TE_Scraper-603"><a href="#TE_Scraper-603"><span class="linenos"> 603</span></a><span class="sd">        in case the earlier data is of lower frequency which can sometimes occurr.</span>
</span><span id="TE_Scraper-604"><a href="#TE_Scraper-604"><span class="linenos"> 604</span></a><span class="sd">        </span>
</span><span id="TE_Scraper-605"><a href="#TE_Scraper-605"><span class="linenos"> 605</span></a><span class="sd">        **Parameters:**</span>
</span><span id="TE_Scraper-606"><a href="#TE_Scraper-606"><span class="linenos"> 606</span></a><span class="sd">        </span>
</span><span id="TE_Scraper-607"><a href="#TE_Scraper-607"><span class="linenos"> 607</span></a><span class="sd">        - force_rerun (bool): Whether to force a rerun of the method to get the start and end dates and frequency of the time series again. The method</span>
</span><span id="TE_Scraper-608"><a href="#TE_Scraper-608"><span class="linenos"> 608</span></a><span class="sd">        will not run again by default if done a second time and start_end and frequency attributes are already set. If the first run resulted in erroneous</span>
</span><span id="TE_Scraper-609"><a href="#TE_Scraper-609"><span class="linenos"> 609</span></a><span class="sd">        assignation of these attributes, set this to True to rerun the method. However, something may need to be changed if it is not working...&quot;&quot;&quot;</span>
</span><span id="TE_Scraper-610"><a href="#TE_Scraper-610"><span class="linenos"> 610</span></a>
</span><span id="TE_Scraper-611"><a href="#TE_Scraper-611"><span class="linenos"> 611</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;get_xlims_from_tooltips method: date_span: &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">date_span</span><span class="p">,</span> <span class="s2">&quot;, chart_type:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span><span class="p">)</span>
</span><span id="TE_Scraper-612"><a href="#TE_Scraper-612"><span class="linenos"> 612</span></a>
</span><span id="TE_Scraper-613"><a href="#TE_Scraper-613"><span class="linenos"> 613</span></a>        <span class="k">if</span> <span class="n">set_max_datespan</span><span class="p">:</span>
</span><span id="TE_Scraper-614"><a href="#TE_Scraper-614"><span class="linenos"> 614</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">set_max_date_span_viaCalendar</span><span class="p">()</span>  <span class="c1">##Set date_span to MAX for start and end date pull...</span>
</span><span id="TE_Scraper-615"><a href="#TE_Scraper-615"><span class="linenos"> 615</span></a>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
</span><span id="TE_Scraper-616"><a href="#TE_Scraper-616"><span class="linenos"> 616</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">update_chart</span><span class="p">()</span>
</span><span id="TE_Scraper-617"><a href="#TE_Scraper-617"><span class="linenos"> 617</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">set_chartType_js</span><span class="p">(</span><span class="s2">&quot;Spline&quot;</span><span class="p">)</span> <span class="c1">#Force spline chart selection - very important. I still have no way to determine if the chart type has changed when it changes automatically.</span>
</span><span id="TE_Scraper-618"><a href="#TE_Scraper-618"><span class="linenos"> 618</span></a>        <span class="c1">#Chart type must be spline or line for this to work. Sometimes the chart_type chnages automatically when datespan is altered.</span>
</span><span id="TE_Scraper-619"><a href="#TE_Scraper-619"><span class="linenos"> 619</span></a>
</span><span id="TE_Scraper-620"><a href="#TE_Scraper-620"><span class="linenos"> 620</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;tooltip_scraper&quot;</span><span class="p">):</span>
</span><span id="TE_Scraper-621"><a href="#TE_Scraper-621"><span class="linenos"> 621</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">tooltip_scraper</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">TooltipScraper</span><span class="p">(</span><span class="n">parent_instance</span> <span class="o">=</span> <span class="bp">self</span><span class="p">)</span> <span class="c1"># Create a tooltip scraper child object</span>
</span><span id="TE_Scraper-622"><a href="#TE_Scraper-622"><span class="linenos"> 622</span></a>        
</span><span id="TE_Scraper-623"><a href="#TE_Scraper-623"><span class="linenos"> 623</span></a>        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span id="TE_Scraper-624"><a href="#TE_Scraper-624"><span class="linenos"> 624</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">start_end</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tooltip_scraper</span><span class="o">.</span><span class="n">first_last_dates</span><span class="p">()</span>
</span><span id="TE_Scraper-625"><a href="#TE_Scraper-625"><span class="linenos"> 625</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_end</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">pd</span><span class="o">.</span><span class="n">isna</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_end</span><span class="p">[</span><span class="s2">&quot;start_date&quot;</span><span class="p">])</span> <span class="ow">or</span> <span class="n">pd</span><span class="o">.</span><span class="n">isna</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_end</span><span class="p">[</span><span class="s2">&quot;end_date&quot;</span><span class="p">]):</span>
</span><span id="TE_Scraper-626"><a href="#TE_Scraper-626"><span class="linenos"> 626</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">start_end</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tooltip_scraper</span><span class="o">.</span><span class="n">first_last_dates</span><span class="p">()</span>
</span><span id="TE_Scraper-627"><a href="#TE_Scraper-627"><span class="linenos"> 627</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Start and end dates scraped from tooltips: &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_end</span><span class="p">)</span>
</span><span id="TE_Scraper-628"><a href="#TE_Scraper-628"><span class="linenos"> 628</span></a>        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;metadata&quot;</span><span class="p">):</span>
</span><span id="TE_Scraper-629"><a href="#TE_Scraper-629"><span class="linenos"> 629</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;unit_tooltips&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_end</span><span class="p">[</span><span class="s2">&quot;unit_str&quot;</span><span class="p">]</span>
</span><span id="TE_Scraper-630"><a href="#TE_Scraper-630"><span class="linenos"> 630</span></a>
</span><span id="TE_Scraper-631"><a href="#TE_Scraper-631"><span class="linenos"> 631</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">make_x_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
</span><span id="TE_Scraper-632"><a href="#TE_Scraper-632"><span class="linenos"> 632</span></a>                     <span class="n">force_rerun_xlims</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="TE_Scraper-633"><a href="#TE_Scraper-633"><span class="linenos"> 633</span></a>                     <span class="n">force_rerun_freqdet</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
</span><span id="TE_Scraper-634"><a href="#TE_Scraper-634"><span class="linenos"> 634</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Make the DateTime Index for the series using the start and end dates scraped from the tooltips. </span>
</span><span id="TE_Scraper-635"><a href="#TE_Scraper-635"><span class="linenos"> 635</span></a><span class="sd">        This uses Selenium and also scrapes the some of the latest datapoints from the tooltips on the chart in order to determine</span>
</span><span id="TE_Scraper-636"><a href="#TE_Scraper-636"><span class="linenos"> 636</span></a><span class="sd">        the frequency of the time series. It will take a bit of time to run.</span>
</span><span id="TE_Scraper-637"><a href="#TE_Scraper-637"><span class="linenos"> 637</span></a>
</span><span id="TE_Scraper-638"><a href="#TE_Scraper-638"><span class="linenos"> 638</span></a><span class="sd">        **Parameters:**</span>
</span><span id="TE_Scraper-639"><a href="#TE_Scraper-639"><span class="linenos"> 639</span></a><span class="sd">        - force_rerun_xlims (bool): Whether to force a rerun of the method to get the start and end dates and frequency of the time series again. The method</span>
</span><span id="TE_Scraper-640"><a href="#TE_Scraper-640"><span class="linenos"> 640</span></a><span class="sd">        will not run again by default if done a second time and start_end and frequency attributes are already set. </span>
</span><span id="TE_Scraper-641"><a href="#TE_Scraper-641"><span class="linenos"> 641</span></a><span class="sd">        - force_rerun_freqdet (bool): Whether to force a rerun of the method to get the frequency of the time series again. The method</span>
</span><span id="TE_Scraper-642"><a href="#TE_Scraper-642"><span class="linenos"> 642</span></a><span class="sd">        will not run again by default if done a second time and frequency attribute is already set. </span>
</span><span id="TE_Scraper-643"><a href="#TE_Scraper-643"><span class="linenos"> 643</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TE_Scraper-644"><a href="#TE_Scraper-644"><span class="linenos"> 644</span></a>        
</span><span id="TE_Scraper-645"><a href="#TE_Scraper-645"><span class="linenos"> 645</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;tooltip_scraper&quot;</span><span class="p">):</span>  <span class="c1"># If the tooltip scraper object is not already created, create it.</span>
</span><span id="TE_Scraper-646"><a href="#TE_Scraper-646"><span class="linenos"> 646</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">tooltip_scraper</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">TooltipScraper</span><span class="p">(</span><span class="n">parent_instance</span> <span class="o">=</span> <span class="bp">self</span><span class="p">)</span> <span class="c1"># Create a tooltip scraper child object</span>
</span><span id="TE_Scraper-647"><a href="#TE_Scraper-647"><span class="linenos"> 647</span></a>
</span><span id="TE_Scraper-648"><a href="#TE_Scraper-648"><span class="linenos"> 648</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Using selenium and tooltip scraping to construct the date time index for the time-series, this&#39;ll take a bit...&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-649"><a href="#TE_Scraper-649"><span class="linenos"> 649</span></a>        <span class="c1">## Get the latest 10 or so points from the chart, date and value from tooltips, in order to determine the frequency of the time series.</span>
</span><span id="TE_Scraper-650"><a href="#TE_Scraper-650"><span class="linenos"> 650</span></a>        <span class="k">if</span> <span class="n">force_rerun_freqdet</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;latest_points&quot;</span><span class="p">):</span>
</span><span id="TE_Scraper-651"><a href="#TE_Scraper-651"><span class="linenos"> 651</span></a>            <span class="c1">#datapoints = self.tooltip_scraper.get_latest_points(num_points = 5)  # Python version, slow</span>
</span><span id="TE_Scraper-652"><a href="#TE_Scraper-652"><span class="linenos"> 652</span></a>            <span class="n">datapoints</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tooltip_scraper</span><span class="o">.</span><span class="n">latest_points_js</span><span class="p">(</span><span class="n">num_points</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>  <span class="c1"># js version, faster</span>
</span><span id="TE_Scraper-653"><a href="#TE_Scraper-653"><span class="linenos"> 653</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">latest_points</span> <span class="o">=</span> <span class="n">datapoints</span>
</span><span id="TE_Scraper-654"><a href="#TE_Scraper-654"><span class="linenos"> 654</span></a>            <span class="c1"># Convert metric prefixes for the values in each datapoint</span>
</span><span id="TE_Scraper-655"><a href="#TE_Scraper-655"><span class="linenos"> 655</span></a>            <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">latest_points</span><span class="p">:</span>
</span><span id="TE_Scraper-656"><a href="#TE_Scraper-656"><span class="linenos"> 656</span></a>                <span class="n">point</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">extract_and_convert_value</span><span class="p">(</span><span class="n">point</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="TE_Scraper-657"><a href="#TE_Scraper-657"><span class="linenos"> 657</span></a>                <span class="n">point</span><span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">ready_datestr</span><span class="p">(</span><span class="n">point</span><span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">])</span>
</span><span id="TE_Scraper-658"><a href="#TE_Scraper-658"><span class="linenos"> 658</span></a>            <span class="n">latest_dates</span> <span class="o">=</span> <span class="p">[</span><span class="n">point</span><span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">datapoints</span><span class="p">]</span>
</span><span id="TE_Scraper-659"><a href="#TE_Scraper-659"><span class="linenos"> 659</span></a>            <span class="c1">#print(&quot;Latest dates: &quot;, latest_dates)</span>
</span><span id="TE_Scraper-660"><a href="#TE_Scraper-660"><span class="linenos"> 660</span></a>
</span><span id="TE_Scraper-661"><a href="#TE_Scraper-661"><span class="linenos"> 661</span></a>            <span class="c1">## Get the frequency of the time series</span>
</span><span id="TE_Scraper-662"><a href="#TE_Scraper-662"><span class="linenos"> 662</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">date_series</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">latest_dates</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;datetime64[ns]&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-663"><a href="#TE_Scraper-663"><span class="linenos"> 663</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">get_date_frequency</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">date_series</span><span class="p">)</span>
</span><span id="TE_Scraper-664"><a href="#TE_Scraper-664"><span class="linenos"> 664</span></a>            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;metadata&quot;</span><span class="p">):</span>
</span><span id="TE_Scraper-665"><a href="#TE_Scraper-665"><span class="linenos"> 665</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;frequency&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span>
</span><span id="TE_Scraper-666"><a href="#TE_Scraper-666"><span class="linenos"> 666</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Frequency of time-series: &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="p">)</span>
</span><span id="TE_Scraper-667"><a href="#TE_Scraper-667"><span class="linenos"> 667</span></a>
</span><span id="TE_Scraper-668"><a href="#TE_Scraper-668"><span class="linenos"> 668</span></a>        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.25</span><span class="p">)</span>
</span><span id="TE_Scraper-669"><a href="#TE_Scraper-669"><span class="linenos"> 669</span></a>
</span><span id="TE_Scraper-670"><a href="#TE_Scraper-670"><span class="linenos"> 670</span></a>        <span class="k">if</span> <span class="n">force_rerun_xlims</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;start_end&quot;</span><span class="p">):</span>
</span><span id="TE_Scraper-671"><a href="#TE_Scraper-671"><span class="linenos"> 671</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">start_end</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="TE_Scraper-672"><a href="#TE_Scraper-672"><span class="linenos"> 672</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">set_max_date_span_viaCalendar</span><span class="p">()</span>  <span class="c1">##Set date_span to MAX for start and end date pull...</span>
</span><span id="TE_Scraper-673"><a href="#TE_Scraper-673"><span class="linenos"> 673</span></a>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.25</span><span class="p">)</span>
</span><span id="TE_Scraper-674"><a href="#TE_Scraper-674"><span class="linenos"> 674</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">set_chartType_js</span><span class="p">(</span><span class="s2">&quot;Spline&quot;</span><span class="p">)</span> <span class="c1">#Force spline chart selection - very important. I still have no way to determine if the chart type has changed when it changes automatically.</span>
</span><span id="TE_Scraper-675"><a href="#TE_Scraper-675"><span class="linenos"> 675</span></a>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.25</span><span class="p">)</span>
</span><span id="TE_Scraper-676"><a href="#TE_Scraper-676"><span class="linenos"> 676</span></a>            <span class="n">retries</span> <span class="o">=</span> <span class="mi">3</span>
</span><span id="TE_Scraper-677"><a href="#TE_Scraper-677"><span class="linenos"> 677</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">retries</span><span class="p">):</span>
</span><span id="TE_Scraper-678"><a href="#TE_Scraper-678"><span class="linenos"> 678</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">start_end</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tooltip_scraper</span><span class="o">.</span><span class="n">first_last_dates_js</span><span class="p">()</span>
</span><span id="TE_Scraper-679"><a href="#TE_Scraper-679"><span class="linenos"> 679</span></a>                <span class="c1"># Check if start_end is None or if any of the four essential keys have None/NaN values</span>
</span><span id="TE_Scraper-680"><a href="#TE_Scraper-680"><span class="linenos"> 680</span></a>                <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_end</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> 
</span><span id="TE_Scraper-681"><a href="#TE_Scraper-681"><span class="linenos"> 681</span></a>                    <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_end</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;start_date&quot;</span><span class="p">,</span> <span class="s2">&quot;end_date&quot;</span><span class="p">])</span> <span class="ow">or</span>
</span><span id="TE_Scraper-682"><a href="#TE_Scraper-682"><span class="linenos"> 682</span></a>                    <span class="nb">any</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">isna</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_end</span><span class="p">[</span><span class="n">key</span><span class="p">])</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;start_date&quot;</span><span class="p">,</span> <span class="s2">&quot;end_date&quot;</span><span class="p">]))</span>\
</span><span id="TE_Scraper-683"><a href="#TE_Scraper-683"><span class="linenos"> 683</span></a>                    <span class="ow">or</span> <span class="nb">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_end</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;start_date&quot;</span><span class="p">,</span> <span class="s2">&quot;end_date&quot;</span><span class="p">]):</span>
</span><span id="TE_Scraper-684"><a href="#TE_Scraper-684"><span class="linenos"> 684</span></a>                    <span class="c1">#print(&quot;Retrying start_end extraction...&quot;)</span>
</span><span id="TE_Scraper-685"><a href="#TE_Scraper-685"><span class="linenos"> 685</span></a>                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.25</span><span class="p">)</span>
</span><span id="TE_Scraper-686"><a href="#TE_Scraper-686"><span class="linenos"> 686</span></a>                    <span class="k">pass</span>
</span><span id="TE_Scraper-687"><a href="#TE_Scraper-687"><span class="linenos"> 687</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="TE_Scraper-688"><a href="#TE_Scraper-688"><span class="linenos"> 688</span></a>                    <span class="k">break</span>
</span><span id="TE_Scraper-689"><a href="#TE_Scraper-689"><span class="linenos"> 689</span></a>            <span class="c1">#For some reason running it twice seems to work better...</span>
</span><span id="TE_Scraper-690"><a href="#TE_Scraper-690"><span class="linenos"> 690</span></a>
</span><span id="TE_Scraper-691"><a href="#TE_Scraper-691"><span class="linenos"> 691</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_end</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TE_Scraper-692"><a href="#TE_Scraper-692"><span class="linenos"> 692</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Start and end values scraped from tooltips: </span><span class="se">\n</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">start_end</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-693"><a href="#TE_Scraper-693"><span class="linenos"> 693</span></a>                <span class="n">start_date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_end</span><span class="p">[</span><span class="s2">&quot;start_date&quot;</span><span class="p">];</span> <span class="n">end_date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_end</span><span class="p">[</span><span class="s2">&quot;end_date&quot;</span><span class="p">]</span>
</span><span id="TE_Scraper-694"><a href="#TE_Scraper-694"><span class="linenos"> 694</span></a>                <span class="n">dtIndex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtIndex</span><span class="p">(</span><span class="n">start_date</span><span class="o">=</span><span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="o">=</span><span class="n">end_date</span><span class="p">,</span> <span class="n">ser_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">])</span>
</span><span id="TE_Scraper-695"><a href="#TE_Scraper-695"><span class="linenos"> 695</span></a>                <span class="k">if</span> <span class="n">dtIndex</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TE_Scraper-696"><a href="#TE_Scraper-696"><span class="linenos"> 696</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DateTimeIndex created successfully for the time-series.&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-697"><a href="#TE_Scraper-697"><span class="linenos"> 697</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">x_index</span> <span class="o">=</span> <span class="n">dtIndex</span>
</span><span id="TE_Scraper-698"><a href="#TE_Scraper-698"><span class="linenos"> 698</span></a>                    <span class="k">return</span> <span class="n">dtIndex</span>  
</span><span id="TE_Scraper-699"><a href="#TE_Scraper-699"><span class="linenos"> 699</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="TE_Scraper-700"><a href="#TE_Scraper-700"><span class="linenos"> 700</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error creating DateTimeIndex for the time-series.&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-701"><a href="#TE_Scraper-701"><span class="linenos"> 701</span></a>                    <span class="k">return</span> <span class="kc">None</span>
</span><span id="TE_Scraper-702"><a href="#TE_Scraper-702"><span class="linenos"> 702</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="TE_Scraper-703"><a href="#TE_Scraper-703"><span class="linenos"> 703</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error: Start and end values not found...pulling out....&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-704"><a href="#TE_Scraper-704"><span class="linenos"> 704</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error: Start and end values not found...pulling out....&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-705"><a href="#TE_Scraper-705"><span class="linenos"> 705</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="TE_Scraper-706"><a href="#TE_Scraper-706"><span class="linenos"> 706</span></a>    
</span><span id="TE_Scraper-707"><a href="#TE_Scraper-707"><span class="linenos"> 707</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_earliest_points</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_points</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;all&quot;</span><span class="p">,</span> <span class="n">num_years</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">):</span>
</span><span id="TE_Scraper-708"><a href="#TE_Scraper-708"><span class="linenos"> 708</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the earliest data points from the chart using the cursor, use this to check for series that have differing frequency</span>
</span><span id="TE_Scraper-709"><a href="#TE_Scraper-709"><span class="linenos"> 709</span></a><span class="sd">        at start and end.&quot;&quot;&quot;</span>
</span><span id="TE_Scraper-710"><a href="#TE_Scraper-710"><span class="linenos"> 710</span></a>
</span><span id="TE_Scraper-711"><a href="#TE_Scraper-711"><span class="linenos"> 711</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;start_end&quot;</span><span class="p">):</span>
</span><span id="TE_Scraper-712"><a href="#TE_Scraper-712"><span class="linenos"> 712</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">get_xlims_from_tooltips</span><span class="p">()</span>
</span><span id="TE_Scraper-713"><a href="#TE_Scraper-713"><span class="linenos"> 713</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;tooltip_scraper&quot;</span><span class="p">):</span>
</span><span id="TE_Scraper-714"><a href="#TE_Scraper-714"><span class="linenos"> 714</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">tooltip_scraper</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">TooltipScraper</span><span class="p">(</span><span class="n">parent_instance</span> <span class="o">=</span> <span class="bp">self</span><span class="p">)</span>
</span><span id="TE_Scraper-715"><a href="#TE_Scraper-715"><span class="linenos"> 715</span></a>        
</span><span id="TE_Scraper-716"><a href="#TE_Scraper-716"><span class="linenos"> 716</span></a>        <span class="n">yearslater</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">n_years_later</span><span class="p">(</span><span class="n">date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_end</span><span class="p">[</span><span class="s2">&quot;start_date&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">),</span> <span class="n">n_years</span> <span class="o">=</span> <span class="n">num_years</span><span class="p">)</span>
</span><span id="TE_Scraper-717"><a href="#TE_Scraper-717"><span class="linenos"> 717</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">custom_date_span_js</span><span class="p">(</span><span class="n">start_date</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">start_end</span><span class="p">[</span><span class="s2">&quot;start_date&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">),</span> <span class="n">end_date</span> <span class="o">=</span> <span class="n">yearslater</span><span class="p">)</span>
</span><span id="TE_Scraper-718"><a href="#TE_Scraper-718"><span class="linenos"> 718</span></a>
</span><span id="TE_Scraper-719"><a href="#TE_Scraper-719"><span class="linenos"> 719</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="TE_Scraper-720"><a href="#TE_Scraper-720"><span class="linenos"> 720</span></a>            <span class="n">datapoints</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tooltip_scraper</span><span class="o">.</span><span class="n">latest_points_js</span><span class="p">(</span><span class="n">num_points</span><span class="o">=</span><span class="n">num_points</span><span class="p">,</span> <span class="n">force_shortest_span</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">wait_time</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</span><span id="TE_Scraper-721"><a href="#TE_Scraper-721"><span class="linenos"> 721</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">early_series</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="n">utils</span><span class="o">.</span><span class="n">extract_and_convert_value</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">datapoints</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> \
</span><span id="TE_Scraper-722"><a href="#TE_Scraper-722"><span class="linenos"> 722</span></a>                                    <span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">([</span><span class="n">utils</span><span class="o">.</span><span class="n">ready_datestr</span><span class="p">(</span><span class="n">date</span><span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">])</span> <span class="k">for</span> <span class="n">date</span> <span class="ow">in</span> <span class="n">datapoints</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
</span><span id="TE_Scraper-723"><a href="#TE_Scraper-723"><span class="linenos"> 723</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="TE_Scraper-724"><a href="#TE_Scraper-724"><span class="linenos"> 724</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Error getting earliest points: &quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="TE_Scraper-725"><a href="#TE_Scraper-725"><span class="linenos"> 725</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="TE_Scraper-726"><a href="#TE_Scraper-726"><span class="linenos"> 726</span></a>
</span><span id="TE_Scraper-727"><a href="#TE_Scraper-727"><span class="linenos"> 727</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">early_series</span>
</span><span id="TE_Scraper-728"><a href="#TE_Scraper-728"><span class="linenos"> 728</span></a>
</span><span id="TE_Scraper-729"><a href="#TE_Scraper-729"><span class="linenos"> 729</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">full_series_fromTooltips</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">set_max_datespan</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="TE_Scraper-730"><a href="#TE_Scraper-730"><span class="linenos"> 730</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Scrape the full series from the dates and values displayed on the tooltips as the cursor is dragged across the chart. Uses javscript to handle the cursor </span>
</span><span id="TE_Scraper-731"><a href="#TE_Scraper-731"><span class="linenos"> 731</span></a><span class="sd">        movement and tooltip retrieval and parsing. This is way faster than using a python loop. I suspect this may end up missing some points for series that </span>
</span><span id="TE_Scraper-732"><a href="#TE_Scraper-732"><span class="linenos"> 732</span></a><span class="sd">        have many datapoints. However, it has worked for all series tested thus far. Assigns the resultant series to the series attribute.</span>
</span><span id="TE_Scraper-733"><a href="#TE_Scraper-733"><span class="linenos"> 733</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TE_Scraper-734"><a href="#TE_Scraper-734"><span class="linenos"> 734</span></a>
</span><span id="TE_Scraper-735"><a href="#TE_Scraper-735"><span class="linenos"> 735</span></a>        <span class="k">if</span> <span class="n">set_max_datespan</span><span class="p">:</span>
</span><span id="TE_Scraper-736"><a href="#TE_Scraper-736"><span class="linenos"> 736</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Setting max date span using calendar...&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-737"><a href="#TE_Scraper-737"><span class="linenos"> 737</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">set_max_date_span_viaCalendar</span><span class="p">()</span>
</span><span id="TE_Scraper-738"><a href="#TE_Scraper-738"><span class="linenos"> 738</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">set_chartType_js</span><span class="p">(</span><span class="s2">&quot;Spline&quot;</span><span class="p">)</span> <span class="c1"># Force spline chart type so that Y position of cursor does not matter for tooltip retrieval.</span>
</span><span id="TE_Scraper-739"><a href="#TE_Scraper-739"><span class="linenos"> 739</span></a>
</span><span id="TE_Scraper-740"><a href="#TE_Scraper-740"><span class="linenos"> 740</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;tooltip_scraper&quot;</span><span class="p">):</span>
</span><span id="TE_Scraper-741"><a href="#TE_Scraper-741"><span class="linenos"> 741</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">init_tooltipScraper</span><span class="p">()</span>  <span class="c1">## Initialize the tooltip scraper.</span>
</span><span id="TE_Scraper-742"><a href="#TE_Scraper-742"><span class="linenos"> 742</span></a>        <span class="c1">## Javascript based method here.</span>
</span><span id="TE_Scraper-743"><a href="#TE_Scraper-743"><span class="linenos"> 743</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="TE_Scraper-744"><a href="#TE_Scraper-744"><span class="linenos"> 744</span></a>            <span class="n">datapoints</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tooltip_scraper</span><span class="o">.</span><span class="n">latest_points_js</span><span class="p">(</span><span class="n">num_points</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">,</span> <span class="n">force_shortest_span</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">wait_time</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</span><span id="TE_Scraper-745"><a href="#TE_Scraper-745"><span class="linenos"> 745</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="TE_Scraper-746"><a href="#TE_Scraper-746"><span class="linenos"> 746</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Tooltip scraping of full series has failed, error: &quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="TE_Scraper-747"><a href="#TE_Scraper-747"><span class="linenos"> 747</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="TE_Scraper-748"><a href="#TE_Scraper-748"><span class="linenos"> 748</span></a>        <span class="c1">#Powerful one line pandas connversion...</span>
</span><span id="TE_Scraper-749"><a href="#TE_Scraper-749"><span class="linenos"> 749</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">series</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="n">utils</span><span class="o">.</span><span class="n">extract_and_convert_value</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">datapoints</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> \
</span><span id="TE_Scraper-750"><a href="#TE_Scraper-750"><span class="linenos"> 750</span></a>                                <span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">([</span><span class="n">utils</span><span class="o">.</span><span class="n">ready_datestr</span><span class="p">(</span><span class="n">date</span><span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">])</span> <span class="k">for</span> <span class="n">date</span> <span class="ow">in</span> <span class="n">datapoints</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
</span><span id="TE_Scraper-751"><a href="#TE_Scraper-751"><span class="linenos"> 751</span></a>
</span><span id="TE_Scraper-752"><a href="#TE_Scraper-752"><span class="linenos"> 752</span></a>        <span class="c1"># Add some more metadata about the series. </span>
</span><span id="TE_Scraper-753"><a href="#TE_Scraper-753"><span class="linenos"> 753</span></a>        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;metadata&quot;</span><span class="p">):</span>
</span><span id="TE_Scraper-754"><a href="#TE_Scraper-754"><span class="linenos"> 754</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;start_date&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-755"><a href="#TE_Scraper-755"><span class="linenos"> 755</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;end_date&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-756"><a href="#TE_Scraper-756"><span class="linenos"> 756</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;min_value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
</span><span id="TE_Scraper-757"><a href="#TE_Scraper-757"><span class="linenos"> 757</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;max_value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
</span><span id="TE_Scraper-758"><a href="#TE_Scraper-758"><span class="linenos"> 758</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;length&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="p">)</span>
</span><span id="TE_Scraper-759"><a href="#TE_Scraper-759"><span class="linenos"> 759</span></a>            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;frequency&quot;</span><span class="p">):</span>
</span><span id="TE_Scraper-760"><a href="#TE_Scraper-760"><span class="linenos"> 760</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;frequency&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span>
</span><span id="TE_Scraper-761"><a href="#TE_Scraper-761"><span class="linenos"> 761</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="TE_Scraper-762"><a href="#TE_Scraper-762"><span class="linenos"> 762</span></a>                <span class="n">freq</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">infer_freq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="c1"># Infer the frequency of the series.</span>
</span><span id="TE_Scraper-763"><a href="#TE_Scraper-763"><span class="linenos"> 763</span></a>                <span class="k">if</span> <span class="n">freq</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TE_Scraper-764"><a href="#TE_Scraper-764"><span class="linenos"> 764</span></a>                    <span class="n">freq</span> <span class="o">=</span> <span class="s2">&quot;Unknown/irregular&quot;</span>
</span><span id="TE_Scraper-765"><a href="#TE_Scraper-765"><span class="linenos"> 765</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;frequency&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">freq</span>
</span><span id="TE_Scraper-766"><a href="#TE_Scraper-766"><span class="linenos"> 766</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">series_metadata</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">)</span>
</span><span id="TE_Scraper-767"><a href="#TE_Scraper-767"><span class="linenos"> 767</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully scraped full series from tooltips.&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-768"><a href="#TE_Scraper-768"><span class="linenos"> 768</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;frequency&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Unknown/irregular&quot;</span><span class="p">:</span>
</span><span id="TE_Scraper-769"><a href="#TE_Scraper-769"><span class="linenos"> 769</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Frequency of the series is unknown or irregular, the tooltip scraping may have missed points. Retry scraping using &#39;path&#39; method instead of &#39;tooltips&#39;.&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-770"><a href="#TE_Scraper-770"><span class="linenos"> 770</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">series</span>
</span><span id="TE_Scraper-771"><a href="#TE_Scraper-771"><span class="linenos"> 771</span></a>
</span><span id="TE_Scraper-772"><a href="#TE_Scraper-772"><span class="linenos"> 772</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">tooltip_multiScrape</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="TE_Scraper-773"><a href="#TE_Scraper-773"><span class="linenos"> 773</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; Use the TooltipScraper object to scrape the full series from the chart. This is the most accurate method of scraping the full</span>
</span><span id="TE_Scraper-774"><a href="#TE_Scraper-774"><span class="linenos"> 774</span></a><span class="sd">        series but s the slowest. The x_index attribute must be set before running this method. The method will use multiple runs</span>
</span><span id="TE_Scraper-775"><a href="#TE_Scraper-775"><span class="linenos"> 775</span></a><span class="sd">        of the javascript tooltip scraping script. It will be done in multiple runs to prevent points being missed. Number of runs</span>
</span><span id="TE_Scraper-776"><a href="#TE_Scraper-776"><span class="linenos"> 776</span></a><span class="sd">        will depend upon the length of the x_index attribute. &quot;&quot;&quot;</span>
</span><span id="TE_Scraper-777"><a href="#TE_Scraper-777"><span class="linenos"> 777</span></a>
</span><span id="TE_Scraper-778"><a href="#TE_Scraper-778"><span class="linenos"> 778</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;tooltip_scraper&quot;</span><span class="p">):</span>
</span><span id="TE_Scraper-779"><a href="#TE_Scraper-779"><span class="linenos"> 779</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">init_tooltipScraper</span><span class="p">()</span>
</span><span id="TE_Scraper-780"><a href="#TE_Scraper-780"><span class="linenos"> 780</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;x_index&quot;</span><span class="p">):</span>
</span><span id="TE_Scraper-781"><a href="#TE_Scraper-781"><span class="linenos"> 781</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">make_x_index</span><span class="p">(</span><span class="n">force_rerun_freqdet</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">force_rerun_xlims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="TE_Scraper-782"><a href="#TE_Scraper-782"><span class="linenos"> 782</span></a>
</span><span id="TE_Scraper-783"><a href="#TE_Scraper-783"><span class="linenos"> 783</span></a>        <span class="n">max_chunk_size</span> <span class="o">=</span> <span class="mi">500</span>  <span class="c1"># Maximum number of points to scrape in one go. This is deterined by the density of datapoints on the chart. </span>
</span><span id="TE_Scraper-784"><a href="#TE_Scraper-784"><span class="linenos"> 784</span></a>        <span class="n">total_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_index</span><span class="p">)</span> <span class="c1"># Total number of points in the x_index attribute.</span>
</span><span id="TE_Scraper-785"><a href="#TE_Scraper-785"><span class="linenos"> 785</span></a>        <span class="n">numscrapes</span> <span class="o">=</span> <span class="p">(</span><span class="n">total_len</span> <span class="o">+</span> <span class="n">max_chunk_size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="n">max_chunk_size</span>  <span class="c1"># Ceiling division</span>
</span><span id="TE_Scraper-786"><a href="#TE_Scraper-786"><span class="linenos"> 786</span></a>        <span class="n">sub_indexes</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1">#The index will be brken up into this list of subIndexes.</span>
</span><span id="TE_Scraper-787"><a href="#TE_Scraper-787"><span class="linenos"> 787</span></a>        <span class="n">base_size</span> <span class="o">=</span> <span class="n">total_len</span> <span class="o">//</span> <span class="n">numscrapes</span>
</span><span id="TE_Scraper-788"><a href="#TE_Scraper-788"><span class="linenos"> 788</span></a>        <span class="n">remainder</span> <span class="o">=</span> <span class="n">total_len</span> <span class="o">%</span> <span class="n">numscrapes</span>
</span><span id="TE_Scraper-789"><a href="#TE_Scraper-789"><span class="linenos"> 789</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; Using mixed scraping approach, slowest, highest accuracy. Splitting x_index into subIndexes</span><span class="se">\</span>
</span><span id="TE_Scraper-790"><a href="#TE_Scraper-790"><span class="linenos"> 790</span></a><span class="s2">        Total points: </span><span class="si">{</span><span class="n">total_len</span><span class="si">}</span><span class="s2">, Max chunk size: </span><span class="si">{</span><span class="n">max_chunk_size</span><span class="si">}</span><span class="s2">, Number of chunks: </span><span class="si">{</span><span class="n">numscrapes</span><span class="si">}</span><span class="s2">, remainder: </span><span class="si">{</span><span class="n">remainder</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-791"><a href="#TE_Scraper-791"><span class="linenos"> 791</span></a>
</span><span id="TE_Scraper-792"><a href="#TE_Scraper-792"><span class="linenos"> 792</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numscrapes</span><span class="p">):</span>
</span><span id="TE_Scraper-793"><a href="#TE_Scraper-793"><span class="linenos"> 793</span></a>            <span class="n">start_idx</span> <span class="o">=</span> <span class="n">i</span> <span class="o">*</span> <span class="n">base_size</span>
</span><span id="TE_Scraper-794"><a href="#TE_Scraper-794"><span class="linenos"> 794</span></a>            <span class="c1"># For last chunk, include all remaining points</span>
</span><span id="TE_Scraper-795"><a href="#TE_Scraper-795"><span class="linenos"> 795</span></a>            <span class="n">end_idx</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">base_size</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">numscrapes</span> <span class="o">-</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">total_len</span>
</span><span id="TE_Scraper-796"><a href="#TE_Scraper-796"><span class="linenos"> 796</span></a>            <span class="n">sub_indexes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_index</span><span class="p">[</span><span class="n">start_idx</span><span class="p">:</span><span class="n">end_idx</span><span class="p">])</span>
</span><span id="TE_Scraper-797"><a href="#TE_Scraper-797"><span class="linenos"> 797</span></a>
</span><span id="TE_Scraper-798"><a href="#TE_Scraper-798"><span class="linenos"> 798</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;x_index Start date: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">x_index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">, End date: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">x_index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-799"><a href="#TE_Scraper-799"><span class="linenos"> 799</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sub_indexes</span><span class="p">):</span> <span class="c1">#Chec</span>
</span><span id="TE_Scraper-800"><a href="#TE_Scraper-800"><span class="linenos"> 800</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SubIndex </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span><span class="si">}</span><span class="s2"> points, from </span><span class="si">{</span><span class="n">idx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">idx</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">, frequency: </span><span class="si">{</span><span class="n">pd</span><span class="o">.</span><span class="n">infer_freq</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-801"><a href="#TE_Scraper-801"><span class="linenos"> 801</span></a>            <span class="c1">#Set the date span on the chart to cover the subIndex.</span>
</span><span id="TE_Scraper-802"><a href="#TE_Scraper-802"><span class="linenos"> 802</span></a>            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">sub_indexes</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="TE_Scraper-803"><a href="#TE_Scraper-803"><span class="linenos"> 803</span></a>                <span class="n">end_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-804"><a href="#TE_Scraper-804"><span class="linenos"> 804</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="TE_Scraper-805"><a href="#TE_Scraper-805"><span class="linenos"> 805</span></a>                <span class="n">end_date</span> <span class="o">=</span> <span class="n">idx</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-806"><a href="#TE_Scraper-806"><span class="linenos"> 806</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">custom_date_span_js</span><span class="p">(</span><span class="n">start_date</span><span class="o">=</span><span class="n">idx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">),</span> <span class="n">end_date</span> <span class="o">=</span> <span class="n">end_date</span><span class="p">)</span>
</span><span id="TE_Scraper-807"><a href="#TE_Scraper-807"><span class="linenos"> 807</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">set_chartType_js</span><span class="p">(</span><span class="s2">&quot;Spline&quot;</span><span class="p">)</span> <span class="c1">#Force spline chart selection - needed for tootip capture</span>
</span><span id="TE_Scraper-808"><a href="#TE_Scraper-808"><span class="linenos"> 808</span></a>
</span><span id="TE_Scraper-809"><a href="#TE_Scraper-809"><span class="linenos"> 809</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="TE_Scraper-810"><a href="#TE_Scraper-810"><span class="linenos"> 810</span></a>                <span class="n">datapoints</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tooltip_scraper</span><span class="o">.</span><span class="n">latest_points_js</span><span class="p">(</span><span class="n">num_points</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">,</span> <span class="n">force_shortest_span</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">wait_time</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="TE_Scraper-811"><a href="#TE_Scraper-811"><span class="linenos"> 811</span></a>                <span class="c1">#Powerful one line pandas connversion...</span>
</span><span id="TE_Scraper-812"><a href="#TE_Scraper-812"><span class="linenos"> 812</span></a>                <span class="n">series</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="n">utils</span><span class="o">.</span><span class="n">extract_and_convert_value</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">datapoints</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> \
</span><span id="TE_Scraper-813"><a href="#TE_Scraper-813"><span class="linenos"> 813</span></a>                                    <span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">([</span><span class="n">utils</span><span class="o">.</span><span class="n">ready_datestr</span><span class="p">(</span><span class="n">date</span><span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">])</span> <span class="k">for</span> <span class="n">date</span> <span class="ow">in</span> <span class="n">datapoints</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
</span><span id="TE_Scraper-814"><a href="#TE_Scraper-814"><span class="linenos"> 814</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="TE_Scraper-815"><a href="#TE_Scraper-815"><span class="linenos"> 815</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Tooltip scraping of full series has failed, error: &quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="TE_Scraper-816"><a href="#TE_Scraper-816"><span class="linenos"> 816</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="TE_Scraper-817"><a href="#TE_Scraper-817"><span class="linenos"> 817</span></a>            
</span><span id="TE_Scraper-818"><a href="#TE_Scraper-818"><span class="linenos"> 818</span></a>            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="TE_Scraper-819"><a href="#TE_Scraper-819"><span class="linenos"> 819</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">series</span> <span class="o">=</span> <span class="n">series</span>
</span><span id="TE_Scraper-820"><a href="#TE_Scraper-820"><span class="linenos"> 820</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="TE_Scraper-821"><a href="#TE_Scraper-821"><span class="linenos"> 821</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">series</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="p">,</span> <span class="n">series</span><span class="p">],</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">])</span>
</span><span id="TE_Scraper-822"><a href="#TE_Scraper-822"><span class="linenos"> 822</span></a>
</span><span id="TE_Scraper-823"><a href="#TE_Scraper-823"><span class="linenos"> 823</span></a>        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;metadata&quot;</span><span class="p">):</span>
</span><span id="TE_Scraper-824"><a href="#TE_Scraper-824"><span class="linenos"> 824</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;start_date&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-825"><a href="#TE_Scraper-825"><span class="linenos"> 825</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;end_date&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-826"><a href="#TE_Scraper-826"><span class="linenos"> 826</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;min_value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
</span><span id="TE_Scraper-827"><a href="#TE_Scraper-827"><span class="linenos"> 827</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;max_value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
</span><span id="TE_Scraper-828"><a href="#TE_Scraper-828"><span class="linenos"> 828</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;length&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="p">)</span>
</span><span id="TE_Scraper-829"><a href="#TE_Scraper-829"><span class="linenos"> 829</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">series_metadata</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">)</span>
</span><span id="TE_Scraper-830"><a href="#TE_Scraper-830"><span class="linenos"> 830</span></a>
</span><span id="TE_Scraper-831"><a href="#TE_Scraper-831"><span class="linenos"> 831</span></a>        <span class="c1">##Sometimes the first and last data points seem to be missed, luckily we have them already in the start_end attribute.</span>
</span><span id="TE_Scraper-832"><a href="#TE_Scraper-832"><span class="linenos"> 832</span></a>        <span class="c1"># Overwrite the first and last points with the start_end values.</span>
</span><span id="TE_Scraper-833"><a href="#TE_Scraper-833"><span class="linenos"> 833</span></a>        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;start_end&quot;</span><span class="p">):</span>
</span><span id="TE_Scraper-834"><a href="#TE_Scraper-834"><span class="linenos"> 834</span></a>            <span class="c1"># Convert start_date and end_date to datetime objects</span>
</span><span id="TE_Scraper-835"><a href="#TE_Scraper-835"><span class="linenos"> 835</span></a>            <span class="n">start_date</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_end</span><span class="p">[</span><span class="s2">&quot;start_date&quot;</span><span class="p">])</span>
</span><span id="TE_Scraper-836"><a href="#TE_Scraper-836"><span class="linenos"> 836</span></a>            <span class="n">end_date</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_end</span><span class="p">[</span><span class="s2">&quot;end_date&quot;</span><span class="p">])</span>
</span><span id="TE_Scraper-837"><a href="#TE_Scraper-837"><span class="linenos"> 837</span></a>            <span class="c1"># Create Series objects for the start and end values</span>
</span><span id="TE_Scraper-838"><a href="#TE_Scraper-838"><span class="linenos"> 838</span></a>            <span class="n">start_series</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">({</span><span class="n">start_date</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_end</span><span class="p">[</span><span class="s2">&quot;start_value&quot;</span><span class="p">]})</span>
</span><span id="TE_Scraper-839"><a href="#TE_Scraper-839"><span class="linenos"> 839</span></a>            <span class="n">end_series</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">({</span><span class="n">end_date</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_end</span><span class="p">[</span><span class="s2">&quot;end_value&quot;</span><span class="p">]})</span>
</span><span id="TE_Scraper-840"><a href="#TE_Scraper-840"><span class="linenos"> 840</span></a>            <span class="c1"># Concatenate with the existing series</span>
</span><span id="TE_Scraper-841"><a href="#TE_Scraper-841"><span class="linenos"> 841</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">series</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">start_series</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="p">,</span> <span class="n">end_series</span><span class="p">])</span>
</span><span id="TE_Scraper-842"><a href="#TE_Scraper-842"><span class="linenos"> 842</span></a>            <span class="c1"># Drop duplicates keeping the last occurrence (which would be from start_end if dates already exist)</span>
</span><span id="TE_Scraper-843"><a href="#TE_Scraper-843"><span class="linenos"> 843</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">series</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="p">[</span><span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">duplicated</span><span class="p">(</span><span class="n">keep</span><span class="o">=</span><span class="s1">&#39;last&#39;</span><span class="p">)]</span>
</span><span id="TE_Scraper-844"><a href="#TE_Scraper-844"><span class="linenos"> 844</span></a>            <span class="c1"># Sort by index to ensure the datetime index is in ascending order</span>
</span><span id="TE_Scraper-845"><a href="#TE_Scraper-845"><span class="linenos"> 845</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">series</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">])</span>
</span><span id="TE_Scraper-846"><a href="#TE_Scraper-846"><span class="linenos"> 846</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully scraped full series from tooltips.&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-847"><a href="#TE_Scraper-847"><span class="linenos"> 847</span></a>        <span class="k">return</span> <span class="kc">True</span>
</span><span id="TE_Scraper-848"><a href="#TE_Scraper-848"><span class="linenos"> 848</span></a>    
</span><span id="TE_Scraper-849"><a href="#TE_Scraper-849"><span class="linenos"> 849</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">series_from_highcharts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="TE_Scraper-850"><a href="#TE_Scraper-850"><span class="linenos"> 850</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the series data from the Highcharts JavaScript object. This is the fastest method of getting the series data from the chart.</span>
</span><span id="TE_Scraper-851"><a href="#TE_Scraper-851"><span class="linenos"> 851</span></a><span class="sd">        The series data is stored in the &quot;series&quot; attribute of the class. The method</span>
</span><span id="TE_Scraper-852"><a href="#TE_Scraper-852"><span class="linenos"> 852</span></a><span class="sd">        will return the series data as well. &quot;&quot;&quot;</span>
</span><span id="TE_Scraper-853"><a href="#TE_Scraper-853"><span class="linenos"> 853</span></a>
</span><span id="TE_Scraper-854"><a href="#TE_Scraper-854"><span class="linenos"> 854</span></a>        <span class="n">js_file_path</span> <span class="o">=</span> <span class="n">wd</span> <span class="o">+</span> <span class="n">fdel</span> <span class="o">+</span> <span class="s1">&#39;check_highcharts.js&#39;</span>
</span><span id="TE_Scraper-855"><a href="#TE_Scraper-855"><span class="linenos"> 855</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">js_file_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
</span><span id="TE_Scraper-856"><a href="#TE_Scraper-856"><span class="linenos"> 856</span></a>            <span class="n">script</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span><span id="TE_Scraper-857"><a href="#TE_Scraper-857"><span class="linenos"> 857</span></a>
</span><span id="TE_Scraper-858"><a href="#TE_Scraper-858"><span class="linenos"> 858</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="TE_Scraper-859"><a href="#TE_Scraper-859"><span class="linenos"> 859</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">execute_script</span><span class="p">(</span><span class="n">script</span><span class="p">)</span>
</span><span id="TE_Scraper-860"><a href="#TE_Scraper-860"><span class="linenos"> 860</span></a>            <span class="c1"># Extract the data points</span>
</span><span id="TE_Scraper-861"><a href="#TE_Scraper-861"><span class="linenos"> 861</span></a>            <span class="n">data_points</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;seriesData&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;points&#39;</span><span class="p">]</span>
</span><span id="TE_Scraper-862"><a href="#TE_Scraper-862"><span class="linenos"> 862</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="p">[(</span><span class="n">point</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">],</span> <span class="n">point</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">])</span> <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">data_points</span><span class="p">]</span>
</span><span id="TE_Scraper-863"><a href="#TE_Scraper-863"><span class="linenos"> 863</span></a>            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">])</span>
</span><span id="TE_Scraper-864"><a href="#TE_Scraper-864"><span class="linenos"> 864</span></a>            <span class="c1"># Convert timestamp to datetime</span>
</span><span id="TE_Scraper-865"><a href="#TE_Scraper-865"><span class="linenos"> 865</span></a>            <span class="n">df</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">],</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;ms&#39;</span><span class="p">)</span>
</span><span id="TE_Scraper-866"><a href="#TE_Scraper-866"><span class="linenos"> 866</span></a>            <span class="c1"># Set date as index</span>
</span><span id="TE_Scraper-867"><a href="#TE_Scraper-867"><span class="linenos"> 867</span></a>            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">)</span>
</span><span id="TE_Scraper-868"><a href="#TE_Scraper-868"><span class="linenos"> 868</span></a>
</span><span id="TE_Scraper-869"><a href="#TE_Scraper-869"><span class="linenos"> 869</span></a>            <span class="n">series</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">])</span>
</span><span id="TE_Scraper-870"><a href="#TE_Scraper-870"><span class="linenos"> 870</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">series</span> <span class="o">=</span> <span class="n">series</span>
</span><span id="TE_Scraper-871"><a href="#TE_Scraper-871"><span class="linenos"> 871</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully extracted series data from Highcharts.&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-872"><a href="#TE_Scraper-872"><span class="linenos"> 872</span></a>            <span class="n">freq</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">infer_freq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="c1"># Infer the frequency of the series.</span>
</span><span id="TE_Scraper-873"><a href="#TE_Scraper-873"><span class="linenos"> 873</span></a>            <span class="k">if</span> <span class="n">freq</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TE_Scraper-874"><a href="#TE_Scraper-874"><span class="linenos"> 874</span></a>                <span class="n">freq</span> <span class="o">=</span> <span class="s2">&quot;Unknown/irregular&quot;</span>
</span><span id="TE_Scraper-875"><a href="#TE_Scraper-875"><span class="linenos"> 875</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;frequency&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">freq</span>
</span><span id="TE_Scraper-876"><a href="#TE_Scraper-876"><span class="linenos"> 876</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;start_date&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-877"><a href="#TE_Scraper-877"><span class="linenos"> 877</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;end_date&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-878"><a href="#TE_Scraper-878"><span class="linenos"> 878</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;min_value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
</span><span id="TE_Scraper-879"><a href="#TE_Scraper-879"><span class="linenos"> 879</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;max_value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
</span><span id="TE_Scraper-880"><a href="#TE_Scraper-880"><span class="linenos"> 880</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;length&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="p">)</span>
</span><span id="TE_Scraper-881"><a href="#TE_Scraper-881"><span class="linenos"> 881</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">series_metadata</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">)</span>
</span><span id="TE_Scraper-882"><a href="#TE_Scraper-882"><span class="linenos"> 882</span></a>            
</span><span id="TE_Scraper-883"><a href="#TE_Scraper-883"><span class="linenos"> 883</span></a>            <span class="k">return</span> <span class="n">series</span>
</span><span id="TE_Scraper-884"><a href="#TE_Scraper-884"><span class="linenos"> 884</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="TE_Scraper-885"><a href="#TE_Scraper-885"><span class="linenos"> 885</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error extracting series from Highcharts: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-886"><a href="#TE_Scraper-886"><span class="linenos"> 886</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="TE_Scraper-887"><a href="#TE_Scraper-887"><span class="linenos"> 887</span></a>
</span><span id="TE_Scraper-888"><a href="#TE_Scraper-888"><span class="linenos"> 888</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_chart_type_from_highcharts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="TE_Scraper-889"><a href="#TE_Scraper-889"><span class="linenos"> 889</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TE_Scraper-890"><a href="#TE_Scraper-890"><span class="linenos"> 890</span></a><span class="sd">        Get the chart type directly from the Highcharts API.</span>
</span><span id="TE_Scraper-891"><a href="#TE_Scraper-891"><span class="linenos"> 891</span></a><span class="sd">        This is the most reliable way to determine chart type.</span>
</span><span id="TE_Scraper-892"><a href="#TE_Scraper-892"><span class="linenos"> 892</span></a><span class="sd">        </span>
</span><span id="TE_Scraper-893"><a href="#TE_Scraper-893"><span class="linenos"> 893</span></a><span class="sd">        Returns:</span>
</span><span id="TE_Scraper-894"><a href="#TE_Scraper-894"><span class="linenos"> 894</span></a><span class="sd">            dict: Chart type information including main type, series types, and point count</span>
</span><span id="TE_Scraper-895"><a href="#TE_Scraper-895"><span class="linenos"> 895</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TE_Scraper-896"><a href="#TE_Scraper-896"><span class="linenos"> 896</span></a>        <span class="n">script</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
</span><span id="TE_Scraper-897"><a href="#TE_Scraper-897"><span class="linenos"> 897</span></a><span class="s2">        try {</span>
</span><span id="TE_Scraper-898"><a href="#TE_Scraper-898"><span class="linenos"> 898</span></a><span class="s2">            if (typeof Highcharts === &#39;undefined&#39;) {</span>
</span><span id="TE_Scraper-899"><a href="#TE_Scraper-899"><span class="linenos"> 899</span></a><span class="s2">                return { error: &quot;Highcharts not found&quot;, success: false };</span>
</span><span id="TE_Scraper-900"><a href="#TE_Scraper-900"><span class="linenos"> 900</span></a><span class="s2">            }</span>
</span><span id="TE_Scraper-901"><a href="#TE_Scraper-901"><span class="linenos"> 901</span></a><span class="s2">            </span>
</span><span id="TE_Scraper-902"><a href="#TE_Scraper-902"><span class="linenos"> 902</span></a><span class="s2">            const chart = Highcharts.charts.find(c =&gt; c &amp;&amp; c.series &amp;&amp; c.series.length &gt; 0);</span>
</span><span id="TE_Scraper-903"><a href="#TE_Scraper-903"><span class="linenos"> 903</span></a><span class="s2">            if (!chart) {</span>
</span><span id="TE_Scraper-904"><a href="#TE_Scraper-904"><span class="linenos"> 904</span></a><span class="s2">                return { error: &quot;No valid chart found&quot;, success: false };</span>
</span><span id="TE_Scraper-905"><a href="#TE_Scraper-905"><span class="linenos"> 905</span></a><span class="s2">            }</span>
</span><span id="TE_Scraper-906"><a href="#TE_Scraper-906"><span class="linenos"> 906</span></a><span class="s2">            </span>
</span><span id="TE_Scraper-907"><a href="#TE_Scraper-907"><span class="linenos"> 907</span></a><span class="s2">            return {</span>
</span><span id="TE_Scraper-908"><a href="#TE_Scraper-908"><span class="linenos"> 908</span></a><span class="s2">                mainType: chart.options?.chart?.type || &quot;unknown&quot;,</span>
</span><span id="TE_Scraper-909"><a href="#TE_Scraper-909"><span class="linenos"> 909</span></a><span class="s2">                seriesTypes: chart.series.map(s =&gt; ({</span>
</span><span id="TE_Scraper-910"><a href="#TE_Scraper-910"><span class="linenos"> 910</span></a><span class="s2">                    name: s.name,</span>
</span><span id="TE_Scraper-911"><a href="#TE_Scraper-911"><span class="linenos"> 911</span></a><span class="s2">                    type: s.type || chart.options?.chart?.type</span>
</span><span id="TE_Scraper-912"><a href="#TE_Scraper-912"><span class="linenos"> 912</span></a><span class="s2">                })),</span>
</span><span id="TE_Scraper-913"><a href="#TE_Scraper-913"><span class="linenos"> 913</span></a><span class="s2">                pointCount: chart.series[0]?.points?.length || 0,</span>
</span><span id="TE_Scraper-914"><a href="#TE_Scraper-914"><span class="linenos"> 914</span></a><span class="s2">                success: true</span>
</span><span id="TE_Scraper-915"><a href="#TE_Scraper-915"><span class="linenos"> 915</span></a><span class="s2">            };</span>
</span><span id="TE_Scraper-916"><a href="#TE_Scraper-916"><span class="linenos"> 916</span></a><span class="s2">        } catch (e) {</span>
</span><span id="TE_Scraper-917"><a href="#TE_Scraper-917"><span class="linenos"> 917</span></a><span class="s2">            return { error: &quot;JavaScript error: &quot; + e.message, success: false };</span>
</span><span id="TE_Scraper-918"><a href="#TE_Scraper-918"><span class="linenos"> 918</span></a><span class="s2">        }</span>
</span><span id="TE_Scraper-919"><a href="#TE_Scraper-919"><span class="linenos"> 919</span></a><span class="s2">        &quot;&quot;&quot;</span>
</span><span id="TE_Scraper-920"><a href="#TE_Scraper-920"><span class="linenos"> 920</span></a>        
</span><span id="TE_Scraper-921"><a href="#TE_Scraper-921"><span class="linenos"> 921</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="TE_Scraper-922"><a href="#TE_Scraper-922"><span class="linenos"> 922</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">execute_script</span><span class="p">(</span><span class="n">script</span><span class="p">)</span>
</span><span id="TE_Scraper-923"><a href="#TE_Scraper-923"><span class="linenos"> 923</span></a>            <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TE_Scraper-924"><a href="#TE_Scraper-924"><span class="linenos"> 924</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;JavaScript execution returned None - Highcharts API may not be accessible&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-925"><a href="#TE_Scraper-925"><span class="linenos"> 925</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="TE_Scraper-926"><a href="#TE_Scraper-926"><span class="linenos"> 926</span></a>                
</span><span id="TE_Scraper-927"><a href="#TE_Scraper-927"><span class="linenos"> 927</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Result: &#39;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
</span><span id="TE_Scraper-928"><a href="#TE_Scraper-928"><span class="linenos"> 928</span></a>            <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;success&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="TE_Scraper-929"><a href="#TE_Scraper-929"><span class="linenos"> 929</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span><span class="o">+</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;seriesTypes&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;Chart&quot;</span>
</span><span id="TE_Scraper-930"><a href="#TE_Scraper-930"><span class="linenos"> 930</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Chart type detected from Highcharts API: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-931"><a href="#TE_Scraper-931"><span class="linenos"> 931</span></a>                <span class="k">return</span> <span class="n">result</span>
</span><span id="TE_Scraper-932"><a href="#TE_Scraper-932"><span class="linenos"> 932</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="TE_Scraper-933"><a href="#TE_Scraper-933"><span class="linenos"> 933</span></a>                <span class="n">error_msg</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="s1">&#39;Unknown error&#39;</span><span class="p">)</span>
</span><span id="TE_Scraper-934"><a href="#TE_Scraper-934"><span class="linenos"> 934</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to detect chart type: </span><span class="si">{</span><span class="n">error_msg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-935"><a href="#TE_Scraper-935"><span class="linenos"> 935</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="TE_Scraper-936"><a href="#TE_Scraper-936"><span class="linenos"> 936</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="TE_Scraper-937"><a href="#TE_Scraper-937"><span class="linenos"> 937</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error detecting chart type: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-938"><a href="#TE_Scraper-938"><span class="linenos"> 938</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="TE_Scraper-939"><a href="#TE_Scraper-939"><span class="linenos"> 939</span></a>        
</span><span id="TE_Scraper-940"><a href="#TE_Scraper-940"><span class="linenos"> 940</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_chartType_highcharts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chart_type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;Column&#39;</span><span class="p">,</span> <span class="s1">&#39;Spline&#39;</span><span class="p">,</span> <span class="s1">&#39;Areaspline&#39;</span><span class="p">,</span> <span class="s1">&#39;Stepline&#39;</span><span class="p">,</span> <span class="s1">&#39;Line&#39;</span><span class="p">,</span> <span class="s1">&#39;Area&#39;</span><span class="p">]):</span>
</span><span id="TE_Scraper-941"><a href="#TE_Scraper-941"><span class="linenos"> 941</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Set chart type directly using Highcharts API, unsure if this is working properly yet. This should be the most reliable way to set the chart type.</span>
</span><span id="TE_Scraper-942"><a href="#TE_Scraper-942"><span class="linenos"> 942</span></a><span class="sd">        List chart types: &#39;Column&#39;, &#39;Spline&#39;, &#39;Areaspline&#39;, &#39;Stepline&#39;, &#39;Line&#39;, &#39;Area&#39;, list them by veiwing chart_types attribute of the TE_Scraper.&quot;&quot;&quot;</span>
</span><span id="TE_Scraper-943"><a href="#TE_Scraper-943"><span class="linenos"> 943</span></a>        
</span><span id="TE_Scraper-944"><a href="#TE_Scraper-944"><span class="linenos"> 944</span></a>        <span class="n">script</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="TE_Scraper-945"><a href="#TE_Scraper-945"><span class="linenos"> 945</span></a><span class="s2">        (() =&gt; </span><span class="se">{{</span>
</span><span id="TE_Scraper-946"><a href="#TE_Scraper-946"><span class="linenos"> 946</span></a><span class="s2">        if (typeof Highcharts === &#39;undefined&#39;) return false;</span>
</span><span id="TE_Scraper-947"><a href="#TE_Scraper-947"><span class="linenos"> 947</span></a><span class="s2">        </span>
</span><span id="TE_Scraper-948"><a href="#TE_Scraper-948"><span class="linenos"> 948</span></a><span class="s2">        const chart = Highcharts.charts.find(c =&gt; c &amp;&amp; c.series &amp;&amp; c.series.length &gt; 0);</span>
</span><span id="TE_Scraper-949"><a href="#TE_Scraper-949"><span class="linenos"> 949</span></a><span class="s2">        if (!chart) return false;</span>
</span><span id="TE_Scraper-950"><a href="#TE_Scraper-950"><span class="linenos"> 950</span></a><span class="s2">        </span>
</span><span id="TE_Scraper-951"><a href="#TE_Scraper-951"><span class="linenos"> 951</span></a><span class="s2">        // Store current type</span>
</span><span id="TE_Scraper-952"><a href="#TE_Scraper-952"><span class="linenos"> 952</span></a><span class="s2">        const currentType = chart.options?.chart?.type;</span>
</span><span id="TE_Scraper-953"><a href="#TE_Scraper-953"><span class="linenos"> 953</span></a><span class="s2">        </span>
</span><span id="TE_Scraper-954"><a href="#TE_Scraper-954"><span class="linenos"> 954</span></a><span class="s2">        // Set new type for all series</span>
</span><span id="TE_Scraper-955"><a href="#TE_Scraper-955"><span class="linenos"> 955</span></a><span class="s2">        chart.update(</span><span class="se">{{</span><span class="s2"> chart: </span><span class="se">{{</span><span class="s2"> type: &#39;</span><span class="si">{</span><span class="n">chart_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">&#39; </span><span class="se">}}</span><span class="s2"> </span><span class="se">}}</span><span class="s2">);</span>
</span><span id="TE_Scraper-956"><a href="#TE_Scraper-956"><span class="linenos"> 956</span></a><span class="s2">        </span>
</span><span id="TE_Scraper-957"><a href="#TE_Scraper-957"><span class="linenos"> 957</span></a><span class="s2">        return true;</span>
</span><span id="TE_Scraper-958"><a href="#TE_Scraper-958"><span class="linenos"> 958</span></a><span class="s2">        </span><span class="se">}}</span><span class="s2">)();</span>
</span><span id="TE_Scraper-959"><a href="#TE_Scraper-959"><span class="linenos"> 959</span></a><span class="s2">        &quot;&quot;&quot;</span>
</span><span id="TE_Scraper-960"><a href="#TE_Scraper-960"><span class="linenos"> 960</span></a>        
</span><span id="TE_Scraper-961"><a href="#TE_Scraper-961"><span class="linenos"> 961</span></a>        <span class="n">success</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">execute_script</span><span class="p">(</span><span class="n">script</span><span class="p">)</span>
</span><span id="TE_Scraper-962"><a href="#TE_Scraper-962"><span class="linenos"> 962</span></a>        
</span><span id="TE_Scraper-963"><a href="#TE_Scraper-963"><span class="linenos"> 963</span></a>        <span class="k">if</span> <span class="n">success</span><span class="p">:</span>
</span><span id="TE_Scraper-964"><a href="#TE_Scraper-964"><span class="linenos"> 964</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span> <span class="o">=</span> <span class="n">chart_type</span>
</span><span id="TE_Scraper-965"><a href="#TE_Scraper-965"><span class="linenos"> 965</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Chart type set to: </span><span class="si">{</span><span class="n">chart_type</span><span class="si">}</span><span class="s2"> (using Highcharts API)&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-966"><a href="#TE_Scraper-966"><span class="linenos"> 966</span></a>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
</span><span id="TE_Scraper-967"><a href="#TE_Scraper-967"><span class="linenos"> 967</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">update_chart</span><span class="p">()</span>
</span><span id="TE_Scraper-968"><a href="#TE_Scraper-968"><span class="linenos"> 968</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="TE_Scraper-969"><a href="#TE_Scraper-969"><span class="linenos"> 969</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="TE_Scraper-970"><a href="#TE_Scraper-970"><span class="linenos"> 970</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error setting chart type: </span><span class="si">{</span><span class="n">chart_type</span><span class="si">}</span><span class="s2"> (using Highcharts API)&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-971"><a href="#TE_Scraper-971"><span class="linenos"> 971</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="TE_Scraper-972"><a href="#TE_Scraper-972"><span class="linenos"> 972</span></a>    
</span><span id="TE_Scraper-973"><a href="#TE_Scraper-973"><span class="linenos"> 973</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_y_axis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">update_chart</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">set_global_y_axis</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="TE_Scraper-974"><a href="#TE_Scraper-974"><span class="linenos"> 974</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get y-axis values from chart to make a y-axis series with tick labels and positions (pixel positions).</span>
</span><span id="TE_Scraper-975"><a href="#TE_Scraper-975"><span class="linenos"> 975</span></a><span class="sd">        Also gets the limits of both axis in pixel co-ordinates. A series containing the y-axis values and their pixel positions (as index) is assigned</span>
</span><span id="TE_Scraper-976"><a href="#TE_Scraper-976"><span class="linenos"> 976</span></a><span class="sd">        to the &quot;y_axis&quot; attribute. The &quot;axis_limits&quot; attribute is made too &amp; is  dictionary containing the pixel co-ordinates of the max and min for both x and y axis.</span>
</span><span id="TE_Scraper-977"><a href="#TE_Scraper-977"><span class="linenos"> 977</span></a>
</span><span id="TE_Scraper-978"><a href="#TE_Scraper-978"><span class="linenos"> 978</span></a><span class="sd">        **Parameters:**</span>
</span><span id="TE_Scraper-979"><a href="#TE_Scraper-979"><span class="linenos"> 979</span></a><span class="sd">        - update_chart (bool): Whether to update the chart before scraping the y-axis values. Default is False.</span>
</span><span id="TE_Scraper-980"><a href="#TE_Scraper-980"><span class="linenos"> 980</span></a><span class="sd">        - set_global_y_axis (bool): Whether to set the y-axis series as a global attribute of the class. Default is False.</span>
</span><span id="TE_Scraper-981"><a href="#TE_Scraper-981"><span class="linenos"> 981</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TE_Scraper-982"><a href="#TE_Scraper-982"><span class="linenos"> 982</span></a>
</span><span id="TE_Scraper-983"><a href="#TE_Scraper-983"><span class="linenos"> 983</span></a>        <span class="c1">##Get positions of y-axis gridlines</span>
</span><span id="TE_Scraper-984"><a href="#TE_Scraper-984"><span class="linenos"> 984</span></a>        <span class="n">y_heights</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="TE_Scraper-985"><a href="#TE_Scraper-985"><span class="linenos"> 985</span></a>        <span class="k">if</span> <span class="n">update_chart</span><span class="p">:</span>
</span><span id="TE_Scraper-986"><a href="#TE_Scraper-986"><span class="linenos"> 986</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">update_chart</span><span class="p">()</span>
</span><span id="TE_Scraper-987"><a href="#TE_Scraper-987"><span class="linenos"> 987</span></a>        <span class="k">if</span> <span class="n">set_global_y_axis</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">date_span</span> <span class="o">!=</span> <span class="s2">&quot;MAX&quot;</span><span class="p">:</span>
</span><span id="TE_Scraper-988"><a href="#TE_Scraper-988"><span class="linenos"> 988</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">set_date_span</span><span class="p">(</span><span class="s2">&quot;MAX&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-989"><a href="#TE_Scraper-989"><span class="linenos"> 989</span></a>
</span><span id="TE_Scraper-990"><a href="#TE_Scraper-990"><span class="linenos"> 990</span></a>        <span class="c1">## First get the pixel values of the max and min for both x and y axis.</span>
</span><span id="TE_Scraper-991"><a href="#TE_Scraper-991"><span class="linenos"> 991</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">axis_limits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_axis_limits</span><span class="p">()</span>
</span><span id="TE_Scraper-992"><a href="#TE_Scraper-992"><span class="linenos"> 992</span></a>
</span><span id="TE_Scraper-993"><a href="#TE_Scraper-993"><span class="linenos"> 993</span></a>        <span class="n">ygrid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_soup</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;g.highcharts-grid.highcharts-yaxis-grid&#39;</span><span class="p">)</span>
</span><span id="TE_Scraper-994"><a href="#TE_Scraper-994"><span class="linenos"> 994</span></a>        <span class="n">gridlines</span> <span class="o">=</span> <span class="n">ygrid</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">findAll</span><span class="p">(</span><span class="s1">&#39;path&#39;</span><span class="p">)</span>
</span><span id="TE_Scraper-995"><a href="#TE_Scraper-995"><span class="linenos"> 995</span></a>        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">gridlines</span><span class="p">:</span>
</span><span id="TE_Scraper-996"><a href="#TE_Scraper-996"><span class="linenos"> 996</span></a>            <span class="n">y_heights</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
</span><span id="TE_Scraper-997"><a href="#TE_Scraper-997"><span class="linenos"> 997</span></a>        <span class="n">y_heights</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">y_heights</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="TE_Scraper-998"><a href="#TE_Scraper-998"><span class="linenos"> 998</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;y_heights: &quot;</span><span class="p">,</span> <span class="n">y_heights</span><span class="p">)</span>
</span><span id="TE_Scraper-999"><a href="#TE_Scraper-999"><span class="linenos"> 999</span></a>
</span><span id="TE_Scraper-1000"><a href="#TE_Scraper-1000"><span class="linenos">1000</span></a>        <span class="c1">##Get y-axis labels</span>
</span><span id="TE_Scraper-1001"><a href="#TE_Scraper-1001"><span class="linenos">1001</span></a>        <span class="n">yax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_soup</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;g.highcharts-axis-labels.highcharts-yaxis-labels&#39;</span><span class="p">)</span>
</span><span id="TE_Scraper-1002"><a href="#TE_Scraper-1002"><span class="linenos">1002</span></a>        <span class="n">textels</span> <span class="o">=</span> <span class="n">yax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s1">&#39;text&#39;</span><span class="p">)</span>
</span><span id="TE_Scraper-1003"><a href="#TE_Scraper-1003"><span class="linenos">1003</span></a>
</span><span id="TE_Scraper-1004"><a href="#TE_Scraper-1004"><span class="linenos">1004</span></a>        <span class="c1"># Replace metrc prefixes:</span>
</span><span id="TE_Scraper-1005"><a href="#TE_Scraper-1005"><span class="linenos">1005</span></a>        <span class="n">yaxlabs</span> <span class="o">=</span> <span class="p">[</span><span class="n">utils</span><span class="o">.</span><span class="n">extract_and_convert_value</span><span class="p">(</span><span class="n">text</span><span class="o">.</span><span class="n">get_text</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">text</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">isalnum</span><span class="p">()</span> <span class="k">else</span> <span class="n">text</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span> <span class="k">for</span> <span class="n">text</span> <span class="ow">in</span> <span class="n">textels</span><span class="p">]</span>
</span><span id="TE_Scraper-1006"><a href="#TE_Scraper-1006"><span class="linenos">1006</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;y-axis labels: </span><span class="si">{</span><span class="n">yaxlabs</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-1007"><a href="#TE_Scraper-1007"><span class="linenos">1007</span></a>
</span><span id="TE_Scraper-1008"><a href="#TE_Scraper-1008"><span class="linenos">1008</span></a>        <span class="c1"># convert to float...</span>
</span><span id="TE_Scraper-1009"><a href="#TE_Scraper-1009"><span class="linenos">1009</span></a>        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">yaxlabs</span><span class="p">):</span>
</span><span id="TE_Scraper-1010"><a href="#TE_Scraper-1010"><span class="linenos">1010</span></a>            <span class="n">yaxlabs</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="nb">str</span><span class="o">.</span><span class="n">isdigit</span><span class="p">,</span> <span class="n">i</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))))</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">yaxlabs</span><span class="p">]</span>
</span><span id="TE_Scraper-1011"><a href="#TE_Scraper-1011"><span class="linenos">1011</span></a>        <span class="n">pixheights</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">height</span><span class="p">)</span> <span class="k">for</span> <span class="n">height</span> <span class="ow">in</span> <span class="n">y_heights</span><span class="p">]</span>
</span><span id="TE_Scraper-1012"><a href="#TE_Scraper-1012"><span class="linenos">1012</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;pixheights: &quot;</span><span class="p">,</span> <span class="n">pixheights</span><span class="p">)</span>
</span><span id="TE_Scraper-1013"><a href="#TE_Scraper-1013"><span class="linenos">1013</span></a>
</span><span id="TE_Scraper-1014"><a href="#TE_Scraper-1014"><span class="linenos">1014</span></a>        <span class="c1">##Get px per unit for y-axis</span>
</span><span id="TE_Scraper-1015"><a href="#TE_Scraper-1015"><span class="linenos">1015</span></a>        <span class="n">pxPerUnit</span> <span class="o">=</span> <span class="p">[</span><span class="nb">abs</span><span class="p">((</span><span class="n">yaxlabs</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span> <span class="n">yaxlabs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="n">pixheights</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span> <span class="n">pixheights</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pixheights</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)]</span>
</span><span id="TE_Scraper-1016"><a href="#TE_Scraper-1016"><span class="linenos">1016</span></a>        <span class="n">average</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">pxPerUnit</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">pxPerUnit</span><span class="p">)</span>
</span><span id="TE_Scraper-1017"><a href="#TE_Scraper-1017"><span class="linenos">1017</span></a>        <span class="k">if</span> <span class="n">set_global_y_axis</span><span class="p">:</span>
</span><span id="TE_Scraper-1018"><a href="#TE_Scraper-1018"><span class="linenos">1018</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">unit_per_pix</span> <span class="o">=</span> <span class="n">average</span>
</span><span id="TE_Scraper-1019"><a href="#TE_Scraper-1019"><span class="linenos">1019</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Average px per unit for y-axis: </span><span class="si">{</span><span class="n">average</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>  <span class="c1">#Calculate the scaling for the chart so we can convert pixel co-ordinates to data values.</span>
</span><span id="TE_Scraper-1020"><a href="#TE_Scraper-1020"><span class="linenos">1020</span></a>
</span><span id="TE_Scraper-1021"><a href="#TE_Scraper-1021"><span class="linenos">1021</span></a>        <span class="n">yaxis</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">yaxlabs</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="n">pixheights</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;ytick_label&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-1022"><a href="#TE_Scraper-1022"><span class="linenos">1022</span></a>        <span class="n">yaxis</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s2">&quot;pixheight&quot;</span><span class="p">,</span> <span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</span><span id="TE_Scraper-1023"><a href="#TE_Scraper-1023"><span class="linenos">1023</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="TE_Scraper-1024"><a href="#TE_Scraper-1024"><span class="linenos">1024</span></a>            <span class="n">yaxis</span> <span class="o">=</span> <span class="n">yaxis</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
</span><span id="TE_Scraper-1025"><a href="#TE_Scraper-1025"><span class="linenos">1025</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="TE_Scraper-1026"><a href="#TE_Scraper-1026"><span class="linenos">1026</span></a>            <span class="k">pass</span>
</span><span id="TE_Scraper-1027"><a href="#TE_Scraper-1027"><span class="linenos">1027</span></a>
</span><span id="TE_Scraper-1028"><a href="#TE_Scraper-1028"><span class="linenos">1028</span></a>        <span class="k">if</span> <span class="n">yaxis</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TE_Scraper-1029"><a href="#TE_Scraper-1029"><span class="linenos">1029</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Y-axis values scraped successfully.&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-1030"><a href="#TE_Scraper-1030"><span class="linenos">1030</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="TE_Scraper-1031"><a href="#TE_Scraper-1031"><span class="linenos">1031</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Y-axis values not scraped successfully, yaxis is None.&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-1032"><a href="#TE_Scraper-1032"><span class="linenos">1032</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="TE_Scraper-1033"><a href="#TE_Scraper-1033"><span class="linenos">1033</span></a>        
</span><span id="TE_Scraper-1034"><a href="#TE_Scraper-1034"><span class="linenos">1034</span></a>        <span class="k">if</span> <span class="n">set_global_y_axis</span><span class="p">:</span>
</span><span id="TE_Scraper-1035"><a href="#TE_Scraper-1035"><span class="linenos">1035</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">y_axis</span> <span class="o">=</span> <span class="n">yaxis</span>
</span><span id="TE_Scraper-1036"><a href="#TE_Scraper-1036"><span class="linenos">1036</span></a>
</span><span id="TE_Scraper-1037"><a href="#TE_Scraper-1037"><span class="linenos">1037</span></a>        <span class="k">return</span> <span class="n">yaxis</span>
</span><span id="TE_Scraper-1038"><a href="#TE_Scraper-1038"><span class="linenos">1038</span></a>     
</span><span id="TE_Scraper-1039"><a href="#TE_Scraper-1039"><span class="linenos">1039</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">init_tooltipScraper</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="TE_Scraper-1040"><a href="#TE_Scraper-1040"><span class="linenos">1040</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialise the TooltipScraper object for the class. This is used to scrape the tooltip box on the chart to get the start and end dates of the time series.</span>
</span><span id="TE_Scraper-1041"><a href="#TE_Scraper-1041"><span class="linenos">1041</span></a><span class="sd">        The tooltip scraper is a child object of the class and is used</span>
</span><span id="TE_Scraper-1042"><a href="#TE_Scraper-1042"><span class="linenos">1042</span></a><span class="sd">        to scrape the tooltip box on the chart to get the start and end dates of the time series. The tooltip scraper is a child object of the class an shares some synced </span>
</span><span id="TE_Scraper-1043"><a href="#TE_Scraper-1043"><span class="linenos">1043</span></a><span class="sd">        attributes with the parent class. &quot;&quot;&quot;</span>
</span><span id="TE_Scraper-1044"><a href="#TE_Scraper-1044"><span class="linenos">1044</span></a>
</span><span id="TE_Scraper-1045"><a href="#TE_Scraper-1045"><span class="linenos">1045</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;tooltip_scraper&quot;</span><span class="p">):</span>
</span><span id="TE_Scraper-1046"><a href="#TE_Scraper-1046"><span class="linenos">1046</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">tooltip_scraper</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">TooltipScraper</span><span class="p">(</span><span class="n">parent_instance</span> <span class="o">=</span> <span class="bp">self</span><span class="p">)</span>
</span><span id="TE_Scraper-1047"><a href="#TE_Scraper-1047"><span class="linenos">1047</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;TooltipScraper object initialised successfully.&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-1048"><a href="#TE_Scraper-1048"><span class="linenos">1048</span></a>        <span class="k">else</span><span class="p">:</span>    
</span><span id="TE_Scraper-1049"><a href="#TE_Scraper-1049"><span class="linenos">1049</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;TooltipScraper object already initialised.&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-1050"><a href="#TE_Scraper-1050"><span class="linenos">1050</span></a>
</span><span id="TE_Scraper-1051"><a href="#TE_Scraper-1051"><span class="linenos">1051</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">dtIndex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_date</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">end_date</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">ser_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Time-series&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">:</span>
</span><span id="TE_Scraper-1052"><a href="#TE_Scraper-1052"><span class="linenos">1052</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TE_Scraper-1053"><a href="#TE_Scraper-1053"><span class="linenos">1053</span></a>
</span><span id="TE_Scraper-1054"><a href="#TE_Scraper-1054"><span class="linenos">1054</span></a><span class="sd">        Create a date index for your series in self.series. Will first make an index to cover the full length of your series </span>
</span><span id="TE_Scraper-1055"><a href="#TE_Scraper-1055"><span class="linenos">1055</span></a><span class="sd">        and then resample to month start freq to match the format on Trading Economics.</span>
</span><span id="TE_Scraper-1056"><a href="#TE_Scraper-1056"><span class="linenos">1056</span></a><span class="sd">        </span>
</span><span id="TE_Scraper-1057"><a href="#TE_Scraper-1057"><span class="linenos">1057</span></a><span class="sd">        **Parameters:**</span>
</span><span id="TE_Scraper-1058"><a href="#TE_Scraper-1058"><span class="linenos">1058</span></a><span class="sd">        - start_date (str) YYYY-MM-DD: The start date of your series</span>
</span><span id="TE_Scraper-1059"><a href="#TE_Scraper-1059"><span class="linenos">1059</span></a><span class="sd">        - end_date (str) YYYY-MM-DD: The end date of your series</span>
</span><span id="TE_Scraper-1060"><a href="#TE_Scraper-1060"><span class="linenos">1060</span></a><span class="sd">        - ser_name (str): The name TO GIVE the series</span>
</span><span id="TE_Scraper-1061"><a href="#TE_Scraper-1061"><span class="linenos">1061</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TE_Scraper-1062"><a href="#TE_Scraper-1062"><span class="linenos">1062</span></a>        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;x_index&quot;</span><span class="p">):</span>
</span><span id="TE_Scraper-1063"><a href="#TE_Scraper-1063"><span class="linenos">1063</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Overwriting existing x_index attribute.&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-1064"><a href="#TE_Scraper-1064"><span class="linenos">1064</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">x_index</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="TE_Scraper-1065"><a href="#TE_Scraper-1065"><span class="linenos">1065</span></a>        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;series&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;frequency&quot;</span><span class="p">):</span>
</span><span id="TE_Scraper-1066"><a href="#TE_Scraper-1066"><span class="linenos">1066</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Series found but frequency not known. Creating a datetime x-index for series with frequency determined by length of series.</span><span class="se">\</span>
</span><span id="TE_Scraper-1067"><a href="#TE_Scraper-1067"><span class="linenos">1067</span></a><span class="s2">                        Returning dtIndex only.&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-1068"><a href="#TE_Scraper-1068"><span class="linenos">1068</span></a>            <span class="n">dtIndex</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span> <span class="o">=</span> <span class="n">start_date</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">end_date</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="p">),</span> <span class="n">inclusive</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-1069"><a href="#TE_Scraper-1069"><span class="linenos">1069</span></a>            <span class="k">return</span> <span class="n">dtIndex</span>
</span><span id="TE_Scraper-1070"><a href="#TE_Scraper-1070"><span class="linenos">1070</span></a>        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;series&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;frequency&quot;</span><span class="p">):</span>
</span><span id="TE_Scraper-1071"><a href="#TE_Scraper-1071"><span class="linenos">1071</span></a>            <span class="n">dtIndex</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span> <span class="o">=</span> <span class="n">start_date</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">end_date</span><span class="p">,</span> <span class="n">freq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="p">)</span>
</span><span id="TE_Scraper-1072"><a href="#TE_Scraper-1072"><span class="linenos">1072</span></a>            <span class="n">new_ser</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">to_list</span><span class="p">(),</span> <span class="n">index</span> <span class="o">=</span> <span class="n">dtIndex</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">ser_name</span><span class="p">)</span>
</span><span id="TE_Scraper-1073"><a href="#TE_Scraper-1073"><span class="linenos">1073</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">trace_path_series</span> <span class="o">=</span> <span class="n">new_ser</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="TE_Scraper-1074"><a href="#TE_Scraper-1074"><span class="linenos">1074</span></a>            <span class="n">new_ser</span> <span class="o">=</span> <span class="n">new_ser</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
</span><span id="TE_Scraper-1075"><a href="#TE_Scraper-1075"><span class="linenos">1075</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">series</span> <span class="o">=</span> <span class="n">new_ser</span>
</span><span id="TE_Scraper-1076"><a href="#TE_Scraper-1076"><span class="linenos">1076</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Series is already scraped, frequency and start, end dates are known. DatetimeIndex created</span><span class="se">\</span>
</span><span id="TE_Scraper-1077"><a href="#TE_Scraper-1077"><span class="linenos">1077</span></a><span class="s2">                        for series, set as index and series resampled at the frequency: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="si">}</span><span class="s2">. series attribute updated.&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-1078"><a href="#TE_Scraper-1078"><span class="linenos">1078</span></a>            <span class="k">return</span> <span class="n">dtIndex</span>
</span><span id="TE_Scraper-1079"><a href="#TE_Scraper-1079"><span class="linenos">1079</span></a>        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;series&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;frequency&quot;</span><span class="p">):</span>
</span><span id="TE_Scraper-1080"><a href="#TE_Scraper-1080"><span class="linenos">1080</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;No series found, using frequency and start and end dates to create a datetime x-index.&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-1081"><a href="#TE_Scraper-1081"><span class="linenos">1081</span></a>            <span class="n">dtIndex</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span> <span class="o">=</span> <span class="n">start_date</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">end_date</span><span class="p">,</span> <span class="n">freq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="p">)</span>
</span><span id="TE_Scraper-1082"><a href="#TE_Scraper-1082"><span class="linenos">1082</span></a>            <span class="k">return</span> <span class="n">dtIndex</span>
</span><span id="TE_Scraper-1083"><a href="#TE_Scraper-1083"><span class="linenos">1083</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="TE_Scraper-1084"><a href="#TE_Scraper-1084"><span class="linenos">1084</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;No series found, frequenc unknown get the series or frequency first. Returning None&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-1085"><a href="#TE_Scraper-1085"><span class="linenos">1085</span></a>            <span class="k">return</span> <span class="kc">None</span> 
</span><span id="TE_Scraper-1086"><a href="#TE_Scraper-1086"><span class="linenos">1086</span></a>        
</span><span id="TE_Scraper-1087"><a href="#TE_Scraper-1087"><span class="linenos">1087</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">apply_x_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x_index</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">use_rounded_tempIndex</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">redo_series</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="TE_Scraper-1088"><a href="#TE_Scraper-1088"><span class="linenos">1088</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Apply a datetime index to the series. This will set the datetime index as the index of the series and resample the series to the frequency</span>
</span><span id="TE_Scraper-1089"><a href="#TE_Scraper-1089"><span class="linenos">1089</span></a><span class="sd">        of the datetime index. The series attribute of the class will be updated with the new series.</span>
</span><span id="TE_Scraper-1090"><a href="#TE_Scraper-1090"><span class="linenos">1090</span></a>
</span><span id="TE_Scraper-1091"><a href="#TE_Scraper-1091"><span class="linenos">1091</span></a><span class="sd">        **Parameters:**</span>
</span><span id="TE_Scraper-1092"><a href="#TE_Scraper-1092"><span class="linenos">1092</span></a><span class="sd">        - x_index (pd.DatetimeIndex): The datetime index to apply to the series. If None, the x_index attribute of the class will be used.</span>
</span><span id="TE_Scraper-1093"><a href="#TE_Scraper-1093"><span class="linenos">1093</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TE_Scraper-1094"><a href="#TE_Scraper-1094"><span class="linenos">1094</span></a>        <span class="k">if</span> <span class="n">x_index</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;x_index&quot;</span><span class="p">):</span>
</span><span id="TE_Scraper-1095"><a href="#TE_Scraper-1095"><span class="linenos">1095</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No datetime x-index found. Run make_x_index() first.&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-1096"><a href="#TE_Scraper-1096"><span class="linenos">1096</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="TE_Scraper-1097"><a href="#TE_Scraper-1097"><span class="linenos">1097</span></a>        <span class="k">elif</span> <span class="n">x_index</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TE_Scraper-1098"><a href="#TE_Scraper-1098"><span class="linenos">1098</span></a>            <span class="n">x_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_index</span>
</span><span id="TE_Scraper-1099"><a href="#TE_Scraper-1099"><span class="linenos">1099</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="TE_Scraper-1100"><a href="#TE_Scraper-1100"><span class="linenos">1100</span></a>            <span class="k">pass</span>
</span><span id="TE_Scraper-1101"><a href="#TE_Scraper-1101"><span class="linenos">1101</span></a>
</span><span id="TE_Scraper-1102"><a href="#TE_Scraper-1102"><span class="linenos">1102</span></a>        <span class="k">if</span> <span class="n">redo_series</span><span class="p">:</span>
</span><span id="TE_Scraper-1103"><a href="#TE_Scraper-1103"><span class="linenos">1103</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">series</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trace_path_series_raw</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="TE_Scraper-1104"><a href="#TE_Scraper-1104"><span class="linenos">1104</span></a>
</span><span id="TE_Scraper-1105"><a href="#TE_Scraper-1105"><span class="linenos">1105</span></a>        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;series&quot;</span><span class="p">):</span>
</span><span id="TE_Scraper-1106"><a href="#TE_Scraper-1106"><span class="linenos">1106</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">series_extracted_from</span> <span class="o">==</span> <span class="s2">&quot;Line&quot;</span><span class="p">:</span>
</span><span id="TE_Scraper-1107"><a href="#TE_Scraper-1107"><span class="linenos">1107</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x_index</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="p">):</span>
</span><span id="TE_Scraper-1108"><a href="#TE_Scraper-1108"><span class="linenos">1108</span></a>                    <span class="n">new_ser</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">to_list</span><span class="p">(),</span> <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_index</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">series_name</span><span class="p">)</span>
</span><span id="TE_Scraper-1109"><a href="#TE_Scraper-1109"><span class="linenos">1109</span></a>                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">x_index</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="p">):</span>
</span><span id="TE_Scraper-1110"><a href="#TE_Scraper-1110"><span class="linenos">1110</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Length of x_index is greater than length of series. This is unfortunate, dunno what to do here...&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-1111"><a href="#TE_Scraper-1111"><span class="linenos">1111</span></a>                    <span class="k">return</span> <span class="kc">None</span>
</span><span id="TE_Scraper-1112"><a href="#TE_Scraper-1112"><span class="linenos">1112</span></a>                <span class="k">else</span><span class="p">:</span> <span class="c1"># use_rounded_tempIndex:</span>
</span><span id="TE_Scraper-1113"><a href="#TE_Scraper-1113"><span class="linenos">1113</span></a>                    <span class="n">temp_index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span> <span class="o">=</span> <span class="n">x_index</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">end</span> <span class="o">=</span> <span class="n">x_index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">periods</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="p">))</span>
</span><span id="TE_Scraper-1114"><a href="#TE_Scraper-1114"><span class="linenos">1114</span></a>                    <span class="n">temp_index</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">round_to_freq</span><span class="p">(</span><span class="n">temp_index</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="p">)</span>
</span><span id="TE_Scraper-1115"><a href="#TE_Scraper-1115"><span class="linenos">1115</span></a>                    <span class="n">new_ser</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">to_list</span><span class="p">(),</span> <span class="n">index</span> <span class="o">=</span> <span class="n">temp_index</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">series_name</span><span class="p">)</span>
</span><span id="TE_Scraper-1116"><a href="#TE_Scraper-1116"><span class="linenos">1116</span></a>                    <span class="n">new_ser</span> <span class="o">=</span> <span class="n">new_ser</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
</span><span id="TE_Scraper-1117"><a href="#TE_Scraper-1117"><span class="linenos">1117</span></a>            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">series_extracted_from</span> <span class="o">==</span> <span class="s2">&quot;Spline&quot;</span><span class="p">:</span>
</span><span id="TE_Scraper-1118"><a href="#TE_Scraper-1118"><span class="linenos">1118</span></a>                <span class="n">temp_index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span> <span class="o">=</span> <span class="n">x_index</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">end</span> <span class="o">=</span> <span class="n">x_index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">periods</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="p">))</span>
</span><span id="TE_Scraper-1119"><a href="#TE_Scraper-1119"><span class="linenos">1119</span></a>                <span class="c1">#print(&quot;temp_index: &quot;, temp_index, &quot;len series: &quot;, len(self.series), &quot;len x_index: &quot;, len(x_index))</span>
</span><span id="TE_Scraper-1120"><a href="#TE_Scraper-1120"><span class="linenos">1120</span></a>                <span class="n">new_ser</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">to_list</span><span class="p">(),</span> <span class="n">index</span> <span class="o">=</span> <span class="n">temp_index</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">series_name</span><span class="p">)</span>
</span><span id="TE_Scraper-1121"><a href="#TE_Scraper-1121"><span class="linenos">1121</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">trace_path_series</span> <span class="o">=</span> <span class="n">new_ser</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="TE_Scraper-1122"><a href="#TE_Scraper-1122"><span class="linenos">1122</span></a>                <span class="n">new_ser</span> <span class="o">=</span> <span class="n">new_ser</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
</span><span id="TE_Scraper-1123"><a href="#TE_Scraper-1123"><span class="linenos">1123</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="TE_Scraper-1124"><a href="#TE_Scraper-1124"><span class="linenos">1124</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Series not extracted from Line or Spline chart. Cannot apply datetime index, go back and run the series_from_chart_soup method.&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-1125"><a href="#TE_Scraper-1125"><span class="linenos">1125</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="TE_Scraper-1126"><a href="#TE_Scraper-1126"><span class="linenos">1126</span></a>            
</span><span id="TE_Scraper-1127"><a href="#TE_Scraper-1127"><span class="linenos">1127</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">series</span> <span class="o">=</span> <span class="n">new_ser</span>  <span class="c1"># Update the series attribute with the new series.</span>
</span><span id="TE_Scraper-1128"><a href="#TE_Scraper-1128"><span class="linenos">1128</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">unscaled_series</span> <span class="o">=</span> <span class="n">new_ser</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="TE_Scraper-1129"><a href="#TE_Scraper-1129"><span class="linenos">1129</span></a>            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;metadata&quot;</span><span class="p">):</span>
</span><span id="TE_Scraper-1130"><a href="#TE_Scraper-1130"><span class="linenos">1130</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;frequency&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span>  <span class="c1"># Update the frequency in the metadata.</span>
</span><span id="TE_Scraper-1131"><a href="#TE_Scraper-1131"><span class="linenos">1131</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DateTimeIndex applied to series, series attribute updated.&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-1132"><a href="#TE_Scraper-1132"><span class="linenos">1132</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="TE_Scraper-1133"><a href="#TE_Scraper-1133"><span class="linenos">1133</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;No series found, get the series first.&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-1134"><a href="#TE_Scraper-1134"><span class="linenos">1134</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="TE_Scraper-1135"><a href="#TE_Scraper-1135"><span class="linenos">1135</span></a>
</span><span id="TE_Scraper-1136"><a href="#TE_Scraper-1136"><span class="linenos">1136</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">extract_axis_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="TE_Scraper-1137"><a href="#TE_Scraper-1137"><span class="linenos">1137</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract axis limits from the chart in terms of pixel co-ordinates.&quot;&quot;&quot;</span>
</span><span id="TE_Scraper-1138"><a href="#TE_Scraper-1138"><span class="linenos">1138</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Extracting axis limits from the chart...&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-1139"><a href="#TE_Scraper-1139"><span class="linenos">1139</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="TE_Scraper-1140"><a href="#TE_Scraper-1140"><span class="linenos">1140</span></a>            <span class="c1"># Extract axis elements</span>
</span><span id="TE_Scraper-1141"><a href="#TE_Scraper-1141"><span class="linenos">1141</span></a>            <span class="n">yax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_soup</span><span class="o">.</span><span class="n">select_one</span><span class="p">(</span><span class="s2">&quot;g.highcharts-axis.highcharts-yaxis path.highcharts-axis-line&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-1142"><a href="#TE_Scraper-1142"><span class="linenos">1142</span></a>            <span class="n">xax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_soup</span><span class="o">.</span><span class="n">select_one</span><span class="p">(</span><span class="s2">&quot;g.highcharts-axis.highcharts-xaxis path.highcharts-axis-line&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-1143"><a href="#TE_Scraper-1143"><span class="linenos">1143</span></a>            
</span><span id="TE_Scraper-1144"><a href="#TE_Scraper-1144"><span class="linenos">1144</span></a>            <span class="n">ylims</span> <span class="o">=</span> <span class="n">yax</span><span class="p">[</span><span class="s2">&quot;d&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;M&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;L&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-1145"><a href="#TE_Scraper-1145"><span class="linenos">1145</span></a>            <span class="n">ylims</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">num</span><span class="p">)</span> <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="n">ylims</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">num</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
</span><span id="TE_Scraper-1146"><a href="#TE_Scraper-1146"><span class="linenos">1146</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;yax: </span><span class="si">{</span><span class="n">ylims</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-1147"><a href="#TE_Scraper-1147"><span class="linenos">1147</span></a>
</span><span id="TE_Scraper-1148"><a href="#TE_Scraper-1148"><span class="linenos">1148</span></a>            <span class="n">xlims</span> <span class="o">=</span> <span class="n">xax</span><span class="p">[</span><span class="s2">&quot;d&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;M&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;L&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-1149"><a href="#TE_Scraper-1149"><span class="linenos">1149</span></a>            <span class="n">xlims</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">num</span><span class="p">)</span> <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="n">xlims</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">num</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
</span><span id="TE_Scraper-1150"><a href="#TE_Scraper-1150"><span class="linenos">1150</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;xax: </span><span class="si">{</span><span class="n">xlims</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-1151"><a href="#TE_Scraper-1151"><span class="linenos">1151</span></a>            
</span><span id="TE_Scraper-1152"><a href="#TE_Scraper-1152"><span class="linenos">1152</span></a>            <span class="n">axis_limits</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="TE_Scraper-1153"><a href="#TE_Scraper-1153"><span class="linenos">1153</span></a>                <span class="s1">&#39;x_min&#39;</span><span class="p">:</span> <span class="n">xlims</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span><span id="TE_Scraper-1154"><a href="#TE_Scraper-1154"><span class="linenos">1154</span></a>                <span class="s1">&#39;x_max&#39;</span><span class="p">:</span> <span class="n">xlims</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
</span><span id="TE_Scraper-1155"><a href="#TE_Scraper-1155"><span class="linenos">1155</span></a>                <span class="s1">&#39;y_min&#39;</span><span class="p">:</span> <span class="n">ylims</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
</span><span id="TE_Scraper-1156"><a href="#TE_Scraper-1156"><span class="linenos">1156</span></a>                <span class="s1">&#39;y_max&#39;</span><span class="p">:</span> <span class="n">ylims</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="TE_Scraper-1157"><a href="#TE_Scraper-1157"><span class="linenos">1157</span></a>            <span class="p">}</span>
</span><span id="TE_Scraper-1158"><a href="#TE_Scraper-1158"><span class="linenos">1158</span></a>            
</span><span id="TE_Scraper-1159"><a href="#TE_Scraper-1159"><span class="linenos">1159</span></a>            <span class="k">return</span> <span class="n">axis_limits</span>
</span><span id="TE_Scraper-1160"><a href="#TE_Scraper-1160"><span class="linenos">1160</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="TE_Scraper-1161"><a href="#TE_Scraper-1161"><span class="linenos">1161</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error extracting axis limits: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-1162"><a href="#TE_Scraper-1162"><span class="linenos">1162</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error extracting axis limits: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-1163"><a href="#TE_Scraper-1163"><span class="linenos">1163</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="TE_Scraper-1164"><a href="#TE_Scraper-1164"><span class="linenos">1164</span></a>    
</span><span id="TE_Scraper-1165"><a href="#TE_Scraper-1165"><span class="linenos">1165</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">plot_series</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">series</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
</span><span id="TE_Scraper-1166"><a href="#TE_Scraper-1166"><span class="linenos">1166</span></a>                    <span class="n">annotation_text</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
</span><span id="TE_Scraper-1167"><a href="#TE_Scraper-1167"><span class="linenos">1167</span></a>                    <span class="n">dpi</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">300</span><span class="p">,</span> 
</span><span id="TE_Scraper-1168"><a href="#TE_Scraper-1168"><span class="linenos">1168</span></a>                    <span class="n">ann_box_pos</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span> <span class="mf">0.2</span><span class="p">),</span>
</span><span id="TE_Scraper-1169"><a href="#TE_Scraper-1169"><span class="linenos">1169</span></a>                    <span class="n">show_fig</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="TE_Scraper-1170"><a href="#TE_Scraper-1170"><span class="linenos">1170</span></a>                    <span class="n">return_fig</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="TE_Scraper-1171"><a href="#TE_Scraper-1171"><span class="linenos">1171</span></a>                    <span class="n">invert_yaxis</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">layout_updates</span><span class="p">):</span>
</span><span id="TE_Scraper-1172"><a href="#TE_Scraper-1172"><span class="linenos">1172</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TE_Scraper-1173"><a href="#TE_Scraper-1173"><span class="linenos">1173</span></a><span class="sd">        Plots the time series data using pandas with plotly as the backend. Plotly is set as the pandas backend in __init__.py for tedata.</span>
</span><span id="TE_Scraper-1174"><a href="#TE_Scraper-1174"><span class="linenos">1174</span></a><span class="sd">        If you want to use matplotlib or other plotting library don&#39;t use this method, plot the series attribute data directly. If using jupyter</span>
</span><span id="TE_Scraper-1175"><a href="#TE_Scraper-1175"><span class="linenos">1175</span></a><span class="sd">        you can set </span>
</span><span id="TE_Scraper-1176"><a href="#TE_Scraper-1176"><span class="linenos">1176</span></a>
</span><span id="TE_Scraper-1177"><a href="#TE_Scraper-1177"><span class="linenos">1177</span></a><span class="sd">        **Parameters**</span>
</span><span id="TE_Scraper-1178"><a href="#TE_Scraper-1178"><span class="linenos">1178</span></a><span class="sd">        - series (pd.Series): The series to plot. Default is None. If None, the series attribute of the class will be plotted.</span>
</span><span id="TE_Scraper-1179"><a href="#TE_Scraper-1179"><span class="linenos">1179</span></a><span class="sd">        - annotation_text (str): Text to display in the annotation box at the bottom of the chart. Default is None. If None, the default annotation text</span>
</span><span id="TE_Scraper-1180"><a href="#TE_Scraper-1180"><span class="linenos">1180</span></a><span class="sd">        will be created from the metadata.</span>
</span><span id="TE_Scraper-1181"><a href="#TE_Scraper-1181"><span class="linenos">1181</span></a><span class="sd">        - dpi (int): The resolution of the plot in dots per inch. Default is 300.</span>
</span><span id="TE_Scraper-1182"><a href="#TE_Scraper-1182"><span class="linenos">1182</span></a><span class="sd">        - ann_box_pos (tuple): The position of the annotation box on the chart. Default is (0, -0.23) which is bottom left.</span>
</span><span id="TE_Scraper-1183"><a href="#TE_Scraper-1183"><span class="linenos">1183</span></a>
</span><span id="TE_Scraper-1184"><a href="#TE_Scraper-1184"><span class="linenos">1184</span></a><span class="sd">        **Returns** None</span>
</span><span id="TE_Scraper-1185"><a href="#TE_Scraper-1185"><span class="linenos">1185</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TE_Scraper-1186"><a href="#TE_Scraper-1186"><span class="linenos">1186</span></a>        
</span><span id="TE_Scraper-1187"><a href="#TE_Scraper-1187"><span class="linenos">1187</span></a>        <span class="k">if</span> <span class="n">series</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TE_Scraper-1188"><a href="#TE_Scraper-1188"><span class="linenos">1188</span></a>            <span class="n">series</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">series</span>
</span><span id="TE_Scraper-1189"><a href="#TE_Scraper-1189"><span class="linenos">1189</span></a>
</span><span id="TE_Scraper-1190"><a href="#TE_Scraper-1190"><span class="linenos">1190</span></a>        <span class="n">fig</span> <span class="o">=</span> <span class="n">series</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>  <span class="c1"># Plot the series using pandas, plotly needs to be set as the pandas plotting backend.</span>
</span><span id="TE_Scraper-1191"><a href="#TE_Scraper-1191"><span class="linenos">1191</span></a>
</span><span id="TE_Scraper-1192"><a href="#TE_Scraper-1192"><span class="linenos">1192</span></a>         <span class="c1"># Existing title and label logic</span>
</span><span id="TE_Scraper-1193"><a href="#TE_Scraper-1193"><span class="linenos">1193</span></a>        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;series_metadata&quot;</span><span class="p">):</span>
</span><span id="TE_Scraper-1194"><a href="#TE_Scraper-1194"><span class="linenos">1194</span></a>            <span class="n">title</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series_metadata</span><span class="p">[</span><span class="s2">&quot;country&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series_metadata</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span>
</span><span id="TE_Scraper-1195"><a href="#TE_Scraper-1195"><span class="linenos">1195</span></a>            <span class="n">ylabel</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series_metadata</span><span class="p">[</span><span class="s2">&quot;units&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span>
</span><span id="TE_Scraper-1196"><a href="#TE_Scraper-1196"><span class="linenos">1196</span></a>            
</span><span id="TE_Scraper-1197"><a href="#TE_Scraper-1197"><span class="linenos">1197</span></a>            <span class="c1"># Create default annotation text from metadata</span>
</span><span id="TE_Scraper-1198"><a href="#TE_Scraper-1198"><span class="linenos">1198</span></a>            <span class="n">frequency</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;frequency&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;frequency&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">else</span> <span class="s2">&quot;Unknown&quot;</span>
</span><span id="TE_Scraper-1199"><a href="#TE_Scraper-1199"><span class="linenos">1199</span></a>            <span class="k">if</span> <span class="n">annotation_text</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TE_Scraper-1200"><a href="#TE_Scraper-1200"><span class="linenos">1200</span></a>                <span class="n">annotation_text</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="TE_Scraper-1201"><a href="#TE_Scraper-1201"><span class="linenos">1201</span></a>                    <span class="sa">f</span><span class="s2">&quot;Source: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;source&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&lt;br&gt;&quot;</span>
</span><span id="TE_Scraper-1202"><a href="#TE_Scraper-1202"><span class="linenos">1202</span></a>                    <span class="sa">f</span><span class="s2">&quot;Original Source: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;original_source&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&lt;br&gt;&quot;</span>
</span><span id="TE_Scraper-1203"><a href="#TE_Scraper-1203"><span class="linenos">1203</span></a>                    <span class="sa">f</span><span class="s2">&quot;Frequency: </span><span class="si">{</span><span class="n">frequency</span><span class="si">}</span><span class="s2">&lt;br&gt;&quot;</span>
</span><span id="TE_Scraper-1204"><a href="#TE_Scraper-1204"><span class="linenos">1204</span></a>                <span class="p">)</span>
</span><span id="TE_Scraper-1205"><a href="#TE_Scraper-1205"><span class="linenos">1205</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="TE_Scraper-1206"><a href="#TE_Scraper-1206"><span class="linenos">1206</span></a>            <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Time Series Plot&quot;</span>
</span><span id="TE_Scraper-1207"><a href="#TE_Scraper-1207"><span class="linenos">1207</span></a>            <span class="n">ylabel</span> <span class="o">=</span> <span class="s2">&quot;Value&quot;</span>
</span><span id="TE_Scraper-1208"><a href="#TE_Scraper-1208"><span class="linenos">1208</span></a>            <span class="n">annotation_text</span> <span class="o">=</span> <span class="n">annotation_text</span> <span class="ow">or</span> <span class="s2">&quot;Source: Trading Economics&quot;</span>
</span><span id="TE_Scraper-1209"><a href="#TE_Scraper-1209"><span class="linenos">1209</span></a>
</span><span id="TE_Scraper-1210"><a href="#TE_Scraper-1210"><span class="linenos">1210</span></a>        <span class="c1"># Add text annotation to bottom left</span>
</span><span id="TE_Scraper-1211"><a href="#TE_Scraper-1211"><span class="linenos">1211</span></a>        <span class="n">fig</span><span class="o">.</span><span class="n">add_annotation</span><span class="p">(</span>
</span><span id="TE_Scraper-1212"><a href="#TE_Scraper-1212"><span class="linenos">1212</span></a>            <span class="n">text</span><span class="o">=</span><span class="n">annotation_text</span><span class="p">,</span>
</span><span id="TE_Scraper-1213"><a href="#TE_Scraper-1213"><span class="linenos">1213</span></a>            <span class="n">xref</span><span class="o">=</span><span class="s2">&quot;paper&quot;</span><span class="p">,</span> <span class="n">yref</span><span class="o">=</span><span class="s2">&quot;paper&quot;</span><span class="p">,</span>
</span><span id="TE_Scraper-1214"><a href="#TE_Scraper-1214"><span class="linenos">1214</span></a>            <span class="n">x</span><span class="o">=</span><span class="n">ann_box_pos</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">ann_box_pos</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
</span><span id="TE_Scraper-1215"><a href="#TE_Scraper-1215"><span class="linenos">1215</span></a>            <span class="n">showarrow</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">),</span>
</span><span id="TE_Scraper-1216"><a href="#TE_Scraper-1216"><span class="linenos">1216</span></a>            <span class="n">align</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>  <span class="n">xanchor</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
</span><span id="TE_Scraper-1217"><a href="#TE_Scraper-1217"><span class="linenos">1217</span></a>            <span class="n">yanchor</span><span class="o">=</span><span class="s2">&quot;bottom&quot;</span><span class="p">,</span> <span class="n">bgcolor</span><span class="o">=</span><span class="s2">&quot;rgba(255, 255, 255, 0.8)&quot;</span><span class="p">,</span>
</span><span id="TE_Scraper-1218"><a href="#TE_Scraper-1218"><span class="linenos">1218</span></a>            <span class="n">bordercolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">borderwidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="TE_Scraper-1219"><a href="#TE_Scraper-1219"><span class="linenos">1219</span></a>
</span><span id="TE_Scraper-1220"><a href="#TE_Scraper-1220"><span class="linenos">1220</span></a>           <span class="c1"># Add y-axis inversion if requested</span>
</span><span id="TE_Scraper-1221"><a href="#TE_Scraper-1221"><span class="linenos">1221</span></a>        <span class="k">if</span> <span class="n">invert_yaxis</span><span class="p">:</span>
</span><span id="TE_Scraper-1222"><a href="#TE_Scraper-1222"><span class="linenos">1222</span></a>            <span class="n">layout_updates</span><span class="p">[</span><span class="s1">&#39;yaxis&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
</span><span id="TE_Scraper-1223"><a href="#TE_Scraper-1223"><span class="linenos">1223</span></a>                <span class="n">autorange</span><span class="o">=</span><span class="s1">&#39;reversed&#39;</span>  <span class="c1"># This inverts the y-axis</span>
</span><span id="TE_Scraper-1224"><a href="#TE_Scraper-1224"><span class="linenos">1224</span></a>            <span class="p">)</span>
</span><span id="TE_Scraper-1225"><a href="#TE_Scraper-1225"><span class="linenos">1225</span></a>
</span><span id="TE_Scraper-1226"><a href="#TE_Scraper-1226"><span class="linenos">1226</span></a>        <span class="c1"># Label x and y axis</span>
</span><span id="TE_Scraper-1227"><a href="#TE_Scraper-1227"><span class="linenos">1227</span></a>        <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
</span><span id="TE_Scraper-1228"><a href="#TE_Scraper-1228"><span class="linenos">1228</span></a>            <span class="n">legend</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
</span><span id="TE_Scraper-1229"><a href="#TE_Scraper-1229"><span class="linenos">1229</span></a>            <span class="n">title_text</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>  <span class="c1"># Remove legend title</span>
</span><span id="TE_Scraper-1230"><a href="#TE_Scraper-1230"><span class="linenos">1230</span></a>            <span class="n">orientation</span><span class="o">=</span><span class="s2">&quot;h&quot;</span><span class="p">,</span>
</span><span id="TE_Scraper-1231"><a href="#TE_Scraper-1231"><span class="linenos">1231</span></a>            <span class="n">yanchor</span><span class="o">=</span><span class="s2">&quot;bottom&quot;</span><span class="p">,</span>
</span><span id="TE_Scraper-1232"><a href="#TE_Scraper-1232"><span class="linenos">1232</span></a>            <span class="n">y</span><span class="o">=-</span><span class="mf">0.2</span><span class="p">,</span>  <span class="c1"># Adjust this value to move the legend further down</span>
</span><span id="TE_Scraper-1233"><a href="#TE_Scraper-1233"><span class="linenos">1233</span></a>            <span class="n">xanchor</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
</span><span id="TE_Scraper-1234"><a href="#TE_Scraper-1234"><span class="linenos">1234</span></a>            <span class="n">x</span><span class="o">=</span><span class="mf">0.5</span>
</span><span id="TE_Scraper-1235"><a href="#TE_Scraper-1235"><span class="linenos">1235</span></a>            <span class="p">),</span>
</span><span id="TE_Scraper-1236"><a href="#TE_Scraper-1236"><span class="linenos">1236</span></a>            <span class="n">yaxis_title</span><span class="o">=</span><span class="n">ylabel</span><span class="p">,</span>
</span><span id="TE_Scraper-1237"><a href="#TE_Scraper-1237"><span class="linenos">1237</span></a>            <span class="n">xaxis_title</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="TE_Scraper-1238"><a href="#TE_Scraper-1238"><span class="linenos">1238</span></a>            <span class="n">title</span> <span class="o">=</span> <span class="n">title</span><span class="p">)</span>
</span><span id="TE_Scraper-1239"><a href="#TE_Scraper-1239"><span class="linenos">1239</span></a>        
</span><span id="TE_Scraper-1240"><a href="#TE_Scraper-1240"><span class="linenos">1240</span></a>            <span class="c1"># Update the layout</span>
</span><span id="TE_Scraper-1241"><a href="#TE_Scraper-1241"><span class="linenos">1241</span></a>        <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="o">**</span><span class="n">layout_updates</span><span class="p">)</span>
</span><span id="TE_Scraper-1242"><a href="#TE_Scraper-1242"><span class="linenos">1242</span></a>
</span><span id="TE_Scraper-1243"><a href="#TE_Scraper-1243"><span class="linenos">1243</span></a>        <span class="c1"># Show the figure</span>
</span><span id="TE_Scraper-1244"><a href="#TE_Scraper-1244"><span class="linenos">1244</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">plot</span> <span class="o">=</span> <span class="n">fig</span>
</span><span id="TE_Scraper-1245"><a href="#TE_Scraper-1245"><span class="linenos">1245</span></a>        <span class="k">if</span> <span class="n">show_fig</span><span class="p">:</span>
</span><span id="TE_Scraper-1246"><a href="#TE_Scraper-1246"><span class="linenos">1246</span></a>            <span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="TE_Scraper-1247"><a href="#TE_Scraper-1247"><span class="linenos">1247</span></a>        <span class="k">if</span> <span class="n">return_fig</span><span class="p">:</span>
</span><span id="TE_Scraper-1248"><a href="#TE_Scraper-1248"><span class="linenos">1248</span></a>            <span class="k">return</span> <span class="n">fig</span>
</span><span id="TE_Scraper-1249"><a href="#TE_Scraper-1249"><span class="linenos">1249</span></a>
</span><span id="TE_Scraper-1250"><a href="#TE_Scraper-1250"><span class="linenos">1250</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">save_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;plot&quot;</span><span class="p">,</span> <span class="n">save_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="n">dpi</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">300</span><span class="p">,</span> <span class="nb">format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;png&quot;</span><span class="p">):</span>
</span><span id="TE_Scraper-1251"><a href="#TE_Scraper-1251"><span class="linenos">1251</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Save the plot to a file. The plot must be created using the plot_series method. This method will save the plot as a PNG image file.</span>
</span><span id="TE_Scraper-1252"><a href="#TE_Scraper-1252"><span class="linenos">1252</span></a>
</span><span id="TE_Scraper-1253"><a href="#TE_Scraper-1253"><span class="linenos">1253</span></a><span class="sd">        **Parameters**</span>
</span><span id="TE_Scraper-1254"><a href="#TE_Scraper-1254"><span class="linenos">1254</span></a><span class="sd">        - filename (str): The name of the file to save the plot to. Default is &#39;plot.png&#39;.</span>
</span><span id="TE_Scraper-1255"><a href="#TE_Scraper-1255"><span class="linenos">1255</span></a><span class="sd">        - save_path (str): The directory to save the plot to. Default is the current working directory.</span>
</span><span id="TE_Scraper-1256"><a href="#TE_Scraper-1256"><span class="linenos">1256</span></a><span class="sd">        - dpi (int): The resolution of the plot in dots per inch. Default is 300.</span>
</span><span id="TE_Scraper-1257"><a href="#TE_Scraper-1257"><span class="linenos">1257</span></a><span class="sd">        - format (str): The format to save the plot in. Default is &#39;png&#39;. Other options are: &quot;html&quot;, &quot;bmp&quot;, &quot;jpeg&quot;, &quot;jpg&quot;.</span>
</span><span id="TE_Scraper-1258"><a href="#TE_Scraper-1258"><span class="linenos">1258</span></a><span class="sd">        Use &quot;html&quot; to save as an interactive plotly plot.</span>
</span><span id="TE_Scraper-1259"><a href="#TE_Scraper-1259"><span class="linenos">1259</span></a>
</span><span id="TE_Scraper-1260"><a href="#TE_Scraper-1260"><span class="linenos">1260</span></a><span class="sd">        :Returns: None</span>
</span><span id="TE_Scraper-1261"><a href="#TE_Scraper-1261"><span class="linenos">1261</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TE_Scraper-1262"><a href="#TE_Scraper-1262"><span class="linenos">1262</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;plot&quot;</span><span class="p">):</span>
</span><span id="TE_Scraper-1263"><a href="#TE_Scraper-1263"><span class="linenos">1263</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Error: Plot not found. Run plot_series() method to create a plot.&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-1264"><a href="#TE_Scraper-1264"><span class="linenos">1264</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="TE_Scraper-1265"><a href="#TE_Scraper-1265"><span class="linenos">1265</span></a>
</span><span id="TE_Scraper-1266"><a href="#TE_Scraper-1266"><span class="linenos">1266</span></a>        <span class="k">if</span> <span class="nb">format</span> <span class="o">==</span> <span class="s2">&quot;html&quot;</span><span class="p">:</span>
</span><span id="TE_Scraper-1267"><a href="#TE_Scraper-1267"><span class="linenos">1267</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">write_html</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">save_path</span><span class="si">}{</span><span class="n">fdel</span><span class="si">}{</span><span class="n">filename</span><span class="si">}</span><span class="s2">.html&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-1268"><a href="#TE_Scraper-1268"><span class="linenos">1268</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Plot saved as </span><span class="si">{</span><span class="n">save_path</span><span class="si">}{</span><span class="n">fdel</span><span class="si">}{</span><span class="n">filename</span><span class="si">}</span><span class="s2">.html&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-1269"><a href="#TE_Scraper-1269"><span class="linenos">1269</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="TE_Scraper-1270"><a href="#TE_Scraper-1270"><span class="linenos">1270</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">write_image</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">save_path</span><span class="si">}{</span><span class="n">fdel</span><span class="si">}{</span><span class="n">filename</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="nb">format</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="nb">format</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">dpi</span><span class="o">/</span><span class="mi">100</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="mi">1400</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="mi">500</span><span class="p">)</span>
</span><span id="TE_Scraper-1271"><a href="#TE_Scraper-1271"><span class="linenos">1271</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Plot saved as </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-1272"><a href="#TE_Scraper-1272"><span class="linenos">1272</span></a>        <span class="k">return</span> <span class="kc">True</span>
</span><span id="TE_Scraper-1273"><a href="#TE_Scraper-1273"><span class="linenos">1273</span></a>
</span><span id="TE_Scraper-1274"><a href="#TE_Scraper-1274"><span class="linenos">1274</span></a>
</span><span id="TE_Scraper-1275"><a href="#TE_Scraper-1275"><span class="linenos">1275</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">scrape_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="TE_Scraper-1276"><a href="#TE_Scraper-1276"><span class="linenos">1276</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Scrape metadata from the page. This method scrapes metadata from the page and stores it in the &#39;metadata&#39; attribute. The metadata</span>
</span><span id="TE_Scraper-1277"><a href="#TE_Scraper-1277"><span class="linenos">1277</span></a><span class="sd">        includes the title, indicator, country, length, frequency, source, , original source, id, start date, end date, min value, and max value of the series.</span>
</span><span id="TE_Scraper-1278"><a href="#TE_Scraper-1278"><span class="linenos">1278</span></a><span class="sd">        It also scrapes a description of the series if available and stores it in the &#39;description&#39; attribute.</span>
</span><span id="TE_Scraper-1279"><a href="#TE_Scraper-1279"><span class="linenos">1279</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TE_Scraper-1280"><a href="#TE_Scraper-1280"><span class="linenos">1280</span></a>
</span><span id="TE_Scraper-1281"><a href="#TE_Scraper-1281"><span class="linenos">1281</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="TE_Scraper-1282"><a href="#TE_Scraper-1282"><span class="linenos">1282</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Scraping metadata for the series from the page...&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-1283"><a href="#TE_Scraper-1283"><span class="linenos">1283</span></a>
</span><span id="TE_Scraper-1284"><a href="#TE_Scraper-1284"><span class="linenos">1284</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="TE_Scraper-1285"><a href="#TE_Scraper-1285"><span class="linenos">1285</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;units&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_soup</span><span class="o">.</span><span class="n">select_one</span><span class="p">(</span><span class="s1">&#39;#singleIndChartUnit2&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
</span><span id="TE_Scraper-1286"><a href="#TE_Scraper-1286"><span class="linenos">1286</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="TE_Scraper-1287"><a href="#TE_Scraper-1287"><span class="linenos">1287</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Units label not found: &quot;</span><span class="p">,</span> <span class="p">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)})</span>
</span><span id="TE_Scraper-1288"><a href="#TE_Scraper-1288"><span class="linenos">1288</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;units&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;a.u&quot;</span>
</span><span id="TE_Scraper-1289"><a href="#TE_Scraper-1289"><span class="linenos">1289</span></a>        
</span><span id="TE_Scraper-1290"><a href="#TE_Scraper-1290"><span class="linenos">1290</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="TE_Scraper-1291"><a href="#TE_Scraper-1291"><span class="linenos">1291</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;original_source&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_soup</span><span class="o">.</span><span class="n">select_one</span><span class="p">(</span><span class="s1">&#39;#singleIndChartUnit&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
</span><span id="TE_Scraper-1292"><a href="#TE_Scraper-1292"><span class="linenos">1292</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="TE_Scraper-1293"><a href="#TE_Scraper-1293"><span class="linenos">1293</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;original_source label not found: &quot;</span><span class="p">,</span> <span class="p">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)})</span>
</span><span id="TE_Scraper-1294"><a href="#TE_Scraper-1294"><span class="linenos">1294</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;original_source&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;unknown&quot;</span>
</span><span id="TE_Scraper-1295"><a href="#TE_Scraper-1295"><span class="linenos">1295</span></a>
</span><span id="TE_Scraper-1296"><a href="#TE_Scraper-1296"><span class="linenos">1296</span></a>        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;page_soup&quot;</span><span class="p">):</span>
</span><span id="TE_Scraper-1297"><a href="#TE_Scraper-1297"><span class="linenos">1297</span></a>            <span class="n">heads</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">page_soup</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;#ctl00_Head1&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-1298"><a href="#TE_Scraper-1298"><span class="linenos">1298</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">heads</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="TE_Scraper-1299"><a href="#TE_Scraper-1299"><span class="linenos">1299</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="TE_Scraper-1300"><a href="#TE_Scraper-1300"><span class="linenos">1300</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span>  <span class="c1"># Use URL if can&#39;t find the title</span>
</span><span id="TE_Scraper-1301"><a href="#TE_Scraper-1301"><span class="linenos">1301</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;indicator&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span>  
</span><span id="TE_Scraper-1302"><a href="#TE_Scraper-1302"><span class="linenos">1302</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;country&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span> 
</span><span id="TE_Scraper-1303"><a href="#TE_Scraper-1303"><span class="linenos">1303</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;source&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Trading Economics&quot;</span> 
</span><span id="TE_Scraper-1304"><a href="#TE_Scraper-1304"><span class="linenos">1304</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">last_url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">:])</span>
</span><span id="TE_Scraper-1305"><a href="#TE_Scraper-1305"><span class="linenos">1305</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Series metadata: </span><span class="se">\n</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-1306"><a href="#TE_Scraper-1306"><span class="linenos">1306</span></a>
</span><span id="TE_Scraper-1307"><a href="#TE_Scraper-1307"><span class="linenos">1307</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="TE_Scraper-1308"><a href="#TE_Scraper-1308"><span class="linenos">1308</span></a>            <span class="n">desc_card</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">page_soup</span><span class="o">.</span><span class="n">select_one</span><span class="p">(</span><span class="s2">&quot;#item_definition&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-1309"><a href="#TE_Scraper-1309"><span class="linenos">1309</span></a>            <span class="n">header_text</span> <span class="o">=</span> <span class="n">desc_card</span><span class="o">.</span><span class="n">select_one</span><span class="p">(</span><span class="s1">&#39;.card-header&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="TE_Scraper-1310"><a href="#TE_Scraper-1310"><span class="linenos">1310</span></a>            <span class="k">if</span> <span class="n">header_text</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
</span><span id="TE_Scraper-1311"><a href="#TE_Scraper-1311"><span class="linenos">1311</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;description&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">desc_card</span><span class="o">.</span><span class="n">select_one</span><span class="p">(</span><span class="s1">&#39;.card-body&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="TE_Scraper-1312"><a href="#TE_Scraper-1312"><span class="linenos">1312</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="TE_Scraper-1313"><a href="#TE_Scraper-1313"><span class="linenos">1313</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Description card title does not match series title.&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-1314"><a href="#TE_Scraper-1314"><span class="linenos">1314</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;description&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Description not found.&quot;</span>
</span><span id="TE_Scraper-1315"><a href="#TE_Scraper-1315"><span class="linenos">1315</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="TE_Scraper-1316"><a href="#TE_Scraper-1316"><span class="linenos">1316</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Description card not found: &quot;</span><span class="p">,</span> <span class="p">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)})</span>
</span><span id="TE_Scraper-1317"><a href="#TE_Scraper-1317"><span class="linenos">1317</span></a>
</span><span id="TE_Scraper-1318"><a href="#TE_Scraper-1318"><span class="linenos">1318</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">series_metadata</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">)</span>
</span><span id="TE_Scraper-1319"><a href="#TE_Scraper-1319"><span class="linenos">1319</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TE_Scraper-1320"><a href="#TE_Scraper-1320"><span class="linenos">1320</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Metadata scraped successfully: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-1321"><a href="#TE_Scraper-1321"><span class="linenos">1321</span></a>
</span><span id="TE_Scraper-1322"><a href="#TE_Scraper-1322"><span class="linenos">1322</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">export_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">savePath</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="TE_Scraper-1323"><a href="#TE_Scraper-1323"><span class="linenos">1323</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; Export the series data to an excel .xlsx file. The series and metadata attributes must be set before running this method.</span>
</span><span id="TE_Scraper-1324"><a href="#TE_Scraper-1324"><span class="linenos">1324</span></a><span class="sd">        Only do it after scraping the series data. The metadata will be saved in a separate sheet in the same file.</span>
</span><span id="TE_Scraper-1325"><a href="#TE_Scraper-1325"><span class="linenos">1325</span></a><span class="sd">        </span>
</span><span id="TE_Scraper-1326"><a href="#TE_Scraper-1326"><span class="linenos">1326</span></a><span class="sd">        **Parameters**</span>
</span><span id="TE_Scraper-1327"><a href="#TE_Scraper-1327"><span class="linenos">1327</span></a><span class="sd">        - savePath (str): The directory to save the file to. Default is the current working directory.</span>
</span><span id="TE_Scraper-1328"><a href="#TE_Scraper-1328"><span class="linenos">1328</span></a><span class="sd">        - filename (str): The name of the file to save the data to. Default is the name of the series. &quot;&quot;&quot;</span>
</span><span id="TE_Scraper-1329"><a href="#TE_Scraper-1329"><span class="linenos">1329</span></a>        
</span><span id="TE_Scraper-1330"><a href="#TE_Scraper-1330"><span class="linenos">1330</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;series&quot;</span><span class="p">):</span>
</span><span id="TE_Scraper-1331"><a href="#TE_Scraper-1331"><span class="linenos">1331</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No series found. Run the series_from_chart_soup method first.&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-1332"><a href="#TE_Scraper-1332"><span class="linenos">1332</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="TE_Scraper-1333"><a href="#TE_Scraper-1333"><span class="linenos">1333</span></a>        <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TE_Scraper-1334"><a href="#TE_Scraper-1334"><span class="linenos">1334</span></a>            <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">series_name</span>
</span><span id="TE_Scraper-1335"><a href="#TE_Scraper-1335"><span class="linenos">1335</span></a>
</span><span id="TE_Scraper-1336"><a href="#TE_Scraper-1336"><span class="linenos">1336</span></a>        <span class="k">with</span> <span class="n">pd</span><span class="o">.</span><span class="n">ExcelWriter</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">savePath</span><span class="si">}{</span><span class="n">fdel</span><span class="si">}{</span><span class="n">filename</span><span class="si">}</span><span class="s2">.xlsx&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">writer</span><span class="p">:</span>
</span><span id="TE_Scraper-1337"><a href="#TE_Scraper-1337"><span class="linenos">1337</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="s1">&#39;Data&#39;</span><span class="p">)</span>
</span><span id="TE_Scraper-1338"><a href="#TE_Scraper-1338"><span class="linenos">1338</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">series_metadata</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="s1">&#39;Metadata&#39;</span><span class="p">)</span>
</span><span id="TE_Scraper-1339"><a href="#TE_Scraper-1339"><span class="linenos">1339</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Data exported to </span><span class="si">{</span><span class="n">savePath</span><span class="si">}{</span><span class="n">fdel</span><span class="si">}{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-1340"><a href="#TE_Scraper-1340"><span class="linenos">1340</span></a>
</span><span id="TE_Scraper-1341"><a href="#TE_Scraper-1341"><span class="linenos">1341</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_page_source</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="TE_Scraper-1342"><a href="#TE_Scraper-1342"><span class="linenos">1342</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get current page source after interactions&quot;&quot;&quot;</span>
</span><span id="TE_Scraper-1343"><a href="#TE_Scraper-1343"><span class="linenos">1343</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">page_source</span>
</span><span id="TE_Scraper-1344"><a href="#TE_Scraper-1344"><span class="linenos">1344</span></a>    
</span><span id="TE_Scraper-1345"><a href="#TE_Scraper-1345"><span class="linenos">1345</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="TE_Scraper-1346"><a href="#TE_Scraper-1346"><span class="linenos">1346</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Clean up resources completely by closing the WebDriver and removing references&quot;&quot;&quot;</span>
</span><span id="TE_Scraper-1347"><a href="#TE_Scraper-1347"><span class="linenos">1347</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="TE_Scraper-1348"><a href="#TE_Scraper-1348"><span class="linenos">1348</span></a>            <span class="c1"># First try graceful close with quitting the driver</span>
</span><span id="TE_Scraper-1349"><a href="#TE_Scraper-1349"><span class="linenos">1349</span></a>            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;driver&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="p">:</span>
</span><span id="TE_Scraper-1350"><a href="#TE_Scraper-1350"><span class="linenos">1350</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="TE_Scraper-1351"><a href="#TE_Scraper-1351"><span class="linenos">1351</span></a>                    <span class="c1"># Close all windows/tabs first</span>
</span><span id="TE_Scraper-1352"><a href="#TE_Scraper-1352"><span class="linenos">1352</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="TE_Scraper-1353"><a href="#TE_Scraper-1353"><span class="linenos">1353</span></a>                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="TE_Scraper-1354"><a href="#TE_Scraper-1354"><span class="linenos">1354</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error closing window: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-1355"><a href="#TE_Scraper-1355"><span class="linenos">1355</span></a>                    <span class="k">pass</span>
</span><span id="TE_Scraper-1356"><a href="#TE_Scraper-1356"><span class="linenos">1356</span></a>                
</span><span id="TE_Scraper-1357"><a href="#TE_Scraper-1357"><span class="linenos">1357</span></a>                <span class="c1"># Then quit the driver completely with error handling for connection issues</span>
</span><span id="TE_Scraper-1358"><a href="#TE_Scraper-1358"><span class="linenos">1358</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="TE_Scraper-1359"><a href="#TE_Scraper-1359"><span class="linenos">1359</span></a>                    <span class="kn">from</span><span class="w"> </span><span class="nn">selenium.common.exceptions</span><span class="w"> </span><span class="kn">import</span> <span class="n">WebDriverException</span>
</span><span id="TE_Scraper-1360"><a href="#TE_Scraper-1360"><span class="linenos">1360</span></a>                    <span class="kn">from</span><span class="w"> </span><span class="nn">urllib3.exceptions</span><span class="w"> </span><span class="kn">import</span> <span class="n">MaxRetryError</span><span class="p">,</span> <span class="n">NewConnectionError</span>
</span><span id="TE_Scraper-1361"><a href="#TE_Scraper-1361"><span class="linenos">1361</span></a>                    
</span><span id="TE_Scraper-1362"><a href="#TE_Scraper-1362"><span class="linenos">1362</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="TE_Scraper-1363"><a href="#TE_Scraper-1363"><span class="linenos">1363</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
</span><span id="TE_Scraper-1364"><a href="#TE_Scraper-1364"><span class="linenos">1364</span></a>                    <span class="k">except</span> <span class="p">(</span><span class="n">WebDriverException</span><span class="p">,</span> <span class="n">MaxRetryError</span><span class="p">,</span> <span class="n">NewConnectionError</span><span class="p">,</span> <span class="ne">ConnectionRefusedError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="TE_Scraper-1365"><a href="#TE_Scraper-1365"><span class="linenos">1365</span></a>                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Connection error when quitting driver (this is normal if browser crashed): </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-1366"><a href="#TE_Scraper-1366"><span class="linenos">1366</span></a>                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="TE_Scraper-1367"><a href="#TE_Scraper-1367"><span class="linenos">1367</span></a>                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error quitting driver: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-1368"><a href="#TE_Scraper-1368"><span class="linenos">1368</span></a>                <span class="k">finally</span><span class="p">:</span>
</span><span id="TE_Scraper-1369"><a href="#TE_Scraper-1369"><span class="linenos">1369</span></a>                    <span class="c1"># Clear the reference regardless of success</span>
</span><span id="TE_Scraper-1370"><a href="#TE_Scraper-1370"><span class="linenos">1370</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">driver</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="TE_Scraper-1371"><a href="#TE_Scraper-1371"><span class="linenos">1371</span></a>            
</span><span id="TE_Scraper-1372"><a href="#TE_Scraper-1372"><span class="linenos">1372</span></a>            <span class="c1"># Also close any tooltip_scraper drivers if they exist</span>
</span><span id="TE_Scraper-1373"><a href="#TE_Scraper-1373"><span class="linenos">1373</span></a>            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;tooltip_scraper&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">tooltip_scraper</span><span class="p">:</span>
</span><span id="TE_Scraper-1374"><a href="#TE_Scraper-1374"><span class="linenos">1374</span></a>                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tooltip_scraper</span><span class="p">,</span> <span class="s2">&quot;driver&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">tooltip_scraper</span><span class="o">.</span><span class="n">driver</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">tooltip_scraper</span><span class="o">.</span><span class="n">driver</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="p">:</span>
</span><span id="TE_Scraper-1375"><a href="#TE_Scraper-1375"><span class="linenos">1375</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="TE_Scraper-1376"><a href="#TE_Scraper-1376"><span class="linenos">1376</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">tooltip_scraper</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
</span><span id="TE_Scraper-1377"><a href="#TE_Scraper-1377"><span class="linenos">1377</span></a>                    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="TE_Scraper-1378"><a href="#TE_Scraper-1378"><span class="linenos">1378</span></a>                        <span class="k">pass</span>
</span><span id="TE_Scraper-1379"><a href="#TE_Scraper-1379"><span class="linenos">1379</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">tooltip_scraper</span><span class="o">.</span><span class="n">driver</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="TE_Scraper-1380"><a href="#TE_Scraper-1380"><span class="linenos">1380</span></a>            
</span><span id="TE_Scraper-1381"><a href="#TE_Scraper-1381"><span class="linenos">1381</span></a>            <span class="c1"># Clear any large data attributes to help garbage collection</span>
</span><span id="TE_Scraper-1382"><a href="#TE_Scraper-1382"><span class="linenos">1382</span></a>            <span class="n">large_attributes</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;series&quot;</span><span class="p">,</span> <span class="s2">&quot;trace_path_series&quot;</span><span class="p">,</span> <span class="s2">&quot;full_page&quot;</span><span class="p">,</span> <span class="s2">&quot;page_soup&quot;</span><span class="p">,</span> 
</span><span id="TE_Scraper-1383"><a href="#TE_Scraper-1383"><span class="linenos">1383</span></a>                            <span class="s2">&quot;chart_soup&quot;</span><span class="p">,</span> <span class="s2">&quot;full_chart&quot;</span><span class="p">,</span> <span class="s2">&quot;plot&quot;</span><span class="p">]</span>
</span><span id="TE_Scraper-1384"><a href="#TE_Scraper-1384"><span class="linenos">1384</span></a>            
</span><span id="TE_Scraper-1385"><a href="#TE_Scraper-1385"><span class="linenos">1385</span></a>            <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">large_attributes</span><span class="p">:</span>
</span><span id="TE_Scraper-1386"><a href="#TE_Scraper-1386"><span class="linenos">1386</span></a>                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
</span><span id="TE_Scraper-1387"><a href="#TE_Scraper-1387"><span class="linenos">1387</span></a>                    <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="TE_Scraper-1388"><a href="#TE_Scraper-1388"><span class="linenos">1388</span></a>                    
</span><span id="TE_Scraper-1389"><a href="#TE_Scraper-1389"><span class="linenos">1389</span></a>            <span class="c1"># Force garbage collection</span>
</span><span id="TE_Scraper-1390"><a href="#TE_Scraper-1390"><span class="linenos">1390</span></a>            <span class="kn">import</span><span class="w"> </span><span class="nn">gc</span>
</span><span id="TE_Scraper-1391"><a href="#TE_Scraper-1391"><span class="linenos">1391</span></a>            <span class="n">gc</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
</span><span id="TE_Scraper-1392"><a href="#TE_Scraper-1392"><span class="linenos">1392</span></a>            
</span><span id="TE_Scraper-1393"><a href="#TE_Scraper-1393"><span class="linenos">1393</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Scraper resources successfully released&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-1394"><a href="#TE_Scraper-1394"><span class="linenos">1394</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="TE_Scraper-1395"><a href="#TE_Scraper-1395"><span class="linenos">1395</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error during cleanup: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper-1396"><a href="#TE_Scraper-1396"><span class="linenos">1396</span></a>    
</span><span id="TE_Scraper-1397"><a href="#TE_Scraper-1397"><span class="linenos">1397</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="TE_Scraper-1398"><a href="#TE_Scraper-1398"><span class="linenos">1398</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span><span id="TE_Scraper-1399"><a href="#TE_Scraper-1399"><span class="linenos">1399</span></a>    
</span><span id="TE_Scraper-1400"><a href="#TE_Scraper-1400"><span class="linenos">1400</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_val</span><span class="p">,</span> <span class="n">exc_tb</span><span class="p">):</span>
</span><span id="TE_Scraper-1401"><a href="#TE_Scraper-1401"><span class="linenos">1401</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Class for scraping data from Trading Economics website. This is the main workhorse of the module.
It is designed to scrape data from the Trading Economics website using Selenium and BeautifulSoup.
It can load a page, click buttons, extract data from elements, and plot the extracted data. Uses multiple inheritance
from the Generic_Webdriver and SharedWebDriverState classes. This enables creation of TooltipScraper child classes that have 
synced atributes such as "chart_soup", "chart_type" &amp; "date_span" &amp; share the same webdriver object. This is useful for scraping.</p>

<p><strong>Init Parameters:</strong> </p>

<ul>
<li>**kwargs (dict): Keyword  arguments to pass to the Generic_Webdriver class. These are the same as the Generic_Webdriver class.
These are:
<ul>
<li>driver (webdriver): A Selenium WebDriver object, can put in an active one or make a new one for a new URL.</li>
<li>use_existing_driver (bool): Whether to use an existing driver in the namespace. If True, the driver parameter is ignored. Default is False.</li>
<li>browser (str): The browser to use for scraping, either 'chrome' or 'firefox'.</li>
<li>headless (bool): Whether to run the browser in headless mode (show no window).</li>
</ul></li>
</ul>
</div>


                            <div id="TE_Scraper.__init__" class="classattr">
                                        <input id="TE_Scraper.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">TE_Scraper</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">**</span><span class="n">kwargs</span></span>)</span>

                <label class="view-source-button" for="TE_Scraper.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TE_Scraper.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TE_Scraper.__init__-57"><a href="#TE_Scraper.__init__-57"><span class="linenos">57</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="TE_Scraper.__init__-58"><a href="#TE_Scraper.__init__-58"><span class="linenos">58</span></a>        <span class="n">Generic_Webdriver</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="TE_Scraper.__init__-59"><a href="#TE_Scraper.__init__-59"><span class="linenos">59</span></a>        <span class="n">SharedWebDriverState</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="TE_Scraper.__init__-60"><a href="#TE_Scraper.__init__-60"><span class="linenos">60</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">observers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>  <span class="c1"># Register self as observer</span>
</span><span id="TE_Scraper.__init__-61"><a href="#TE_Scraper.__init__-61"><span class="linenos">61</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_shared_state</span> <span class="o">=</span> <span class="bp">self</span>  <span class="c1"># Since we inherit SharedWebDriverState, we are our own shared state</span>
</span></pre></div>


            <div class="docstring"><p>Initialize shared state attributes, it is chart_type and date_span which we want to keep synced between the classes.</p>
</div>


                            </div>
                            <div id="TE_Scraper.BrowserType" class="classattr">
                                <div class="attr variable">
            <span class="name">BrowserType</span>        =
<span class="default_value">typing.Literal[&#39;chrome&#39;, &#39;firefox&#39;]</span>

        
    </div>
    <a class="headerlink" href="#TE_Scraper.BrowserType"></a>
    
    

                            </div>
                            <div id="TE_Scraper.load_page" class="classattr">
                                        <input id="TE_Scraper.load_page-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">load_page</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">url</span>, </span><span class="param"><span class="n">extra_wait_time</span><span class="o">=</span><span class="mi">3</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="TE_Scraper.load_page-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TE_Scraper.load_page"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TE_Scraper.load_page-63"><a href="#TE_Scraper.load_page-63"><span class="linenos"> 63</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">load_page</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">extra_wait_time</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>
</span><span id="TE_Scraper.load_page-64"><a href="#TE_Scraper.load_page-64"><span class="linenos"> 64</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Load page and wait for it to be ready&quot;&quot;&quot;</span>
</span><span id="TE_Scraper.load_page-65"><a href="#TE_Scraper.load_page-65"><span class="linenos"> 65</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">last_url</span> <span class="o">=</span> <span class="n">url</span>
</span><span id="TE_Scraper.load_page-66"><a href="#TE_Scraper.load_page-66"><span class="linenos"> 66</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">series_name</span> <span class="o">=</span> <span class="n">url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.load_page-67"><a href="#TE_Scraper.load_page-67"><span class="linenos"> 67</span></a>        
</span><span id="TE_Scraper.load_page-68"><a href="#TE_Scraper.load_page-68"><span class="linenos"> 68</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="TE_Scraper.load_page-69"><a href="#TE_Scraper.load_page-69"><span class="linenos"> 69</span></a>            <span class="c1"># This waits for initial page load</span>
</span><span id="TE_Scraper.load_page-70"><a href="#TE_Scraper.load_page-70"><span class="linenos"> 70</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</span><span id="TE_Scraper.load_page-71"><a href="#TE_Scraper.load_page-71"><span class="linenos"> 71</span></a>            
</span><span id="TE_Scraper.load_page-72"><a href="#TE_Scraper.load_page-72"><span class="linenos"> 72</span></a>            <span class="c1"># Now explicitly wait for your critical elements</span>
</span><span id="TE_Scraper.load_page-73"><a href="#TE_Scraper.load_page-73"><span class="linenos"> 73</span></a>            <span class="n">chart_element</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wait</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
</span><span id="TE_Scraper.load_page-74"><a href="#TE_Scraper.load_page-74"><span class="linenos"> 74</span></a>                <span class="n">EC</span><span class="o">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">ID</span><span class="p">,</span> <span class="s2">&quot;chart&quot;</span><span class="p">)),</span>
</span><span id="TE_Scraper.load_page-75"><a href="#TE_Scraper.load_page-75"><span class="linenos"> 75</span></a>                <span class="n">message</span><span class="o">=</span><span class="s2">&quot;Chart element not found after page load&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.load_page-76"><a href="#TE_Scraper.load_page-76"><span class="linenos"> 76</span></a>            
</span><span id="TE_Scraper.load_page-77"><a href="#TE_Scraper.load_page-77"><span class="linenos"> 77</span></a>            <span class="c1"># Scroll chart into view to ensure it&#39;s visible for interactions</span>
</span><span id="TE_Scraper.load_page-78"><a href="#TE_Scraper.load_page-78"><span class="linenos"> 78</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">execute_script</span><span class="p">(</span><span class="s2">&quot;arguments[0].scrollIntoView({behavior: &#39;auto&#39;, block: &#39;center&#39;});&quot;</span><span class="p">,</span> <span class="n">chart_element</span><span class="p">)</span>
</span><span id="TE_Scraper.load_page-79"><a href="#TE_Scraper.load_page-79"><span class="linenos"> 79</span></a>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>  <span class="c1"># Small delay to let scrolling complete</span>
</span><span id="TE_Scraper.load_page-80"><a href="#TE_Scraper.load_page-80"><span class="linenos"> 80</span></a>            
</span><span id="TE_Scraper.load_page-81"><a href="#TE_Scraper.load_page-81"><span class="linenos"> 81</span></a>            <span class="c1"># Wait for the chart content to be loaded</span>
</span><span id="TE_Scraper.load_page-82"><a href="#TE_Scraper.load_page-82"><span class="linenos"> 82</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">wait</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
</span><span id="TE_Scraper.load_page-83"><a href="#TE_Scraper.load_page-83"><span class="linenos"> 83</span></a>                <span class="n">EC</span><span class="o">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">CLASS_NAME</span><span class="p">,</span> <span class="s2">&quot;highcharts-series-group&quot;</span><span class="p">)),</span>
</span><span id="TE_Scraper.load_page-84"><a href="#TE_Scraper.load_page-84"><span class="linenos"> 84</span></a>                <span class="n">message</span><span class="o">=</span><span class="s2">&quot;Chart series not loaded&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.load_page-85"><a href="#TE_Scraper.load_page-85"><span class="linenos"> 85</span></a>            
</span><span id="TE_Scraper.load_page-86"><a href="#TE_Scraper.load_page-86"><span class="linenos"> 86</span></a>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">extra_wait_time</span><span class="p">)</span>  <span class="c1"># Extra wait time after page load just to be sure...</span>
</span><span id="TE_Scraper.load_page-87"><a href="#TE_Scraper.load_page-87"><span class="linenos"> 87</span></a>            
</span><span id="TE_Scraper.load_page-88"><a href="#TE_Scraper.load_page-88"><span class="linenos"> 88</span></a>            <span class="c1"># Now it&#39;s safe to get the page source</span>
</span><span id="TE_Scraper.load_page-89"><a href="#TE_Scraper.load_page-89"><span class="linenos"> 89</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">full_page</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_page_source</span><span class="p">()</span>
</span><span id="TE_Scraper.load_page-90"><a href="#TE_Scraper.load_page-90"><span class="linenos"> 90</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">page_soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">full_page</span><span class="p">,</span> <span class="s1">&#39;html.parser&#39;</span><span class="p">)</span>
</span><span id="TE_Scraper.load_page-91"><a href="#TE_Scraper.load_page-91"><span class="linenos"> 91</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">chart_soup</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">page_soup</span><span class="o">.</span><span class="n">select_one</span><span class="p">(</span><span class="s2">&quot;#chart&quot;</span><span class="p">)</span>  <span class="c1">#Make a bs4 object from the #chart element of the page.</span>
</span><span id="TE_Scraper.load_page-92"><a href="#TE_Scraper.load_page-92"><span class="linenos"> 92</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">full_chart</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_soup</span><span class="o">.</span><span class="n">contents</span>
</span><span id="TE_Scraper.load_page-93"><a href="#TE_Scraper.load_page-93"><span class="linenos"> 93</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="TE_Scraper.load_page-94"><a href="#TE_Scraper.load_page-94"><span class="linenos"> 94</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error loading page: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.load_page-95"><a href="#TE_Scraper.load_page-95"><span class="linenos"> 95</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error loading page: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.load_page-96"><a href="#TE_Scraper.load_page-96"><span class="linenos"> 96</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="TE_Scraper.load_page-97"><a href="#TE_Scraper.load_page-97"><span class="linenos"> 97</span></a>        
</span><span id="TE_Scraper.load_page-98"><a href="#TE_Scraper.load_page-98"><span class="linenos"> 98</span></a>        <span class="n">retries</span> <span class="o">=</span> <span class="mi">4</span>
</span><span id="TE_Scraper.load_page-99"><a href="#TE_Scraper.load_page-99"><span class="linenos"> 99</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">retries</span><span class="p">):</span>
</span><span id="TE_Scraper.load_page-100"><a href="#TE_Scraper.load_page-100"><span class="linenos">100</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_chart_types_dict</span><span class="p">():</span> <span class="c1"># Create the chart types dictionary for the chart.</span>
</span><span id="TE_Scraper.load_page-101"><a href="#TE_Scraper.load_page-101"><span class="linenos">101</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Chart types dictionary created successfully.&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.load_page-102"><a href="#TE_Scraper.load_page-102"><span class="linenos">102</span></a>                <span class="k">break</span>
</span><span id="TE_Scraper.load_page-103"><a href="#TE_Scraper.load_page-103"><span class="linenos">103</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="TE_Scraper.load_page-104"><a href="#TE_Scraper.load_page-104"><span class="linenos">104</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Error creating chart types dictionary. Retrying, attempt: &quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
</span><span id="TE_Scraper.load_page-105"><a href="#TE_Scraper.load_page-105"><span class="linenos">105</span></a>            
</span><span id="TE_Scraper.load_page-106"><a href="#TE_Scraper.load_page-106"><span class="linenos">106</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">update_date_span</span><span class="p">()</span>
</span><span id="TE_Scraper.load_page-107"><a href="#TE_Scraper.load_page-107"><span class="linenos">107</span></a>        <span class="k">return</span> <span class="kc">True</span>
</span></pre></div>


            <div class="docstring"><p>Load page and wait for it to be ready</p>
</div>


                            </div>
                            <div id="TE_Scraper.click_button" class="classattr">
                                        <input id="TE_Scraper.click_button-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">click_button</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">selector</span>, </span><span class="param"><span class="n">selector_type</span><span class="o">=</span><span class="s1">&#39;css selector&#39;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="TE_Scraper.click_button-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TE_Scraper.click_button"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TE_Scraper.click_button-109"><a href="#TE_Scraper.click_button-109"><span class="linenos">109</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">click_button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">selector</span><span class="p">,</span> <span class="n">selector_type</span><span class="o">=</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">):</span>
</span><span id="TE_Scraper.click_button-110"><a href="#TE_Scraper.click_button-110"><span class="linenos">110</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Click button using webdriver and wait for response.</span>
</span><span id="TE_Scraper.click_button-111"><a href="#TE_Scraper.click_button-111"><span class="linenos">111</span></a><span class="sd">        **Parameters:**</span>
</span><span id="TE_Scraper.click_button-112"><a href="#TE_Scraper.click_button-112"><span class="linenos">112</span></a><span class="sd">        - selector (str): The CSS selector for the button to click.</span>
</span><span id="TE_Scraper.click_button-113"><a href="#TE_Scraper.click_button-113"><span class="linenos">113</span></a><span class="sd">        - selector_type (By): The type of selector to use, By.CSS_SELECTOR by default.&quot;&quot;&quot;</span>
</span><span id="TE_Scraper.click_button-114"><a href="#TE_Scraper.click_button-114"><span class="linenos">114</span></a>
</span><span id="TE_Scraper.click_button-115"><a href="#TE_Scraper.click_button-115"><span class="linenos">115</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="TE_Scraper.click_button-116"><a href="#TE_Scraper.click_button-116"><span class="linenos">116</span></a>            <span class="c1"># Wait for element to be clickable</span>
</span><span id="TE_Scraper.click_button-117"><a href="#TE_Scraper.click_button-117"><span class="linenos">117</span></a>            <span class="n">button</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wait</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
</span><span id="TE_Scraper.click_button-118"><a href="#TE_Scraper.click_button-118"><span class="linenos">118</span></a>                <span class="n">EC</span><span class="o">.</span><span class="n">element_to_be_clickable</span><span class="p">((</span><span class="n">selector_type</span><span class="p">,</span> <span class="n">selector</span><span class="p">)))</span>
</span><span id="TE_Scraper.click_button-119"><a href="#TE_Scraper.click_button-119"><span class="linenos">119</span></a>            
</span><span id="TE_Scraper.click_button-120"><a href="#TE_Scraper.click_button-120"><span class="linenos">120</span></a>            <span class="n">button</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
</span><span id="TE_Scraper.click_button-121"><a href="#TE_Scraper.click_button-121"><span class="linenos">121</span></a>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.25</span><span class="p">)</span>
</span><span id="TE_Scraper.click_button-122"><a href="#TE_Scraper.click_button-122"><span class="linenos">122</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="TE_Scraper.click_button-123"><a href="#TE_Scraper.click_button-123"><span class="linenos">123</span></a>        <span class="k">except</span> <span class="n">TimeoutException</span><span class="p">:</span>
</span><span id="TE_Scraper.click_button-124"><a href="#TE_Scraper.click_button-124"><span class="linenos">124</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Button not found or not clickable: </span><span class="si">{</span><span class="n">selector</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.click_button-125"><a href="#TE_Scraper.click_button-125"><span class="linenos">125</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="TE_Scraper.click_button-126"><a href="#TE_Scraper.click_button-126"><span class="linenos">126</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="TE_Scraper.click_button-127"><a href="#TE_Scraper.click_button-127"><span class="linenos">127</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error clicking button: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.click_button-128"><a href="#TE_Scraper.click_button-128"><span class="linenos">128</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span></pre></div>


            <div class="docstring"><p>Click button using webdriver and wait for response.
<strong>Parameters:</strong></p>

<ul>
<li>selector (str): The CSS selector for the button to click.</li>
<li>selector_type (By): The type of selector to use, By.CSS_SELECTOR by default.</li>
</ul>
</div>


                            </div>
                            <div id="TE_Scraper.find_max_button" class="classattr">
                                        <input id="TE_Scraper.find_max_button-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">find_max_button</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">selector</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;#dateSpansDiv&#39;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="TE_Scraper.find_max_button-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TE_Scraper.find_max_button"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TE_Scraper.find_max_button-130"><a href="#TE_Scraper.find_max_button-130"><span class="linenos">130</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">find_max_button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">selector</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;#dateSpansDiv&quot;</span><span class="p">):</span>
</span><span id="TE_Scraper.find_max_button-131"><a href="#TE_Scraper.find_max_button-131"><span class="linenos">131</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Find the button on the chart that selects the maximum date range and return the CSS selector for it.</span>
</span><span id="TE_Scraper.find_max_button-132"><a href="#TE_Scraper.find_max_button-132"><span class="linenos">132</span></a><span class="sd">        The button is usually labelled &#39;MAX&#39; and is used to select the maximum date range for the chart. The selector for the button is</span>
</span><span id="TE_Scraper.find_max_button-133"><a href="#TE_Scraper.find_max_button-133"><span class="linenos">133</span></a><span class="sd">        usually &#39;#dateSpansDiv&#39; but can be changed if the button is not found. The method will return the CSS selector for the button.</span>
</span><span id="TE_Scraper.find_max_button-134"><a href="#TE_Scraper.find_max_button-134"><span class="linenos">134</span></a><span class="sd">        This will also create an atrribute &#39;date_spans&#39; which is a dictionary containing the text of the date span buttons and their CSS selectors.&quot;&quot;&quot;</span>
</span><span id="TE_Scraper.find_max_button-135"><a href="#TE_Scraper.find_max_button-135"><span class="linenos">135</span></a>
</span><span id="TE_Scraper.find_max_button-136"><a href="#TE_Scraper.find_max_button-136"><span class="linenos">136</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="TE_Scraper.find_max_button-137"><a href="#TE_Scraper.find_max_button-137"><span class="linenos">137</span></a>            <span class="n">buts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">page_soup</span><span class="o">.</span><span class="n">select_one</span><span class="p">(</span><span class="n">selector</span><span class="p">)</span>
</span><span id="TE_Scraper.find_max_button-138"><a href="#TE_Scraper.find_max_button-138"><span class="linenos">138</span></a>            <span class="n">datebut</span> <span class="o">=</span> <span class="n">buts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">buts</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="n">buts</span>
</span><span id="TE_Scraper.find_max_button-139"><a href="#TE_Scraper.find_max_button-139"><span class="linenos">139</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">date_spans</span> <span class="o">=</span> <span class="p">{</span><span class="n">child</span><span class="o">.</span><span class="n">text</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;a.</span><span class="si">{</span><span class="n">child</span><span class="p">[</span><span class="s1">&#39;class&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nb">isinstance</span><span class="p">(</span><span class="n">child</span><span class="p">[</span><span class="s1">&#39;class&#39;</span><span class="p">],</span><span class="w"> </span><span class="nb">list</span><span class="p">)</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="n">child</span><span class="p">[</span><span class="s1">&#39;class&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">:nth-child(</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">)&quot;</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">child</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">datebut</span><span class="o">.</span><span class="n">children</span><span class="p">)}</span>
</span><span id="TE_Scraper.find_max_button-140"><a href="#TE_Scraper.find_max_button-140"><span class="linenos">140</span></a>
</span><span id="TE_Scraper.find_max_button-141"><a href="#TE_Scraper.find_max_button-141"><span class="linenos">141</span></a>            <span class="k">if</span> <span class="s2">&quot;MAX&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">date_spans</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="TE_Scraper.find_max_button-142"><a href="#TE_Scraper.find_max_button-142"><span class="linenos">142</span></a>                <span class="n">max_selector</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">date_spans</span><span class="p">[</span><span class="s2">&quot;MAX&quot;</span><span class="p">]</span>
</span><span id="TE_Scraper.find_max_button-143"><a href="#TE_Scraper.find_max_button-143"><span class="linenos">143</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="TE_Scraper.find_max_button-144"><a href="#TE_Scraper.find_max_button-144"><span class="linenos">144</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;MAX button not found.&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.find_max_button-145"><a href="#TE_Scraper.find_max_button-145"><span class="linenos">145</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;MAX button found for chart at URL: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">last_url</span><span class="si">}</span><span class="s2">, selector: </span><span class="si">{</span><span class="n">max_selector</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.find_max_button-146"><a href="#TE_Scraper.find_max_button-146"><span class="linenos">146</span></a>            
</span><span id="TE_Scraper.find_max_button-147"><a href="#TE_Scraper.find_max_button-147"><span class="linenos">147</span></a>            <span class="k">return</span> <span class="n">max_selector</span>
</span><span id="TE_Scraper.find_max_button-148"><a href="#TE_Scraper.find_max_button-148"><span class="linenos">148</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="TE_Scraper.find_max_button-149"><a href="#TE_Scraper.find_max_button-149"><span class="linenos">149</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error finding date spans buttons: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.find_max_button-150"><a href="#TE_Scraper.find_max_button-150"><span class="linenos">150</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error finding date spans buttons: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.find_max_button-151"><a href="#TE_Scraper.find_max_button-151"><span class="linenos">151</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span></pre></div>


            <div class="docstring"><p>Find the button on the chart that selects the maximum date range and return the CSS selector for it.
The button is usually labelled 'MAX' and is used to select the maximum date range for the chart. The selector for the button is
usually '#dateSpansDiv' but can be changed if the button is not found. The method will return the CSS selector for the button.
This will also create an atrribute 'date_spans' which is a dictionary containing the text of the date span buttons and their CSS selectors.</p>
</div>


                            </div>
                            <div id="TE_Scraper.click_max_button" class="classattr">
                                        <input id="TE_Scraper.click_max_button-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">click_max_button</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="TE_Scraper.click_max_button-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TE_Scraper.click_max_button"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TE_Scraper.click_max_button-153"><a href="#TE_Scraper.click_max_button-153"><span class="linenos">153</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">click_max_button</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="TE_Scraper.click_max_button-154"><a href="#TE_Scraper.click_max_button-154"><span class="linenos">154</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Click the button that selects the maximum date range on the chart. This is usually the &#39;MAX&#39; button and is used to select the maximum date range for the chart.</span>
</span><span id="TE_Scraper.click_max_button-155"><a href="#TE_Scraper.click_max_button-155"><span class="linenos">155</span></a><span class="sd">        The method will find the button and click it. It will also wait for the chart to update after clicking the button.&quot;&quot;&quot;</span>
</span><span id="TE_Scraper.click_max_button-156"><a href="#TE_Scraper.click_max_button-156"><span class="linenos">156</span></a>        <span class="n">max_selector</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_max_button</span><span class="p">()</span>
</span><span id="TE_Scraper.click_max_button-157"><a href="#TE_Scraper.click_max_button-157"><span class="linenos">157</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">click_button</span><span class="p">(</span><span class="n">max_selector</span><span class="p">):</span>
</span><span id="TE_Scraper.click_max_button-158"><a href="#TE_Scraper.click_max_button-158"><span class="linenos">158</span></a>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span id="TE_Scraper.click_max_button-159"><a href="#TE_Scraper.click_max_button-159"><span class="linenos">159</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;MAX button clicked successfully.&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.click_max_button-160"><a href="#TE_Scraper.click_max_button-160"><span class="linenos">160</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">date_span</span> <span class="o">=</span> <span class="s2">&quot;MAX&quot;</span>
</span><span id="TE_Scraper.click_max_button-161"><a href="#TE_Scraper.click_max_button-161"><span class="linenos">161</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">update_chart</span><span class="p">()</span>
</span><span id="TE_Scraper.click_max_button-162"><a href="#TE_Scraper.click_max_button-162"><span class="linenos">162</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="TE_Scraper.click_max_button-163"><a href="#TE_Scraper.click_max_button-163"><span class="linenos">163</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Error clicking MAX button.&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.click_max_button-164"><a href="#TE_Scraper.click_max_button-164"><span class="linenos">164</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span></pre></div>


            <div class="docstring"><p>Click the button that selects the maximum date range on the chart. This is usually the 'MAX' button and is used to select the maximum date range for the chart.
The method will find the button and click it. It will also wait for the chart to update after clicking the button.</p>
</div>


                            </div>
                            <div id="TE_Scraper.determine_date_span" class="classattr">
                                        <input id="TE_Scraper.determine_date_span-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">determine_date_span</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">update_chart</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="TE_Scraper.determine_date_span-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TE_Scraper.determine_date_span"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TE_Scraper.determine_date_span-166"><a href="#TE_Scraper.determine_date_span-166"><span class="linenos">166</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">determine_date_span</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">update_chart</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
</span><span id="TE_Scraper.determine_date_span-167"><a href="#TE_Scraper.determine_date_span-167"><span class="linenos">167</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Determine the selected date span from the Trading Economics chart currently displayed in webdriver.&quot;&quot;&quot;</span>
</span><span id="TE_Scraper.determine_date_span-168"><a href="#TE_Scraper.determine_date_span-168"><span class="linenos">168</span></a>    
</span><span id="TE_Scraper.determine_date_span-169"><a href="#TE_Scraper.determine_date_span-169"><span class="linenos">169</span></a>        <span class="k">if</span> <span class="n">update_chart</span><span class="p">:</span> 
</span><span id="TE_Scraper.determine_date_span-170"><a href="#TE_Scraper.determine_date_span-170"><span class="linenos">170</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">update_chart</span><span class="p">()</span>
</span><span id="TE_Scraper.determine_date_span-171"><a href="#TE_Scraper.determine_date_span-171"><span class="linenos">171</span></a>        <span class="c1">## Populate the date spans dictionary</span>
</span><span id="TE_Scraper.determine_date_span-172"><a href="#TE_Scraper.determine_date_span-172"><span class="linenos">172</span></a>        <span class="n">buts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_soup</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;#dateSpansDiv&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.determine_date_span-173"><a href="#TE_Scraper.determine_date_span-173"><span class="linenos">173</span></a>        <span class="n">datebut</span> <span class="o">=</span> <span class="n">buts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">buts</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="n">buts</span>
</span><span id="TE_Scraper.determine_date_span-174"><a href="#TE_Scraper.determine_date_span-174"><span class="linenos">174</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">date_spans</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
</span><span id="TE_Scraper.determine_date_span-175"><a href="#TE_Scraper.determine_date_span-175"><span class="linenos">175</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">child</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">datebut</span><span class="o">.</span><span class="n">children</span><span class="p">):</span>
</span><span id="TE_Scraper.determine_date_span-176"><a href="#TE_Scraper.determine_date_span-176"><span class="linenos">176</span></a>            <span class="n">selector</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;a.</span><span class="si">{</span><span class="n">child</span><span class="p">[</span><span class="s1">&#39;class&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nb">isinstance</span><span class="p">(</span><span class="n">child</span><span class="p">[</span><span class="s1">&#39;class&#39;</span><span class="p">],</span><span class="w"> </span><span class="nb">list</span><span class="p">)</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="n">child</span><span class="p">[</span><span class="s1">&#39;class&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">:nth-child(</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">)&quot;</span>
</span><span id="TE_Scraper.determine_date_span-177"><a href="#TE_Scraper.determine_date_span-177"><span class="linenos">177</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">date_spans</span><span class="p">[</span><span class="n">child</span><span class="o">.</span><span class="n">text</span><span class="p">]</span> <span class="o">=</span> <span class="n">selector</span>
</span><span id="TE_Scraper.determine_date_span-178"><a href="#TE_Scraper.determine_date_span-178"><span class="linenos">178</span></a>
</span><span id="TE_Scraper.determine_date_span-179"><a href="#TE_Scraper.determine_date_span-179"><span class="linenos">179</span></a>        <span class="c1">## Find the selected date span</span>
</span><span id="TE_Scraper.determine_date_span-180"><a href="#TE_Scraper.determine_date_span-180"><span class="linenos">180</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">buts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="TE_Scraper.determine_date_span-181"><a href="#TE_Scraper.determine_date_span-181"><span class="linenos">181</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="n">buts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">children</span>
</span><span id="TE_Scraper.determine_date_span-182"><a href="#TE_Scraper.determine_date_span-182"><span class="linenos">182</span></a>        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">buts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="TE_Scraper.determine_date_span-183"><a href="#TE_Scraper.determine_date_span-183"><span class="linenos">183</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Multiple date spans found&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.determine_date_span-184"><a href="#TE_Scraper.determine_date_span-184"><span class="linenos">184</span></a>            <span class="k">return</span> <span class="n">buts</span>
</span><span id="TE_Scraper.determine_date_span-185"><a href="#TE_Scraper.determine_date_span-185"><span class="linenos">185</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="TE_Scraper.determine_date_span-186"><a href="#TE_Scraper.determine_date_span-186"><span class="linenos">186</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No date spans found&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.determine_date_span-187"><a href="#TE_Scraper.determine_date_span-187"><span class="linenos">187</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="TE_Scraper.determine_date_span-188"><a href="#TE_Scraper.determine_date_span-188"><span class="linenos">188</span></a>
</span><span id="TE_Scraper.determine_date_span-189"><a href="#TE_Scraper.determine_date_span-189"><span class="linenos">189</span></a>        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
</span><span id="TE_Scraper.determine_date_span-190"><a href="#TE_Scraper.determine_date_span-190"><span class="linenos">190</span></a>            <span class="c1">#print(&quot;Date span element: &quot;, r)</span>
</span><span id="TE_Scraper.determine_date_span-191"><a href="#TE_Scraper.determine_date_span-191"><span class="linenos">191</span></a>            <span class="k">if</span> <span class="s2">&quot;selected&quot;</span> <span class="ow">in</span> <span class="n">r</span><span class="p">[</span><span class="s2">&quot;class&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">r</span><span class="o">.</span><span class="n">text</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">date_spans</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
</span><span id="TE_Scraper.determine_date_span-192"><a href="#TE_Scraper.determine_date_span-192"><span class="linenos">192</span></a>                <span class="n">date_span</span> <span class="o">=</span> <span class="p">{</span><span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">:</span> <span class="n">r</span><span class="p">}</span>
</span><span id="TE_Scraper.determine_date_span-193"><a href="#TE_Scraper.determine_date_span-193"><span class="linenos">193</span></a>                <span class="k">return</span> <span class="n">date_span</span>
</span><span id="TE_Scraper.determine_date_span-194"><a href="#TE_Scraper.determine_date_span-194"><span class="linenos">194</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="TE_Scraper.determine_date_span-195"><a href="#TE_Scraper.determine_date_span-195"><span class="linenos">195</span></a>                <span class="c1"># No button has been slected already in this case.</span>
</span><span id="TE_Scraper.determine_date_span-196"><a href="#TE_Scraper.determine_date_span-196"><span class="linenos">196</span></a>                <span class="n">shortest_span</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">date_spans</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="TE_Scraper.determine_date_span-197"><a href="#TE_Scraper.determine_date_span-197"><span class="linenos">197</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">set_date_span</span><span class="p">(</span><span class="n">shortest_span</span><span class="p">)</span>
</span><span id="TE_Scraper.determine_date_span-198"><a href="#TE_Scraper.determine_date_span-198"><span class="linenos">198</span></a>                <span class="k">return</span> <span class="n">shortest_span</span>
</span></pre></div>


            <div class="docstring"><p>Determine the selected date span from the Trading Economics chart currently displayed in webdriver.</p>
</div>


                            </div>
                            <div id="TE_Scraper.update_chart" class="classattr">
                                        <input id="TE_Scraper.update_chart-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">update_chart</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="TE_Scraper.update_chart-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TE_Scraper.update_chart"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TE_Scraper.update_chart-200"><a href="#TE_Scraper.update_chart-200"><span class="linenos">200</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">update_chart</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="TE_Scraper.update_chart-201"><a href="#TE_Scraper.update_chart-201"><span class="linenos">201</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Update the chart attributes after loading a new page or clicking a button. This will check the page source and update the </span>
</span><span id="TE_Scraper.update_chart-202"><a href="#TE_Scraper.update_chart-202"><span class="linenos">202</span></a><span class="sd">        beautiful soup objects such as chart_soup, from which most other methods derive their functionality. It will also update the full_chart attribute</span>
</span><span id="TE_Scraper.update_chart-203"><a href="#TE_Scraper.update_chart-203"><span class="linenos">203</span></a><span class="sd">        which is the full HTML of the chart element on the page. This method should be run after changing something on the webpage via driver such</span>
</span><span id="TE_Scraper.update_chart-204"><a href="#TE_Scraper.update_chart-204"><span class="linenos">204</span></a><span class="sd">        as clicking a button to change the date span or chart type.&quot;&quot;&quot;</span>
</span><span id="TE_Scraper.update_chart-205"><a href="#TE_Scraper.update_chart-205"><span class="linenos">205</span></a>
</span><span id="TE_Scraper.update_chart-206"><a href="#TE_Scraper.update_chart-206"><span class="linenos">206</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="TE_Scraper.update_chart-207"><a href="#TE_Scraper.update_chart-207"><span class="linenos">207</span></a>            <span class="c1"># Since we inherit from SharedWebDriverState, we can directly set the page_source property</span>
</span><span id="TE_Scraper.update_chart-208"><a href="#TE_Scraper.update_chart-208"><span class="linenos">208</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">page_source</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">page_source</span>
</span><span id="TE_Scraper.update_chart-209"><a href="#TE_Scraper.update_chart-209"><span class="linenos">209</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="TE_Scraper.update_chart-210"><a href="#TE_Scraper.update_chart-210"><span class="linenos">210</span></a>
</span><span id="TE_Scraper.update_chart-211"><a href="#TE_Scraper.update_chart-211"><span class="linenos">211</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="TE_Scraper.update_chart-212"><a href="#TE_Scraper.update_chart-212"><span class="linenos">212</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to update chart: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.update_chart-213"><a href="#TE_Scraper.update_chart-213"><span class="linenos">213</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span></pre></div>


            <div class="docstring"><p>Update the chart attributes after loading a new page or clicking a button. This will check the page source and update the 
beautiful soup objects such as chart_soup, from which most other methods derive their functionality. It will also update the full_chart attribute
which is the full HTML of the chart element on the page. This method should be run after changing something on the webpage via driver such
as clicking a button to change the date span or chart type.</p>
</div>


                            </div>
                            <div id="TE_Scraper.set_date_span" class="classattr">
                                        <input id="TE_Scraper.set_date_span-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_date_span</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">date_span</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="TE_Scraper.set_date_span-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TE_Scraper.set_date_span"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TE_Scraper.set_date_span-215"><a href="#TE_Scraper.set_date_span-215"><span class="linenos">215</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_date_span</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">date_span</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="TE_Scraper.set_date_span-216"><a href="#TE_Scraper.set_date_span-216"><span class="linenos">216</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the date span on the Trading Economics chart. This is done by clicking the date span button on the chart. The date span is a button on the chart</span>
</span><span id="TE_Scraper.set_date_span-217"><a href="#TE_Scraper.set_date_span-217"><span class="linenos">217</span></a><span class="sd">        that allows you to change the date range of the chart. This method will click the button for the date span specified in the date_span parameter.</span>
</span><span id="TE_Scraper.set_date_span-218"><a href="#TE_Scraper.set_date_span-218"><span class="linenos">218</span></a><span class="sd">        The date_span parameter should be a string that matches one of the date span buttons on the chart. The method will also update the date_span attribute</span>
</span><span id="TE_Scraper.set_date_span-219"><a href="#TE_Scraper.set_date_span-219"><span class="linenos">219</span></a><span class="sd">        of the class to reflect the new date span.&quot;&quot;&quot;</span>
</span><span id="TE_Scraper.set_date_span-220"><a href="#TE_Scraper.set_date_span-220"><span class="linenos">220</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;date_spans&quot;</span><span class="p">):</span>
</span><span id="TE_Scraper.set_date_span-221"><a href="#TE_Scraper.set_date_span-221"><span class="linenos">221</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">determine_date_span</span><span class="p">()</span>
</span><span id="TE_Scraper.set_date_span-222"><a href="#TE_Scraper.set_date_span-222"><span class="linenos">222</span></a>        <span class="k">if</span> <span class="n">date_span</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">date_spans</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="TE_Scraper.set_date_span-223"><a href="#TE_Scraper.set_date_span-223"><span class="linenos">223</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">click_button</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">date_spans</span><span class="p">[</span><span class="n">date_span</span><span class="p">]):</span>
</span><span id="TE_Scraper.set_date_span-224"><a href="#TE_Scraper.set_date_span-224"><span class="linenos">224</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">date_span</span> <span class="o">=</span> <span class="n">date_span</span>
</span><span id="TE_Scraper.set_date_span-225"><a href="#TE_Scraper.set_date_span-225"><span class="linenos">225</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Date span set to: </span><span class="si">{</span><span class="n">date_span</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.set_date_span-226"><a href="#TE_Scraper.set_date_span-226"><span class="linenos">226</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">update_chart</span><span class="p">()</span>
</span><span id="TE_Scraper.set_date_span-227"><a href="#TE_Scraper.set_date_span-227"><span class="linenos">227</span></a>                <span class="k">return</span> <span class="kc">True</span>
</span><span id="TE_Scraper.set_date_span-228"><a href="#TE_Scraper.set_date_span-228"><span class="linenos">228</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="TE_Scraper.set_date_span-229"><a href="#TE_Scraper.set_date_span-229"><span class="linenos">229</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error setting date span: </span><span class="si">{</span><span class="n">date_span</span><span class="si">}</span><span class="s2">, check that the date span button is clickable.&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.set_date_span-230"><a href="#TE_Scraper.set_date_span-230"><span class="linenos">230</span></a>                <span class="k">return</span> <span class="kc">False</span>
</span><span id="TE_Scraper.set_date_span-231"><a href="#TE_Scraper.set_date_span-231"><span class="linenos">231</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="TE_Scraper.set_date_span-232"><a href="#TE_Scraper.set_date_span-232"><span class="linenos">232</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error setting date span: </span><span class="si">{</span><span class="n">date_span</span><span class="si">}</span><span class="s2">, check that the supplied date span matches one of the keys in the self.date_spans attribute (dict).&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.set_date_span-233"><a href="#TE_Scraper.set_date_span-233"><span class="linenos">233</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span></pre></div>


            <div class="docstring"><p>Set the date span on the Trading Economics chart. This is done by clicking the date span button on the chart. The date span is a button on the chart
that allows you to change the date range of the chart. This method will click the button for the date span specified in the date_span parameter.
The date_span parameter should be a string that matches one of the date span buttons on the chart. The method will also update the date_span attribute
of the class to reflect the new date span.</p>
</div>


                            </div>
                            <div id="TE_Scraper.set_max_date_span_viaCalendar" class="classattr">
                                        <input id="TE_Scraper.set_max_date_span_viaCalendar-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_max_date_span_viaCalendar</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="TE_Scraper.set_max_date_span_viaCalendar-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TE_Scraper.set_max_date_span_viaCalendar"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TE_Scraper.set_max_date_span_viaCalendar-235"><a href="#TE_Scraper.set_max_date_span_viaCalendar-235"><span class="linenos">235</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_max_date_span_viaCalendar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="TE_Scraper.set_max_date_span_viaCalendar-236"><a href="#TE_Scraper.set_max_date_span_viaCalendar-236"><span class="linenos">236</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; Looks like Trading Economics have gone ahead and made the &quot;MAX&quot; button on charts a subscriber only feature. No problem, we can still set the max date range</span>
</span><span id="TE_Scraper.set_max_date_span_viaCalendar-237"><a href="#TE_Scraper.set_max_date_span_viaCalendar-237"><span class="linenos">237</span></a><span class="sd">        by using the calendar widget on the chart. This method will click the calendar button and then enter an arbitrary date far in the past as start date and the </span>
</span><span id="TE_Scraper.set_max_date_span_viaCalendar-238"><a href="#TE_Scraper.set_max_date_span_viaCalendar-238"><span class="linenos">238</span></a><span class="sd">        current date as the end date.&quot;&quot;&quot;</span>
</span><span id="TE_Scraper.set_max_date_span_viaCalendar-239"><a href="#TE_Scraper.set_max_date_span_viaCalendar-239"><span class="linenos">239</span></a>
</span><span id="TE_Scraper.set_max_date_span_viaCalendar-240"><a href="#TE_Scraper.set_max_date_span_viaCalendar-240"><span class="linenos">240</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">custom_date_span_js</span><span class="p">(</span><span class="n">start_date</span><span class="o">=</span><span class="s2">&quot;1850-01-01&quot;</span><span class="p">,</span> <span class="n">end_date</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">))</span>
</span><span id="TE_Scraper.set_max_date_span_viaCalendar-241"><a href="#TE_Scraper.set_max_date_span_viaCalendar-241"><span class="linenos">241</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">date_span</span> <span class="o">=</span> <span class="s2">&quot;MAX&quot;</span>
</span></pre></div>


            <div class="docstring"><p>Looks like Trading Economics have gone ahead and made the "MAX" button on charts a subscriber only feature. No problem, we can still set the max date range
by using the calendar widget on the chart. This method will click the calendar button and then enter an arbitrary date far in the past as start date and the 
current date as the end date.</p>
</div>


                            </div>
                            <div id="TE_Scraper.update_date_span" class="classattr">
                                        <input id="TE_Scraper.update_date_span-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">update_date_span</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">update_chart</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="TE_Scraper.update_date_span-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TE_Scraper.update_date_span"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TE_Scraper.update_date_span-243"><a href="#TE_Scraper.update_date_span-243"><span class="linenos">243</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">update_date_span</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">update_chart</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="TE_Scraper.update_date_span-244"><a href="#TE_Scraper.update_date_span-244"><span class="linenos">244</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Update the date span after clicking a button. This will check the page source and update the date span attribute.</span>
</span><span id="TE_Scraper.update_date_span-245"><a href="#TE_Scraper.update_date_span-245"><span class="linenos">245</span></a><span class="sd">        This method can be used t check that the curret date span is correct after clicking a button to change it. </span>
</span><span id="TE_Scraper.update_date_span-246"><a href="#TE_Scraper.update_date_span-246"><span class="linenos">246</span></a><span class="sd">        It will update the date_span attribute. It is not necessary after running set_date_span though as that method already updates the date span attribute.</span>
</span><span id="TE_Scraper.update_date_span-247"><a href="#TE_Scraper.update_date_span-247"><span class="linenos">247</span></a>
</span><span id="TE_Scraper.update_date_span-248"><a href="#TE_Scraper.update_date_span-248"><span class="linenos">248</span></a><span class="sd">        **Parameters:**</span>
</span><span id="TE_Scraper.update_date_span-249"><a href="#TE_Scraper.update_date_span-249"><span class="linenos">249</span></a><span class="sd">        - update_chart (bool): Whether to update the chart before determining the date span. Default is False.</span>
</span><span id="TE_Scraper.update_date_span-250"><a href="#TE_Scraper.update_date_span-250"><span class="linenos">250</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TE_Scraper.update_date_span-251"><a href="#TE_Scraper.update_date_span-251"><span class="linenos">251</span></a>
</span><span id="TE_Scraper.update_date_span-252"><a href="#TE_Scraper.update_date_span-252"><span class="linenos">252</span></a>        <span class="k">if</span> <span class="n">update_chart</span><span class="p">:</span>
</span><span id="TE_Scraper.update_date_span-253"><a href="#TE_Scraper.update_date_span-253"><span class="linenos">253</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">update_chart</span><span class="p">()</span>
</span><span id="TE_Scraper.update_date_span-254"><a href="#TE_Scraper.update_date_span-254"><span class="linenos">254</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">date_span_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">determine_date_span</span><span class="p">()</span>
</span><span id="TE_Scraper.update_date_span-255"><a href="#TE_Scraper.update_date_span-255"><span class="linenos">255</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">date_span</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">date_spans</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Update the date span after clicking a button. This will check the page source and update the date span attribute.
This method can be used t check that the curret date span is correct after clicking a button to change it. 
It will update the date_span attribute. It is not necessary after running set_date_span though as that method already updates the date span attribute.</p>

<p><strong>Parameters:</strong></p>

<ul>
<li>update_chart (bool): Whether to update the chart before determining the date span. Default is False.</li>
</ul>
</div>


                            </div>
                            <div id="TE_Scraper.create_chart_types_dict" class="classattr">
                                        <input id="TE_Scraper.create_chart_types_dict-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">create_chart_types_dict</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="TE_Scraper.create_chart_types_dict-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TE_Scraper.create_chart_types_dict"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TE_Scraper.create_chart_types_dict-257"><a href="#TE_Scraper.create_chart_types_dict-257"><span class="linenos">257</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_chart_types_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="TE_Scraper.create_chart_types_dict-258"><a href="#TE_Scraper.create_chart_types_dict-258"><span class="linenos">258</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a dictionary of chart types and their CSS selectors. This is used to select the chart type on the Trading Economics chart.</span>
</span><span id="TE_Scraper.create_chart_types_dict-259"><a href="#TE_Scraper.create_chart_types_dict-259"><span class="linenos">259</span></a><span class="sd">        The dictionary is stored in the chart_types attribute of the class. The keys are the names of the chart types and the values are the CSS selectors</span>
</span><span id="TE_Scraper.create_chart_types_dict-260"><a href="#TE_Scraper.create_chart_types_dict-260"><span class="linenos">260</span></a><span class="sd">        for the chart type buttons on the chart.&quot;&quot;&quot;</span>
</span><span id="TE_Scraper.create_chart_types_dict-261"><a href="#TE_Scraper.create_chart_types_dict-261"><span class="linenos">261</span></a>
</span><span id="TE_Scraper.create_chart_types_dict-262"><a href="#TE_Scraper.create_chart_types_dict-262"><span class="linenos">262</span></a>        <span class="n">hart_types</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_soup</span><span class="o">.</span><span class="n">select_one</span><span class="p">(</span><span class="s2">&quot;.chartTypesWrapper&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.create_chart_types_dict-263"><a href="#TE_Scraper.create_chart_types_dict-263"><span class="linenos">263</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">chart_types</span> <span class="o">=</span> <span class="p">{</span><span class="n">child</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">]:</span> <span class="s2">&quot;.&quot;</span><span class="o">+</span><span class="n">child</span><span class="p">[</span><span class="s2">&quot;class&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot; .&quot;</span><span class="o">+</span> <span class="n">child</span><span class="o">.</span><span class="n">button</span><span class="p">[</span><span class="s2">&quot;class&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">hart_types</span><span class="o">.</span><span class="n">children</span><span class="p">}</span>
</span><span id="TE_Scraper.create_chart_types_dict-264"><a href="#TE_Scraper.create_chart_types_dict-264"><span class="linenos">264</span></a>        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_types</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="TE_Scraper.create_chart_types_dict-265"><a href="#TE_Scraper.create_chart_types_dict-265"><span class="linenos">265</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">chart_types</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="TE_Scraper.create_chart_types_dict-266"><a href="#TE_Scraper.create_chart_types_dict-266"><span class="linenos">266</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Chart types dictionary created successfully: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">chart_types</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.create_chart_types_dict-267"><a href="#TE_Scraper.create_chart_types_dict-267"><span class="linenos">267</span></a>        <span class="k">return</span> <span class="kc">True</span>
</span></pre></div>


            <div class="docstring"><p>Create a dictionary of chart types and their CSS selectors. This is used to select the chart type on the Trading Economics chart.
The dictionary is stored in the chart_types attribute of the class. The keys are the names of the chart types and the values are the CSS selectors
for the chart type buttons on the chart.</p>
</div>


                            </div>
                            <div id="TE_Scraper.select_chart_type" class="classattr">
                                        <input id="TE_Scraper.select_chart_type-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">select_chart_type</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">chart_type</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="TE_Scraper.select_chart_type-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TE_Scraper.select_chart_type"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TE_Scraper.select_chart_type-269"><a href="#TE_Scraper.select_chart_type-269"><span class="linenos">269</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">select_chart_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chart_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="TE_Scraper.select_chart_type-270"><a href="#TE_Scraper.select_chart_type-270"><span class="linenos">270</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Select a chart type on the Trading Economics chart. This is done by clicking the chart type button and then selecting the specified chart type.</span>
</span><span id="TE_Scraper.select_chart_type-271"><a href="#TE_Scraper.select_chart_type-271"><span class="linenos">271</span></a><span class="sd">        The chart type should be a string that matches one of the chart types in the chart_types dictionary. The method will click the chart type button</span>
</span><span id="TE_Scraper.select_chart_type-272"><a href="#TE_Scraper.select_chart_type-272"><span class="linenos">272</span></a><span class="sd">        and then select the specified chart type. It will also update the chart_type attribute of the class to reflect the new chart type.</span>
</span><span id="TE_Scraper.select_chart_type-273"><a href="#TE_Scraper.select_chart_type-273"><span class="linenos">273</span></a>
</span><span id="TE_Scraper.select_chart_type-274"><a href="#TE_Scraper.select_chart_type-274"><span class="linenos">274</span></a><span class="sd">        **Parameters:**</span>
</span><span id="TE_Scraper.select_chart_type-275"><a href="#TE_Scraper.select_chart_type-275"><span class="linenos">275</span></a><span class="sd">        - chart_type (str): The chart type to select on the chart. This must be one of the keys of the chart_types dictionary attribute of the class.</span>
</span><span id="TE_Scraper.select_chart_type-276"><a href="#TE_Scraper.select_chart_type-276"><span class="linenos">276</span></a><span class="sd">        List the options by printing self.chart_types.keys()</span>
</span><span id="TE_Scraper.select_chart_type-277"><a href="#TE_Scraper.select_chart_type-277"><span class="linenos">277</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TE_Scraper.select_chart_type-278"><a href="#TE_Scraper.select_chart_type-278"><span class="linenos">278</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;chart_types&quot;</span><span class="p">):</span>
</span><span id="TE_Scraper.select_chart_type-279"><a href="#TE_Scraper.select_chart_type-279"><span class="linenos">279</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">create_chart_types_dict</span><span class="p">()</span>
</span><span id="TE_Scraper.select_chart_type-280"><a href="#TE_Scraper.select_chart_type-280"><span class="linenos">280</span></a>        
</span><span id="TE_Scraper.select_chart_type-281"><a href="#TE_Scraper.select_chart_type-281"><span class="linenos">281</span></a>        <span class="n">selector</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;#chart.chart_module.chart1.undertaker-section div.chart_preview.undertaker_chart.logic-new-charts-no div.hawk-totalWrapper div.hawk-header</span><span class="se">\</span>
</span><span id="TE_Scraper.select_chart_type-282"><a href="#TE_Scraper.select_chart_type-282"><span class="linenos">282</span></a><span class="s2">          div.topnav-flex-container div.pickChartTypes div.PREselectedChartType div.chartTypesWrapper.dropDownStyle div</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">chart_types</span><span class="p">[</span><span class="n">chart_type</span><span class="p">]</span><span class="si">}</span><span class="s2"> button.dkLabels-label-btn&quot;</span>
</span><span id="TE_Scraper.select_chart_type-283"><a href="#TE_Scraper.select_chart_type-283"><span class="linenos">283</span></a>        
</span><span id="TE_Scraper.select_chart_type-284"><a href="#TE_Scraper.select_chart_type-284"><span class="linenos">284</span></a>        <span class="k">if</span> <span class="n">chart_type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_types</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="TE_Scraper.select_chart_type-285"><a href="#TE_Scraper.select_chart_type-285"><span class="linenos">285</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">click_button</span><span class="p">(</span><span class="s2">&quot;#chart &gt; div &gt; div &gt; div.hawk-header &gt; div &gt; div.pickChartTypes &gt; div &gt; button&quot;</span><span class="p">):</span>
</span><span id="TE_Scraper.select_chart_type-286"><a href="#TE_Scraper.select_chart_type-286"><span class="linenos">286</span></a>                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">1.5</span><span class="p">)</span>
</span><span id="TE_Scraper.select_chart_type-287"><a href="#TE_Scraper.select_chart_type-287"><span class="linenos">287</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">click_button</span><span class="p">(</span><span class="n">selector</span><span class="p">):</span>
</span><span id="TE_Scraper.select_chart_type-288"><a href="#TE_Scraper.select_chart_type-288"><span class="linenos">288</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_types</span><span class="p">[</span><span class="n">chart_type</span><span class="p">]</span>
</span><span id="TE_Scraper.select_chart_type-289"><a href="#TE_Scraper.select_chart_type-289"><span class="linenos">289</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Chart type set to: </span><span class="si">{</span><span class="n">chart_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.select_chart_type-290"><a href="#TE_Scraper.select_chart_type-290"><span class="linenos">290</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">update_chart</span><span class="p">()</span>
</span><span id="TE_Scraper.select_chart_type-291"><a href="#TE_Scraper.select_chart_type-291"><span class="linenos">291</span></a>                    <span class="k">return</span> <span class="kc">True</span>
</span><span id="TE_Scraper.select_chart_type-292"><a href="#TE_Scraper.select_chart_type-292"><span class="linenos">292</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="TE_Scraper.select_chart_type-293"><a href="#TE_Scraper.select_chart_type-293"><span class="linenos">293</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error selecting chart type: </span><span class="si">{</span><span class="n">chart_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.select_chart_type-294"><a href="#TE_Scraper.select_chart_type-294"><span class="linenos">294</span></a>                    <span class="k">return</span> <span class="kc">False</span>
</span><span id="TE_Scraper.select_chart_type-295"><a href="#TE_Scraper.select_chart_type-295"><span class="linenos">295</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="TE_Scraper.select_chart_type-296"><a href="#TE_Scraper.select_chart_type-296"><span class="linenos">296</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error selecting chart type: </span><span class="si">{</span><span class="n">chart_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.select_chart_type-297"><a href="#TE_Scraper.select_chart_type-297"><span class="linenos">297</span></a>                <span class="k">return</span> <span class="kc">False</span>
</span><span id="TE_Scraper.select_chart_type-298"><a href="#TE_Scraper.select_chart_type-298"><span class="linenos">298</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="TE_Scraper.select_chart_type-299"><a href="#TE_Scraper.select_chart_type-299"><span class="linenos">299</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Chart type not found: </span><span class="si">{</span><span class="n">chart_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.select_chart_type-300"><a href="#TE_Scraper.select_chart_type-300"><span class="linenos">300</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span></pre></div>


            <div class="docstring"><p>Select a chart type on the Trading Economics chart. This is done by clicking the chart type button and then selecting the specified chart type.
The chart type should be a string that matches one of the chart types in the chart_types dictionary. The method will click the chart type button
and then select the specified chart type. It will also update the chart_type attribute of the class to reflect the new chart type.</p>

<p><strong>Parameters:</strong></p>

<ul>
<li>chart_type (str): The chart type to select on the chart. This must be one of the keys of the chart_types dictionary attribute of the class.
List the options by printing self.chart_types.keys()</li>
</ul>
</div>


                            </div>
                            <div id="TE_Scraper.set_chartType_js" class="classattr">
                                        <input id="TE_Scraper.set_chartType_js-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_chartType_js</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">chart_type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;Column&#39;</span><span class="p">,</span> <span class="s1">&#39;Spline&#39;</span><span class="p">,</span> <span class="s1">&#39;Areaspline&#39;</span><span class="p">,</span> <span class="s1">&#39;Stepline&#39;</span><span class="p">,</span> <span class="s1">&#39;Line&#39;</span><span class="p">,</span> <span class="s1">&#39;Area&#39;</span><span class="p">]</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="TE_Scraper.set_chartType_js-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TE_Scraper.set_chartType_js"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TE_Scraper.set_chartType_js-310"><a href="#TE_Scraper.set_chartType_js-310"><span class="linenos">310</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_chartType_js</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chart_type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;Column&#39;</span><span class="p">,</span> <span class="s1">&#39;Spline&#39;</span><span class="p">,</span> <span class="s1">&#39;Areaspline&#39;</span><span class="p">,</span> <span class="s1">&#39;Stepline&#39;</span><span class="p">,</span> <span class="s1">&#39;Line&#39;</span><span class="p">,</span> <span class="s1">&#39;Area&#39;</span><span class="p">]):</span>
</span><span id="TE_Scraper.set_chartType_js-311"><a href="#TE_Scraper.set_chartType_js-311"><span class="linenos">311</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the chart type using javascript. This is a more robust method of setting the chart type than using the click_button method.</span>
</span><span id="TE_Scraper.set_chartType_js-312"><a href="#TE_Scraper.set_chartType_js-312"><span class="linenos">312</span></a><span class="sd">        The click_button method can sometimes fail to click the chart type button. This method will set the chart type using javascript and will</span>
</span><span id="TE_Scraper.set_chartType_js-313"><a href="#TE_Scraper.set_chartType_js-313"><span class="linenos">313</span></a><span class="sd">        update the chart_type attribute of the class to reflect the new chart type.</span>
</span><span id="TE_Scraper.set_chartType_js-314"><a href="#TE_Scraper.set_chartType_js-314"><span class="linenos">314</span></a>
</span><span id="TE_Scraper.set_chartType_js-315"><a href="#TE_Scraper.set_chartType_js-315"><span class="linenos">315</span></a><span class="sd">        **Parameters:**</span>
</span><span id="TE_Scraper.set_chartType_js-316"><a href="#TE_Scraper.set_chartType_js-316"><span class="linenos">316</span></a><span class="sd">        - chart_type (Literal): The chart type to set. This should be one of the keys of the chart_types dictionary attribute of the class. The </span>
</span><span id="TE_Scraper.set_chartType_js-317"><a href="#TE_Scraper.set_chartType_js-317"><span class="linenos">317</span></a><span class="sd">        options are &#39;Column&#39;, &#39;Spline&#39;, &#39;Areaspline&#39;, &#39;Stepline&#39;, &#39;Line&#39;, &#39;Area&#39;.</span>
</span><span id="TE_Scraper.set_chartType_js-318"><a href="#TE_Scraper.set_chartType_js-318"><span class="linenos">318</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TE_Scraper.set_chartType_js-319"><a href="#TE_Scraper.set_chartType_js-319"><span class="linenos">319</span></a>        
</span><span id="TE_Scraper.set_chartType_js-320"><a href="#TE_Scraper.set_chartType_js-320"><span class="linenos">320</span></a>        <span class="n">success</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">execute_script</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="TE_Scraper.set_chartType_js-321"><a href="#TE_Scraper.set_chartType_js-321"><span class="linenos">321</span></a><span class="s2">                var chartType = &quot;</span><span class="si">{</span><span class="n">chart_type</span><span class="si">}</span><span class="s2">&quot;;</span>
</span><span id="TE_Scraper.set_chartType_js-322"><a href="#TE_Scraper.set_chartType_js-322"><span class="linenos">322</span></a><span class="s2">                var buttons = document.querySelectorAll(&#39;.chartTypesWrapper button&#39;);</span>
</span><span id="TE_Scraper.set_chartType_js-323"><a href="#TE_Scraper.set_chartType_js-323"><span class="linenos">323</span></a><span class="s2">                for (var i = 0; i &lt; buttons.length; i++) </span><span class="se">{{</span>
</span><span id="TE_Scraper.set_chartType_js-324"><a href="#TE_Scraper.set_chartType_js-324"><span class="linenos">324</span></a><span class="s2">                    if (buttons[i].textContent.trim() === chartType || </span>
</span><span id="TE_Scraper.set_chartType_js-325"><a href="#TE_Scraper.set_chartType_js-325"><span class="linenos">325</span></a><span class="s2">                        buttons[i].getAttribute(&#39;title&#39;) === chartType ||</span>
</span><span id="TE_Scraper.set_chartType_js-326"><a href="#TE_Scraper.set_chartType_js-326"><span class="linenos">326</span></a><span class="s2">                        buttons[i].parentElement.getAttribute(&#39;title&#39;) === chartType) </span><span class="se">{{</span>
</span><span id="TE_Scraper.set_chartType_js-327"><a href="#TE_Scraper.set_chartType_js-327"><span class="linenos">327</span></a><span class="s2">                        buttons[i].click();</span>
</span><span id="TE_Scraper.set_chartType_js-328"><a href="#TE_Scraper.set_chartType_js-328"><span class="linenos">328</span></a><span class="s2">                        return true;</span>
</span><span id="TE_Scraper.set_chartType_js-329"><a href="#TE_Scraper.set_chartType_js-329"><span class="linenos">329</span></a><span class="s2">                    </span><span class="se">}}</span>
</span><span id="TE_Scraper.set_chartType_js-330"><a href="#TE_Scraper.set_chartType_js-330"><span class="linenos">330</span></a><span class="s2">                </span><span class="se">}}</span>
</span><span id="TE_Scraper.set_chartType_js-331"><a href="#TE_Scraper.set_chartType_js-331"><span class="linenos">331</span></a><span class="s2">                return false;</span>
</span><span id="TE_Scraper.set_chartType_js-332"><a href="#TE_Scraper.set_chartType_js-332"><span class="linenos">332</span></a><span class="s2">            &quot;&quot;&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.set_chartType_js-333"><a href="#TE_Scraper.set_chartType_js-333"><span class="linenos">333</span></a>            
</span><span id="TE_Scraper.set_chartType_js-334"><a href="#TE_Scraper.set_chartType_js-334"><span class="linenos">334</span></a>        <span class="k">if</span> <span class="n">success</span><span class="p">:</span>
</span><span id="TE_Scraper.set_chartType_js-335"><a href="#TE_Scraper.set_chartType_js-335"><span class="linenos">335</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_types</span><span class="p">[</span><span class="n">chart_type</span><span class="p">]</span>
</span><span id="TE_Scraper.set_chartType_js-336"><a href="#TE_Scraper.set_chartType_js-336"><span class="linenos">336</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Chart type set to: </span><span class="si">{</span><span class="n">chart_type</span><span class="si">}</span><span class="s2"> (using JavaScript)&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.set_chartType_js-337"><a href="#TE_Scraper.set_chartType_js-337"><span class="linenos">337</span></a>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
</span><span id="TE_Scraper.set_chartType_js-338"><a href="#TE_Scraper.set_chartType_js-338"><span class="linenos">338</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">update_chart</span><span class="p">()</span>
</span><span id="TE_Scraper.set_chartType_js-339"><a href="#TE_Scraper.set_chartType_js-339"><span class="linenos">339</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="TE_Scraper.set_chartType_js-340"><a href="#TE_Scraper.set_chartType_js-340"><span class="linenos">340</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="TE_Scraper.set_chartType_js-341"><a href="#TE_Scraper.set_chartType_js-341"><span class="linenos">341</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error setting chart type: </span><span class="si">{</span><span class="n">chart_type</span><span class="si">}</span><span class="s2"> (using JavaScript)&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.set_chartType_js-342"><a href="#TE_Scraper.set_chartType_js-342"><span class="linenos">342</span></a>            <span class="k">return</span> <span class="kc">False</span>   
</span></pre></div>


            <div class="docstring"><p>Set the chart type using javascript. This is a more robust method of setting the chart type than using the click_button method.
The click_button method can sometimes fail to click the chart type button. This method will set the chart type using javascript and will
update the chart_type attribute of the class to reflect the new chart type.</p>

<p><strong>Parameters:</strong></p>

<ul>
<li>chart_type (Literal): The chart type to set. This should be one of the keys of the chart_types dictionary attribute of the class. The 
options are 'Column', 'Spline', 'Areaspline', 'Stepline', 'Line', 'Area'.</li>
</ul>
</div>


                            </div>
                            <div id="TE_Scraper.get_element" class="classattr">
                                        <input id="TE_Scraper.get_element-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_element</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">selector</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;.highcharts-series path&#39;</span>,</span><span class="param">	<span class="n">selector_type</span><span class="o">=</span><span class="s1">&#39;css selector&#39;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="TE_Scraper.get_element-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TE_Scraper.get_element"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TE_Scraper.get_element-344"><a href="#TE_Scraper.get_element-344"><span class="linenos">344</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_element</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">selector</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;.highcharts-series path&quot;</span><span class="p">,</span> <span class="n">selector_type</span><span class="o">=</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">):</span>
</span><span id="TE_Scraper.get_element-345"><a href="#TE_Scraper.get_element-345"><span class="linenos">345</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Find element by selector. The data trace displayed on a Trading Economics chart is a PATH element in the SVG chart.</span>
</span><span id="TE_Scraper.get_element-346"><a href="#TE_Scraper.get_element-346"><span class="linenos">346</span></a><span class="sd">        This is selected using the CSS selector &quot;.highcharts-series path&quot; by default. The element is stored in the &#39;current_element&#39; attribute.</span>
</span><span id="TE_Scraper.get_element-347"><a href="#TE_Scraper.get_element-347"><span class="linenos">347</span></a><span class="sd">        It can be used to select other elements on the chart as well and assign that to current element attribute.</span>
</span><span id="TE_Scraper.get_element-348"><a href="#TE_Scraper.get_element-348"><span class="linenos">348</span></a><span class="sd">        </span>
</span><span id="TE_Scraper.get_element-349"><a href="#TE_Scraper.get_element-349"><span class="linenos">349</span></a><span class="sd">        **Parameters:**</span>
</span><span id="TE_Scraper.get_element-350"><a href="#TE_Scraper.get_element-350"><span class="linenos">350</span></a><span class="sd">        - selector (str): The CSS selector for the element to find.</span>
</span><span id="TE_Scraper.get_element-351"><a href="#TE_Scraper.get_element-351"><span class="linenos">351</span></a><span class="sd">        - selector_type (By): The type of selector to use, By.CSS_SELECTOR by default.</span>
</span><span id="TE_Scraper.get_element-352"><a href="#TE_Scraper.get_element-352"><span class="linenos">352</span></a>
</span><span id="TE_Scraper.get_element-353"><a href="#TE_Scraper.get_element-353"><span class="linenos">353</span></a><span class="sd">        **Returns:**</span>
</span><span id="TE_Scraper.get_element-354"><a href="#TE_Scraper.get_element-354"><span class="linenos">354</span></a><span class="sd">        - element: The found element or None if not found.</span>
</span><span id="TE_Scraper.get_element-355"><a href="#TE_Scraper.get_element-355"><span class="linenos">355</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TE_Scraper.get_element-356"><a href="#TE_Scraper.get_element-356"><span class="linenos">356</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="TE_Scraper.get_element-357"><a href="#TE_Scraper.get_element-357"><span class="linenos">357</span></a>            <span class="n">element</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wait</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
</span><span id="TE_Scraper.get_element-358"><a href="#TE_Scraper.get_element-358"><span class="linenos">358</span></a>                <span class="n">EC</span><span class="o">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">selector_type</span><span class="p">,</span> <span class="n">selector</span><span class="p">))</span>
</span><span id="TE_Scraper.get_element-359"><a href="#TE_Scraper.get_element-359"><span class="linenos">359</span></a>            <span class="p">)</span>
</span><span id="TE_Scraper.get_element-360"><a href="#TE_Scraper.get_element-360"><span class="linenos">360</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">current_element</span> <span class="o">=</span> <span class="n">element</span>
</span><span id="TE_Scraper.get_element-361"><a href="#TE_Scraper.get_element-361"><span class="linenos">361</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Element found and assigned to current_element attribute: </span><span class="si">{</span><span class="n">selector</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.get_element-362"><a href="#TE_Scraper.get_element-362"><span class="linenos">362</span></a>            <span class="k">return</span> <span class="n">element</span>
</span><span id="TE_Scraper.get_element-363"><a href="#TE_Scraper.get_element-363"><span class="linenos">363</span></a>        <span class="k">except</span> <span class="n">TimeoutException</span><span class="p">:</span>
</span><span id="TE_Scraper.get_element-364"><a href="#TE_Scraper.get_element-364"><span class="linenos">364</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Element not found: </span><span class="si">{</span><span class="n">selector</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.get_element-365"><a href="#TE_Scraper.get_element-365"><span class="linenos">365</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Element not found: </span><span class="si">{</span><span class="n">selector</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.get_element-366"><a href="#TE_Scraper.get_element-366"><span class="linenos">366</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="TE_Scraper.get_element-367"><a href="#TE_Scraper.get_element-367"><span class="linenos">367</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="TE_Scraper.get_element-368"><a href="#TE_Scraper.get_element-368"><span class="linenos">368</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error finding element: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.get_element-369"><a href="#TE_Scraper.get_element-369"><span class="linenos">369</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error finding element: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.get_element-370"><a href="#TE_Scraper.get_element-370"><span class="linenos">370</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span></pre></div>


            <div class="docstring"><p>Find element by selector. The data trace displayed on a Trading Economics chart is a PATH element in the SVG chart.
This is selected using the CSS selector ".highcharts-series path" by default. The element is stored in the 'current_element' attribute.
It can be used to select other elements on the chart as well and assign that to current element attribute.</p>

<p><strong>Parameters:</strong></p>

<ul>
<li>selector (str): The CSS selector for the element to find.</li>
<li>selector_type (By): The type of selector to use, By.CSS_SELECTOR by default.</li>
</ul>

<p><strong>Returns:</strong></p>

<ul>
<li>element: The found element or None if not found.</li>
</ul>
</div>


                            </div>
                            <div id="TE_Scraper.series_from_chart_soup" class="classattr">
                                        <input id="TE_Scraper.series_from_chart_soup-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">series_from_chart_soup</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">selector</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;.highcharts-graph&#39;</span>,</span><span class="param">	<span class="n">invert_the_series</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">set_max_datespan</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">local_run</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">use_chart_type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;Line&#39;</span><span class="p">,</span> <span class="s1">&#39;Spline&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Spline&#39;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="TE_Scraper.series_from_chart_soup-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TE_Scraper.series_from_chart_soup"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TE_Scraper.series_from_chart_soup-372"><a href="#TE_Scraper.series_from_chart_soup-372"><span class="linenos">372</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">series_from_chart_soup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">selector</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;.highcharts-graph&quot;</span><span class="p">,</span> 
</span><span id="TE_Scraper.series_from_chart_soup-373"><a href="#TE_Scraper.series_from_chart_soup-373"><span class="linenos">373</span></a>                               <span class="n">invert_the_series</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> 
</span><span id="TE_Scraper.series_from_chart_soup-374"><a href="#TE_Scraper.series_from_chart_soup-374"><span class="linenos">374</span></a>                               <span class="n">set_max_datespan</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="TE_Scraper.series_from_chart_soup-375"><a href="#TE_Scraper.series_from_chart_soup-375"><span class="linenos">375</span></a>                               <span class="n">local_run</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="TE_Scraper.series_from_chart_soup-376"><a href="#TE_Scraper.series_from_chart_soup-376"><span class="linenos">376</span></a>                               <span class="n">use_chart_type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;Line&quot;</span><span class="p">,</span> <span class="s2">&quot;Spline&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Spline&quot;</span><span class="p">):</span>  
</span><span id="TE_Scraper.series_from_chart_soup-377"><a href="#TE_Scraper.series_from_chart_soup-377"><span class="linenos">377</span></a><span class="w">          </span>
</span><span id="TE_Scraper.series_from_chart_soup-378"><a href="#TE_Scraper.series_from_chart_soup-378"><span class="linenos">378</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract series data from element text. This extracts the plotted series from the svg chart by taking the PATH </span>
</span><span id="TE_Scraper.series_from_chart_soup-379"><a href="#TE_Scraper.series_from_chart_soup-379"><span class="linenos">379</span></a><span class="sd">        element of the data tarace on the chart. Series values are pixel co-ordinates on the chart.</span>
</span><span id="TE_Scraper.series_from_chart_soup-380"><a href="#TE_Scraper.series_from_chart_soup-380"><span class="linenos">380</span></a>
</span><span id="TE_Scraper.series_from_chart_soup-381"><a href="#TE_Scraper.series_from_chart_soup-381"><span class="linenos">381</span></a><span class="sd">        **Parameters:**</span>
</span><span id="TE_Scraper.series_from_chart_soup-382"><a href="#TE_Scraper.series_from_chart_soup-382"><span class="linenos">382</span></a><span class="sd">        - invert_the_series (bool): Whether to invert the series values.</span>
</span><span id="TE_Scraper.series_from_chart_soup-383"><a href="#TE_Scraper.series_from_chart_soup-383"><span class="linenos">383</span></a><span class="sd">        - return_series (bool): whether or not to return the series at end. Series is assigned to self.series always.</span>
</span><span id="TE_Scraper.series_from_chart_soup-384"><a href="#TE_Scraper.series_from_chart_soup-384"><span class="linenos">384</span></a><span class="sd">        - set_max_datespan (bool): Whether to set the date span to MAX before extracting the series data. Default is False.</span>
</span><span id="TE_Scraper.series_from_chart_soup-385"><a href="#TE_Scraper.series_from_chart_soup-385"><span class="linenos">385</span></a><span class="sd">        - local_run (bool): Whether the method is being run to get the full date_span series or just extacting part of the series</span>
</span><span id="TE_Scraper.series_from_chart_soup-386"><a href="#TE_Scraper.series_from_chart_soup-386"><span class="linenos">386</span></a><span class="sd">        to then aggregate together the full series. Default is False.</span>
</span><span id="TE_Scraper.series_from_chart_soup-387"><a href="#TE_Scraper.series_from_chart_soup-387"><span class="linenos">387</span></a><span class="sd">        - use_chart_type (str): The chart type to use for the extraction of the series data. Default is &quot;Spline&quot;. This is used to set the chart type before extracting the series data.</span>
</span><span id="TE_Scraper.series_from_chart_soup-388"><a href="#TE_Scraper.series_from_chart_soup-388"><span class="linenos">388</span></a><span class="sd">        CUATION: This method may fail with certain types of charts. It is best to use Spline unless you have a reason to use another type.</span>
</span><span id="TE_Scraper.series_from_chart_soup-389"><a href="#TE_Scraper.series_from_chart_soup-389"><span class="linenos">389</span></a>
</span><span id="TE_Scraper.series_from_chart_soup-390"><a href="#TE_Scraper.series_from_chart_soup-390"><span class="linenos">390</span></a><span class="sd">        **Returns:**</span>
</span><span id="TE_Scraper.series_from_chart_soup-391"><a href="#TE_Scraper.series_from_chart_soup-391"><span class="linenos">391</span></a>
</span><span id="TE_Scraper.series_from_chart_soup-392"><a href="#TE_Scraper.series_from_chart_soup-392"><span class="linenos">392</span></a><span class="sd">        - series (pd.Series): The extracted series data that is the raw pixel co-ordinate values of the data trace on the svg chart.</span>
</span><span id="TE_Scraper.series_from_chart_soup-393"><a href="#TE_Scraper.series_from_chart_soup-393"><span class="linenos">393</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TE_Scraper.series_from_chart_soup-394"><a href="#TE_Scraper.series_from_chart_soup-394"><span class="linenos">394</span></a>
</span><span id="TE_Scraper.series_from_chart_soup-395"><a href="#TE_Scraper.series_from_chart_soup-395"><span class="linenos">395</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">update_chart</span><span class="p">()</span> <span class="c1"># Update chart..</span>
</span><span id="TE_Scraper.series_from_chart_soup-396"><a href="#TE_Scraper.series_from_chart_soup-396"><span class="linenos">396</span></a>
</span><span id="TE_Scraper.series_from_chart_soup-397"><a href="#TE_Scraper.series_from_chart_soup-397"><span class="linenos">397</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_types</span><span class="p">[</span><span class="n">use_chart_type</span><span class="p">]:</span>
</span><span id="TE_Scraper.series_from_chart_soup-398"><a href="#TE_Scraper.series_from_chart_soup-398"><span class="linenos">398</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">set_chartType_js</span><span class="p">(</span><span class="n">use_chart_type</span><span class="p">)</span> <span class="c1">## Use a certain chart type for the extraction of the series data. May fail with certain types of charts.</span>
</span><span id="TE_Scraper.series_from_chart_soup-399"><a href="#TE_Scraper.series_from_chart_soup-399"><span class="linenos">399</span></a>
</span><span id="TE_Scraper.series_from_chart_soup-400"><a href="#TE_Scraper.series_from_chart_soup-400"><span class="linenos">400</span></a>        <span class="k">if</span> <span class="n">set_max_datespan</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">date_span</span> <span class="o">!=</span> <span class="s2">&quot;MAX&quot;</span><span class="p">:</span>
</span><span id="TE_Scraper.series_from_chart_soup-401"><a href="#TE_Scraper.series_from_chart_soup-401"><span class="linenos">401</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">set_date_span</span><span class="p">(</span><span class="s2">&quot;MAX&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.series_from_chart_soup-402"><a href="#TE_Scraper.series_from_chart_soup-402"><span class="linenos">402</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Series path extraction method: Extracting series data from chart soup.&quot;</span><span class="p">)</span> 
</span><span id="TE_Scraper.series_from_chart_soup-403"><a href="#TE_Scraper.series_from_chart_soup-403"><span class="linenos">403</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Date span: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">date_span</span><span class="si">}</span><span class="s2">. Chart type: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span><span class="si">}</span><span class="s2">, URL: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">last_url</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.series_from_chart_soup-404"><a href="#TE_Scraper.series_from_chart_soup-404"><span class="linenos">404</span></a>    
</span><span id="TE_Scraper.series_from_chart_soup-405"><a href="#TE_Scraper.series_from_chart_soup-405"><span class="linenos">405</span></a>        <span class="n">datastrlist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_soup</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">selector</span><span class="p">)</span>
</span><span id="TE_Scraper.series_from_chart_soup-406"><a href="#TE_Scraper.series_from_chart_soup-406"><span class="linenos">406</span></a>        
</span><span id="TE_Scraper.series_from_chart_soup-407"><a href="#TE_Scraper.series_from_chart_soup-407"><span class="linenos">407</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">datastrlist</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="TE_Scraper.series_from_chart_soup-408"><a href="#TE_Scraper.series_from_chart_soup-408"><span class="linenos">408</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Multiple series found in the chart. Got to figure out which one to use... work to do here... This will not work yet, please report error.&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.series_from_chart_soup-409"><a href="#TE_Scraper.series_from_chart_soup-409"><span class="linenos">409</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Multiple series found in the chart. Got to figure out which one to use... work to do here...&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.series_from_chart_soup-410"><a href="#TE_Scraper.series_from_chart_soup-410"><span class="linenos">410</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="TE_Scraper.series_from_chart_soup-411"><a href="#TE_Scraper.series_from_chart_soup-411"><span class="linenos">411</span></a>            <span class="n">raw_series</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_soup</span><span class="o">.</span><span class="n">select_one</span><span class="p">(</span><span class="s2">&quot;.highcharts-graph&quot;</span><span class="p">)[</span><span class="s2">&quot;d&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.series_from_chart_soup-412"><a href="#TE_Scraper.series_from_chart_soup-412"><span class="linenos">412</span></a>    
</span><span id="TE_Scraper.series_from_chart_soup-413"><a href="#TE_Scraper.series_from_chart_soup-413"><span class="linenos">413</span></a>        <span class="n">ser</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">raw_series</span><span class="p">)</span>
</span><span id="TE_Scraper.series_from_chart_soup-414"><a href="#TE_Scraper.series_from_chart_soup-414"><span class="linenos">414</span></a>        <span class="n">ser_num</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">ser</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
</span><span id="TE_Scraper.series_from_chart_soup-415"><a href="#TE_Scraper.series_from_chart_soup-415"><span class="linenos">415</span></a>
</span><span id="TE_Scraper.series_from_chart_soup-416"><a href="#TE_Scraper.series_from_chart_soup-416"><span class="linenos">416</span></a>        <span class="n">exvals</span> <span class="o">=</span> <span class="n">ser_num</span><span class="p">[::</span><span class="mi">2</span><span class="p">];</span> <span class="n">yvals</span> <span class="o">=</span> <span class="n">ser_num</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
</span><span id="TE_Scraper.series_from_chart_soup-417"><a href="#TE_Scraper.series_from_chart_soup-417"><span class="linenos">417</span></a>        <span class="n">exvals</span> <span class="o">=</span> <span class="n">exvals</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
</span><span id="TE_Scraper.series_from_chart_soup-418"><a href="#TE_Scraper.series_from_chart_soup-418"><span class="linenos">418</span></a>        <span class="n">yvals</span> <span class="o">=</span> <span class="n">yvals</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
</span><span id="TE_Scraper.series_from_chart_soup-419"><a href="#TE_Scraper.series_from_chart_soup-419"><span class="linenos">419</span></a>        <span class="n">series</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">yvals</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="n">exvals</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Extracted Series&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.series_from_chart_soup-420"><a href="#TE_Scraper.series_from_chart_soup-420"><span class="linenos">420</span></a>
</span><span id="TE_Scraper.series_from_chart_soup-421"><a href="#TE_Scraper.series_from_chart_soup-421"><span class="linenos">421</span></a>        <span class="k">if</span> <span class="n">local_run</span><span class="p">:</span>
</span><span id="TE_Scraper.series_from_chart_soup-422"><a href="#TE_Scraper.series_from_chart_soup-422"><span class="linenos">422</span></a>            <span class="n">y_axis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_y_axis</span><span class="p">()</span>
</span><span id="TE_Scraper.series_from_chart_soup-423"><a href="#TE_Scraper.series_from_chart_soup-423"><span class="linenos">423</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="TE_Scraper.series_from_chart_soup-424"><a href="#TE_Scraper.series_from_chart_soup-424"><span class="linenos">424</span></a>            <span class="n">y_axis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_axis</span>
</span><span id="TE_Scraper.series_from_chart_soup-425"><a href="#TE_Scraper.series_from_chart_soup-425"><span class="linenos">425</span></a>
</span><span id="TE_Scraper.series_from_chart_soup-426"><a href="#TE_Scraper.series_from_chart_soup-426"><span class="linenos">426</span></a>        <span class="k">if</span> <span class="n">invert_the_series</span><span class="p">:</span>
</span><span id="TE_Scraper.series_from_chart_soup-427"><a href="#TE_Scraper.series_from_chart_soup-427"><span class="linenos">427</span></a>            <span class="n">series</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">invert_series</span><span class="p">(</span><span class="n">series</span><span class="p">,</span> <span class="n">max_val</span> <span class="o">=</span> <span class="n">y_axis</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
</span><span id="TE_Scraper.series_from_chart_soup-428"><a href="#TE_Scraper.series_from_chart_soup-428"><span class="linenos">428</span></a>        
</span><span id="TE_Scraper.series_from_chart_soup-429"><a href="#TE_Scraper.series_from_chart_soup-429"><span class="linenos">429</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">local_run</span><span class="p">:</span>
</span><span id="TE_Scraper.series_from_chart_soup-430"><a href="#TE_Scraper.series_from_chart_soup-430"><span class="linenos">430</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">trace_path_series_raw</span> <span class="o">=</span> <span class="n">series</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="TE_Scraper.series_from_chart_soup-431"><a href="#TE_Scraper.series_from_chart_soup-431"><span class="linenos">431</span></a>         <span class="c1"># Keep the raw pixel co-ordinate valued series extracted from the svg path element.</span>
</span><span id="TE_Scraper.series_from_chart_soup-432"><a href="#TE_Scraper.series_from_chart_soup-432"><span class="linenos">432</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Raw data series extracted successfully.&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.series_from_chart_soup-433"><a href="#TE_Scraper.series_from_chart_soup-433"><span class="linenos">433</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">series_extracted_from</span> <span class="o">=</span> <span class="n">use_chart_type</span>  <span class="c1">#Add this attribute so that the apply_x_index method knows which chart_type the series came from.</span>
</span><span id="TE_Scraper.series_from_chart_soup-434"><a href="#TE_Scraper.series_from_chart_soup-434"><span class="linenos">434</span></a>        
</span><span id="TE_Scraper.series_from_chart_soup-435"><a href="#TE_Scraper.series_from_chart_soup-435"><span class="linenos">435</span></a>        <span class="c1">#Add translate to the series to yield the proper y-values</span>
</span><span id="TE_Scraper.series_from_chart_soup-436"><a href="#TE_Scraper.series_from_chart_soup-436"><span class="linenos">436</span></a>        <span class="n">transform</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_soup</span><span class="o">.</span><span class="n">select_one</span><span class="p">(</span><span class="s2">&quot;.highcharts-graph&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="p">[</span><span class="s2">&quot;transform&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.series_from_chart_soup-437"><a href="#TE_Scraper.series_from_chart_soup-437"><span class="linenos">437</span></a>        <span class="n">translate</span> <span class="o">=</span> <span class="n">transform</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;translate(&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;)&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.series_from_chart_soup-438"><a href="#TE_Scraper.series_from_chart_soup-438"><span class="linenos">438</span></a>        <span class="n">translate</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">translate</span><span class="p">]</span>
</span><span id="TE_Scraper.series_from_chart_soup-439"><a href="#TE_Scraper.series_from_chart_soup-439"><span class="linenos">439</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">other_transforms</span> <span class="o">=</span> <span class="n">transform</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
</span><span id="TE_Scraper.series_from_chart_soup-440"><a href="#TE_Scraper.series_from_chart_soup-440"><span class="linenos">440</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">transform</span> <span class="o">=</span> <span class="n">translate</span>
</span><span id="TE_Scraper.series_from_chart_soup-441"><a href="#TE_Scraper.series_from_chart_soup-441"><span class="linenos">441</span></a>
</span><span id="TE_Scraper.series_from_chart_soup-442"><a href="#TE_Scraper.series_from_chart_soup-442"><span class="linenos">442</span></a>        <span class="n">series</span> <span class="o">=</span> <span class="n">series</span> <span class="o">+</span> <span class="n">translate</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="TE_Scraper.series_from_chart_soup-443"><a href="#TE_Scraper.series_from_chart_soup-443"><span class="linenos">443</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">series</span> <span class="o">=</span> <span class="n">series</span>
</span><span id="TE_Scraper.series_from_chart_soup-444"><a href="#TE_Scraper.series_from_chart_soup-444"><span class="linenos">444</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">raw_path_series</span> <span class="o">=</span> <span class="n">series</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="TE_Scraper.series_from_chart_soup-445"><a href="#TE_Scraper.series_from_chart_soup-445"><span class="linenos">445</span></a>        <span class="k">return</span> <span class="n">series</span>
</span></pre></div>


            <div class="docstring"><p>Extract series data from element text. This extracts the plotted series from the svg chart by taking the PATH 
element of the data tarace on the chart. Series values are pixel co-ordinates on the chart.</p>

<p><strong>Parameters:</strong></p>

<ul>
<li>invert_the_series (bool): Whether to invert the series values.</li>
<li>return_series (bool): whether or not to return the series at end. Series is assigned to self.series always.</li>
<li>set_max_datespan (bool): Whether to set the date span to MAX before extracting the series data. Default is False.</li>
<li>local_run (bool): Whether the method is being run to get the full date_span series or just extacting part of the series
to then aggregate together the full series. Default is False.</li>
<li>use_chart_type (str): The chart type to use for the extraction of the series data. Default is "Spline". This is used to set the chart type before extracting the series data.
CUATION: This method may fail with certain types of charts. It is best to use Spline unless you have a reason to use another type.</li>
</ul>

<p><strong>Returns:</strong></p>

<ul>
<li>series (pd.Series): The extracted series data that is the raw pixel co-ordinate values of the data trace on the svg chart.</li>
</ul>
</div>


                            </div>
                            <div id="TE_Scraper.custom_date_span" class="classattr">
                                        <input id="TE_Scraper.custom_date_span-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">custom_date_span</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">start_date</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;1900-01-01&#39;</span>,</span><span class="param">	<span class="n">end_date</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;2025-03-21&#39;</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="TE_Scraper.custom_date_span-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TE_Scraper.custom_date_span"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TE_Scraper.custom_date_span-447"><a href="#TE_Scraper.custom_date_span-447"><span class="linenos">447</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">custom_date_span</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_date</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;1900-01-01&quot;</span><span class="p">,</span> <span class="n">end_date</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">))</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="TE_Scraper.custom_date_span-448"><a href="#TE_Scraper.custom_date_span-448"><span class="linenos">448</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the date range on the active chart in the webdriver window. </span>
</span><span id="TE_Scraper.custom_date_span-449"><a href="#TE_Scraper.custom_date_span-449"><span class="linenos">449</span></a><span class="sd">        This is done by entering the start and end dates into the date range input boxes</span>
</span><span id="TE_Scraper.custom_date_span-450"><a href="#TE_Scraper.custom_date_span-450"><span class="linenos">450</span></a><span class="sd">        </span>
</span><span id="TE_Scraper.custom_date_span-451"><a href="#TE_Scraper.custom_date_span-451"><span class="linenos">451</span></a><span class="sd">        Args:</span>
</span><span id="TE_Scraper.custom_date_span-452"><a href="#TE_Scraper.custom_date_span-452"><span class="linenos">452</span></a><span class="sd">            start_date (str): Start date in format YYYY-MM-DD</span>
</span><span id="TE_Scraper.custom_date_span-453"><a href="#TE_Scraper.custom_date_span-453"><span class="linenos">453</span></a><span class="sd">            end_date (str): End date in format YYYY-MM-DD</span>
</span><span id="TE_Scraper.custom_date_span-454"><a href="#TE_Scraper.custom_date_span-454"><span class="linenos">454</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TE_Scraper.custom_date_span-455"><a href="#TE_Scraper.custom_date_span-455"><span class="linenos">455</span></a>
</span><span id="TE_Scraper.custom_date_span-456"><a href="#TE_Scraper.custom_date_span-456"><span class="linenos">456</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">click_button</span><span class="p">(</span><span class="s2">&quot;#dateInputsToggle&quot;</span><span class="p">):</span>
</span><span id="TE_Scraper.custom_date_span-457"><a href="#TE_Scraper.custom_date_span-457"><span class="linenos">457</span></a>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
</span><span id="TE_Scraper.custom_date_span-458"><a href="#TE_Scraper.custom_date_span-458"><span class="linenos">458</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="TE_Scraper.custom_date_span-459"><a href="#TE_Scraper.custom_date_span-459"><span class="linenos">459</span></a>                <span class="c1"># Find elements</span>
</span><span id="TE_Scraper.custom_date_span-460"><a href="#TE_Scraper.custom_date_span-460"><span class="linenos">460</span></a>                <span class="n">start_input</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wait</span><span class="o">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="o">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">ID</span><span class="p">,</span> <span class="s2">&quot;d1&quot;</span><span class="p">)))</span>
</span><span id="TE_Scraper.custom_date_span-461"><a href="#TE_Scraper.custom_date_span-461"><span class="linenos">461</span></a>                <span class="n">end_input</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wait</span><span class="o">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="o">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">ID</span><span class="p">,</span> <span class="s2">&quot;d2&quot;</span><span class="p">)))</span>
</span><span id="TE_Scraper.custom_date_span-462"><a href="#TE_Scraper.custom_date_span-462"><span class="linenos">462</span></a>                
</span><span id="TE_Scraper.custom_date_span-463"><a href="#TE_Scraper.custom_date_span-463"><span class="linenos">463</span></a>                <span class="c1"># Clear existing text</span>
</span><span id="TE_Scraper.custom_date_span-464"><a href="#TE_Scraper.custom_date_span-464"><span class="linenos">464</span></a>                <span class="n">start_input</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</span><span id="TE_Scraper.custom_date_span-465"><a href="#TE_Scraper.custom_date_span-465"><span class="linenos">465</span></a>                <span class="n">end_input</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</span><span id="TE_Scraper.custom_date_span-466"><a href="#TE_Scraper.custom_date_span-466"><span class="linenos">466</span></a>                
</span><span id="TE_Scraper.custom_date_span-467"><a href="#TE_Scraper.custom_date_span-467"><span class="linenos">467</span></a>                <span class="c1"># Enter new dates</span>
</span><span id="TE_Scraper.custom_date_span-468"><a href="#TE_Scraper.custom_date_span-468"><span class="linenos">468</span></a>                <span class="n">start_input</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">start_date</span><span class="p">)</span>
</span><span id="TE_Scraper.custom_date_span-469"><a href="#TE_Scraper.custom_date_span-469"><span class="linenos">469</span></a>                <span class="n">end_input</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">end_date</span><span class="p">)</span>
</span><span id="TE_Scraper.custom_date_span-470"><a href="#TE_Scraper.custom_date_span-470"><span class="linenos">470</span></a>                
</span><span id="TE_Scraper.custom_date_span-471"><a href="#TE_Scraper.custom_date_span-471"><span class="linenos">471</span></a>                <span class="c1"># Press Enter to confirm</span>
</span><span id="TE_Scraper.custom_date_span-472"><a href="#TE_Scraper.custom_date_span-472"><span class="linenos">472</span></a>                <span class="n">end_input</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">Keys</span><span class="o">.</span><span class="n">RETURN</span><span class="p">)</span>
</span><span id="TE_Scraper.custom_date_span-473"><a href="#TE_Scraper.custom_date_span-473"><span class="linenos">473</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">date_span</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Custom&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;start_date&quot;</span><span class="p">:</span> <span class="n">start_date</span><span class="p">,</span> <span class="s2">&quot;end_date&quot;</span><span class="p">:</span> <span class="n">end_date</span><span class="p">}}</span>
</span><span id="TE_Scraper.custom_date_span-474"><a href="#TE_Scraper.custom_date_span-474"><span class="linenos">474</span></a>                <span class="k">return</span> <span class="kc">True</span>
</span><span id="TE_Scraper.custom_date_span-475"><a href="#TE_Scraper.custom_date_span-475"><span class="linenos">475</span></a>                
</span><span id="TE_Scraper.custom_date_span-476"><a href="#TE_Scraper.custom_date_span-476"><span class="linenos">476</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="TE_Scraper.custom_date_span-477"><a href="#TE_Scraper.custom_date_span-477"><span class="linenos">477</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to enter dates: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.custom_date_span-478"><a href="#TE_Scraper.custom_date_span-478"><span class="linenos">478</span></a>                <span class="k">return</span> <span class="kc">False</span>
</span><span id="TE_Scraper.custom_date_span-479"><a href="#TE_Scraper.custom_date_span-479"><span class="linenos">479</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="TE_Scraper.custom_date_span-480"><a href="#TE_Scraper.custom_date_span-480"><span class="linenos">480</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Failed to open date range inputs&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.custom_date_span-481"><a href="#TE_Scraper.custom_date_span-481"><span class="linenos">481</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span></pre></div>


            <div class="docstring"><p>Set the date range on the active chart in the webdriver window. 
This is done by entering the start and end dates into the date range input boxes</p>

<p>Args:
    start_date (str): Start date in format YYYY-MM-DD
    end_date (str): End date in format YYYY-MM-DD</p>
</div>


                            </div>
                            <div id="TE_Scraper.custom_date_span_js" class="classattr">
                                        <input id="TE_Scraper.custom_date_span_js-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">custom_date_span_js</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">start_date</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;1900-01-01&#39;</span>,</span><span class="param">	<span class="n">end_date</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;2025-03-21&#39;</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="TE_Scraper.custom_date_span_js-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TE_Scraper.custom_date_span_js"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TE_Scraper.custom_date_span_js-483"><a href="#TE_Scraper.custom_date_span_js-483"><span class="linenos">483</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">custom_date_span_js</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_date</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;1900-01-01&quot;</span><span class="p">,</span> <span class="n">end_date</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">))</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="TE_Scraper.custom_date_span_js-484"><a href="#TE_Scraper.custom_date_span_js-484"><span class="linenos">484</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the date range on the active chart in the webdriver window using JavaScript.</span>
</span><span id="TE_Scraper.custom_date_span_js-485"><a href="#TE_Scraper.custom_date_span_js-485"><span class="linenos">485</span></a><span class="sd">        This is more reliable than using Selenium&#39;s send_keys and can avoid issues with focus.</span>
</span><span id="TE_Scraper.custom_date_span_js-486"><a href="#TE_Scraper.custom_date_span_js-486"><span class="linenos">486</span></a><span class="sd">        </span>
</span><span id="TE_Scraper.custom_date_span_js-487"><a href="#TE_Scraper.custom_date_span_js-487"><span class="linenos">487</span></a><span class="sd">        Args:</span>
</span><span id="TE_Scraper.custom_date_span_js-488"><a href="#TE_Scraper.custom_date_span_js-488"><span class="linenos">488</span></a><span class="sd">            start_date (str): Start date in format YYYY-MM-DD</span>
</span><span id="TE_Scraper.custom_date_span_js-489"><a href="#TE_Scraper.custom_date_span_js-489"><span class="linenos">489</span></a><span class="sd">            end_date (str): End date in format YYYY-MM-DD</span>
</span><span id="TE_Scraper.custom_date_span_js-490"><a href="#TE_Scraper.custom_date_span_js-490"><span class="linenos">490</span></a><span class="sd">            </span>
</span><span id="TE_Scraper.custom_date_span_js-491"><a href="#TE_Scraper.custom_date_span_js-491"><span class="linenos">491</span></a><span class="sd">        Returns:</span>
</span><span id="TE_Scraper.custom_date_span_js-492"><a href="#TE_Scraper.custom_date_span_js-492"><span class="linenos">492</span></a><span class="sd">            bool: True if successful, False otherwise</span>
</span><span id="TE_Scraper.custom_date_span_js-493"><a href="#TE_Scraper.custom_date_span_js-493"><span class="linenos">493</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TE_Scraper.custom_date_span_js-494"><a href="#TE_Scraper.custom_date_span_js-494"><span class="linenos">494</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="TE_Scraper.custom_date_span_js-495"><a href="#TE_Scraper.custom_date_span_js-495"><span class="linenos">495</span></a>            <span class="c1"># Load JavaScript code from file</span>
</span><span id="TE_Scraper.custom_date_span_js-496"><a href="#TE_Scraper.custom_date_span_js-496"><span class="linenos">496</span></a>            <span class="n">js_file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">),</span> <span class="s1">&#39;custom_datespan.js&#39;</span><span class="p">)</span>
</span><span id="TE_Scraper.custom_date_span_js-497"><a href="#TE_Scraper.custom_date_span_js-497"><span class="linenos">497</span></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">js_file_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
</span><span id="TE_Scraper.custom_date_span_js-498"><a href="#TE_Scraper.custom_date_span_js-498"><span class="linenos">498</span></a>                <span class="n">js_code</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span><span id="TE_Scraper.custom_date_span_js-499"><a href="#TE_Scraper.custom_date_span_js-499"><span class="linenos">499</span></a>            
</span><span id="TE_Scraper.custom_date_span_js-500"><a href="#TE_Scraper.custom_date_span_js-500"><span class="linenos">500</span></a>            <span class="c1"># Execute the JavaScript with parameters</span>
</span><span id="TE_Scraper.custom_date_span_js-501"><a href="#TE_Scraper.custom_date_span_js-501"><span class="linenos">501</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">execute_async_script</span><span class="p">(</span><span class="n">js_code</span><span class="p">,</span> <span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">)</span>
</span><span id="TE_Scraper.custom_date_span_js-502"><a href="#TE_Scraper.custom_date_span_js-502"><span class="linenos">502</span></a>            
</span><span id="TE_Scraper.custom_date_span_js-503"><a href="#TE_Scraper.custom_date_span_js-503"><span class="linenos">503</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;success&#39;</span><span class="p">):</span>
</span><span id="TE_Scraper.custom_date_span_js-504"><a href="#TE_Scraper.custom_date_span_js-504"><span class="linenos">504</span></a>                <span class="c1"># Set date span in our object</span>
</span><span id="TE_Scraper.custom_date_span_js-505"><a href="#TE_Scraper.custom_date_span_js-505"><span class="linenos">505</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">date_span</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Custom&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;start_date&quot;</span><span class="p">:</span> <span class="n">start_date</span><span class="p">,</span> <span class="s2">&quot;end_date&quot;</span><span class="p">:</span> <span class="n">end_date</span><span class="p">}}</span>
</span><span id="TE_Scraper.custom_date_span_js-506"><a href="#TE_Scraper.custom_date_span_js-506"><span class="linenos">506</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">update_chart</span><span class="p">()</span>
</span><span id="TE_Scraper.custom_date_span_js-507"><a href="#TE_Scraper.custom_date_span_js-507"><span class="linenos">507</span></a>                
</span><span id="TE_Scraper.custom_date_span_js-508"><a href="#TE_Scraper.custom_date_span_js-508"><span class="linenos">508</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Date span set to custom range: </span><span class="si">{</span><span class="n">start_date</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">end_date</span><span class="si">}</span><span class="s2"> (using JavaScript)&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.custom_date_span_js-509"><a href="#TE_Scraper.custom_date_span_js-509"><span class="linenos">509</span></a>                <span class="k">return</span> <span class="kc">True</span>
</span><span id="TE_Scraper.custom_date_span_js-510"><a href="#TE_Scraper.custom_date_span_js-510"><span class="linenos">510</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="TE_Scraper.custom_date_span_js-511"><a href="#TE_Scraper.custom_date_span_js-511"><span class="linenos">511</span></a>                <span class="n">error_msg</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="s1">&#39;Unknown error&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="s1">&#39;Unknown error&#39;</span>
</span><span id="TE_Scraper.custom_date_span_js-512"><a href="#TE_Scraper.custom_date_span_js-512"><span class="linenos">512</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to set date span using JavaScript: </span><span class="si">{</span><span class="n">error_msg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.custom_date_span_js-513"><a href="#TE_Scraper.custom_date_span_js-513"><span class="linenos">513</span></a>                <span class="k">return</span> <span class="kc">False</span>
</span><span id="TE_Scraper.custom_date_span_js-514"><a href="#TE_Scraper.custom_date_span_js-514"><span class="linenos">514</span></a>            
</span><span id="TE_Scraper.custom_date_span_js-515"><a href="#TE_Scraper.custom_date_span_js-515"><span class="linenos">515</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="TE_Scraper.custom_date_span_js-516"><a href="#TE_Scraper.custom_date_span_js-516"><span class="linenos">516</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error executing custom_date_span_js: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.custom_date_span_js-517"><a href="#TE_Scraper.custom_date_span_js-517"><span class="linenos">517</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span></pre></div>


            <div class="docstring"><p>Set the date range on the active chart in the webdriver window using JavaScript.
This is more reliable than using Selenium's send_keys and can avoid issues with focus.</p>

<p>Args:
    start_date (str): Start date in format YYYY-MM-DD
    end_date (str): End date in format YYYY-MM-DD</p>

<p>Returns:
    bool: True if successful, False otherwise</p>
</div>


                            </div>
                            <div id="TE_Scraper.get_datamax_min" class="classattr">
                                        <input id="TE_Scraper.get_datamax_min-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_datamax_min</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="TE_Scraper.get_datamax_min-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TE_Scraper.get_datamax_min"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TE_Scraper.get_datamax_min-519"><a href="#TE_Scraper.get_datamax_min-519"><span class="linenos">519</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_datamax_min</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="TE_Scraper.get_datamax_min-520"><a href="#TE_Scraper.get_datamax_min-520"><span class="linenos">520</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the max and min data values for the series using y-axis values... This is deprecated and not used in the current version of the code.&quot;&quot;&quot;</span>
</span><span id="TE_Scraper.get_datamax_min-521"><a href="#TE_Scraper.get_datamax_min-521"><span class="linenos">521</span></a>        
</span><span id="TE_Scraper.get_datamax_min-522"><a href="#TE_Scraper.get_datamax_min-522"><span class="linenos">522</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;get_datamax_min method, axisY0 = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">y_axis</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">, axisY1 = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">y_axis</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.get_datamax_min-523"><a href="#TE_Scraper.get_datamax_min-523"><span class="linenos">523</span></a>        <span class="n">px_range</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_axis</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_axis</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="TE_Scraper.get_datamax_min-524"><a href="#TE_Scraper.get_datamax_min-524"><span class="linenos">524</span></a>        <span class="n">labrange</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_axis</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_axis</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="TE_Scraper.get_datamax_min-525"><a href="#TE_Scraper.get_datamax_min-525"><span class="linenos">525</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">unit_per_pix_alt2</span> <span class="o">=</span> <span class="n">labrange</span><span class="o">/</span><span class="n">px_range</span>
</span><span id="TE_Scraper.get_datamax_min-526"><a href="#TE_Scraper.get_datamax_min-526"><span class="linenos">526</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;unit_per_pix: &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit_per_pix</span><span class="p">)</span>
</span><span id="TE_Scraper.get_datamax_min-527"><a href="#TE_Scraper.get_datamax_min-527"><span class="linenos">527</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;unit_per_pix: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">unit_per_pix</span><span class="si">}</span><span class="s2">, alt2: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">unit_per_pix_alt2</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.get_datamax_min-528"><a href="#TE_Scraper.get_datamax_min-528"><span class="linenos">528</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">datamax</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_axis</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_axis</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">max</span><span class="p">())</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">unit_per_pix</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</span><span id="TE_Scraper.get_datamax_min-529"><a href="#TE_Scraper.get_datamax_min-529"><span class="linenos">529</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">datamin</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_axis</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">y_axis</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">unit_per_pix</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</span><span id="TE_Scraper.get_datamax_min-530"><a href="#TE_Scraper.get_datamax_min-530"><span class="linenos">530</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;datamax: &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">datamax</span><span class="p">,</span> <span class="s2">&quot;datamin: &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">datamin</span><span class="p">)</span>
</span><span id="TE_Scraper.get_datamax_min-531"><a href="#TE_Scraper.get_datamax_min-531"><span class="linenos">531</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;datamax: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">datamax</span><span class="si">}</span><span class="s2">, datamin: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">datamin</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.get_datamax_min-532"><a href="#TE_Scraper.get_datamax_min-532"><span class="linenos">532</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datamax</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">datamin</span>
</span></pre></div>


            <div class="docstring"><p>Get the max and min data values for the series using y-axis values... This is deprecated and not used in the current version of the code.</p>
</div>


                            </div>
                            <div id="TE_Scraper.scale_series" class="classattr">
                                        <input id="TE_Scraper.scale_series-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">scale_series</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">right_way_up</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="TE_Scraper.scale_series-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TE_Scraper.scale_series"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TE_Scraper.scale_series-534"><a href="#TE_Scraper.scale_series-534"><span class="linenos">534</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">scale_series</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">right_way_up</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
</span><span id="TE_Scraper.scale_series-535"><a href="#TE_Scraper.scale_series-535"><span class="linenos">535</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Scale the series using the first and last values from the series pulled from the tooltip box. Uses the y axis limits and the max and min of the y axis</span>
</span><span id="TE_Scraper.scale_series-536"><a href="#TE_Scraper.scale_series-536"><span class="linenos">536</span></a><span class="sd">        to determine the scaling factor to convert pixel co-ordinates to data values. The scaling factor is stored in the self.axlims_upp attribute.&quot;&quot;&quot;</span>
</span><span id="TE_Scraper.scale_series-537"><a href="#TE_Scraper.scale_series-537"><span class="linenos">537</span></a>
</span><span id="TE_Scraper.scale_series-538"><a href="#TE_Scraper.scale_series-538"><span class="linenos">538</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">right_way_up</span><span class="p">:</span>
</span><span id="TE_Scraper.scale_series-539"><a href="#TE_Scraper.scale_series-539"><span class="linenos">539</span></a>            <span class="n">max_val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_axis</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>  <span class="c1"># This should be the top pixel of the chart.</span>
</span><span id="TE_Scraper.scale_series-540"><a href="#TE_Scraper.scale_series-540"><span class="linenos">540</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">series</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">invert_series</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="p">,</span> <span class="n">max_val</span> <span class="o">=</span> <span class="n">max_val</span><span class="p">)</span>
</span><span id="TE_Scraper.scale_series-541"><a href="#TE_Scraper.scale_series-541"><span class="linenos">541</span></a>            
</span><span id="TE_Scraper.scale_series-542"><a href="#TE_Scraper.scale_series-542"><span class="linenos">542</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;axis_limits&quot;</span><span class="p">):</span>
</span><span id="TE_Scraper.scale_series-543"><a href="#TE_Scraper.scale_series-543"><span class="linenos">543</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">axis_limits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_axis_limits</span><span class="p">()</span>
</span><span id="TE_Scraper.scale_series-544"><a href="#TE_Scraper.scale_series-544"><span class="linenos">544</span></a>        <span class="n">ymin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis_limits</span><span class="p">[</span><span class="s1">&#39;y_min&#39;</span><span class="p">];</span> <span class="n">ymax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis_limits</span><span class="p">[</span><span class="s1">&#39;y_max&#39;</span><span class="p">]</span>
</span><span id="TE_Scraper.scale_series-545"><a href="#TE_Scraper.scale_series-545"><span class="linenos">545</span></a>        <span class="c1">## Turns out that this formulation below is the best way to calculate the scaling factor for the chart.</span>
</span><span id="TE_Scraper.scale_series-546"><a href="#TE_Scraper.scale_series-546"><span class="linenos">546</span></a>        <span class="n">unit_range</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_axis</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_axis</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="TE_Scraper.scale_series-547"><a href="#TE_Scraper.scale_series-547"><span class="linenos">547</span></a>        <span class="n">pxrange</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_axis</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_axis</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="TE_Scraper.scale_series-548"><a href="#TE_Scraper.scale_series-548"><span class="linenos">548</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">axlims_upp</span> <span class="o">=</span> <span class="n">unit_range</span><span class="o">/</span><span class="n">pxrange</span>
</span><span id="TE_Scraper.scale_series-549"><a href="#TE_Scraper.scale_series-549"><span class="linenos">549</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unit per pix forumlation, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">y_axis</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">y_axis</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">unit_range</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">pxrange</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">ymax</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">ymin</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">axlims_upp</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.scale_series-550"><a href="#TE_Scraper.scale_series-550"><span class="linenos">550</span></a>
</span><span id="TE_Scraper.scale_series-551"><a href="#TE_Scraper.scale_series-551"><span class="linenos">551</span></a>        <span class="c1"># if the start and end points are at similar values this will be problematic though. </span>
</span><span id="TE_Scraper.scale_series-552"><a href="#TE_Scraper.scale_series-552"><span class="linenos">552</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Scale series method:  </span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="TE_Scraper.scale_series-553"><a href="#TE_Scraper.scale_series-553"><span class="linenos">553</span></a>                        <span class="sa">f</span><span class="s2">&quot;unit_per_pix calculated from the y axis ticks: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">unit_per_pix</span><span class="si">}</span><span class="s2">, </span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="TE_Scraper.scale_series-554"><a href="#TE_Scraper.scale_series-554"><span class="linenos">554</span></a>                        <span class="sa">f</span><span class="s2">&quot;unit_per_pix from axis limits and self.y_axis (probably best way): </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">axlims_upp</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="TE_Scraper.scale_series-555"><a href="#TE_Scraper.scale_series-555"><span class="linenos">555</span></a>                        <span class="sa">f</span><span class="s2">&quot;yaxis top tick: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">y_axis</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">, yaxis bot tick: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">y_axis</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="TE_Scraper.scale_series-556"><a href="#TE_Scraper.scale_series-556"><span class="linenos">556</span></a>                        <span class="sa">f</span><span class="s2">&quot;axis_limits: </span><span class="si">{</span><span class="n">ymin</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">ymax</span><span class="si">}</span><span class="s2">, y-axis series min &amp; max pixel values: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">y_axis</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">y_axis</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.scale_series-557"><a href="#TE_Scraper.scale_series-557"><span class="linenos">557</span></a>
</span><span id="TE_Scraper.scale_series-558"><a href="#TE_Scraper.scale_series-558"><span class="linenos">558</span></a>        <span class="c1">##Does the Y axis cross zero? Where is the zero point??</span>
</span><span id="TE_Scraper.scale_series-559"><a href="#TE_Scraper.scale_series-559"><span class="linenos">559</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">x_intercept_px</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">find_zero_crossing</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_axis</span><span class="p">)</span>
</span><span id="TE_Scraper.scale_series-560"><a href="#TE_Scraper.scale_series-560"><span class="linenos">560</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Series crosses zero, x-axis should be at about pixel y-cordinate: &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_intercept_px</span><span class="p">)</span>
</span><span id="TE_Scraper.scale_series-561"><a href="#TE_Scraper.scale_series-561"><span class="linenos">561</span></a>
</span><span id="TE_Scraper.scale_series-562"><a href="#TE_Scraper.scale_series-562"><span class="linenos">562</span></a>        <span class="n">unscaled</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unscaled_series</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="TE_Scraper.scale_series-563"><a href="#TE_Scraper.scale_series-563"><span class="linenos">563</span></a>        <span class="c1"># Calculate the series in vector fashion</span>
</span><span id="TE_Scraper.scale_series-564"><a href="#TE_Scraper.scale_series-564"><span class="linenos">564</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">series</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_axis</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">unscaled</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">axlims_upp</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_axis</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="TE_Scraper.scale_series-565"><a href="#TE_Scraper.scale_series-565"><span class="linenos">565</span></a>
</span><span id="TE_Scraper.scale_series-566"><a href="#TE_Scraper.scale_series-566"><span class="linenos">566</span></a>        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;metadata&quot;</span><span class="p">):</span>
</span><span id="TE_Scraper.scale_series-567"><a href="#TE_Scraper.scale_series-567"><span class="linenos">567</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;start_date&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.scale_series-568"><a href="#TE_Scraper.scale_series-568"><span class="linenos">568</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;end_date&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.scale_series-569"><a href="#TE_Scraper.scale_series-569"><span class="linenos">569</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;min_value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
</span><span id="TE_Scraper.scale_series-570"><a href="#TE_Scraper.scale_series-570"><span class="linenos">570</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;max_value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
</span><span id="TE_Scraper.scale_series-571"><a href="#TE_Scraper.scale_series-571"><span class="linenos">571</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;length&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="p">)</span>
</span><span id="TE_Scraper.scale_series-572"><a href="#TE_Scraper.scale_series-572"><span class="linenos">572</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">series_metadata</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">)</span>
</span><span id="TE_Scraper.scale_series-573"><a href="#TE_Scraper.scale_series-573"><span class="linenos">573</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="TE_Scraper.scale_series-574"><a href="#TE_Scraper.scale_series-574"><span class="linenos">574</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;start_end not found, run get_datamax_min() first.&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.scale_series-575"><a href="#TE_Scraper.scale_series-575"><span class="linenos">575</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;start_end not found, run get_datamax_min() first.&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.scale_series-576"><a href="#TE_Scraper.scale_series-576"><span class="linenos">576</span></a>            <span class="k">return</span>
</span><span id="TE_Scraper.scale_series-577"><a href="#TE_Scraper.scale_series-577"><span class="linenos">577</span></a>
</span><span id="TE_Scraper.scale_series-578"><a href="#TE_Scraper.scale_series-578"><span class="linenos">578</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">series</span>
</span></pre></div>


            <div class="docstring"><p>Scale the series using the first and last values from the series pulled from the tooltip box. Uses the y axis limits and the max and min of the y axis
to determine the scaling factor to convert pixel co-ordinates to data values. The scaling factor is stored in the self.axlims_upp attribute.</p>
</div>


                            </div>
                            <div id="TE_Scraper.get_chart_dims" class="classattr">
                                        <input id="TE_Scraper.get_chart_dims-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_chart_dims</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="TE_Scraper.get_chart_dims-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TE_Scraper.get_chart_dims"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TE_Scraper.get_chart_dims-580"><a href="#TE_Scraper.get_chart_dims-580"><span class="linenos">580</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_chart_dims</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="TE_Scraper.get_chart_dims-581"><a href="#TE_Scraper.get_chart_dims-581"><span class="linenos">581</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get dimensions of chart and plotting area&quot;&quot;&quot;</span>
</span><span id="TE_Scraper.get_chart_dims-582"><a href="#TE_Scraper.get_chart_dims-582"><span class="linenos">582</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="TE_Scraper.get_chart_dims-583"><a href="#TE_Scraper.get_chart_dims-583"><span class="linenos">583</span></a>            <span class="c1"># Ensure full_chart is WebElement</span>
</span><span id="TE_Scraper.get_chart_dims-584"><a href="#TE_Scraper.get_chart_dims-584"><span class="linenos">584</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">chart_element</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s2">&quot;#chart&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.get_chart_dims-585"><a href="#TE_Scraper.get_chart_dims-585"><span class="linenos">585</span></a>            <span class="c1"># Get overall chart dimensions</span>
</span><span id="TE_Scraper.get_chart_dims-586"><a href="#TE_Scraper.get_chart_dims-586"><span class="linenos">586</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">chart_rect</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">v</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_element</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
</span><span id="TE_Scraper.get_chart_dims-587"><a href="#TE_Scraper.get_chart_dims-587"><span class="linenos">587</span></a>            
</span><span id="TE_Scraper.get_chart_dims-588"><a href="#TE_Scraper.get_chart_dims-588"><span class="linenos">588</span></a>            <span class="c1"># Get plot area dimensions</span>
</span><span id="TE_Scraper.get_chart_dims-589"><a href="#TE_Scraper.get_chart_dims-589"><span class="linenos">589</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">plot_background</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s1">&#39;.highcharts-plot-background&#39;</span><span class="p">)</span>
</span><span id="TE_Scraper.get_chart_dims-590"><a href="#TE_Scraper.get_chart_dims-590"><span class="linenos">590</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">axes_rect</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">v</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_background</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
</span><span id="TE_Scraper.get_chart_dims-591"><a href="#TE_Scraper.get_chart_dims-591"><span class="linenos">591</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">chart_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes_rect</span><span class="p">[</span><span class="s2">&quot;width&quot;</span><span class="p">]</span>
</span><span id="TE_Scraper.get_chart_dims-592"><a href="#TE_Scraper.get_chart_dims-592"><span class="linenos">592</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">chart_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes_rect</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">]</span>
</span><span id="TE_Scraper.get_chart_dims-593"><a href="#TE_Scraper.get_chart_dims-593"><span class="linenos">593</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="TE_Scraper.get_chart_dims-594"><a href="#TE_Scraper.get_chart_dims-594"><span class="linenos">594</span></a>        
</span><span id="TE_Scraper.get_chart_dims-595"><a href="#TE_Scraper.get_chart_dims-595"><span class="linenos">595</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="TE_Scraper.get_chart_dims-596"><a href="#TE_Scraper.get_chart_dims-596"><span class="linenos">596</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to get chart dimensions: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.get_chart_dims-597"><a href="#TE_Scraper.get_chart_dims-597"><span class="linenos">597</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to get chart dimensions: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.get_chart_dims-598"><a href="#TE_Scraper.get_chart_dims-598"><span class="linenos">598</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span></pre></div>


            <div class="docstring"><p>Get dimensions of chart and plotting area</p>
</div>


                            </div>
                            <div id="TE_Scraper.get_xlims_from_tooltips" class="classattr">
                                        <input id="TE_Scraper.get_xlims_from_tooltips-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_xlims_from_tooltips</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">set_max_datespan</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="TE_Scraper.get_xlims_from_tooltips-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TE_Scraper.get_xlims_from_tooltips"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TE_Scraper.get_xlims_from_tooltips-600"><a href="#TE_Scraper.get_xlims_from_tooltips-600"><span class="linenos">600</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_xlims_from_tooltips</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">set_max_datespan</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
</span><span id="TE_Scraper.get_xlims_from_tooltips-601"><a href="#TE_Scraper.get_xlims_from_tooltips-601"><span class="linenos">601</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; Use the TooltipScraper class to get the start and end dates and some other points of the time series using the tooltip box displayed on the chart.</span>
</span><span id="TE_Scraper.get_xlims_from_tooltips-602"><a href="#TE_Scraper.get_xlims_from_tooltips-602"><span class="linenos">602</span></a><span class="sd">        Takes the latest num_points points from the chart and uses them to determine the frequency of the time series. The latest data is used</span>
</span><span id="TE_Scraper.get_xlims_from_tooltips-603"><a href="#TE_Scraper.get_xlims_from_tooltips-603"><span class="linenos">603</span></a><span class="sd">        in case the earlier data is of lower frequency which can sometimes occurr.</span>
</span><span id="TE_Scraper.get_xlims_from_tooltips-604"><a href="#TE_Scraper.get_xlims_from_tooltips-604"><span class="linenos">604</span></a><span class="sd">        </span>
</span><span id="TE_Scraper.get_xlims_from_tooltips-605"><a href="#TE_Scraper.get_xlims_from_tooltips-605"><span class="linenos">605</span></a><span class="sd">        **Parameters:**</span>
</span><span id="TE_Scraper.get_xlims_from_tooltips-606"><a href="#TE_Scraper.get_xlims_from_tooltips-606"><span class="linenos">606</span></a><span class="sd">        </span>
</span><span id="TE_Scraper.get_xlims_from_tooltips-607"><a href="#TE_Scraper.get_xlims_from_tooltips-607"><span class="linenos">607</span></a><span class="sd">        - force_rerun (bool): Whether to force a rerun of the method to get the start and end dates and frequency of the time series again. The method</span>
</span><span id="TE_Scraper.get_xlims_from_tooltips-608"><a href="#TE_Scraper.get_xlims_from_tooltips-608"><span class="linenos">608</span></a><span class="sd">        will not run again by default if done a second time and start_end and frequency attributes are already set. If the first run resulted in erroneous</span>
</span><span id="TE_Scraper.get_xlims_from_tooltips-609"><a href="#TE_Scraper.get_xlims_from_tooltips-609"><span class="linenos">609</span></a><span class="sd">        assignation of these attributes, set this to True to rerun the method. However, something may need to be changed if it is not working...&quot;&quot;&quot;</span>
</span><span id="TE_Scraper.get_xlims_from_tooltips-610"><a href="#TE_Scraper.get_xlims_from_tooltips-610"><span class="linenos">610</span></a>
</span><span id="TE_Scraper.get_xlims_from_tooltips-611"><a href="#TE_Scraper.get_xlims_from_tooltips-611"><span class="linenos">611</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;get_xlims_from_tooltips method: date_span: &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">date_span</span><span class="p">,</span> <span class="s2">&quot;, chart_type:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span><span class="p">)</span>
</span><span id="TE_Scraper.get_xlims_from_tooltips-612"><a href="#TE_Scraper.get_xlims_from_tooltips-612"><span class="linenos">612</span></a>
</span><span id="TE_Scraper.get_xlims_from_tooltips-613"><a href="#TE_Scraper.get_xlims_from_tooltips-613"><span class="linenos">613</span></a>        <span class="k">if</span> <span class="n">set_max_datespan</span><span class="p">:</span>
</span><span id="TE_Scraper.get_xlims_from_tooltips-614"><a href="#TE_Scraper.get_xlims_from_tooltips-614"><span class="linenos">614</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">set_max_date_span_viaCalendar</span><span class="p">()</span>  <span class="c1">##Set date_span to MAX for start and end date pull...</span>
</span><span id="TE_Scraper.get_xlims_from_tooltips-615"><a href="#TE_Scraper.get_xlims_from_tooltips-615"><span class="linenos">615</span></a>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
</span><span id="TE_Scraper.get_xlims_from_tooltips-616"><a href="#TE_Scraper.get_xlims_from_tooltips-616"><span class="linenos">616</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">update_chart</span><span class="p">()</span>
</span><span id="TE_Scraper.get_xlims_from_tooltips-617"><a href="#TE_Scraper.get_xlims_from_tooltips-617"><span class="linenos">617</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">set_chartType_js</span><span class="p">(</span><span class="s2">&quot;Spline&quot;</span><span class="p">)</span> <span class="c1">#Force spline chart selection - very important. I still have no way to determine if the chart type has changed when it changes automatically.</span>
</span><span id="TE_Scraper.get_xlims_from_tooltips-618"><a href="#TE_Scraper.get_xlims_from_tooltips-618"><span class="linenos">618</span></a>        <span class="c1">#Chart type must be spline or line for this to work. Sometimes the chart_type chnages automatically when datespan is altered.</span>
</span><span id="TE_Scraper.get_xlims_from_tooltips-619"><a href="#TE_Scraper.get_xlims_from_tooltips-619"><span class="linenos">619</span></a>
</span><span id="TE_Scraper.get_xlims_from_tooltips-620"><a href="#TE_Scraper.get_xlims_from_tooltips-620"><span class="linenos">620</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;tooltip_scraper&quot;</span><span class="p">):</span>
</span><span id="TE_Scraper.get_xlims_from_tooltips-621"><a href="#TE_Scraper.get_xlims_from_tooltips-621"><span class="linenos">621</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">tooltip_scraper</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">TooltipScraper</span><span class="p">(</span><span class="n">parent_instance</span> <span class="o">=</span> <span class="bp">self</span><span class="p">)</span> <span class="c1"># Create a tooltip scraper child object</span>
</span><span id="TE_Scraper.get_xlims_from_tooltips-622"><a href="#TE_Scraper.get_xlims_from_tooltips-622"><span class="linenos">622</span></a>        
</span><span id="TE_Scraper.get_xlims_from_tooltips-623"><a href="#TE_Scraper.get_xlims_from_tooltips-623"><span class="linenos">623</span></a>        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span id="TE_Scraper.get_xlims_from_tooltips-624"><a href="#TE_Scraper.get_xlims_from_tooltips-624"><span class="linenos">624</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">start_end</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tooltip_scraper</span><span class="o">.</span><span class="n">first_last_dates</span><span class="p">()</span>
</span><span id="TE_Scraper.get_xlims_from_tooltips-625"><a href="#TE_Scraper.get_xlims_from_tooltips-625"><span class="linenos">625</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_end</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">pd</span><span class="o">.</span><span class="n">isna</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_end</span><span class="p">[</span><span class="s2">&quot;start_date&quot;</span><span class="p">])</span> <span class="ow">or</span> <span class="n">pd</span><span class="o">.</span><span class="n">isna</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_end</span><span class="p">[</span><span class="s2">&quot;end_date&quot;</span><span class="p">]):</span>
</span><span id="TE_Scraper.get_xlims_from_tooltips-626"><a href="#TE_Scraper.get_xlims_from_tooltips-626"><span class="linenos">626</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">start_end</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tooltip_scraper</span><span class="o">.</span><span class="n">first_last_dates</span><span class="p">()</span>
</span><span id="TE_Scraper.get_xlims_from_tooltips-627"><a href="#TE_Scraper.get_xlims_from_tooltips-627"><span class="linenos">627</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Start and end dates scraped from tooltips: &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_end</span><span class="p">)</span>
</span><span id="TE_Scraper.get_xlims_from_tooltips-628"><a href="#TE_Scraper.get_xlims_from_tooltips-628"><span class="linenos">628</span></a>        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;metadata&quot;</span><span class="p">):</span>
</span><span id="TE_Scraper.get_xlims_from_tooltips-629"><a href="#TE_Scraper.get_xlims_from_tooltips-629"><span class="linenos">629</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;unit_tooltips&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_end</span><span class="p">[</span><span class="s2">&quot;unit_str&quot;</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Use the TooltipScraper class to get the start and end dates and some other points of the time series using the tooltip box displayed on the chart.
Takes the latest num_points points from the chart and uses them to determine the frequency of the time series. The latest data is used
in case the earlier data is of lower frequency which can sometimes occurr.</p>

<p><strong>Parameters:</strong></p>

<ul>
<li>force_rerun (bool): Whether to force a rerun of the method to get the start and end dates and frequency of the time series again. The method
will not run again by default if done a second time and start_end and frequency attributes are already set. If the first run resulted in erroneous
assignation of these attributes, set this to True to rerun the method. However, something may need to be changed if it is not working...</li>
</ul>
</div>


                            </div>
                            <div id="TE_Scraper.make_x_index" class="classattr">
                                        <input id="TE_Scraper.make_x_index-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">make_x_index</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">force_rerun_xlims</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">force_rerun_freqdet</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="TE_Scraper.make_x_index-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TE_Scraper.make_x_index"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TE_Scraper.make_x_index-631"><a href="#TE_Scraper.make_x_index-631"><span class="linenos">631</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">make_x_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
</span><span id="TE_Scraper.make_x_index-632"><a href="#TE_Scraper.make_x_index-632"><span class="linenos">632</span></a>                     <span class="n">force_rerun_xlims</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="TE_Scraper.make_x_index-633"><a href="#TE_Scraper.make_x_index-633"><span class="linenos">633</span></a>                     <span class="n">force_rerun_freqdet</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
</span><span id="TE_Scraper.make_x_index-634"><a href="#TE_Scraper.make_x_index-634"><span class="linenos">634</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Make the DateTime Index for the series using the start and end dates scraped from the tooltips. </span>
</span><span id="TE_Scraper.make_x_index-635"><a href="#TE_Scraper.make_x_index-635"><span class="linenos">635</span></a><span class="sd">        This uses Selenium and also scrapes the some of the latest datapoints from the tooltips on the chart in order to determine</span>
</span><span id="TE_Scraper.make_x_index-636"><a href="#TE_Scraper.make_x_index-636"><span class="linenos">636</span></a><span class="sd">        the frequency of the time series. It will take a bit of time to run.</span>
</span><span id="TE_Scraper.make_x_index-637"><a href="#TE_Scraper.make_x_index-637"><span class="linenos">637</span></a>
</span><span id="TE_Scraper.make_x_index-638"><a href="#TE_Scraper.make_x_index-638"><span class="linenos">638</span></a><span class="sd">        **Parameters:**</span>
</span><span id="TE_Scraper.make_x_index-639"><a href="#TE_Scraper.make_x_index-639"><span class="linenos">639</span></a><span class="sd">        - force_rerun_xlims (bool): Whether to force a rerun of the method to get the start and end dates and frequency of the time series again. The method</span>
</span><span id="TE_Scraper.make_x_index-640"><a href="#TE_Scraper.make_x_index-640"><span class="linenos">640</span></a><span class="sd">        will not run again by default if done a second time and start_end and frequency attributes are already set. </span>
</span><span id="TE_Scraper.make_x_index-641"><a href="#TE_Scraper.make_x_index-641"><span class="linenos">641</span></a><span class="sd">        - force_rerun_freqdet (bool): Whether to force a rerun of the method to get the frequency of the time series again. The method</span>
</span><span id="TE_Scraper.make_x_index-642"><a href="#TE_Scraper.make_x_index-642"><span class="linenos">642</span></a><span class="sd">        will not run again by default if done a second time and frequency attribute is already set. </span>
</span><span id="TE_Scraper.make_x_index-643"><a href="#TE_Scraper.make_x_index-643"><span class="linenos">643</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TE_Scraper.make_x_index-644"><a href="#TE_Scraper.make_x_index-644"><span class="linenos">644</span></a>        
</span><span id="TE_Scraper.make_x_index-645"><a href="#TE_Scraper.make_x_index-645"><span class="linenos">645</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;tooltip_scraper&quot;</span><span class="p">):</span>  <span class="c1"># If the tooltip scraper object is not already created, create it.</span>
</span><span id="TE_Scraper.make_x_index-646"><a href="#TE_Scraper.make_x_index-646"><span class="linenos">646</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">tooltip_scraper</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">TooltipScraper</span><span class="p">(</span><span class="n">parent_instance</span> <span class="o">=</span> <span class="bp">self</span><span class="p">)</span> <span class="c1"># Create a tooltip scraper child object</span>
</span><span id="TE_Scraper.make_x_index-647"><a href="#TE_Scraper.make_x_index-647"><span class="linenos">647</span></a>
</span><span id="TE_Scraper.make_x_index-648"><a href="#TE_Scraper.make_x_index-648"><span class="linenos">648</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Using selenium and tooltip scraping to construct the date time index for the time-series, this&#39;ll take a bit...&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.make_x_index-649"><a href="#TE_Scraper.make_x_index-649"><span class="linenos">649</span></a>        <span class="c1">## Get the latest 10 or so points from the chart, date and value from tooltips, in order to determine the frequency of the time series.</span>
</span><span id="TE_Scraper.make_x_index-650"><a href="#TE_Scraper.make_x_index-650"><span class="linenos">650</span></a>        <span class="k">if</span> <span class="n">force_rerun_freqdet</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;latest_points&quot;</span><span class="p">):</span>
</span><span id="TE_Scraper.make_x_index-651"><a href="#TE_Scraper.make_x_index-651"><span class="linenos">651</span></a>            <span class="c1">#datapoints = self.tooltip_scraper.get_latest_points(num_points = 5)  # Python version, slow</span>
</span><span id="TE_Scraper.make_x_index-652"><a href="#TE_Scraper.make_x_index-652"><span class="linenos">652</span></a>            <span class="n">datapoints</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tooltip_scraper</span><span class="o">.</span><span class="n">latest_points_js</span><span class="p">(</span><span class="n">num_points</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>  <span class="c1"># js version, faster</span>
</span><span id="TE_Scraper.make_x_index-653"><a href="#TE_Scraper.make_x_index-653"><span class="linenos">653</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">latest_points</span> <span class="o">=</span> <span class="n">datapoints</span>
</span><span id="TE_Scraper.make_x_index-654"><a href="#TE_Scraper.make_x_index-654"><span class="linenos">654</span></a>            <span class="c1"># Convert metric prefixes for the values in each datapoint</span>
</span><span id="TE_Scraper.make_x_index-655"><a href="#TE_Scraper.make_x_index-655"><span class="linenos">655</span></a>            <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">latest_points</span><span class="p">:</span>
</span><span id="TE_Scraper.make_x_index-656"><a href="#TE_Scraper.make_x_index-656"><span class="linenos">656</span></a>                <span class="n">point</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">extract_and_convert_value</span><span class="p">(</span><span class="n">point</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="TE_Scraper.make_x_index-657"><a href="#TE_Scraper.make_x_index-657"><span class="linenos">657</span></a>                <span class="n">point</span><span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">ready_datestr</span><span class="p">(</span><span class="n">point</span><span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">])</span>
</span><span id="TE_Scraper.make_x_index-658"><a href="#TE_Scraper.make_x_index-658"><span class="linenos">658</span></a>            <span class="n">latest_dates</span> <span class="o">=</span> <span class="p">[</span><span class="n">point</span><span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">datapoints</span><span class="p">]</span>
</span><span id="TE_Scraper.make_x_index-659"><a href="#TE_Scraper.make_x_index-659"><span class="linenos">659</span></a>            <span class="c1">#print(&quot;Latest dates: &quot;, latest_dates)</span>
</span><span id="TE_Scraper.make_x_index-660"><a href="#TE_Scraper.make_x_index-660"><span class="linenos">660</span></a>
</span><span id="TE_Scraper.make_x_index-661"><a href="#TE_Scraper.make_x_index-661"><span class="linenos">661</span></a>            <span class="c1">## Get the frequency of the time series</span>
</span><span id="TE_Scraper.make_x_index-662"><a href="#TE_Scraper.make_x_index-662"><span class="linenos">662</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">date_series</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">latest_dates</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;datetime64[ns]&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.make_x_index-663"><a href="#TE_Scraper.make_x_index-663"><span class="linenos">663</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">get_date_frequency</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">date_series</span><span class="p">)</span>
</span><span id="TE_Scraper.make_x_index-664"><a href="#TE_Scraper.make_x_index-664"><span class="linenos">664</span></a>            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;metadata&quot;</span><span class="p">):</span>
</span><span id="TE_Scraper.make_x_index-665"><a href="#TE_Scraper.make_x_index-665"><span class="linenos">665</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;frequency&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span>
</span><span id="TE_Scraper.make_x_index-666"><a href="#TE_Scraper.make_x_index-666"><span class="linenos">666</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Frequency of time-series: &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="p">)</span>
</span><span id="TE_Scraper.make_x_index-667"><a href="#TE_Scraper.make_x_index-667"><span class="linenos">667</span></a>
</span><span id="TE_Scraper.make_x_index-668"><a href="#TE_Scraper.make_x_index-668"><span class="linenos">668</span></a>        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.25</span><span class="p">)</span>
</span><span id="TE_Scraper.make_x_index-669"><a href="#TE_Scraper.make_x_index-669"><span class="linenos">669</span></a>
</span><span id="TE_Scraper.make_x_index-670"><a href="#TE_Scraper.make_x_index-670"><span class="linenos">670</span></a>        <span class="k">if</span> <span class="n">force_rerun_xlims</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;start_end&quot;</span><span class="p">):</span>
</span><span id="TE_Scraper.make_x_index-671"><a href="#TE_Scraper.make_x_index-671"><span class="linenos">671</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">start_end</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="TE_Scraper.make_x_index-672"><a href="#TE_Scraper.make_x_index-672"><span class="linenos">672</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">set_max_date_span_viaCalendar</span><span class="p">()</span>  <span class="c1">##Set date_span to MAX for start and end date pull...</span>
</span><span id="TE_Scraper.make_x_index-673"><a href="#TE_Scraper.make_x_index-673"><span class="linenos">673</span></a>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.25</span><span class="p">)</span>
</span><span id="TE_Scraper.make_x_index-674"><a href="#TE_Scraper.make_x_index-674"><span class="linenos">674</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">set_chartType_js</span><span class="p">(</span><span class="s2">&quot;Spline&quot;</span><span class="p">)</span> <span class="c1">#Force spline chart selection - very important. I still have no way to determine if the chart type has changed when it changes automatically.</span>
</span><span id="TE_Scraper.make_x_index-675"><a href="#TE_Scraper.make_x_index-675"><span class="linenos">675</span></a>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.25</span><span class="p">)</span>
</span><span id="TE_Scraper.make_x_index-676"><a href="#TE_Scraper.make_x_index-676"><span class="linenos">676</span></a>            <span class="n">retries</span> <span class="o">=</span> <span class="mi">3</span>
</span><span id="TE_Scraper.make_x_index-677"><a href="#TE_Scraper.make_x_index-677"><span class="linenos">677</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">retries</span><span class="p">):</span>
</span><span id="TE_Scraper.make_x_index-678"><a href="#TE_Scraper.make_x_index-678"><span class="linenos">678</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">start_end</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tooltip_scraper</span><span class="o">.</span><span class="n">first_last_dates_js</span><span class="p">()</span>
</span><span id="TE_Scraper.make_x_index-679"><a href="#TE_Scraper.make_x_index-679"><span class="linenos">679</span></a>                <span class="c1"># Check if start_end is None or if any of the four essential keys have None/NaN values</span>
</span><span id="TE_Scraper.make_x_index-680"><a href="#TE_Scraper.make_x_index-680"><span class="linenos">680</span></a>                <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_end</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> 
</span><span id="TE_Scraper.make_x_index-681"><a href="#TE_Scraper.make_x_index-681"><span class="linenos">681</span></a>                    <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_end</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;start_date&quot;</span><span class="p">,</span> <span class="s2">&quot;end_date&quot;</span><span class="p">])</span> <span class="ow">or</span>
</span><span id="TE_Scraper.make_x_index-682"><a href="#TE_Scraper.make_x_index-682"><span class="linenos">682</span></a>                    <span class="nb">any</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">isna</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_end</span><span class="p">[</span><span class="n">key</span><span class="p">])</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;start_date&quot;</span><span class="p">,</span> <span class="s2">&quot;end_date&quot;</span><span class="p">]))</span>\
</span><span id="TE_Scraper.make_x_index-683"><a href="#TE_Scraper.make_x_index-683"><span class="linenos">683</span></a>                    <span class="ow">or</span> <span class="nb">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_end</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;start_date&quot;</span><span class="p">,</span> <span class="s2">&quot;end_date&quot;</span><span class="p">]):</span>
</span><span id="TE_Scraper.make_x_index-684"><a href="#TE_Scraper.make_x_index-684"><span class="linenos">684</span></a>                    <span class="c1">#print(&quot;Retrying start_end extraction...&quot;)</span>
</span><span id="TE_Scraper.make_x_index-685"><a href="#TE_Scraper.make_x_index-685"><span class="linenos">685</span></a>                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.25</span><span class="p">)</span>
</span><span id="TE_Scraper.make_x_index-686"><a href="#TE_Scraper.make_x_index-686"><span class="linenos">686</span></a>                    <span class="k">pass</span>
</span><span id="TE_Scraper.make_x_index-687"><a href="#TE_Scraper.make_x_index-687"><span class="linenos">687</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="TE_Scraper.make_x_index-688"><a href="#TE_Scraper.make_x_index-688"><span class="linenos">688</span></a>                    <span class="k">break</span>
</span><span id="TE_Scraper.make_x_index-689"><a href="#TE_Scraper.make_x_index-689"><span class="linenos">689</span></a>            <span class="c1">#For some reason running it twice seems to work better...</span>
</span><span id="TE_Scraper.make_x_index-690"><a href="#TE_Scraper.make_x_index-690"><span class="linenos">690</span></a>
</span><span id="TE_Scraper.make_x_index-691"><a href="#TE_Scraper.make_x_index-691"><span class="linenos">691</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_end</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TE_Scraper.make_x_index-692"><a href="#TE_Scraper.make_x_index-692"><span class="linenos">692</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Start and end values scraped from tooltips: </span><span class="se">\n</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">start_end</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.make_x_index-693"><a href="#TE_Scraper.make_x_index-693"><span class="linenos">693</span></a>                <span class="n">start_date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_end</span><span class="p">[</span><span class="s2">&quot;start_date&quot;</span><span class="p">];</span> <span class="n">end_date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_end</span><span class="p">[</span><span class="s2">&quot;end_date&quot;</span><span class="p">]</span>
</span><span id="TE_Scraper.make_x_index-694"><a href="#TE_Scraper.make_x_index-694"><span class="linenos">694</span></a>                <span class="n">dtIndex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtIndex</span><span class="p">(</span><span class="n">start_date</span><span class="o">=</span><span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="o">=</span><span class="n">end_date</span><span class="p">,</span> <span class="n">ser_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">])</span>
</span><span id="TE_Scraper.make_x_index-695"><a href="#TE_Scraper.make_x_index-695"><span class="linenos">695</span></a>                <span class="k">if</span> <span class="n">dtIndex</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TE_Scraper.make_x_index-696"><a href="#TE_Scraper.make_x_index-696"><span class="linenos">696</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DateTimeIndex created successfully for the time-series.&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.make_x_index-697"><a href="#TE_Scraper.make_x_index-697"><span class="linenos">697</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">x_index</span> <span class="o">=</span> <span class="n">dtIndex</span>
</span><span id="TE_Scraper.make_x_index-698"><a href="#TE_Scraper.make_x_index-698"><span class="linenos">698</span></a>                    <span class="k">return</span> <span class="n">dtIndex</span>  
</span><span id="TE_Scraper.make_x_index-699"><a href="#TE_Scraper.make_x_index-699"><span class="linenos">699</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="TE_Scraper.make_x_index-700"><a href="#TE_Scraper.make_x_index-700"><span class="linenos">700</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error creating DateTimeIndex for the time-series.&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.make_x_index-701"><a href="#TE_Scraper.make_x_index-701"><span class="linenos">701</span></a>                    <span class="k">return</span> <span class="kc">None</span>
</span><span id="TE_Scraper.make_x_index-702"><a href="#TE_Scraper.make_x_index-702"><span class="linenos">702</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="TE_Scraper.make_x_index-703"><a href="#TE_Scraper.make_x_index-703"><span class="linenos">703</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error: Start and end values not found...pulling out....&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.make_x_index-704"><a href="#TE_Scraper.make_x_index-704"><span class="linenos">704</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error: Start and end values not found...pulling out....&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.make_x_index-705"><a href="#TE_Scraper.make_x_index-705"><span class="linenos">705</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span></pre></div>


            <div class="docstring"><p>Make the DateTime Index for the series using the start and end dates scraped from the tooltips. 
This uses Selenium and also scrapes the some of the latest datapoints from the tooltips on the chart in order to determine
the frequency of the time series. It will take a bit of time to run.</p>

<p><strong>Parameters:</strong></p>

<ul>
<li>force_rerun_xlims (bool): Whether to force a rerun of the method to get the start and end dates and frequency of the time series again. The method
will not run again by default if done a second time and start_end and frequency attributes are already set. </li>
<li>force_rerun_freqdet (bool): Whether to force a rerun of the method to get the frequency of the time series again. The method
will not run again by default if done a second time and frequency attribute is already set.</li>
</ul>
</div>


                            </div>
                            <div id="TE_Scraper.get_earliest_points" class="classattr">
                                        <input id="TE_Scraper.get_earliest_points-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_earliest_points</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">num_points</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;all&#39;</span>, </span><span class="param"><span class="n">num_years</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="TE_Scraper.get_earliest_points-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TE_Scraper.get_earliest_points"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TE_Scraper.get_earliest_points-707"><a href="#TE_Scraper.get_earliest_points-707"><span class="linenos">707</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_earliest_points</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_points</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;all&quot;</span><span class="p">,</span> <span class="n">num_years</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">):</span>
</span><span id="TE_Scraper.get_earliest_points-708"><a href="#TE_Scraper.get_earliest_points-708"><span class="linenos">708</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the earliest data points from the chart using the cursor, use this to check for series that have differing frequency</span>
</span><span id="TE_Scraper.get_earliest_points-709"><a href="#TE_Scraper.get_earliest_points-709"><span class="linenos">709</span></a><span class="sd">        at start and end.&quot;&quot;&quot;</span>
</span><span id="TE_Scraper.get_earliest_points-710"><a href="#TE_Scraper.get_earliest_points-710"><span class="linenos">710</span></a>
</span><span id="TE_Scraper.get_earliest_points-711"><a href="#TE_Scraper.get_earliest_points-711"><span class="linenos">711</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;start_end&quot;</span><span class="p">):</span>
</span><span id="TE_Scraper.get_earliest_points-712"><a href="#TE_Scraper.get_earliest_points-712"><span class="linenos">712</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">get_xlims_from_tooltips</span><span class="p">()</span>
</span><span id="TE_Scraper.get_earliest_points-713"><a href="#TE_Scraper.get_earliest_points-713"><span class="linenos">713</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;tooltip_scraper&quot;</span><span class="p">):</span>
</span><span id="TE_Scraper.get_earliest_points-714"><a href="#TE_Scraper.get_earliest_points-714"><span class="linenos">714</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">tooltip_scraper</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">TooltipScraper</span><span class="p">(</span><span class="n">parent_instance</span> <span class="o">=</span> <span class="bp">self</span><span class="p">)</span>
</span><span id="TE_Scraper.get_earliest_points-715"><a href="#TE_Scraper.get_earliest_points-715"><span class="linenos">715</span></a>        
</span><span id="TE_Scraper.get_earliest_points-716"><a href="#TE_Scraper.get_earliest_points-716"><span class="linenos">716</span></a>        <span class="n">yearslater</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">n_years_later</span><span class="p">(</span><span class="n">date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_end</span><span class="p">[</span><span class="s2">&quot;start_date&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">),</span> <span class="n">n_years</span> <span class="o">=</span> <span class="n">num_years</span><span class="p">)</span>
</span><span id="TE_Scraper.get_earliest_points-717"><a href="#TE_Scraper.get_earliest_points-717"><span class="linenos">717</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">custom_date_span_js</span><span class="p">(</span><span class="n">start_date</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">start_end</span><span class="p">[</span><span class="s2">&quot;start_date&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">),</span> <span class="n">end_date</span> <span class="o">=</span> <span class="n">yearslater</span><span class="p">)</span>
</span><span id="TE_Scraper.get_earliest_points-718"><a href="#TE_Scraper.get_earliest_points-718"><span class="linenos">718</span></a>
</span><span id="TE_Scraper.get_earliest_points-719"><a href="#TE_Scraper.get_earliest_points-719"><span class="linenos">719</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="TE_Scraper.get_earliest_points-720"><a href="#TE_Scraper.get_earliest_points-720"><span class="linenos">720</span></a>            <span class="n">datapoints</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tooltip_scraper</span><span class="o">.</span><span class="n">latest_points_js</span><span class="p">(</span><span class="n">num_points</span><span class="o">=</span><span class="n">num_points</span><span class="p">,</span> <span class="n">force_shortest_span</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">wait_time</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</span><span id="TE_Scraper.get_earliest_points-721"><a href="#TE_Scraper.get_earliest_points-721"><span class="linenos">721</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">early_series</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="n">utils</span><span class="o">.</span><span class="n">extract_and_convert_value</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">datapoints</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> \
</span><span id="TE_Scraper.get_earliest_points-722"><a href="#TE_Scraper.get_earliest_points-722"><span class="linenos">722</span></a>                                    <span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">([</span><span class="n">utils</span><span class="o">.</span><span class="n">ready_datestr</span><span class="p">(</span><span class="n">date</span><span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">])</span> <span class="k">for</span> <span class="n">date</span> <span class="ow">in</span> <span class="n">datapoints</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
</span><span id="TE_Scraper.get_earliest_points-723"><a href="#TE_Scraper.get_earliest_points-723"><span class="linenos">723</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="TE_Scraper.get_earliest_points-724"><a href="#TE_Scraper.get_earliest_points-724"><span class="linenos">724</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Error getting earliest points: &quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="TE_Scraper.get_earliest_points-725"><a href="#TE_Scraper.get_earliest_points-725"><span class="linenos">725</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="TE_Scraper.get_earliest_points-726"><a href="#TE_Scraper.get_earliest_points-726"><span class="linenos">726</span></a>
</span><span id="TE_Scraper.get_earliest_points-727"><a href="#TE_Scraper.get_earliest_points-727"><span class="linenos">727</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">early_series</span>
</span></pre></div>


            <div class="docstring"><p>Get the earliest data points from the chart using the cursor, use this to check for series that have differing frequency
at start and end.</p>
</div>


                            </div>
                            <div id="TE_Scraper.full_series_fromTooltips" class="classattr">
                                        <input id="TE_Scraper.full_series_fromTooltips-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">full_series_fromTooltips</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">set_max_datespan</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="TE_Scraper.full_series_fromTooltips-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TE_Scraper.full_series_fromTooltips"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TE_Scraper.full_series_fromTooltips-729"><a href="#TE_Scraper.full_series_fromTooltips-729"><span class="linenos">729</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">full_series_fromTooltips</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">set_max_datespan</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="TE_Scraper.full_series_fromTooltips-730"><a href="#TE_Scraper.full_series_fromTooltips-730"><span class="linenos">730</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Scrape the full series from the dates and values displayed on the tooltips as the cursor is dragged across the chart. Uses javscript to handle the cursor </span>
</span><span id="TE_Scraper.full_series_fromTooltips-731"><a href="#TE_Scraper.full_series_fromTooltips-731"><span class="linenos">731</span></a><span class="sd">        movement and tooltip retrieval and parsing. This is way faster than using a python loop. I suspect this may end up missing some points for series that </span>
</span><span id="TE_Scraper.full_series_fromTooltips-732"><a href="#TE_Scraper.full_series_fromTooltips-732"><span class="linenos">732</span></a><span class="sd">        have many datapoints. However, it has worked for all series tested thus far. Assigns the resultant series to the series attribute.</span>
</span><span id="TE_Scraper.full_series_fromTooltips-733"><a href="#TE_Scraper.full_series_fromTooltips-733"><span class="linenos">733</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TE_Scraper.full_series_fromTooltips-734"><a href="#TE_Scraper.full_series_fromTooltips-734"><span class="linenos">734</span></a>
</span><span id="TE_Scraper.full_series_fromTooltips-735"><a href="#TE_Scraper.full_series_fromTooltips-735"><span class="linenos">735</span></a>        <span class="k">if</span> <span class="n">set_max_datespan</span><span class="p">:</span>
</span><span id="TE_Scraper.full_series_fromTooltips-736"><a href="#TE_Scraper.full_series_fromTooltips-736"><span class="linenos">736</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Setting max date span using calendar...&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.full_series_fromTooltips-737"><a href="#TE_Scraper.full_series_fromTooltips-737"><span class="linenos">737</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">set_max_date_span_viaCalendar</span><span class="p">()</span>
</span><span id="TE_Scraper.full_series_fromTooltips-738"><a href="#TE_Scraper.full_series_fromTooltips-738"><span class="linenos">738</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">set_chartType_js</span><span class="p">(</span><span class="s2">&quot;Spline&quot;</span><span class="p">)</span> <span class="c1"># Force spline chart type so that Y position of cursor does not matter for tooltip retrieval.</span>
</span><span id="TE_Scraper.full_series_fromTooltips-739"><a href="#TE_Scraper.full_series_fromTooltips-739"><span class="linenos">739</span></a>
</span><span id="TE_Scraper.full_series_fromTooltips-740"><a href="#TE_Scraper.full_series_fromTooltips-740"><span class="linenos">740</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;tooltip_scraper&quot;</span><span class="p">):</span>
</span><span id="TE_Scraper.full_series_fromTooltips-741"><a href="#TE_Scraper.full_series_fromTooltips-741"><span class="linenos">741</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">init_tooltipScraper</span><span class="p">()</span>  <span class="c1">## Initialize the tooltip scraper.</span>
</span><span id="TE_Scraper.full_series_fromTooltips-742"><a href="#TE_Scraper.full_series_fromTooltips-742"><span class="linenos">742</span></a>        <span class="c1">## Javascript based method here.</span>
</span><span id="TE_Scraper.full_series_fromTooltips-743"><a href="#TE_Scraper.full_series_fromTooltips-743"><span class="linenos">743</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="TE_Scraper.full_series_fromTooltips-744"><a href="#TE_Scraper.full_series_fromTooltips-744"><span class="linenos">744</span></a>            <span class="n">datapoints</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tooltip_scraper</span><span class="o">.</span><span class="n">latest_points_js</span><span class="p">(</span><span class="n">num_points</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">,</span> <span class="n">force_shortest_span</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">wait_time</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</span><span id="TE_Scraper.full_series_fromTooltips-745"><a href="#TE_Scraper.full_series_fromTooltips-745"><span class="linenos">745</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="TE_Scraper.full_series_fromTooltips-746"><a href="#TE_Scraper.full_series_fromTooltips-746"><span class="linenos">746</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Tooltip scraping of full series has failed, error: &quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="TE_Scraper.full_series_fromTooltips-747"><a href="#TE_Scraper.full_series_fromTooltips-747"><span class="linenos">747</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="TE_Scraper.full_series_fromTooltips-748"><a href="#TE_Scraper.full_series_fromTooltips-748"><span class="linenos">748</span></a>        <span class="c1">#Powerful one line pandas connversion...</span>
</span><span id="TE_Scraper.full_series_fromTooltips-749"><a href="#TE_Scraper.full_series_fromTooltips-749"><span class="linenos">749</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">series</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="n">utils</span><span class="o">.</span><span class="n">extract_and_convert_value</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">datapoints</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> \
</span><span id="TE_Scraper.full_series_fromTooltips-750"><a href="#TE_Scraper.full_series_fromTooltips-750"><span class="linenos">750</span></a>                                <span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">([</span><span class="n">utils</span><span class="o">.</span><span class="n">ready_datestr</span><span class="p">(</span><span class="n">date</span><span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">])</span> <span class="k">for</span> <span class="n">date</span> <span class="ow">in</span> <span class="n">datapoints</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
</span><span id="TE_Scraper.full_series_fromTooltips-751"><a href="#TE_Scraper.full_series_fromTooltips-751"><span class="linenos">751</span></a>
</span><span id="TE_Scraper.full_series_fromTooltips-752"><a href="#TE_Scraper.full_series_fromTooltips-752"><span class="linenos">752</span></a>        <span class="c1"># Add some more metadata about the series. </span>
</span><span id="TE_Scraper.full_series_fromTooltips-753"><a href="#TE_Scraper.full_series_fromTooltips-753"><span class="linenos">753</span></a>        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;metadata&quot;</span><span class="p">):</span>
</span><span id="TE_Scraper.full_series_fromTooltips-754"><a href="#TE_Scraper.full_series_fromTooltips-754"><span class="linenos">754</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;start_date&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.full_series_fromTooltips-755"><a href="#TE_Scraper.full_series_fromTooltips-755"><span class="linenos">755</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;end_date&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.full_series_fromTooltips-756"><a href="#TE_Scraper.full_series_fromTooltips-756"><span class="linenos">756</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;min_value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
</span><span id="TE_Scraper.full_series_fromTooltips-757"><a href="#TE_Scraper.full_series_fromTooltips-757"><span class="linenos">757</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;max_value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
</span><span id="TE_Scraper.full_series_fromTooltips-758"><a href="#TE_Scraper.full_series_fromTooltips-758"><span class="linenos">758</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;length&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="p">)</span>
</span><span id="TE_Scraper.full_series_fromTooltips-759"><a href="#TE_Scraper.full_series_fromTooltips-759"><span class="linenos">759</span></a>            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;frequency&quot;</span><span class="p">):</span>
</span><span id="TE_Scraper.full_series_fromTooltips-760"><a href="#TE_Scraper.full_series_fromTooltips-760"><span class="linenos">760</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;frequency&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span>
</span><span id="TE_Scraper.full_series_fromTooltips-761"><a href="#TE_Scraper.full_series_fromTooltips-761"><span class="linenos">761</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="TE_Scraper.full_series_fromTooltips-762"><a href="#TE_Scraper.full_series_fromTooltips-762"><span class="linenos">762</span></a>                <span class="n">freq</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">infer_freq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="c1"># Infer the frequency of the series.</span>
</span><span id="TE_Scraper.full_series_fromTooltips-763"><a href="#TE_Scraper.full_series_fromTooltips-763"><span class="linenos">763</span></a>                <span class="k">if</span> <span class="n">freq</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TE_Scraper.full_series_fromTooltips-764"><a href="#TE_Scraper.full_series_fromTooltips-764"><span class="linenos">764</span></a>                    <span class="n">freq</span> <span class="o">=</span> <span class="s2">&quot;Unknown/irregular&quot;</span>
</span><span id="TE_Scraper.full_series_fromTooltips-765"><a href="#TE_Scraper.full_series_fromTooltips-765"><span class="linenos">765</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;frequency&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">freq</span>
</span><span id="TE_Scraper.full_series_fromTooltips-766"><a href="#TE_Scraper.full_series_fromTooltips-766"><span class="linenos">766</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">series_metadata</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">)</span>
</span><span id="TE_Scraper.full_series_fromTooltips-767"><a href="#TE_Scraper.full_series_fromTooltips-767"><span class="linenos">767</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully scraped full series from tooltips.&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.full_series_fromTooltips-768"><a href="#TE_Scraper.full_series_fromTooltips-768"><span class="linenos">768</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;frequency&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Unknown/irregular&quot;</span><span class="p">:</span>
</span><span id="TE_Scraper.full_series_fromTooltips-769"><a href="#TE_Scraper.full_series_fromTooltips-769"><span class="linenos">769</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Frequency of the series is unknown or irregular, the tooltip scraping may have missed points. Retry scraping using &#39;path&#39; method instead of &#39;tooltips&#39;.&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.full_series_fromTooltips-770"><a href="#TE_Scraper.full_series_fromTooltips-770"><span class="linenos">770</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">series</span>
</span></pre></div>


            <div class="docstring"><p>Scrape the full series from the dates and values displayed on the tooltips as the cursor is dragged across the chart. Uses javscript to handle the cursor 
movement and tooltip retrieval and parsing. This is way faster than using a python loop. I suspect this may end up missing some points for series that 
have many datapoints. However, it has worked for all series tested thus far. Assigns the resultant series to the series attribute.</p>
</div>


                            </div>
                            <div id="TE_Scraper.tooltip_multiScrape" class="classattr">
                                        <input id="TE_Scraper.tooltip_multiScrape-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">tooltip_multiScrape</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="TE_Scraper.tooltip_multiScrape-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TE_Scraper.tooltip_multiScrape"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TE_Scraper.tooltip_multiScrape-772"><a href="#TE_Scraper.tooltip_multiScrape-772"><span class="linenos">772</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">tooltip_multiScrape</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="TE_Scraper.tooltip_multiScrape-773"><a href="#TE_Scraper.tooltip_multiScrape-773"><span class="linenos">773</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; Use the TooltipScraper object to scrape the full series from the chart. This is the most accurate method of scraping the full</span>
</span><span id="TE_Scraper.tooltip_multiScrape-774"><a href="#TE_Scraper.tooltip_multiScrape-774"><span class="linenos">774</span></a><span class="sd">        series but s the slowest. The x_index attribute must be set before running this method. The method will use multiple runs</span>
</span><span id="TE_Scraper.tooltip_multiScrape-775"><a href="#TE_Scraper.tooltip_multiScrape-775"><span class="linenos">775</span></a><span class="sd">        of the javascript tooltip scraping script. It will be done in multiple runs to prevent points being missed. Number of runs</span>
</span><span id="TE_Scraper.tooltip_multiScrape-776"><a href="#TE_Scraper.tooltip_multiScrape-776"><span class="linenos">776</span></a><span class="sd">        will depend upon the length of the x_index attribute. &quot;&quot;&quot;</span>
</span><span id="TE_Scraper.tooltip_multiScrape-777"><a href="#TE_Scraper.tooltip_multiScrape-777"><span class="linenos">777</span></a>
</span><span id="TE_Scraper.tooltip_multiScrape-778"><a href="#TE_Scraper.tooltip_multiScrape-778"><span class="linenos">778</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;tooltip_scraper&quot;</span><span class="p">):</span>
</span><span id="TE_Scraper.tooltip_multiScrape-779"><a href="#TE_Scraper.tooltip_multiScrape-779"><span class="linenos">779</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">init_tooltipScraper</span><span class="p">()</span>
</span><span id="TE_Scraper.tooltip_multiScrape-780"><a href="#TE_Scraper.tooltip_multiScrape-780"><span class="linenos">780</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;x_index&quot;</span><span class="p">):</span>
</span><span id="TE_Scraper.tooltip_multiScrape-781"><a href="#TE_Scraper.tooltip_multiScrape-781"><span class="linenos">781</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">make_x_index</span><span class="p">(</span><span class="n">force_rerun_freqdet</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">force_rerun_xlims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="TE_Scraper.tooltip_multiScrape-782"><a href="#TE_Scraper.tooltip_multiScrape-782"><span class="linenos">782</span></a>
</span><span id="TE_Scraper.tooltip_multiScrape-783"><a href="#TE_Scraper.tooltip_multiScrape-783"><span class="linenos">783</span></a>        <span class="n">max_chunk_size</span> <span class="o">=</span> <span class="mi">500</span>  <span class="c1"># Maximum number of points to scrape in one go. This is deterined by the density of datapoints on the chart. </span>
</span><span id="TE_Scraper.tooltip_multiScrape-784"><a href="#TE_Scraper.tooltip_multiScrape-784"><span class="linenos">784</span></a>        <span class="n">total_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_index</span><span class="p">)</span> <span class="c1"># Total number of points in the x_index attribute.</span>
</span><span id="TE_Scraper.tooltip_multiScrape-785"><a href="#TE_Scraper.tooltip_multiScrape-785"><span class="linenos">785</span></a>        <span class="n">numscrapes</span> <span class="o">=</span> <span class="p">(</span><span class="n">total_len</span> <span class="o">+</span> <span class="n">max_chunk_size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="n">max_chunk_size</span>  <span class="c1"># Ceiling division</span>
</span><span id="TE_Scraper.tooltip_multiScrape-786"><a href="#TE_Scraper.tooltip_multiScrape-786"><span class="linenos">786</span></a>        <span class="n">sub_indexes</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1">#The index will be brken up into this list of subIndexes.</span>
</span><span id="TE_Scraper.tooltip_multiScrape-787"><a href="#TE_Scraper.tooltip_multiScrape-787"><span class="linenos">787</span></a>        <span class="n">base_size</span> <span class="o">=</span> <span class="n">total_len</span> <span class="o">//</span> <span class="n">numscrapes</span>
</span><span id="TE_Scraper.tooltip_multiScrape-788"><a href="#TE_Scraper.tooltip_multiScrape-788"><span class="linenos">788</span></a>        <span class="n">remainder</span> <span class="o">=</span> <span class="n">total_len</span> <span class="o">%</span> <span class="n">numscrapes</span>
</span><span id="TE_Scraper.tooltip_multiScrape-789"><a href="#TE_Scraper.tooltip_multiScrape-789"><span class="linenos">789</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; Using mixed scraping approach, slowest, highest accuracy. Splitting x_index into subIndexes</span><span class="se">\</span>
</span><span id="TE_Scraper.tooltip_multiScrape-790"><a href="#TE_Scraper.tooltip_multiScrape-790"><span class="linenos">790</span></a><span class="s2">        Total points: </span><span class="si">{</span><span class="n">total_len</span><span class="si">}</span><span class="s2">, Max chunk size: </span><span class="si">{</span><span class="n">max_chunk_size</span><span class="si">}</span><span class="s2">, Number of chunks: </span><span class="si">{</span><span class="n">numscrapes</span><span class="si">}</span><span class="s2">, remainder: </span><span class="si">{</span><span class="n">remainder</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.tooltip_multiScrape-791"><a href="#TE_Scraper.tooltip_multiScrape-791"><span class="linenos">791</span></a>
</span><span id="TE_Scraper.tooltip_multiScrape-792"><a href="#TE_Scraper.tooltip_multiScrape-792"><span class="linenos">792</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numscrapes</span><span class="p">):</span>
</span><span id="TE_Scraper.tooltip_multiScrape-793"><a href="#TE_Scraper.tooltip_multiScrape-793"><span class="linenos">793</span></a>            <span class="n">start_idx</span> <span class="o">=</span> <span class="n">i</span> <span class="o">*</span> <span class="n">base_size</span>
</span><span id="TE_Scraper.tooltip_multiScrape-794"><a href="#TE_Scraper.tooltip_multiScrape-794"><span class="linenos">794</span></a>            <span class="c1"># For last chunk, include all remaining points</span>
</span><span id="TE_Scraper.tooltip_multiScrape-795"><a href="#TE_Scraper.tooltip_multiScrape-795"><span class="linenos">795</span></a>            <span class="n">end_idx</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">base_size</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">numscrapes</span> <span class="o">-</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">total_len</span>
</span><span id="TE_Scraper.tooltip_multiScrape-796"><a href="#TE_Scraper.tooltip_multiScrape-796"><span class="linenos">796</span></a>            <span class="n">sub_indexes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_index</span><span class="p">[</span><span class="n">start_idx</span><span class="p">:</span><span class="n">end_idx</span><span class="p">])</span>
</span><span id="TE_Scraper.tooltip_multiScrape-797"><a href="#TE_Scraper.tooltip_multiScrape-797"><span class="linenos">797</span></a>
</span><span id="TE_Scraper.tooltip_multiScrape-798"><a href="#TE_Scraper.tooltip_multiScrape-798"><span class="linenos">798</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;x_index Start date: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">x_index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">, End date: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">x_index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.tooltip_multiScrape-799"><a href="#TE_Scraper.tooltip_multiScrape-799"><span class="linenos">799</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sub_indexes</span><span class="p">):</span> <span class="c1">#Chec</span>
</span><span id="TE_Scraper.tooltip_multiScrape-800"><a href="#TE_Scraper.tooltip_multiScrape-800"><span class="linenos">800</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SubIndex </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span><span class="si">}</span><span class="s2"> points, from </span><span class="si">{</span><span class="n">idx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">idx</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">, frequency: </span><span class="si">{</span><span class="n">pd</span><span class="o">.</span><span class="n">infer_freq</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.tooltip_multiScrape-801"><a href="#TE_Scraper.tooltip_multiScrape-801"><span class="linenos">801</span></a>            <span class="c1">#Set the date span on the chart to cover the subIndex.</span>
</span><span id="TE_Scraper.tooltip_multiScrape-802"><a href="#TE_Scraper.tooltip_multiScrape-802"><span class="linenos">802</span></a>            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">sub_indexes</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="TE_Scraper.tooltip_multiScrape-803"><a href="#TE_Scraper.tooltip_multiScrape-803"><span class="linenos">803</span></a>                <span class="n">end_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.tooltip_multiScrape-804"><a href="#TE_Scraper.tooltip_multiScrape-804"><span class="linenos">804</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="TE_Scraper.tooltip_multiScrape-805"><a href="#TE_Scraper.tooltip_multiScrape-805"><span class="linenos">805</span></a>                <span class="n">end_date</span> <span class="o">=</span> <span class="n">idx</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.tooltip_multiScrape-806"><a href="#TE_Scraper.tooltip_multiScrape-806"><span class="linenos">806</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">custom_date_span_js</span><span class="p">(</span><span class="n">start_date</span><span class="o">=</span><span class="n">idx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">),</span> <span class="n">end_date</span> <span class="o">=</span> <span class="n">end_date</span><span class="p">)</span>
</span><span id="TE_Scraper.tooltip_multiScrape-807"><a href="#TE_Scraper.tooltip_multiScrape-807"><span class="linenos">807</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">set_chartType_js</span><span class="p">(</span><span class="s2">&quot;Spline&quot;</span><span class="p">)</span> <span class="c1">#Force spline chart selection - needed for tootip capture</span>
</span><span id="TE_Scraper.tooltip_multiScrape-808"><a href="#TE_Scraper.tooltip_multiScrape-808"><span class="linenos">808</span></a>
</span><span id="TE_Scraper.tooltip_multiScrape-809"><a href="#TE_Scraper.tooltip_multiScrape-809"><span class="linenos">809</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="TE_Scraper.tooltip_multiScrape-810"><a href="#TE_Scraper.tooltip_multiScrape-810"><span class="linenos">810</span></a>                <span class="n">datapoints</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tooltip_scraper</span><span class="o">.</span><span class="n">latest_points_js</span><span class="p">(</span><span class="n">num_points</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">,</span> <span class="n">force_shortest_span</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">wait_time</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="TE_Scraper.tooltip_multiScrape-811"><a href="#TE_Scraper.tooltip_multiScrape-811"><span class="linenos">811</span></a>                <span class="c1">#Powerful one line pandas connversion...</span>
</span><span id="TE_Scraper.tooltip_multiScrape-812"><a href="#TE_Scraper.tooltip_multiScrape-812"><span class="linenos">812</span></a>                <span class="n">series</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="n">utils</span><span class="o">.</span><span class="n">extract_and_convert_value</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">datapoints</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> \
</span><span id="TE_Scraper.tooltip_multiScrape-813"><a href="#TE_Scraper.tooltip_multiScrape-813"><span class="linenos">813</span></a>                                    <span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">([</span><span class="n">utils</span><span class="o">.</span><span class="n">ready_datestr</span><span class="p">(</span><span class="n">date</span><span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">])</span> <span class="k">for</span> <span class="n">date</span> <span class="ow">in</span> <span class="n">datapoints</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
</span><span id="TE_Scraper.tooltip_multiScrape-814"><a href="#TE_Scraper.tooltip_multiScrape-814"><span class="linenos">814</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="TE_Scraper.tooltip_multiScrape-815"><a href="#TE_Scraper.tooltip_multiScrape-815"><span class="linenos">815</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Tooltip scraping of full series has failed, error: &quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="TE_Scraper.tooltip_multiScrape-816"><a href="#TE_Scraper.tooltip_multiScrape-816"><span class="linenos">816</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="TE_Scraper.tooltip_multiScrape-817"><a href="#TE_Scraper.tooltip_multiScrape-817"><span class="linenos">817</span></a>            
</span><span id="TE_Scraper.tooltip_multiScrape-818"><a href="#TE_Scraper.tooltip_multiScrape-818"><span class="linenos">818</span></a>            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="TE_Scraper.tooltip_multiScrape-819"><a href="#TE_Scraper.tooltip_multiScrape-819"><span class="linenos">819</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">series</span> <span class="o">=</span> <span class="n">series</span>
</span><span id="TE_Scraper.tooltip_multiScrape-820"><a href="#TE_Scraper.tooltip_multiScrape-820"><span class="linenos">820</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="TE_Scraper.tooltip_multiScrape-821"><a href="#TE_Scraper.tooltip_multiScrape-821"><span class="linenos">821</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">series</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="p">,</span> <span class="n">series</span><span class="p">],</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">])</span>
</span><span id="TE_Scraper.tooltip_multiScrape-822"><a href="#TE_Scraper.tooltip_multiScrape-822"><span class="linenos">822</span></a>
</span><span id="TE_Scraper.tooltip_multiScrape-823"><a href="#TE_Scraper.tooltip_multiScrape-823"><span class="linenos">823</span></a>        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;metadata&quot;</span><span class="p">):</span>
</span><span id="TE_Scraper.tooltip_multiScrape-824"><a href="#TE_Scraper.tooltip_multiScrape-824"><span class="linenos">824</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;start_date&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.tooltip_multiScrape-825"><a href="#TE_Scraper.tooltip_multiScrape-825"><span class="linenos">825</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;end_date&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.tooltip_multiScrape-826"><a href="#TE_Scraper.tooltip_multiScrape-826"><span class="linenos">826</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;min_value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
</span><span id="TE_Scraper.tooltip_multiScrape-827"><a href="#TE_Scraper.tooltip_multiScrape-827"><span class="linenos">827</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;max_value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
</span><span id="TE_Scraper.tooltip_multiScrape-828"><a href="#TE_Scraper.tooltip_multiScrape-828"><span class="linenos">828</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;length&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="p">)</span>
</span><span id="TE_Scraper.tooltip_multiScrape-829"><a href="#TE_Scraper.tooltip_multiScrape-829"><span class="linenos">829</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">series_metadata</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">)</span>
</span><span id="TE_Scraper.tooltip_multiScrape-830"><a href="#TE_Scraper.tooltip_multiScrape-830"><span class="linenos">830</span></a>
</span><span id="TE_Scraper.tooltip_multiScrape-831"><a href="#TE_Scraper.tooltip_multiScrape-831"><span class="linenos">831</span></a>        <span class="c1">##Sometimes the first and last data points seem to be missed, luckily we have them already in the start_end attribute.</span>
</span><span id="TE_Scraper.tooltip_multiScrape-832"><a href="#TE_Scraper.tooltip_multiScrape-832"><span class="linenos">832</span></a>        <span class="c1"># Overwrite the first and last points with the start_end values.</span>
</span><span id="TE_Scraper.tooltip_multiScrape-833"><a href="#TE_Scraper.tooltip_multiScrape-833"><span class="linenos">833</span></a>        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;start_end&quot;</span><span class="p">):</span>
</span><span id="TE_Scraper.tooltip_multiScrape-834"><a href="#TE_Scraper.tooltip_multiScrape-834"><span class="linenos">834</span></a>            <span class="c1"># Convert start_date and end_date to datetime objects</span>
</span><span id="TE_Scraper.tooltip_multiScrape-835"><a href="#TE_Scraper.tooltip_multiScrape-835"><span class="linenos">835</span></a>            <span class="n">start_date</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_end</span><span class="p">[</span><span class="s2">&quot;start_date&quot;</span><span class="p">])</span>
</span><span id="TE_Scraper.tooltip_multiScrape-836"><a href="#TE_Scraper.tooltip_multiScrape-836"><span class="linenos">836</span></a>            <span class="n">end_date</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_end</span><span class="p">[</span><span class="s2">&quot;end_date&quot;</span><span class="p">])</span>
</span><span id="TE_Scraper.tooltip_multiScrape-837"><a href="#TE_Scraper.tooltip_multiScrape-837"><span class="linenos">837</span></a>            <span class="c1"># Create Series objects for the start and end values</span>
</span><span id="TE_Scraper.tooltip_multiScrape-838"><a href="#TE_Scraper.tooltip_multiScrape-838"><span class="linenos">838</span></a>            <span class="n">start_series</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">({</span><span class="n">start_date</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_end</span><span class="p">[</span><span class="s2">&quot;start_value&quot;</span><span class="p">]})</span>
</span><span id="TE_Scraper.tooltip_multiScrape-839"><a href="#TE_Scraper.tooltip_multiScrape-839"><span class="linenos">839</span></a>            <span class="n">end_series</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">({</span><span class="n">end_date</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_end</span><span class="p">[</span><span class="s2">&quot;end_value&quot;</span><span class="p">]})</span>
</span><span id="TE_Scraper.tooltip_multiScrape-840"><a href="#TE_Scraper.tooltip_multiScrape-840"><span class="linenos">840</span></a>            <span class="c1"># Concatenate with the existing series</span>
</span><span id="TE_Scraper.tooltip_multiScrape-841"><a href="#TE_Scraper.tooltip_multiScrape-841"><span class="linenos">841</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">series</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">start_series</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="p">,</span> <span class="n">end_series</span><span class="p">])</span>
</span><span id="TE_Scraper.tooltip_multiScrape-842"><a href="#TE_Scraper.tooltip_multiScrape-842"><span class="linenos">842</span></a>            <span class="c1"># Drop duplicates keeping the last occurrence (which would be from start_end if dates already exist)</span>
</span><span id="TE_Scraper.tooltip_multiScrape-843"><a href="#TE_Scraper.tooltip_multiScrape-843"><span class="linenos">843</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">series</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="p">[</span><span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">duplicated</span><span class="p">(</span><span class="n">keep</span><span class="o">=</span><span class="s1">&#39;last&#39;</span><span class="p">)]</span>
</span><span id="TE_Scraper.tooltip_multiScrape-844"><a href="#TE_Scraper.tooltip_multiScrape-844"><span class="linenos">844</span></a>            <span class="c1"># Sort by index to ensure the datetime index is in ascending order</span>
</span><span id="TE_Scraper.tooltip_multiScrape-845"><a href="#TE_Scraper.tooltip_multiScrape-845"><span class="linenos">845</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">series</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">])</span>
</span><span id="TE_Scraper.tooltip_multiScrape-846"><a href="#TE_Scraper.tooltip_multiScrape-846"><span class="linenos">846</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully scraped full series from tooltips.&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.tooltip_multiScrape-847"><a href="#TE_Scraper.tooltip_multiScrape-847"><span class="linenos">847</span></a>        <span class="k">return</span> <span class="kc">True</span>
</span></pre></div>


            <div class="docstring"><p>Use the TooltipScraper object to scrape the full series from the chart. This is the most accurate method of scraping the full
series but s the slowest. The x_index attribute must be set before running this method. The method will use multiple runs
of the javascript tooltip scraping script. It will be done in multiple runs to prevent points being missed. Number of runs
will depend upon the length of the x_index attribute.</p>
</div>


                            </div>
                            <div id="TE_Scraper.series_from_highcharts" class="classattr">
                                        <input id="TE_Scraper.series_from_highcharts-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">series_from_highcharts</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="TE_Scraper.series_from_highcharts-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TE_Scraper.series_from_highcharts"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TE_Scraper.series_from_highcharts-849"><a href="#TE_Scraper.series_from_highcharts-849"><span class="linenos">849</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">series_from_highcharts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="TE_Scraper.series_from_highcharts-850"><a href="#TE_Scraper.series_from_highcharts-850"><span class="linenos">850</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the series data from the Highcharts JavaScript object. This is the fastest method of getting the series data from the chart.</span>
</span><span id="TE_Scraper.series_from_highcharts-851"><a href="#TE_Scraper.series_from_highcharts-851"><span class="linenos">851</span></a><span class="sd">        The series data is stored in the &quot;series&quot; attribute of the class. The method</span>
</span><span id="TE_Scraper.series_from_highcharts-852"><a href="#TE_Scraper.series_from_highcharts-852"><span class="linenos">852</span></a><span class="sd">        will return the series data as well. &quot;&quot;&quot;</span>
</span><span id="TE_Scraper.series_from_highcharts-853"><a href="#TE_Scraper.series_from_highcharts-853"><span class="linenos">853</span></a>
</span><span id="TE_Scraper.series_from_highcharts-854"><a href="#TE_Scraper.series_from_highcharts-854"><span class="linenos">854</span></a>        <span class="n">js_file_path</span> <span class="o">=</span> <span class="n">wd</span> <span class="o">+</span> <span class="n">fdel</span> <span class="o">+</span> <span class="s1">&#39;check_highcharts.js&#39;</span>
</span><span id="TE_Scraper.series_from_highcharts-855"><a href="#TE_Scraper.series_from_highcharts-855"><span class="linenos">855</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">js_file_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
</span><span id="TE_Scraper.series_from_highcharts-856"><a href="#TE_Scraper.series_from_highcharts-856"><span class="linenos">856</span></a>            <span class="n">script</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span><span id="TE_Scraper.series_from_highcharts-857"><a href="#TE_Scraper.series_from_highcharts-857"><span class="linenos">857</span></a>
</span><span id="TE_Scraper.series_from_highcharts-858"><a href="#TE_Scraper.series_from_highcharts-858"><span class="linenos">858</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="TE_Scraper.series_from_highcharts-859"><a href="#TE_Scraper.series_from_highcharts-859"><span class="linenos">859</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">execute_script</span><span class="p">(</span><span class="n">script</span><span class="p">)</span>
</span><span id="TE_Scraper.series_from_highcharts-860"><a href="#TE_Scraper.series_from_highcharts-860"><span class="linenos">860</span></a>            <span class="c1"># Extract the data points</span>
</span><span id="TE_Scraper.series_from_highcharts-861"><a href="#TE_Scraper.series_from_highcharts-861"><span class="linenos">861</span></a>            <span class="n">data_points</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;seriesData&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;points&#39;</span><span class="p">]</span>
</span><span id="TE_Scraper.series_from_highcharts-862"><a href="#TE_Scraper.series_from_highcharts-862"><span class="linenos">862</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="p">[(</span><span class="n">point</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">],</span> <span class="n">point</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">])</span> <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">data_points</span><span class="p">]</span>
</span><span id="TE_Scraper.series_from_highcharts-863"><a href="#TE_Scraper.series_from_highcharts-863"><span class="linenos">863</span></a>            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">])</span>
</span><span id="TE_Scraper.series_from_highcharts-864"><a href="#TE_Scraper.series_from_highcharts-864"><span class="linenos">864</span></a>            <span class="c1"># Convert timestamp to datetime</span>
</span><span id="TE_Scraper.series_from_highcharts-865"><a href="#TE_Scraper.series_from_highcharts-865"><span class="linenos">865</span></a>            <span class="n">df</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">],</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;ms&#39;</span><span class="p">)</span>
</span><span id="TE_Scraper.series_from_highcharts-866"><a href="#TE_Scraper.series_from_highcharts-866"><span class="linenos">866</span></a>            <span class="c1"># Set date as index</span>
</span><span id="TE_Scraper.series_from_highcharts-867"><a href="#TE_Scraper.series_from_highcharts-867"><span class="linenos">867</span></a>            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">)</span>
</span><span id="TE_Scraper.series_from_highcharts-868"><a href="#TE_Scraper.series_from_highcharts-868"><span class="linenos">868</span></a>
</span><span id="TE_Scraper.series_from_highcharts-869"><a href="#TE_Scraper.series_from_highcharts-869"><span class="linenos">869</span></a>            <span class="n">series</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">])</span>
</span><span id="TE_Scraper.series_from_highcharts-870"><a href="#TE_Scraper.series_from_highcharts-870"><span class="linenos">870</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">series</span> <span class="o">=</span> <span class="n">series</span>
</span><span id="TE_Scraper.series_from_highcharts-871"><a href="#TE_Scraper.series_from_highcharts-871"><span class="linenos">871</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully extracted series data from Highcharts.&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.series_from_highcharts-872"><a href="#TE_Scraper.series_from_highcharts-872"><span class="linenos">872</span></a>            <span class="n">freq</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">infer_freq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="c1"># Infer the frequency of the series.</span>
</span><span id="TE_Scraper.series_from_highcharts-873"><a href="#TE_Scraper.series_from_highcharts-873"><span class="linenos">873</span></a>            <span class="k">if</span> <span class="n">freq</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TE_Scraper.series_from_highcharts-874"><a href="#TE_Scraper.series_from_highcharts-874"><span class="linenos">874</span></a>                <span class="n">freq</span> <span class="o">=</span> <span class="s2">&quot;Unknown/irregular&quot;</span>
</span><span id="TE_Scraper.series_from_highcharts-875"><a href="#TE_Scraper.series_from_highcharts-875"><span class="linenos">875</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;frequency&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">freq</span>
</span><span id="TE_Scraper.series_from_highcharts-876"><a href="#TE_Scraper.series_from_highcharts-876"><span class="linenos">876</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;start_date&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.series_from_highcharts-877"><a href="#TE_Scraper.series_from_highcharts-877"><span class="linenos">877</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;end_date&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.series_from_highcharts-878"><a href="#TE_Scraper.series_from_highcharts-878"><span class="linenos">878</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;min_value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
</span><span id="TE_Scraper.series_from_highcharts-879"><a href="#TE_Scraper.series_from_highcharts-879"><span class="linenos">879</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;max_value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
</span><span id="TE_Scraper.series_from_highcharts-880"><a href="#TE_Scraper.series_from_highcharts-880"><span class="linenos">880</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;length&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="p">)</span>
</span><span id="TE_Scraper.series_from_highcharts-881"><a href="#TE_Scraper.series_from_highcharts-881"><span class="linenos">881</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">series_metadata</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">)</span>
</span><span id="TE_Scraper.series_from_highcharts-882"><a href="#TE_Scraper.series_from_highcharts-882"><span class="linenos">882</span></a>            
</span><span id="TE_Scraper.series_from_highcharts-883"><a href="#TE_Scraper.series_from_highcharts-883"><span class="linenos">883</span></a>            <span class="k">return</span> <span class="n">series</span>
</span><span id="TE_Scraper.series_from_highcharts-884"><a href="#TE_Scraper.series_from_highcharts-884"><span class="linenos">884</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="TE_Scraper.series_from_highcharts-885"><a href="#TE_Scraper.series_from_highcharts-885"><span class="linenos">885</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error extracting series from Highcharts: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.series_from_highcharts-886"><a href="#TE_Scraper.series_from_highcharts-886"><span class="linenos">886</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span></pre></div>


            <div class="docstring"><p>Get the series data from the Highcharts JavaScript object. This is the fastest method of getting the series data from the chart.
The series data is stored in the "series" attribute of the class. The method
will return the series data as well.</p>
</div>


                            </div>
                            <div id="TE_Scraper.get_chart_type_from_highcharts" class="classattr">
                                        <input id="TE_Scraper.get_chart_type_from_highcharts-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_chart_type_from_highcharts</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="TE_Scraper.get_chart_type_from_highcharts-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TE_Scraper.get_chart_type_from_highcharts"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TE_Scraper.get_chart_type_from_highcharts-888"><a href="#TE_Scraper.get_chart_type_from_highcharts-888"><span class="linenos">888</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_chart_type_from_highcharts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="TE_Scraper.get_chart_type_from_highcharts-889"><a href="#TE_Scraper.get_chart_type_from_highcharts-889"><span class="linenos">889</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TE_Scraper.get_chart_type_from_highcharts-890"><a href="#TE_Scraper.get_chart_type_from_highcharts-890"><span class="linenos">890</span></a><span class="sd">        Get the chart type directly from the Highcharts API.</span>
</span><span id="TE_Scraper.get_chart_type_from_highcharts-891"><a href="#TE_Scraper.get_chart_type_from_highcharts-891"><span class="linenos">891</span></a><span class="sd">        This is the most reliable way to determine chart type.</span>
</span><span id="TE_Scraper.get_chart_type_from_highcharts-892"><a href="#TE_Scraper.get_chart_type_from_highcharts-892"><span class="linenos">892</span></a><span class="sd">        </span>
</span><span id="TE_Scraper.get_chart_type_from_highcharts-893"><a href="#TE_Scraper.get_chart_type_from_highcharts-893"><span class="linenos">893</span></a><span class="sd">        Returns:</span>
</span><span id="TE_Scraper.get_chart_type_from_highcharts-894"><a href="#TE_Scraper.get_chart_type_from_highcharts-894"><span class="linenos">894</span></a><span class="sd">            dict: Chart type information including main type, series types, and point count</span>
</span><span id="TE_Scraper.get_chart_type_from_highcharts-895"><a href="#TE_Scraper.get_chart_type_from_highcharts-895"><span class="linenos">895</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TE_Scraper.get_chart_type_from_highcharts-896"><a href="#TE_Scraper.get_chart_type_from_highcharts-896"><span class="linenos">896</span></a>        <span class="n">script</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
</span><span id="TE_Scraper.get_chart_type_from_highcharts-897"><a href="#TE_Scraper.get_chart_type_from_highcharts-897"><span class="linenos">897</span></a><span class="s2">        try {</span>
</span><span id="TE_Scraper.get_chart_type_from_highcharts-898"><a href="#TE_Scraper.get_chart_type_from_highcharts-898"><span class="linenos">898</span></a><span class="s2">            if (typeof Highcharts === &#39;undefined&#39;) {</span>
</span><span id="TE_Scraper.get_chart_type_from_highcharts-899"><a href="#TE_Scraper.get_chart_type_from_highcharts-899"><span class="linenos">899</span></a><span class="s2">                return { error: &quot;Highcharts not found&quot;, success: false };</span>
</span><span id="TE_Scraper.get_chart_type_from_highcharts-900"><a href="#TE_Scraper.get_chart_type_from_highcharts-900"><span class="linenos">900</span></a><span class="s2">            }</span>
</span><span id="TE_Scraper.get_chart_type_from_highcharts-901"><a href="#TE_Scraper.get_chart_type_from_highcharts-901"><span class="linenos">901</span></a><span class="s2">            </span>
</span><span id="TE_Scraper.get_chart_type_from_highcharts-902"><a href="#TE_Scraper.get_chart_type_from_highcharts-902"><span class="linenos">902</span></a><span class="s2">            const chart = Highcharts.charts.find(c =&gt; c &amp;&amp; c.series &amp;&amp; c.series.length &gt; 0);</span>
</span><span id="TE_Scraper.get_chart_type_from_highcharts-903"><a href="#TE_Scraper.get_chart_type_from_highcharts-903"><span class="linenos">903</span></a><span class="s2">            if (!chart) {</span>
</span><span id="TE_Scraper.get_chart_type_from_highcharts-904"><a href="#TE_Scraper.get_chart_type_from_highcharts-904"><span class="linenos">904</span></a><span class="s2">                return { error: &quot;No valid chart found&quot;, success: false };</span>
</span><span id="TE_Scraper.get_chart_type_from_highcharts-905"><a href="#TE_Scraper.get_chart_type_from_highcharts-905"><span class="linenos">905</span></a><span class="s2">            }</span>
</span><span id="TE_Scraper.get_chart_type_from_highcharts-906"><a href="#TE_Scraper.get_chart_type_from_highcharts-906"><span class="linenos">906</span></a><span class="s2">            </span>
</span><span id="TE_Scraper.get_chart_type_from_highcharts-907"><a href="#TE_Scraper.get_chart_type_from_highcharts-907"><span class="linenos">907</span></a><span class="s2">            return {</span>
</span><span id="TE_Scraper.get_chart_type_from_highcharts-908"><a href="#TE_Scraper.get_chart_type_from_highcharts-908"><span class="linenos">908</span></a><span class="s2">                mainType: chart.options?.chart?.type || &quot;unknown&quot;,</span>
</span><span id="TE_Scraper.get_chart_type_from_highcharts-909"><a href="#TE_Scraper.get_chart_type_from_highcharts-909"><span class="linenos">909</span></a><span class="s2">                seriesTypes: chart.series.map(s =&gt; ({</span>
</span><span id="TE_Scraper.get_chart_type_from_highcharts-910"><a href="#TE_Scraper.get_chart_type_from_highcharts-910"><span class="linenos">910</span></a><span class="s2">                    name: s.name,</span>
</span><span id="TE_Scraper.get_chart_type_from_highcharts-911"><a href="#TE_Scraper.get_chart_type_from_highcharts-911"><span class="linenos">911</span></a><span class="s2">                    type: s.type || chart.options?.chart?.type</span>
</span><span id="TE_Scraper.get_chart_type_from_highcharts-912"><a href="#TE_Scraper.get_chart_type_from_highcharts-912"><span class="linenos">912</span></a><span class="s2">                })),</span>
</span><span id="TE_Scraper.get_chart_type_from_highcharts-913"><a href="#TE_Scraper.get_chart_type_from_highcharts-913"><span class="linenos">913</span></a><span class="s2">                pointCount: chart.series[0]?.points?.length || 0,</span>
</span><span id="TE_Scraper.get_chart_type_from_highcharts-914"><a href="#TE_Scraper.get_chart_type_from_highcharts-914"><span class="linenos">914</span></a><span class="s2">                success: true</span>
</span><span id="TE_Scraper.get_chart_type_from_highcharts-915"><a href="#TE_Scraper.get_chart_type_from_highcharts-915"><span class="linenos">915</span></a><span class="s2">            };</span>
</span><span id="TE_Scraper.get_chart_type_from_highcharts-916"><a href="#TE_Scraper.get_chart_type_from_highcharts-916"><span class="linenos">916</span></a><span class="s2">        } catch (e) {</span>
</span><span id="TE_Scraper.get_chart_type_from_highcharts-917"><a href="#TE_Scraper.get_chart_type_from_highcharts-917"><span class="linenos">917</span></a><span class="s2">            return { error: &quot;JavaScript error: &quot; + e.message, success: false };</span>
</span><span id="TE_Scraper.get_chart_type_from_highcharts-918"><a href="#TE_Scraper.get_chart_type_from_highcharts-918"><span class="linenos">918</span></a><span class="s2">        }</span>
</span><span id="TE_Scraper.get_chart_type_from_highcharts-919"><a href="#TE_Scraper.get_chart_type_from_highcharts-919"><span class="linenos">919</span></a><span class="s2">        &quot;&quot;&quot;</span>
</span><span id="TE_Scraper.get_chart_type_from_highcharts-920"><a href="#TE_Scraper.get_chart_type_from_highcharts-920"><span class="linenos">920</span></a>        
</span><span id="TE_Scraper.get_chart_type_from_highcharts-921"><a href="#TE_Scraper.get_chart_type_from_highcharts-921"><span class="linenos">921</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="TE_Scraper.get_chart_type_from_highcharts-922"><a href="#TE_Scraper.get_chart_type_from_highcharts-922"><span class="linenos">922</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">execute_script</span><span class="p">(</span><span class="n">script</span><span class="p">)</span>
</span><span id="TE_Scraper.get_chart_type_from_highcharts-923"><a href="#TE_Scraper.get_chart_type_from_highcharts-923"><span class="linenos">923</span></a>            <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TE_Scraper.get_chart_type_from_highcharts-924"><a href="#TE_Scraper.get_chart_type_from_highcharts-924"><span class="linenos">924</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;JavaScript execution returned None - Highcharts API may not be accessible&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.get_chart_type_from_highcharts-925"><a href="#TE_Scraper.get_chart_type_from_highcharts-925"><span class="linenos">925</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="TE_Scraper.get_chart_type_from_highcharts-926"><a href="#TE_Scraper.get_chart_type_from_highcharts-926"><span class="linenos">926</span></a>                
</span><span id="TE_Scraper.get_chart_type_from_highcharts-927"><a href="#TE_Scraper.get_chart_type_from_highcharts-927"><span class="linenos">927</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Result: &#39;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
</span><span id="TE_Scraper.get_chart_type_from_highcharts-928"><a href="#TE_Scraper.get_chart_type_from_highcharts-928"><span class="linenos">928</span></a>            <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;success&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="TE_Scraper.get_chart_type_from_highcharts-929"><a href="#TE_Scraper.get_chart_type_from_highcharts-929"><span class="linenos">929</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span><span class="o">+</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;seriesTypes&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;Chart&quot;</span>
</span><span id="TE_Scraper.get_chart_type_from_highcharts-930"><a href="#TE_Scraper.get_chart_type_from_highcharts-930"><span class="linenos">930</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Chart type detected from Highcharts API: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.get_chart_type_from_highcharts-931"><a href="#TE_Scraper.get_chart_type_from_highcharts-931"><span class="linenos">931</span></a>                <span class="k">return</span> <span class="n">result</span>
</span><span id="TE_Scraper.get_chart_type_from_highcharts-932"><a href="#TE_Scraper.get_chart_type_from_highcharts-932"><span class="linenos">932</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="TE_Scraper.get_chart_type_from_highcharts-933"><a href="#TE_Scraper.get_chart_type_from_highcharts-933"><span class="linenos">933</span></a>                <span class="n">error_msg</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="s1">&#39;Unknown error&#39;</span><span class="p">)</span>
</span><span id="TE_Scraper.get_chart_type_from_highcharts-934"><a href="#TE_Scraper.get_chart_type_from_highcharts-934"><span class="linenos">934</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to detect chart type: </span><span class="si">{</span><span class="n">error_msg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.get_chart_type_from_highcharts-935"><a href="#TE_Scraper.get_chart_type_from_highcharts-935"><span class="linenos">935</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="TE_Scraper.get_chart_type_from_highcharts-936"><a href="#TE_Scraper.get_chart_type_from_highcharts-936"><span class="linenos">936</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="TE_Scraper.get_chart_type_from_highcharts-937"><a href="#TE_Scraper.get_chart_type_from_highcharts-937"><span class="linenos">937</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error detecting chart type: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.get_chart_type_from_highcharts-938"><a href="#TE_Scraper.get_chart_type_from_highcharts-938"><span class="linenos">938</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span></pre></div>


            <div class="docstring"><p>Get the chart type directly from the Highcharts API.
This is the most reliable way to determine chart type.</p>

<p>Returns:
    dict: Chart type information including main type, series types, and point count</p>
</div>


                            </div>
                            <div id="TE_Scraper.set_chartType_highcharts" class="classattr">
                                        <input id="TE_Scraper.set_chartType_highcharts-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_chartType_highcharts</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">chart_type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;Column&#39;</span><span class="p">,</span> <span class="s1">&#39;Spline&#39;</span><span class="p">,</span> <span class="s1">&#39;Areaspline&#39;</span><span class="p">,</span> <span class="s1">&#39;Stepline&#39;</span><span class="p">,</span> <span class="s1">&#39;Line&#39;</span><span class="p">,</span> <span class="s1">&#39;Area&#39;</span><span class="p">]</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="TE_Scraper.set_chartType_highcharts-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TE_Scraper.set_chartType_highcharts"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TE_Scraper.set_chartType_highcharts-940"><a href="#TE_Scraper.set_chartType_highcharts-940"><span class="linenos">940</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_chartType_highcharts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chart_type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;Column&#39;</span><span class="p">,</span> <span class="s1">&#39;Spline&#39;</span><span class="p">,</span> <span class="s1">&#39;Areaspline&#39;</span><span class="p">,</span> <span class="s1">&#39;Stepline&#39;</span><span class="p">,</span> <span class="s1">&#39;Line&#39;</span><span class="p">,</span> <span class="s1">&#39;Area&#39;</span><span class="p">]):</span>
</span><span id="TE_Scraper.set_chartType_highcharts-941"><a href="#TE_Scraper.set_chartType_highcharts-941"><span class="linenos">941</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Set chart type directly using Highcharts API, unsure if this is working properly yet. This should be the most reliable way to set the chart type.</span>
</span><span id="TE_Scraper.set_chartType_highcharts-942"><a href="#TE_Scraper.set_chartType_highcharts-942"><span class="linenos">942</span></a><span class="sd">        List chart types: &#39;Column&#39;, &#39;Spline&#39;, &#39;Areaspline&#39;, &#39;Stepline&#39;, &#39;Line&#39;, &#39;Area&#39;, list them by veiwing chart_types attribute of the TE_Scraper.&quot;&quot;&quot;</span>
</span><span id="TE_Scraper.set_chartType_highcharts-943"><a href="#TE_Scraper.set_chartType_highcharts-943"><span class="linenos">943</span></a>        
</span><span id="TE_Scraper.set_chartType_highcharts-944"><a href="#TE_Scraper.set_chartType_highcharts-944"><span class="linenos">944</span></a>        <span class="n">script</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="TE_Scraper.set_chartType_highcharts-945"><a href="#TE_Scraper.set_chartType_highcharts-945"><span class="linenos">945</span></a><span class="s2">        (() =&gt; </span><span class="se">{{</span>
</span><span id="TE_Scraper.set_chartType_highcharts-946"><a href="#TE_Scraper.set_chartType_highcharts-946"><span class="linenos">946</span></a><span class="s2">        if (typeof Highcharts === &#39;undefined&#39;) return false;</span>
</span><span id="TE_Scraper.set_chartType_highcharts-947"><a href="#TE_Scraper.set_chartType_highcharts-947"><span class="linenos">947</span></a><span class="s2">        </span>
</span><span id="TE_Scraper.set_chartType_highcharts-948"><a href="#TE_Scraper.set_chartType_highcharts-948"><span class="linenos">948</span></a><span class="s2">        const chart = Highcharts.charts.find(c =&gt; c &amp;&amp; c.series &amp;&amp; c.series.length &gt; 0);</span>
</span><span id="TE_Scraper.set_chartType_highcharts-949"><a href="#TE_Scraper.set_chartType_highcharts-949"><span class="linenos">949</span></a><span class="s2">        if (!chart) return false;</span>
</span><span id="TE_Scraper.set_chartType_highcharts-950"><a href="#TE_Scraper.set_chartType_highcharts-950"><span class="linenos">950</span></a><span class="s2">        </span>
</span><span id="TE_Scraper.set_chartType_highcharts-951"><a href="#TE_Scraper.set_chartType_highcharts-951"><span class="linenos">951</span></a><span class="s2">        // Store current type</span>
</span><span id="TE_Scraper.set_chartType_highcharts-952"><a href="#TE_Scraper.set_chartType_highcharts-952"><span class="linenos">952</span></a><span class="s2">        const currentType = chart.options?.chart?.type;</span>
</span><span id="TE_Scraper.set_chartType_highcharts-953"><a href="#TE_Scraper.set_chartType_highcharts-953"><span class="linenos">953</span></a><span class="s2">        </span>
</span><span id="TE_Scraper.set_chartType_highcharts-954"><a href="#TE_Scraper.set_chartType_highcharts-954"><span class="linenos">954</span></a><span class="s2">        // Set new type for all series</span>
</span><span id="TE_Scraper.set_chartType_highcharts-955"><a href="#TE_Scraper.set_chartType_highcharts-955"><span class="linenos">955</span></a><span class="s2">        chart.update(</span><span class="se">{{</span><span class="s2"> chart: </span><span class="se">{{</span><span class="s2"> type: &#39;</span><span class="si">{</span><span class="n">chart_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">&#39; </span><span class="se">}}</span><span class="s2"> </span><span class="se">}}</span><span class="s2">);</span>
</span><span id="TE_Scraper.set_chartType_highcharts-956"><a href="#TE_Scraper.set_chartType_highcharts-956"><span class="linenos">956</span></a><span class="s2">        </span>
</span><span id="TE_Scraper.set_chartType_highcharts-957"><a href="#TE_Scraper.set_chartType_highcharts-957"><span class="linenos">957</span></a><span class="s2">        return true;</span>
</span><span id="TE_Scraper.set_chartType_highcharts-958"><a href="#TE_Scraper.set_chartType_highcharts-958"><span class="linenos">958</span></a><span class="s2">        </span><span class="se">}}</span><span class="s2">)();</span>
</span><span id="TE_Scraper.set_chartType_highcharts-959"><a href="#TE_Scraper.set_chartType_highcharts-959"><span class="linenos">959</span></a><span class="s2">        &quot;&quot;&quot;</span>
</span><span id="TE_Scraper.set_chartType_highcharts-960"><a href="#TE_Scraper.set_chartType_highcharts-960"><span class="linenos">960</span></a>        
</span><span id="TE_Scraper.set_chartType_highcharts-961"><a href="#TE_Scraper.set_chartType_highcharts-961"><span class="linenos">961</span></a>        <span class="n">success</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">execute_script</span><span class="p">(</span><span class="n">script</span><span class="p">)</span>
</span><span id="TE_Scraper.set_chartType_highcharts-962"><a href="#TE_Scraper.set_chartType_highcharts-962"><span class="linenos">962</span></a>        
</span><span id="TE_Scraper.set_chartType_highcharts-963"><a href="#TE_Scraper.set_chartType_highcharts-963"><span class="linenos">963</span></a>        <span class="k">if</span> <span class="n">success</span><span class="p">:</span>
</span><span id="TE_Scraper.set_chartType_highcharts-964"><a href="#TE_Scraper.set_chartType_highcharts-964"><span class="linenos">964</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span> <span class="o">=</span> <span class="n">chart_type</span>
</span><span id="TE_Scraper.set_chartType_highcharts-965"><a href="#TE_Scraper.set_chartType_highcharts-965"><span class="linenos">965</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Chart type set to: </span><span class="si">{</span><span class="n">chart_type</span><span class="si">}</span><span class="s2"> (using Highcharts API)&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.set_chartType_highcharts-966"><a href="#TE_Scraper.set_chartType_highcharts-966"><span class="linenos">966</span></a>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
</span><span id="TE_Scraper.set_chartType_highcharts-967"><a href="#TE_Scraper.set_chartType_highcharts-967"><span class="linenos">967</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">update_chart</span><span class="p">()</span>
</span><span id="TE_Scraper.set_chartType_highcharts-968"><a href="#TE_Scraper.set_chartType_highcharts-968"><span class="linenos">968</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="TE_Scraper.set_chartType_highcharts-969"><a href="#TE_Scraper.set_chartType_highcharts-969"><span class="linenos">969</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="TE_Scraper.set_chartType_highcharts-970"><a href="#TE_Scraper.set_chartType_highcharts-970"><span class="linenos">970</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error setting chart type: </span><span class="si">{</span><span class="n">chart_type</span><span class="si">}</span><span class="s2"> (using Highcharts API)&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.set_chartType_highcharts-971"><a href="#TE_Scraper.set_chartType_highcharts-971"><span class="linenos">971</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span></pre></div>


            <div class="docstring"><p>Set chart type directly using Highcharts API, unsure if this is working properly yet. This should be the most reliable way to set the chart type.
List chart types: 'Column', 'Spline', 'Areaspline', 'Stepline', 'Line', 'Area', list them by veiwing chart_types attribute of the TE_Scraper.</p>
</div>


                            </div>
                            <div id="TE_Scraper.get_y_axis" class="classattr">
                                        <input id="TE_Scraper.get_y_axis-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_y_axis</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">update_chart</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>, </span><span class="param"><span class="n">set_global_y_axis</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="TE_Scraper.get_y_axis-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TE_Scraper.get_y_axis"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TE_Scraper.get_y_axis-973"><a href="#TE_Scraper.get_y_axis-973"><span class="linenos"> 973</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_y_axis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">update_chart</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">set_global_y_axis</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="TE_Scraper.get_y_axis-974"><a href="#TE_Scraper.get_y_axis-974"><span class="linenos"> 974</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get y-axis values from chart to make a y-axis series with tick labels and positions (pixel positions).</span>
</span><span id="TE_Scraper.get_y_axis-975"><a href="#TE_Scraper.get_y_axis-975"><span class="linenos"> 975</span></a><span class="sd">        Also gets the limits of both axis in pixel co-ordinates. A series containing the y-axis values and their pixel positions (as index) is assigned</span>
</span><span id="TE_Scraper.get_y_axis-976"><a href="#TE_Scraper.get_y_axis-976"><span class="linenos"> 976</span></a><span class="sd">        to the &quot;y_axis&quot; attribute. The &quot;axis_limits&quot; attribute is made too &amp; is  dictionary containing the pixel co-ordinates of the max and min for both x and y axis.</span>
</span><span id="TE_Scraper.get_y_axis-977"><a href="#TE_Scraper.get_y_axis-977"><span class="linenos"> 977</span></a>
</span><span id="TE_Scraper.get_y_axis-978"><a href="#TE_Scraper.get_y_axis-978"><span class="linenos"> 978</span></a><span class="sd">        **Parameters:**</span>
</span><span id="TE_Scraper.get_y_axis-979"><a href="#TE_Scraper.get_y_axis-979"><span class="linenos"> 979</span></a><span class="sd">        - update_chart (bool): Whether to update the chart before scraping the y-axis values. Default is False.</span>
</span><span id="TE_Scraper.get_y_axis-980"><a href="#TE_Scraper.get_y_axis-980"><span class="linenos"> 980</span></a><span class="sd">        - set_global_y_axis (bool): Whether to set the y-axis series as a global attribute of the class. Default is False.</span>
</span><span id="TE_Scraper.get_y_axis-981"><a href="#TE_Scraper.get_y_axis-981"><span class="linenos"> 981</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TE_Scraper.get_y_axis-982"><a href="#TE_Scraper.get_y_axis-982"><span class="linenos"> 982</span></a>
</span><span id="TE_Scraper.get_y_axis-983"><a href="#TE_Scraper.get_y_axis-983"><span class="linenos"> 983</span></a>        <span class="c1">##Get positions of y-axis gridlines</span>
</span><span id="TE_Scraper.get_y_axis-984"><a href="#TE_Scraper.get_y_axis-984"><span class="linenos"> 984</span></a>        <span class="n">y_heights</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="TE_Scraper.get_y_axis-985"><a href="#TE_Scraper.get_y_axis-985"><span class="linenos"> 985</span></a>        <span class="k">if</span> <span class="n">update_chart</span><span class="p">:</span>
</span><span id="TE_Scraper.get_y_axis-986"><a href="#TE_Scraper.get_y_axis-986"><span class="linenos"> 986</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">update_chart</span><span class="p">()</span>
</span><span id="TE_Scraper.get_y_axis-987"><a href="#TE_Scraper.get_y_axis-987"><span class="linenos"> 987</span></a>        <span class="k">if</span> <span class="n">set_global_y_axis</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">date_span</span> <span class="o">!=</span> <span class="s2">&quot;MAX&quot;</span><span class="p">:</span>
</span><span id="TE_Scraper.get_y_axis-988"><a href="#TE_Scraper.get_y_axis-988"><span class="linenos"> 988</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">set_date_span</span><span class="p">(</span><span class="s2">&quot;MAX&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.get_y_axis-989"><a href="#TE_Scraper.get_y_axis-989"><span class="linenos"> 989</span></a>
</span><span id="TE_Scraper.get_y_axis-990"><a href="#TE_Scraper.get_y_axis-990"><span class="linenos"> 990</span></a>        <span class="c1">## First get the pixel values of the max and min for both x and y axis.</span>
</span><span id="TE_Scraper.get_y_axis-991"><a href="#TE_Scraper.get_y_axis-991"><span class="linenos"> 991</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">axis_limits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_axis_limits</span><span class="p">()</span>
</span><span id="TE_Scraper.get_y_axis-992"><a href="#TE_Scraper.get_y_axis-992"><span class="linenos"> 992</span></a>
</span><span id="TE_Scraper.get_y_axis-993"><a href="#TE_Scraper.get_y_axis-993"><span class="linenos"> 993</span></a>        <span class="n">ygrid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_soup</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;g.highcharts-grid.highcharts-yaxis-grid&#39;</span><span class="p">)</span>
</span><span id="TE_Scraper.get_y_axis-994"><a href="#TE_Scraper.get_y_axis-994"><span class="linenos"> 994</span></a>        <span class="n">gridlines</span> <span class="o">=</span> <span class="n">ygrid</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">findAll</span><span class="p">(</span><span class="s1">&#39;path&#39;</span><span class="p">)</span>
</span><span id="TE_Scraper.get_y_axis-995"><a href="#TE_Scraper.get_y_axis-995"><span class="linenos"> 995</span></a>        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">gridlines</span><span class="p">:</span>
</span><span id="TE_Scraper.get_y_axis-996"><a href="#TE_Scraper.get_y_axis-996"><span class="linenos"> 996</span></a>            <span class="n">y_heights</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
</span><span id="TE_Scraper.get_y_axis-997"><a href="#TE_Scraper.get_y_axis-997"><span class="linenos"> 997</span></a>        <span class="n">y_heights</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">y_heights</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="TE_Scraper.get_y_axis-998"><a href="#TE_Scraper.get_y_axis-998"><span class="linenos"> 998</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;y_heights: &quot;</span><span class="p">,</span> <span class="n">y_heights</span><span class="p">)</span>
</span><span id="TE_Scraper.get_y_axis-999"><a href="#TE_Scraper.get_y_axis-999"><span class="linenos"> 999</span></a>
</span><span id="TE_Scraper.get_y_axis-1000"><a href="#TE_Scraper.get_y_axis-1000"><span class="linenos">1000</span></a>        <span class="c1">##Get y-axis labels</span>
</span><span id="TE_Scraper.get_y_axis-1001"><a href="#TE_Scraper.get_y_axis-1001"><span class="linenos">1001</span></a>        <span class="n">yax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_soup</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;g.highcharts-axis-labels.highcharts-yaxis-labels&#39;</span><span class="p">)</span>
</span><span id="TE_Scraper.get_y_axis-1002"><a href="#TE_Scraper.get_y_axis-1002"><span class="linenos">1002</span></a>        <span class="n">textels</span> <span class="o">=</span> <span class="n">yax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s1">&#39;text&#39;</span><span class="p">)</span>
</span><span id="TE_Scraper.get_y_axis-1003"><a href="#TE_Scraper.get_y_axis-1003"><span class="linenos">1003</span></a>
</span><span id="TE_Scraper.get_y_axis-1004"><a href="#TE_Scraper.get_y_axis-1004"><span class="linenos">1004</span></a>        <span class="c1"># Replace metrc prefixes:</span>
</span><span id="TE_Scraper.get_y_axis-1005"><a href="#TE_Scraper.get_y_axis-1005"><span class="linenos">1005</span></a>        <span class="n">yaxlabs</span> <span class="o">=</span> <span class="p">[</span><span class="n">utils</span><span class="o">.</span><span class="n">extract_and_convert_value</span><span class="p">(</span><span class="n">text</span><span class="o">.</span><span class="n">get_text</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">text</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">isalnum</span><span class="p">()</span> <span class="k">else</span> <span class="n">text</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span> <span class="k">for</span> <span class="n">text</span> <span class="ow">in</span> <span class="n">textels</span><span class="p">]</span>
</span><span id="TE_Scraper.get_y_axis-1006"><a href="#TE_Scraper.get_y_axis-1006"><span class="linenos">1006</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;y-axis labels: </span><span class="si">{</span><span class="n">yaxlabs</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.get_y_axis-1007"><a href="#TE_Scraper.get_y_axis-1007"><span class="linenos">1007</span></a>
</span><span id="TE_Scraper.get_y_axis-1008"><a href="#TE_Scraper.get_y_axis-1008"><span class="linenos">1008</span></a>        <span class="c1"># convert to float...</span>
</span><span id="TE_Scraper.get_y_axis-1009"><a href="#TE_Scraper.get_y_axis-1009"><span class="linenos">1009</span></a>        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">yaxlabs</span><span class="p">):</span>
</span><span id="TE_Scraper.get_y_axis-1010"><a href="#TE_Scraper.get_y_axis-1010"><span class="linenos">1010</span></a>            <span class="n">yaxlabs</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="nb">str</span><span class="o">.</span><span class="n">isdigit</span><span class="p">,</span> <span class="n">i</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))))</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">yaxlabs</span><span class="p">]</span>
</span><span id="TE_Scraper.get_y_axis-1011"><a href="#TE_Scraper.get_y_axis-1011"><span class="linenos">1011</span></a>        <span class="n">pixheights</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">height</span><span class="p">)</span> <span class="k">for</span> <span class="n">height</span> <span class="ow">in</span> <span class="n">y_heights</span><span class="p">]</span>
</span><span id="TE_Scraper.get_y_axis-1012"><a href="#TE_Scraper.get_y_axis-1012"><span class="linenos">1012</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;pixheights: &quot;</span><span class="p">,</span> <span class="n">pixheights</span><span class="p">)</span>
</span><span id="TE_Scraper.get_y_axis-1013"><a href="#TE_Scraper.get_y_axis-1013"><span class="linenos">1013</span></a>
</span><span id="TE_Scraper.get_y_axis-1014"><a href="#TE_Scraper.get_y_axis-1014"><span class="linenos">1014</span></a>        <span class="c1">##Get px per unit for y-axis</span>
</span><span id="TE_Scraper.get_y_axis-1015"><a href="#TE_Scraper.get_y_axis-1015"><span class="linenos">1015</span></a>        <span class="n">pxPerUnit</span> <span class="o">=</span> <span class="p">[</span><span class="nb">abs</span><span class="p">((</span><span class="n">yaxlabs</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span> <span class="n">yaxlabs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="n">pixheights</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span> <span class="n">pixheights</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pixheights</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)]</span>
</span><span id="TE_Scraper.get_y_axis-1016"><a href="#TE_Scraper.get_y_axis-1016"><span class="linenos">1016</span></a>        <span class="n">average</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">pxPerUnit</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">pxPerUnit</span><span class="p">)</span>
</span><span id="TE_Scraper.get_y_axis-1017"><a href="#TE_Scraper.get_y_axis-1017"><span class="linenos">1017</span></a>        <span class="k">if</span> <span class="n">set_global_y_axis</span><span class="p">:</span>
</span><span id="TE_Scraper.get_y_axis-1018"><a href="#TE_Scraper.get_y_axis-1018"><span class="linenos">1018</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">unit_per_pix</span> <span class="o">=</span> <span class="n">average</span>
</span><span id="TE_Scraper.get_y_axis-1019"><a href="#TE_Scraper.get_y_axis-1019"><span class="linenos">1019</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Average px per unit for y-axis: </span><span class="si">{</span><span class="n">average</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>  <span class="c1">#Calculate the scaling for the chart so we can convert pixel co-ordinates to data values.</span>
</span><span id="TE_Scraper.get_y_axis-1020"><a href="#TE_Scraper.get_y_axis-1020"><span class="linenos">1020</span></a>
</span><span id="TE_Scraper.get_y_axis-1021"><a href="#TE_Scraper.get_y_axis-1021"><span class="linenos">1021</span></a>        <span class="n">yaxis</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">yaxlabs</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="n">pixheights</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;ytick_label&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.get_y_axis-1022"><a href="#TE_Scraper.get_y_axis-1022"><span class="linenos">1022</span></a>        <span class="n">yaxis</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s2">&quot;pixheight&quot;</span><span class="p">,</span> <span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</span><span id="TE_Scraper.get_y_axis-1023"><a href="#TE_Scraper.get_y_axis-1023"><span class="linenos">1023</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="TE_Scraper.get_y_axis-1024"><a href="#TE_Scraper.get_y_axis-1024"><span class="linenos">1024</span></a>            <span class="n">yaxis</span> <span class="o">=</span> <span class="n">yaxis</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
</span><span id="TE_Scraper.get_y_axis-1025"><a href="#TE_Scraper.get_y_axis-1025"><span class="linenos">1025</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="TE_Scraper.get_y_axis-1026"><a href="#TE_Scraper.get_y_axis-1026"><span class="linenos">1026</span></a>            <span class="k">pass</span>
</span><span id="TE_Scraper.get_y_axis-1027"><a href="#TE_Scraper.get_y_axis-1027"><span class="linenos">1027</span></a>
</span><span id="TE_Scraper.get_y_axis-1028"><a href="#TE_Scraper.get_y_axis-1028"><span class="linenos">1028</span></a>        <span class="k">if</span> <span class="n">yaxis</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TE_Scraper.get_y_axis-1029"><a href="#TE_Scraper.get_y_axis-1029"><span class="linenos">1029</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Y-axis values scraped successfully.&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.get_y_axis-1030"><a href="#TE_Scraper.get_y_axis-1030"><span class="linenos">1030</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="TE_Scraper.get_y_axis-1031"><a href="#TE_Scraper.get_y_axis-1031"><span class="linenos">1031</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Y-axis values not scraped successfully, yaxis is None.&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.get_y_axis-1032"><a href="#TE_Scraper.get_y_axis-1032"><span class="linenos">1032</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="TE_Scraper.get_y_axis-1033"><a href="#TE_Scraper.get_y_axis-1033"><span class="linenos">1033</span></a>        
</span><span id="TE_Scraper.get_y_axis-1034"><a href="#TE_Scraper.get_y_axis-1034"><span class="linenos">1034</span></a>        <span class="k">if</span> <span class="n">set_global_y_axis</span><span class="p">:</span>
</span><span id="TE_Scraper.get_y_axis-1035"><a href="#TE_Scraper.get_y_axis-1035"><span class="linenos">1035</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">y_axis</span> <span class="o">=</span> <span class="n">yaxis</span>
</span><span id="TE_Scraper.get_y_axis-1036"><a href="#TE_Scraper.get_y_axis-1036"><span class="linenos">1036</span></a>
</span><span id="TE_Scraper.get_y_axis-1037"><a href="#TE_Scraper.get_y_axis-1037"><span class="linenos">1037</span></a>        <span class="k">return</span> <span class="n">yaxis</span>
</span></pre></div>


            <div class="docstring"><p>Get y-axis values from chart to make a y-axis series with tick labels and positions (pixel positions).
Also gets the limits of both axis in pixel co-ordinates. A series containing the y-axis values and their pixel positions (as index) is assigned
to the "y_axis" attribute. The "axis_limits" attribute is made too &amp; is  dictionary containing the pixel co-ordinates of the max and min for both x and y axis.</p>

<p><strong>Parameters:</strong></p>

<ul>
<li>update_chart (bool): Whether to update the chart before scraping the y-axis values. Default is False.</li>
<li>set_global_y_axis (bool): Whether to set the y-axis series as a global attribute of the class. Default is False.</li>
</ul>
</div>


                            </div>
                            <div id="TE_Scraper.init_tooltipScraper" class="classattr">
                                        <input id="TE_Scraper.init_tooltipScraper-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">init_tooltipScraper</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="TE_Scraper.init_tooltipScraper-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TE_Scraper.init_tooltipScraper"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TE_Scraper.init_tooltipScraper-1039"><a href="#TE_Scraper.init_tooltipScraper-1039"><span class="linenos">1039</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">init_tooltipScraper</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="TE_Scraper.init_tooltipScraper-1040"><a href="#TE_Scraper.init_tooltipScraper-1040"><span class="linenos">1040</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialise the TooltipScraper object for the class. This is used to scrape the tooltip box on the chart to get the start and end dates of the time series.</span>
</span><span id="TE_Scraper.init_tooltipScraper-1041"><a href="#TE_Scraper.init_tooltipScraper-1041"><span class="linenos">1041</span></a><span class="sd">        The tooltip scraper is a child object of the class and is used</span>
</span><span id="TE_Scraper.init_tooltipScraper-1042"><a href="#TE_Scraper.init_tooltipScraper-1042"><span class="linenos">1042</span></a><span class="sd">        to scrape the tooltip box on the chart to get the start and end dates of the time series. The tooltip scraper is a child object of the class an shares some synced </span>
</span><span id="TE_Scraper.init_tooltipScraper-1043"><a href="#TE_Scraper.init_tooltipScraper-1043"><span class="linenos">1043</span></a><span class="sd">        attributes with the parent class. &quot;&quot;&quot;</span>
</span><span id="TE_Scraper.init_tooltipScraper-1044"><a href="#TE_Scraper.init_tooltipScraper-1044"><span class="linenos">1044</span></a>
</span><span id="TE_Scraper.init_tooltipScraper-1045"><a href="#TE_Scraper.init_tooltipScraper-1045"><span class="linenos">1045</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;tooltip_scraper&quot;</span><span class="p">):</span>
</span><span id="TE_Scraper.init_tooltipScraper-1046"><a href="#TE_Scraper.init_tooltipScraper-1046"><span class="linenos">1046</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">tooltip_scraper</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">TooltipScraper</span><span class="p">(</span><span class="n">parent_instance</span> <span class="o">=</span> <span class="bp">self</span><span class="p">)</span>
</span><span id="TE_Scraper.init_tooltipScraper-1047"><a href="#TE_Scraper.init_tooltipScraper-1047"><span class="linenos">1047</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;TooltipScraper object initialised successfully.&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.init_tooltipScraper-1048"><a href="#TE_Scraper.init_tooltipScraper-1048"><span class="linenos">1048</span></a>        <span class="k">else</span><span class="p">:</span>    
</span><span id="TE_Scraper.init_tooltipScraper-1049"><a href="#TE_Scraper.init_tooltipScraper-1049"><span class="linenos">1049</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;TooltipScraper object already initialised.&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Initialise the TooltipScraper object for the class. This is used to scrape the tooltip box on the chart to get the start and end dates of the time series.
The tooltip scraper is a child object of the class and is used
to scrape the tooltip box on the chart to get the start and end dates of the time series. The tooltip scraper is a child object of the class an shares some synced 
attributes with the parent class.</p>
</div>


                            </div>
                            <div id="TE_Scraper.dtIndex" class="classattr">
                                        <input id="TE_Scraper.dtIndex-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">dtIndex</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">start_date</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">end_date</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">ser_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;Time-series&#39;</span></span><span class="return-annotation">) -> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">indexes</span><span class="o">.</span><span class="n">datetimes</span><span class="o">.</span><span class="n">DatetimeIndex</span>:</span></span>

                <label class="view-source-button" for="TE_Scraper.dtIndex-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TE_Scraper.dtIndex"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TE_Scraper.dtIndex-1051"><a href="#TE_Scraper.dtIndex-1051"><span class="linenos">1051</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">dtIndex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_date</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">end_date</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">ser_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Time-series&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">:</span>
</span><span id="TE_Scraper.dtIndex-1052"><a href="#TE_Scraper.dtIndex-1052"><span class="linenos">1052</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TE_Scraper.dtIndex-1053"><a href="#TE_Scraper.dtIndex-1053"><span class="linenos">1053</span></a>
</span><span id="TE_Scraper.dtIndex-1054"><a href="#TE_Scraper.dtIndex-1054"><span class="linenos">1054</span></a><span class="sd">        Create a date index for your series in self.series. Will first make an index to cover the full length of your series </span>
</span><span id="TE_Scraper.dtIndex-1055"><a href="#TE_Scraper.dtIndex-1055"><span class="linenos">1055</span></a><span class="sd">        and then resample to month start freq to match the format on Trading Economics.</span>
</span><span id="TE_Scraper.dtIndex-1056"><a href="#TE_Scraper.dtIndex-1056"><span class="linenos">1056</span></a><span class="sd">        </span>
</span><span id="TE_Scraper.dtIndex-1057"><a href="#TE_Scraper.dtIndex-1057"><span class="linenos">1057</span></a><span class="sd">        **Parameters:**</span>
</span><span id="TE_Scraper.dtIndex-1058"><a href="#TE_Scraper.dtIndex-1058"><span class="linenos">1058</span></a><span class="sd">        - start_date (str) YYYY-MM-DD: The start date of your series</span>
</span><span id="TE_Scraper.dtIndex-1059"><a href="#TE_Scraper.dtIndex-1059"><span class="linenos">1059</span></a><span class="sd">        - end_date (str) YYYY-MM-DD: The end date of your series</span>
</span><span id="TE_Scraper.dtIndex-1060"><a href="#TE_Scraper.dtIndex-1060"><span class="linenos">1060</span></a><span class="sd">        - ser_name (str): The name TO GIVE the series</span>
</span><span id="TE_Scraper.dtIndex-1061"><a href="#TE_Scraper.dtIndex-1061"><span class="linenos">1061</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TE_Scraper.dtIndex-1062"><a href="#TE_Scraper.dtIndex-1062"><span class="linenos">1062</span></a>        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;x_index&quot;</span><span class="p">):</span>
</span><span id="TE_Scraper.dtIndex-1063"><a href="#TE_Scraper.dtIndex-1063"><span class="linenos">1063</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Overwriting existing x_index attribute.&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.dtIndex-1064"><a href="#TE_Scraper.dtIndex-1064"><span class="linenos">1064</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">x_index</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="TE_Scraper.dtIndex-1065"><a href="#TE_Scraper.dtIndex-1065"><span class="linenos">1065</span></a>        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;series&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;frequency&quot;</span><span class="p">):</span>
</span><span id="TE_Scraper.dtIndex-1066"><a href="#TE_Scraper.dtIndex-1066"><span class="linenos">1066</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Series found but frequency not known. Creating a datetime x-index for series with frequency determined by length of series.</span><span class="se">\</span>
</span><span id="TE_Scraper.dtIndex-1067"><a href="#TE_Scraper.dtIndex-1067"><span class="linenos">1067</span></a><span class="s2">                        Returning dtIndex only.&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.dtIndex-1068"><a href="#TE_Scraper.dtIndex-1068"><span class="linenos">1068</span></a>            <span class="n">dtIndex</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span> <span class="o">=</span> <span class="n">start_date</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">end_date</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="p">),</span> <span class="n">inclusive</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.dtIndex-1069"><a href="#TE_Scraper.dtIndex-1069"><span class="linenos">1069</span></a>            <span class="k">return</span> <span class="n">dtIndex</span>
</span><span id="TE_Scraper.dtIndex-1070"><a href="#TE_Scraper.dtIndex-1070"><span class="linenos">1070</span></a>        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;series&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;frequency&quot;</span><span class="p">):</span>
</span><span id="TE_Scraper.dtIndex-1071"><a href="#TE_Scraper.dtIndex-1071"><span class="linenos">1071</span></a>            <span class="n">dtIndex</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span> <span class="o">=</span> <span class="n">start_date</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">end_date</span><span class="p">,</span> <span class="n">freq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="p">)</span>
</span><span id="TE_Scraper.dtIndex-1072"><a href="#TE_Scraper.dtIndex-1072"><span class="linenos">1072</span></a>            <span class="n">new_ser</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">to_list</span><span class="p">(),</span> <span class="n">index</span> <span class="o">=</span> <span class="n">dtIndex</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">ser_name</span><span class="p">)</span>
</span><span id="TE_Scraper.dtIndex-1073"><a href="#TE_Scraper.dtIndex-1073"><span class="linenos">1073</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">trace_path_series</span> <span class="o">=</span> <span class="n">new_ser</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="TE_Scraper.dtIndex-1074"><a href="#TE_Scraper.dtIndex-1074"><span class="linenos">1074</span></a>            <span class="n">new_ser</span> <span class="o">=</span> <span class="n">new_ser</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
</span><span id="TE_Scraper.dtIndex-1075"><a href="#TE_Scraper.dtIndex-1075"><span class="linenos">1075</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">series</span> <span class="o">=</span> <span class="n">new_ser</span>
</span><span id="TE_Scraper.dtIndex-1076"><a href="#TE_Scraper.dtIndex-1076"><span class="linenos">1076</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Series is already scraped, frequency and start, end dates are known. DatetimeIndex created</span><span class="se">\</span>
</span><span id="TE_Scraper.dtIndex-1077"><a href="#TE_Scraper.dtIndex-1077"><span class="linenos">1077</span></a><span class="s2">                        for series, set as index and series resampled at the frequency: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="si">}</span><span class="s2">. series attribute updated.&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.dtIndex-1078"><a href="#TE_Scraper.dtIndex-1078"><span class="linenos">1078</span></a>            <span class="k">return</span> <span class="n">dtIndex</span>
</span><span id="TE_Scraper.dtIndex-1079"><a href="#TE_Scraper.dtIndex-1079"><span class="linenos">1079</span></a>        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;series&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;frequency&quot;</span><span class="p">):</span>
</span><span id="TE_Scraper.dtIndex-1080"><a href="#TE_Scraper.dtIndex-1080"><span class="linenos">1080</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;No series found, using frequency and start and end dates to create a datetime x-index.&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.dtIndex-1081"><a href="#TE_Scraper.dtIndex-1081"><span class="linenos">1081</span></a>            <span class="n">dtIndex</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span> <span class="o">=</span> <span class="n">start_date</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">end_date</span><span class="p">,</span> <span class="n">freq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="p">)</span>
</span><span id="TE_Scraper.dtIndex-1082"><a href="#TE_Scraper.dtIndex-1082"><span class="linenos">1082</span></a>            <span class="k">return</span> <span class="n">dtIndex</span>
</span><span id="TE_Scraper.dtIndex-1083"><a href="#TE_Scraper.dtIndex-1083"><span class="linenos">1083</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="TE_Scraper.dtIndex-1084"><a href="#TE_Scraper.dtIndex-1084"><span class="linenos">1084</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;No series found, frequenc unknown get the series or frequency first. Returning None&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.dtIndex-1085"><a href="#TE_Scraper.dtIndex-1085"><span class="linenos">1085</span></a>            <span class="k">return</span> <span class="kc">None</span> 
</span></pre></div>


            <div class="docstring"><p>Create a date index for your series in self.series. Will first make an index to cover the full length of your series 
and then resample to month start freq to match the format on Trading Economics.</p>

<p><strong>Parameters:</strong></p>

<ul>
<li>start_date (str) YYYY-MM-DD: The start date of your series</li>
<li>end_date (str) YYYY-MM-DD: The end date of your series</li>
<li>ser_name (str): The name TO GIVE the series</li>
</ul>
</div>


                            </div>
                            <div id="TE_Scraper.apply_x_index" class="classattr">
                                        <input id="TE_Scraper.apply_x_index-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">apply_x_index</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">x_index</span><span class="p">:</span> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">indexes</span><span class="o">.</span><span class="n">datetimes</span><span class="o">.</span><span class="n">DatetimeIndex</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">use_rounded_tempIndex</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">redo_series</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="TE_Scraper.apply_x_index-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TE_Scraper.apply_x_index"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TE_Scraper.apply_x_index-1087"><a href="#TE_Scraper.apply_x_index-1087"><span class="linenos">1087</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">apply_x_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x_index</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">use_rounded_tempIndex</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">redo_series</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="TE_Scraper.apply_x_index-1088"><a href="#TE_Scraper.apply_x_index-1088"><span class="linenos">1088</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Apply a datetime index to the series. This will set the datetime index as the index of the series and resample the series to the frequency</span>
</span><span id="TE_Scraper.apply_x_index-1089"><a href="#TE_Scraper.apply_x_index-1089"><span class="linenos">1089</span></a><span class="sd">        of the datetime index. The series attribute of the class will be updated with the new series.</span>
</span><span id="TE_Scraper.apply_x_index-1090"><a href="#TE_Scraper.apply_x_index-1090"><span class="linenos">1090</span></a>
</span><span id="TE_Scraper.apply_x_index-1091"><a href="#TE_Scraper.apply_x_index-1091"><span class="linenos">1091</span></a><span class="sd">        **Parameters:**</span>
</span><span id="TE_Scraper.apply_x_index-1092"><a href="#TE_Scraper.apply_x_index-1092"><span class="linenos">1092</span></a><span class="sd">        - x_index (pd.DatetimeIndex): The datetime index to apply to the series. If None, the x_index attribute of the class will be used.</span>
</span><span id="TE_Scraper.apply_x_index-1093"><a href="#TE_Scraper.apply_x_index-1093"><span class="linenos">1093</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TE_Scraper.apply_x_index-1094"><a href="#TE_Scraper.apply_x_index-1094"><span class="linenos">1094</span></a>        <span class="k">if</span> <span class="n">x_index</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;x_index&quot;</span><span class="p">):</span>
</span><span id="TE_Scraper.apply_x_index-1095"><a href="#TE_Scraper.apply_x_index-1095"><span class="linenos">1095</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No datetime x-index found. Run make_x_index() first.&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.apply_x_index-1096"><a href="#TE_Scraper.apply_x_index-1096"><span class="linenos">1096</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="TE_Scraper.apply_x_index-1097"><a href="#TE_Scraper.apply_x_index-1097"><span class="linenos">1097</span></a>        <span class="k">elif</span> <span class="n">x_index</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TE_Scraper.apply_x_index-1098"><a href="#TE_Scraper.apply_x_index-1098"><span class="linenos">1098</span></a>            <span class="n">x_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_index</span>
</span><span id="TE_Scraper.apply_x_index-1099"><a href="#TE_Scraper.apply_x_index-1099"><span class="linenos">1099</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="TE_Scraper.apply_x_index-1100"><a href="#TE_Scraper.apply_x_index-1100"><span class="linenos">1100</span></a>            <span class="k">pass</span>
</span><span id="TE_Scraper.apply_x_index-1101"><a href="#TE_Scraper.apply_x_index-1101"><span class="linenos">1101</span></a>
</span><span id="TE_Scraper.apply_x_index-1102"><a href="#TE_Scraper.apply_x_index-1102"><span class="linenos">1102</span></a>        <span class="k">if</span> <span class="n">redo_series</span><span class="p">:</span>
</span><span id="TE_Scraper.apply_x_index-1103"><a href="#TE_Scraper.apply_x_index-1103"><span class="linenos">1103</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">series</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trace_path_series_raw</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="TE_Scraper.apply_x_index-1104"><a href="#TE_Scraper.apply_x_index-1104"><span class="linenos">1104</span></a>
</span><span id="TE_Scraper.apply_x_index-1105"><a href="#TE_Scraper.apply_x_index-1105"><span class="linenos">1105</span></a>        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;series&quot;</span><span class="p">):</span>
</span><span id="TE_Scraper.apply_x_index-1106"><a href="#TE_Scraper.apply_x_index-1106"><span class="linenos">1106</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">series_extracted_from</span> <span class="o">==</span> <span class="s2">&quot;Line&quot;</span><span class="p">:</span>
</span><span id="TE_Scraper.apply_x_index-1107"><a href="#TE_Scraper.apply_x_index-1107"><span class="linenos">1107</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x_index</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="p">):</span>
</span><span id="TE_Scraper.apply_x_index-1108"><a href="#TE_Scraper.apply_x_index-1108"><span class="linenos">1108</span></a>                    <span class="n">new_ser</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">to_list</span><span class="p">(),</span> <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_index</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">series_name</span><span class="p">)</span>
</span><span id="TE_Scraper.apply_x_index-1109"><a href="#TE_Scraper.apply_x_index-1109"><span class="linenos">1109</span></a>                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">x_index</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="p">):</span>
</span><span id="TE_Scraper.apply_x_index-1110"><a href="#TE_Scraper.apply_x_index-1110"><span class="linenos">1110</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Length of x_index is greater than length of series. This is unfortunate, dunno what to do here...&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.apply_x_index-1111"><a href="#TE_Scraper.apply_x_index-1111"><span class="linenos">1111</span></a>                    <span class="k">return</span> <span class="kc">None</span>
</span><span id="TE_Scraper.apply_x_index-1112"><a href="#TE_Scraper.apply_x_index-1112"><span class="linenos">1112</span></a>                <span class="k">else</span><span class="p">:</span> <span class="c1"># use_rounded_tempIndex:</span>
</span><span id="TE_Scraper.apply_x_index-1113"><a href="#TE_Scraper.apply_x_index-1113"><span class="linenos">1113</span></a>                    <span class="n">temp_index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span> <span class="o">=</span> <span class="n">x_index</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">end</span> <span class="o">=</span> <span class="n">x_index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">periods</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="p">))</span>
</span><span id="TE_Scraper.apply_x_index-1114"><a href="#TE_Scraper.apply_x_index-1114"><span class="linenos">1114</span></a>                    <span class="n">temp_index</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">round_to_freq</span><span class="p">(</span><span class="n">temp_index</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="p">)</span>
</span><span id="TE_Scraper.apply_x_index-1115"><a href="#TE_Scraper.apply_x_index-1115"><span class="linenos">1115</span></a>                    <span class="n">new_ser</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">to_list</span><span class="p">(),</span> <span class="n">index</span> <span class="o">=</span> <span class="n">temp_index</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">series_name</span><span class="p">)</span>
</span><span id="TE_Scraper.apply_x_index-1116"><a href="#TE_Scraper.apply_x_index-1116"><span class="linenos">1116</span></a>                    <span class="n">new_ser</span> <span class="o">=</span> <span class="n">new_ser</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
</span><span id="TE_Scraper.apply_x_index-1117"><a href="#TE_Scraper.apply_x_index-1117"><span class="linenos">1117</span></a>            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">series_extracted_from</span> <span class="o">==</span> <span class="s2">&quot;Spline&quot;</span><span class="p">:</span>
</span><span id="TE_Scraper.apply_x_index-1118"><a href="#TE_Scraper.apply_x_index-1118"><span class="linenos">1118</span></a>                <span class="n">temp_index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span> <span class="o">=</span> <span class="n">x_index</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">end</span> <span class="o">=</span> <span class="n">x_index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">periods</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="p">))</span>
</span><span id="TE_Scraper.apply_x_index-1119"><a href="#TE_Scraper.apply_x_index-1119"><span class="linenos">1119</span></a>                <span class="c1">#print(&quot;temp_index: &quot;, temp_index, &quot;len series: &quot;, len(self.series), &quot;len x_index: &quot;, len(x_index))</span>
</span><span id="TE_Scraper.apply_x_index-1120"><a href="#TE_Scraper.apply_x_index-1120"><span class="linenos">1120</span></a>                <span class="n">new_ser</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">to_list</span><span class="p">(),</span> <span class="n">index</span> <span class="o">=</span> <span class="n">temp_index</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">series_name</span><span class="p">)</span>
</span><span id="TE_Scraper.apply_x_index-1121"><a href="#TE_Scraper.apply_x_index-1121"><span class="linenos">1121</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">trace_path_series</span> <span class="o">=</span> <span class="n">new_ser</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="TE_Scraper.apply_x_index-1122"><a href="#TE_Scraper.apply_x_index-1122"><span class="linenos">1122</span></a>                <span class="n">new_ser</span> <span class="o">=</span> <span class="n">new_ser</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
</span><span id="TE_Scraper.apply_x_index-1123"><a href="#TE_Scraper.apply_x_index-1123"><span class="linenos">1123</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="TE_Scraper.apply_x_index-1124"><a href="#TE_Scraper.apply_x_index-1124"><span class="linenos">1124</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Series not extracted from Line or Spline chart. Cannot apply datetime index, go back and run the series_from_chart_soup method.&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.apply_x_index-1125"><a href="#TE_Scraper.apply_x_index-1125"><span class="linenos">1125</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="TE_Scraper.apply_x_index-1126"><a href="#TE_Scraper.apply_x_index-1126"><span class="linenos">1126</span></a>            
</span><span id="TE_Scraper.apply_x_index-1127"><a href="#TE_Scraper.apply_x_index-1127"><span class="linenos">1127</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">series</span> <span class="o">=</span> <span class="n">new_ser</span>  <span class="c1"># Update the series attribute with the new series.</span>
</span><span id="TE_Scraper.apply_x_index-1128"><a href="#TE_Scraper.apply_x_index-1128"><span class="linenos">1128</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">unscaled_series</span> <span class="o">=</span> <span class="n">new_ser</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="TE_Scraper.apply_x_index-1129"><a href="#TE_Scraper.apply_x_index-1129"><span class="linenos">1129</span></a>            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;metadata&quot;</span><span class="p">):</span>
</span><span id="TE_Scraper.apply_x_index-1130"><a href="#TE_Scraper.apply_x_index-1130"><span class="linenos">1130</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;frequency&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span>  <span class="c1"># Update the frequency in the metadata.</span>
</span><span id="TE_Scraper.apply_x_index-1131"><a href="#TE_Scraper.apply_x_index-1131"><span class="linenos">1131</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DateTimeIndex applied to series, series attribute updated.&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.apply_x_index-1132"><a href="#TE_Scraper.apply_x_index-1132"><span class="linenos">1132</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="TE_Scraper.apply_x_index-1133"><a href="#TE_Scraper.apply_x_index-1133"><span class="linenos">1133</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;No series found, get the series first.&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.apply_x_index-1134"><a href="#TE_Scraper.apply_x_index-1134"><span class="linenos">1134</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span></pre></div>


            <div class="docstring"><p>Apply a datetime index to the series. This will set the datetime index as the index of the series and resample the series to the frequency
of the datetime index. The series attribute of the class will be updated with the new series.</p>

<p><strong>Parameters:</strong></p>

<ul>
<li>x_index (pd.DatetimeIndex): The datetime index to apply to the series. If None, the x_index attribute of the class will be used.</li>
</ul>
</div>


                            </div>
                            <div id="TE_Scraper.extract_axis_limits" class="classattr">
                                        <input id="TE_Scraper.extract_axis_limits-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">extract_axis_limits</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="TE_Scraper.extract_axis_limits-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TE_Scraper.extract_axis_limits"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TE_Scraper.extract_axis_limits-1136"><a href="#TE_Scraper.extract_axis_limits-1136"><span class="linenos">1136</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">extract_axis_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="TE_Scraper.extract_axis_limits-1137"><a href="#TE_Scraper.extract_axis_limits-1137"><span class="linenos">1137</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract axis limits from the chart in terms of pixel co-ordinates.&quot;&quot;&quot;</span>
</span><span id="TE_Scraper.extract_axis_limits-1138"><a href="#TE_Scraper.extract_axis_limits-1138"><span class="linenos">1138</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Extracting axis limits from the chart...&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.extract_axis_limits-1139"><a href="#TE_Scraper.extract_axis_limits-1139"><span class="linenos">1139</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="TE_Scraper.extract_axis_limits-1140"><a href="#TE_Scraper.extract_axis_limits-1140"><span class="linenos">1140</span></a>            <span class="c1"># Extract axis elements</span>
</span><span id="TE_Scraper.extract_axis_limits-1141"><a href="#TE_Scraper.extract_axis_limits-1141"><span class="linenos">1141</span></a>            <span class="n">yax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_soup</span><span class="o">.</span><span class="n">select_one</span><span class="p">(</span><span class="s2">&quot;g.highcharts-axis.highcharts-yaxis path.highcharts-axis-line&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.extract_axis_limits-1142"><a href="#TE_Scraper.extract_axis_limits-1142"><span class="linenos">1142</span></a>            <span class="n">xax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_soup</span><span class="o">.</span><span class="n">select_one</span><span class="p">(</span><span class="s2">&quot;g.highcharts-axis.highcharts-xaxis path.highcharts-axis-line&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.extract_axis_limits-1143"><a href="#TE_Scraper.extract_axis_limits-1143"><span class="linenos">1143</span></a>            
</span><span id="TE_Scraper.extract_axis_limits-1144"><a href="#TE_Scraper.extract_axis_limits-1144"><span class="linenos">1144</span></a>            <span class="n">ylims</span> <span class="o">=</span> <span class="n">yax</span><span class="p">[</span><span class="s2">&quot;d&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;M&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;L&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.extract_axis_limits-1145"><a href="#TE_Scraper.extract_axis_limits-1145"><span class="linenos">1145</span></a>            <span class="n">ylims</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">num</span><span class="p">)</span> <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="n">ylims</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">num</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
</span><span id="TE_Scraper.extract_axis_limits-1146"><a href="#TE_Scraper.extract_axis_limits-1146"><span class="linenos">1146</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;yax: </span><span class="si">{</span><span class="n">ylims</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.extract_axis_limits-1147"><a href="#TE_Scraper.extract_axis_limits-1147"><span class="linenos">1147</span></a>
</span><span id="TE_Scraper.extract_axis_limits-1148"><a href="#TE_Scraper.extract_axis_limits-1148"><span class="linenos">1148</span></a>            <span class="n">xlims</span> <span class="o">=</span> <span class="n">xax</span><span class="p">[</span><span class="s2">&quot;d&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;M&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;L&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.extract_axis_limits-1149"><a href="#TE_Scraper.extract_axis_limits-1149"><span class="linenos">1149</span></a>            <span class="n">xlims</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">num</span><span class="p">)</span> <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="n">xlims</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">num</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
</span><span id="TE_Scraper.extract_axis_limits-1150"><a href="#TE_Scraper.extract_axis_limits-1150"><span class="linenos">1150</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;xax: </span><span class="si">{</span><span class="n">xlims</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.extract_axis_limits-1151"><a href="#TE_Scraper.extract_axis_limits-1151"><span class="linenos">1151</span></a>            
</span><span id="TE_Scraper.extract_axis_limits-1152"><a href="#TE_Scraper.extract_axis_limits-1152"><span class="linenos">1152</span></a>            <span class="n">axis_limits</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="TE_Scraper.extract_axis_limits-1153"><a href="#TE_Scraper.extract_axis_limits-1153"><span class="linenos">1153</span></a>                <span class="s1">&#39;x_min&#39;</span><span class="p">:</span> <span class="n">xlims</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span><span id="TE_Scraper.extract_axis_limits-1154"><a href="#TE_Scraper.extract_axis_limits-1154"><span class="linenos">1154</span></a>                <span class="s1">&#39;x_max&#39;</span><span class="p">:</span> <span class="n">xlims</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
</span><span id="TE_Scraper.extract_axis_limits-1155"><a href="#TE_Scraper.extract_axis_limits-1155"><span class="linenos">1155</span></a>                <span class="s1">&#39;y_min&#39;</span><span class="p">:</span> <span class="n">ylims</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
</span><span id="TE_Scraper.extract_axis_limits-1156"><a href="#TE_Scraper.extract_axis_limits-1156"><span class="linenos">1156</span></a>                <span class="s1">&#39;y_max&#39;</span><span class="p">:</span> <span class="n">ylims</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="TE_Scraper.extract_axis_limits-1157"><a href="#TE_Scraper.extract_axis_limits-1157"><span class="linenos">1157</span></a>            <span class="p">}</span>
</span><span id="TE_Scraper.extract_axis_limits-1158"><a href="#TE_Scraper.extract_axis_limits-1158"><span class="linenos">1158</span></a>            
</span><span id="TE_Scraper.extract_axis_limits-1159"><a href="#TE_Scraper.extract_axis_limits-1159"><span class="linenos">1159</span></a>            <span class="k">return</span> <span class="n">axis_limits</span>
</span><span id="TE_Scraper.extract_axis_limits-1160"><a href="#TE_Scraper.extract_axis_limits-1160"><span class="linenos">1160</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="TE_Scraper.extract_axis_limits-1161"><a href="#TE_Scraper.extract_axis_limits-1161"><span class="linenos">1161</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error extracting axis limits: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.extract_axis_limits-1162"><a href="#TE_Scraper.extract_axis_limits-1162"><span class="linenos">1162</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error extracting axis limits: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.extract_axis_limits-1163"><a href="#TE_Scraper.extract_axis_limits-1163"><span class="linenos">1163</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span></pre></div>


            <div class="docstring"><p>Extract axis limits from the chart in terms of pixel co-ordinates.</p>
</div>


                            </div>
                            <div id="TE_Scraper.plot_series" class="classattr">
                                        <input id="TE_Scraper.plot_series-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">plot_series</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">series</span><span class="p">:</span> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">Series</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">annotation_text</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">dpi</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">300</span>,</span><span class="param">	<span class="n">ann_box_pos</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.2</span><span class="p">)</span>,</span><span class="param">	<span class="n">show_fig</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">return_fig</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">invert_yaxis</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="o">**</span><span class="n">layout_updates</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="TE_Scraper.plot_series-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TE_Scraper.plot_series"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TE_Scraper.plot_series-1165"><a href="#TE_Scraper.plot_series-1165"><span class="linenos">1165</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">plot_series</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">series</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
</span><span id="TE_Scraper.plot_series-1166"><a href="#TE_Scraper.plot_series-1166"><span class="linenos">1166</span></a>                    <span class="n">annotation_text</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
</span><span id="TE_Scraper.plot_series-1167"><a href="#TE_Scraper.plot_series-1167"><span class="linenos">1167</span></a>                    <span class="n">dpi</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">300</span><span class="p">,</span> 
</span><span id="TE_Scraper.plot_series-1168"><a href="#TE_Scraper.plot_series-1168"><span class="linenos">1168</span></a>                    <span class="n">ann_box_pos</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span> <span class="mf">0.2</span><span class="p">),</span>
</span><span id="TE_Scraper.plot_series-1169"><a href="#TE_Scraper.plot_series-1169"><span class="linenos">1169</span></a>                    <span class="n">show_fig</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="TE_Scraper.plot_series-1170"><a href="#TE_Scraper.plot_series-1170"><span class="linenos">1170</span></a>                    <span class="n">return_fig</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="TE_Scraper.plot_series-1171"><a href="#TE_Scraper.plot_series-1171"><span class="linenos">1171</span></a>                    <span class="n">invert_yaxis</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">layout_updates</span><span class="p">):</span>
</span><span id="TE_Scraper.plot_series-1172"><a href="#TE_Scraper.plot_series-1172"><span class="linenos">1172</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TE_Scraper.plot_series-1173"><a href="#TE_Scraper.plot_series-1173"><span class="linenos">1173</span></a><span class="sd">        Plots the time series data using pandas with plotly as the backend. Plotly is set as the pandas backend in __init__.py for tedata.</span>
</span><span id="TE_Scraper.plot_series-1174"><a href="#TE_Scraper.plot_series-1174"><span class="linenos">1174</span></a><span class="sd">        If you want to use matplotlib or other plotting library don&#39;t use this method, plot the series attribute data directly. If using jupyter</span>
</span><span id="TE_Scraper.plot_series-1175"><a href="#TE_Scraper.plot_series-1175"><span class="linenos">1175</span></a><span class="sd">        you can set </span>
</span><span id="TE_Scraper.plot_series-1176"><a href="#TE_Scraper.plot_series-1176"><span class="linenos">1176</span></a>
</span><span id="TE_Scraper.plot_series-1177"><a href="#TE_Scraper.plot_series-1177"><span class="linenos">1177</span></a><span class="sd">        **Parameters**</span>
</span><span id="TE_Scraper.plot_series-1178"><a href="#TE_Scraper.plot_series-1178"><span class="linenos">1178</span></a><span class="sd">        - series (pd.Series): The series to plot. Default is None. If None, the series attribute of the class will be plotted.</span>
</span><span id="TE_Scraper.plot_series-1179"><a href="#TE_Scraper.plot_series-1179"><span class="linenos">1179</span></a><span class="sd">        - annotation_text (str): Text to display in the annotation box at the bottom of the chart. Default is None. If None, the default annotation text</span>
</span><span id="TE_Scraper.plot_series-1180"><a href="#TE_Scraper.plot_series-1180"><span class="linenos">1180</span></a><span class="sd">        will be created from the metadata.</span>
</span><span id="TE_Scraper.plot_series-1181"><a href="#TE_Scraper.plot_series-1181"><span class="linenos">1181</span></a><span class="sd">        - dpi (int): The resolution of the plot in dots per inch. Default is 300.</span>
</span><span id="TE_Scraper.plot_series-1182"><a href="#TE_Scraper.plot_series-1182"><span class="linenos">1182</span></a><span class="sd">        - ann_box_pos (tuple): The position of the annotation box on the chart. Default is (0, -0.23) which is bottom left.</span>
</span><span id="TE_Scraper.plot_series-1183"><a href="#TE_Scraper.plot_series-1183"><span class="linenos">1183</span></a>
</span><span id="TE_Scraper.plot_series-1184"><a href="#TE_Scraper.plot_series-1184"><span class="linenos">1184</span></a><span class="sd">        **Returns** None</span>
</span><span id="TE_Scraper.plot_series-1185"><a href="#TE_Scraper.plot_series-1185"><span class="linenos">1185</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TE_Scraper.plot_series-1186"><a href="#TE_Scraper.plot_series-1186"><span class="linenos">1186</span></a>        
</span><span id="TE_Scraper.plot_series-1187"><a href="#TE_Scraper.plot_series-1187"><span class="linenos">1187</span></a>        <span class="k">if</span> <span class="n">series</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TE_Scraper.plot_series-1188"><a href="#TE_Scraper.plot_series-1188"><span class="linenos">1188</span></a>            <span class="n">series</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">series</span>
</span><span id="TE_Scraper.plot_series-1189"><a href="#TE_Scraper.plot_series-1189"><span class="linenos">1189</span></a>
</span><span id="TE_Scraper.plot_series-1190"><a href="#TE_Scraper.plot_series-1190"><span class="linenos">1190</span></a>        <span class="n">fig</span> <span class="o">=</span> <span class="n">series</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>  <span class="c1"># Plot the series using pandas, plotly needs to be set as the pandas plotting backend.</span>
</span><span id="TE_Scraper.plot_series-1191"><a href="#TE_Scraper.plot_series-1191"><span class="linenos">1191</span></a>
</span><span id="TE_Scraper.plot_series-1192"><a href="#TE_Scraper.plot_series-1192"><span class="linenos">1192</span></a>         <span class="c1"># Existing title and label logic</span>
</span><span id="TE_Scraper.plot_series-1193"><a href="#TE_Scraper.plot_series-1193"><span class="linenos">1193</span></a>        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;series_metadata&quot;</span><span class="p">):</span>
</span><span id="TE_Scraper.plot_series-1194"><a href="#TE_Scraper.plot_series-1194"><span class="linenos">1194</span></a>            <span class="n">title</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series_metadata</span><span class="p">[</span><span class="s2">&quot;country&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series_metadata</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span>
</span><span id="TE_Scraper.plot_series-1195"><a href="#TE_Scraper.plot_series-1195"><span class="linenos">1195</span></a>            <span class="n">ylabel</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series_metadata</span><span class="p">[</span><span class="s2">&quot;units&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span>
</span><span id="TE_Scraper.plot_series-1196"><a href="#TE_Scraper.plot_series-1196"><span class="linenos">1196</span></a>            
</span><span id="TE_Scraper.plot_series-1197"><a href="#TE_Scraper.plot_series-1197"><span class="linenos">1197</span></a>            <span class="c1"># Create default annotation text from metadata</span>
</span><span id="TE_Scraper.plot_series-1198"><a href="#TE_Scraper.plot_series-1198"><span class="linenos">1198</span></a>            <span class="n">frequency</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;frequency&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;frequency&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">else</span> <span class="s2">&quot;Unknown&quot;</span>
</span><span id="TE_Scraper.plot_series-1199"><a href="#TE_Scraper.plot_series-1199"><span class="linenos">1199</span></a>            <span class="k">if</span> <span class="n">annotation_text</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TE_Scraper.plot_series-1200"><a href="#TE_Scraper.plot_series-1200"><span class="linenos">1200</span></a>                <span class="n">annotation_text</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="TE_Scraper.plot_series-1201"><a href="#TE_Scraper.plot_series-1201"><span class="linenos">1201</span></a>                    <span class="sa">f</span><span class="s2">&quot;Source: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;source&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&lt;br&gt;&quot;</span>
</span><span id="TE_Scraper.plot_series-1202"><a href="#TE_Scraper.plot_series-1202"><span class="linenos">1202</span></a>                    <span class="sa">f</span><span class="s2">&quot;Original Source: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;original_source&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&lt;br&gt;&quot;</span>
</span><span id="TE_Scraper.plot_series-1203"><a href="#TE_Scraper.plot_series-1203"><span class="linenos">1203</span></a>                    <span class="sa">f</span><span class="s2">&quot;Frequency: </span><span class="si">{</span><span class="n">frequency</span><span class="si">}</span><span class="s2">&lt;br&gt;&quot;</span>
</span><span id="TE_Scraper.plot_series-1204"><a href="#TE_Scraper.plot_series-1204"><span class="linenos">1204</span></a>                <span class="p">)</span>
</span><span id="TE_Scraper.plot_series-1205"><a href="#TE_Scraper.plot_series-1205"><span class="linenos">1205</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="TE_Scraper.plot_series-1206"><a href="#TE_Scraper.plot_series-1206"><span class="linenos">1206</span></a>            <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Time Series Plot&quot;</span>
</span><span id="TE_Scraper.plot_series-1207"><a href="#TE_Scraper.plot_series-1207"><span class="linenos">1207</span></a>            <span class="n">ylabel</span> <span class="o">=</span> <span class="s2">&quot;Value&quot;</span>
</span><span id="TE_Scraper.plot_series-1208"><a href="#TE_Scraper.plot_series-1208"><span class="linenos">1208</span></a>            <span class="n">annotation_text</span> <span class="o">=</span> <span class="n">annotation_text</span> <span class="ow">or</span> <span class="s2">&quot;Source: Trading Economics&quot;</span>
</span><span id="TE_Scraper.plot_series-1209"><a href="#TE_Scraper.plot_series-1209"><span class="linenos">1209</span></a>
</span><span id="TE_Scraper.plot_series-1210"><a href="#TE_Scraper.plot_series-1210"><span class="linenos">1210</span></a>        <span class="c1"># Add text annotation to bottom left</span>
</span><span id="TE_Scraper.plot_series-1211"><a href="#TE_Scraper.plot_series-1211"><span class="linenos">1211</span></a>        <span class="n">fig</span><span class="o">.</span><span class="n">add_annotation</span><span class="p">(</span>
</span><span id="TE_Scraper.plot_series-1212"><a href="#TE_Scraper.plot_series-1212"><span class="linenos">1212</span></a>            <span class="n">text</span><span class="o">=</span><span class="n">annotation_text</span><span class="p">,</span>
</span><span id="TE_Scraper.plot_series-1213"><a href="#TE_Scraper.plot_series-1213"><span class="linenos">1213</span></a>            <span class="n">xref</span><span class="o">=</span><span class="s2">&quot;paper&quot;</span><span class="p">,</span> <span class="n">yref</span><span class="o">=</span><span class="s2">&quot;paper&quot;</span><span class="p">,</span>
</span><span id="TE_Scraper.plot_series-1214"><a href="#TE_Scraper.plot_series-1214"><span class="linenos">1214</span></a>            <span class="n">x</span><span class="o">=</span><span class="n">ann_box_pos</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">ann_box_pos</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
</span><span id="TE_Scraper.plot_series-1215"><a href="#TE_Scraper.plot_series-1215"><span class="linenos">1215</span></a>            <span class="n">showarrow</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">),</span>
</span><span id="TE_Scraper.plot_series-1216"><a href="#TE_Scraper.plot_series-1216"><span class="linenos">1216</span></a>            <span class="n">align</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>  <span class="n">xanchor</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
</span><span id="TE_Scraper.plot_series-1217"><a href="#TE_Scraper.plot_series-1217"><span class="linenos">1217</span></a>            <span class="n">yanchor</span><span class="o">=</span><span class="s2">&quot;bottom&quot;</span><span class="p">,</span> <span class="n">bgcolor</span><span class="o">=</span><span class="s2">&quot;rgba(255, 255, 255, 0.8)&quot;</span><span class="p">,</span>
</span><span id="TE_Scraper.plot_series-1218"><a href="#TE_Scraper.plot_series-1218"><span class="linenos">1218</span></a>            <span class="n">bordercolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">borderwidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="TE_Scraper.plot_series-1219"><a href="#TE_Scraper.plot_series-1219"><span class="linenos">1219</span></a>
</span><span id="TE_Scraper.plot_series-1220"><a href="#TE_Scraper.plot_series-1220"><span class="linenos">1220</span></a>           <span class="c1"># Add y-axis inversion if requested</span>
</span><span id="TE_Scraper.plot_series-1221"><a href="#TE_Scraper.plot_series-1221"><span class="linenos">1221</span></a>        <span class="k">if</span> <span class="n">invert_yaxis</span><span class="p">:</span>
</span><span id="TE_Scraper.plot_series-1222"><a href="#TE_Scraper.plot_series-1222"><span class="linenos">1222</span></a>            <span class="n">layout_updates</span><span class="p">[</span><span class="s1">&#39;yaxis&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
</span><span id="TE_Scraper.plot_series-1223"><a href="#TE_Scraper.plot_series-1223"><span class="linenos">1223</span></a>                <span class="n">autorange</span><span class="o">=</span><span class="s1">&#39;reversed&#39;</span>  <span class="c1"># This inverts the y-axis</span>
</span><span id="TE_Scraper.plot_series-1224"><a href="#TE_Scraper.plot_series-1224"><span class="linenos">1224</span></a>            <span class="p">)</span>
</span><span id="TE_Scraper.plot_series-1225"><a href="#TE_Scraper.plot_series-1225"><span class="linenos">1225</span></a>
</span><span id="TE_Scraper.plot_series-1226"><a href="#TE_Scraper.plot_series-1226"><span class="linenos">1226</span></a>        <span class="c1"># Label x and y axis</span>
</span><span id="TE_Scraper.plot_series-1227"><a href="#TE_Scraper.plot_series-1227"><span class="linenos">1227</span></a>        <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
</span><span id="TE_Scraper.plot_series-1228"><a href="#TE_Scraper.plot_series-1228"><span class="linenos">1228</span></a>            <span class="n">legend</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
</span><span id="TE_Scraper.plot_series-1229"><a href="#TE_Scraper.plot_series-1229"><span class="linenos">1229</span></a>            <span class="n">title_text</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>  <span class="c1"># Remove legend title</span>
</span><span id="TE_Scraper.plot_series-1230"><a href="#TE_Scraper.plot_series-1230"><span class="linenos">1230</span></a>            <span class="n">orientation</span><span class="o">=</span><span class="s2">&quot;h&quot;</span><span class="p">,</span>
</span><span id="TE_Scraper.plot_series-1231"><a href="#TE_Scraper.plot_series-1231"><span class="linenos">1231</span></a>            <span class="n">yanchor</span><span class="o">=</span><span class="s2">&quot;bottom&quot;</span><span class="p">,</span>
</span><span id="TE_Scraper.plot_series-1232"><a href="#TE_Scraper.plot_series-1232"><span class="linenos">1232</span></a>            <span class="n">y</span><span class="o">=-</span><span class="mf">0.2</span><span class="p">,</span>  <span class="c1"># Adjust this value to move the legend further down</span>
</span><span id="TE_Scraper.plot_series-1233"><a href="#TE_Scraper.plot_series-1233"><span class="linenos">1233</span></a>            <span class="n">xanchor</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
</span><span id="TE_Scraper.plot_series-1234"><a href="#TE_Scraper.plot_series-1234"><span class="linenos">1234</span></a>            <span class="n">x</span><span class="o">=</span><span class="mf">0.5</span>
</span><span id="TE_Scraper.plot_series-1235"><a href="#TE_Scraper.plot_series-1235"><span class="linenos">1235</span></a>            <span class="p">),</span>
</span><span id="TE_Scraper.plot_series-1236"><a href="#TE_Scraper.plot_series-1236"><span class="linenos">1236</span></a>            <span class="n">yaxis_title</span><span class="o">=</span><span class="n">ylabel</span><span class="p">,</span>
</span><span id="TE_Scraper.plot_series-1237"><a href="#TE_Scraper.plot_series-1237"><span class="linenos">1237</span></a>            <span class="n">xaxis_title</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="TE_Scraper.plot_series-1238"><a href="#TE_Scraper.plot_series-1238"><span class="linenos">1238</span></a>            <span class="n">title</span> <span class="o">=</span> <span class="n">title</span><span class="p">)</span>
</span><span id="TE_Scraper.plot_series-1239"><a href="#TE_Scraper.plot_series-1239"><span class="linenos">1239</span></a>        
</span><span id="TE_Scraper.plot_series-1240"><a href="#TE_Scraper.plot_series-1240"><span class="linenos">1240</span></a>            <span class="c1"># Update the layout</span>
</span><span id="TE_Scraper.plot_series-1241"><a href="#TE_Scraper.plot_series-1241"><span class="linenos">1241</span></a>        <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="o">**</span><span class="n">layout_updates</span><span class="p">)</span>
</span><span id="TE_Scraper.plot_series-1242"><a href="#TE_Scraper.plot_series-1242"><span class="linenos">1242</span></a>
</span><span id="TE_Scraper.plot_series-1243"><a href="#TE_Scraper.plot_series-1243"><span class="linenos">1243</span></a>        <span class="c1"># Show the figure</span>
</span><span id="TE_Scraper.plot_series-1244"><a href="#TE_Scraper.plot_series-1244"><span class="linenos">1244</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">plot</span> <span class="o">=</span> <span class="n">fig</span>
</span><span id="TE_Scraper.plot_series-1245"><a href="#TE_Scraper.plot_series-1245"><span class="linenos">1245</span></a>        <span class="k">if</span> <span class="n">show_fig</span><span class="p">:</span>
</span><span id="TE_Scraper.plot_series-1246"><a href="#TE_Scraper.plot_series-1246"><span class="linenos">1246</span></a>            <span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="TE_Scraper.plot_series-1247"><a href="#TE_Scraper.plot_series-1247"><span class="linenos">1247</span></a>        <span class="k">if</span> <span class="n">return_fig</span><span class="p">:</span>
</span><span id="TE_Scraper.plot_series-1248"><a href="#TE_Scraper.plot_series-1248"><span class="linenos">1248</span></a>            <span class="k">return</span> <span class="n">fig</span>
</span></pre></div>


            <div class="docstring"><p>Plots the time series data using pandas with plotly as the backend. Plotly is set as the pandas backend in __init__.py for tedata.
If you want to use matplotlib or other plotting library don't use this method, plot the series attribute data directly. If using jupyter
you can set </p>

<p><strong>Parameters</strong></p>

<ul>
<li>series (pd.Series): The series to plot. Default is None. If None, the series attribute of the class will be plotted.</li>
<li>annotation_text (str): Text to display in the annotation box at the bottom of the chart. Default is None. If None, the default annotation text
will be created from the metadata.</li>
<li>dpi (int): The resolution of the plot in dots per inch. Default is 300.</li>
<li>ann_box_pos (tuple): The position of the annotation box on the chart. Default is (0, -0.23) which is bottom left.</li>
</ul>

<p><strong>Returns</strong> None</p>
</div>


                            </div>
                            <div id="TE_Scraper.save_plot" class="classattr">
                                        <input id="TE_Scraper.save_plot-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">save_plot</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;plot&#39;</span>,</span><span class="param">	<span class="n">save_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;/Users/jamesbishop/Documents/Python/Scraping/tedata&#39;</span>,</span><span class="param">	<span class="n">dpi</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">300</span>,</span><span class="param">	<span class="nb">format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;png&#39;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="TE_Scraper.save_plot-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TE_Scraper.save_plot"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TE_Scraper.save_plot-1250"><a href="#TE_Scraper.save_plot-1250"><span class="linenos">1250</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">save_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;plot&quot;</span><span class="p">,</span> <span class="n">save_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="n">dpi</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">300</span><span class="p">,</span> <span class="nb">format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;png&quot;</span><span class="p">):</span>
</span><span id="TE_Scraper.save_plot-1251"><a href="#TE_Scraper.save_plot-1251"><span class="linenos">1251</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Save the plot to a file. The plot must be created using the plot_series method. This method will save the plot as a PNG image file.</span>
</span><span id="TE_Scraper.save_plot-1252"><a href="#TE_Scraper.save_plot-1252"><span class="linenos">1252</span></a>
</span><span id="TE_Scraper.save_plot-1253"><a href="#TE_Scraper.save_plot-1253"><span class="linenos">1253</span></a><span class="sd">        **Parameters**</span>
</span><span id="TE_Scraper.save_plot-1254"><a href="#TE_Scraper.save_plot-1254"><span class="linenos">1254</span></a><span class="sd">        - filename (str): The name of the file to save the plot to. Default is &#39;plot.png&#39;.</span>
</span><span id="TE_Scraper.save_plot-1255"><a href="#TE_Scraper.save_plot-1255"><span class="linenos">1255</span></a><span class="sd">        - save_path (str): The directory to save the plot to. Default is the current working directory.</span>
</span><span id="TE_Scraper.save_plot-1256"><a href="#TE_Scraper.save_plot-1256"><span class="linenos">1256</span></a><span class="sd">        - dpi (int): The resolution of the plot in dots per inch. Default is 300.</span>
</span><span id="TE_Scraper.save_plot-1257"><a href="#TE_Scraper.save_plot-1257"><span class="linenos">1257</span></a><span class="sd">        - format (str): The format to save the plot in. Default is &#39;png&#39;. Other options are: &quot;html&quot;, &quot;bmp&quot;, &quot;jpeg&quot;, &quot;jpg&quot;.</span>
</span><span id="TE_Scraper.save_plot-1258"><a href="#TE_Scraper.save_plot-1258"><span class="linenos">1258</span></a><span class="sd">        Use &quot;html&quot; to save as an interactive plotly plot.</span>
</span><span id="TE_Scraper.save_plot-1259"><a href="#TE_Scraper.save_plot-1259"><span class="linenos">1259</span></a>
</span><span id="TE_Scraper.save_plot-1260"><a href="#TE_Scraper.save_plot-1260"><span class="linenos">1260</span></a><span class="sd">        :Returns: None</span>
</span><span id="TE_Scraper.save_plot-1261"><a href="#TE_Scraper.save_plot-1261"><span class="linenos">1261</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TE_Scraper.save_plot-1262"><a href="#TE_Scraper.save_plot-1262"><span class="linenos">1262</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;plot&quot;</span><span class="p">):</span>
</span><span id="TE_Scraper.save_plot-1263"><a href="#TE_Scraper.save_plot-1263"><span class="linenos">1263</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Error: Plot not found. Run plot_series() method to create a plot.&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.save_plot-1264"><a href="#TE_Scraper.save_plot-1264"><span class="linenos">1264</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="TE_Scraper.save_plot-1265"><a href="#TE_Scraper.save_plot-1265"><span class="linenos">1265</span></a>
</span><span id="TE_Scraper.save_plot-1266"><a href="#TE_Scraper.save_plot-1266"><span class="linenos">1266</span></a>        <span class="k">if</span> <span class="nb">format</span> <span class="o">==</span> <span class="s2">&quot;html&quot;</span><span class="p">:</span>
</span><span id="TE_Scraper.save_plot-1267"><a href="#TE_Scraper.save_plot-1267"><span class="linenos">1267</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">write_html</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">save_path</span><span class="si">}{</span><span class="n">fdel</span><span class="si">}{</span><span class="n">filename</span><span class="si">}</span><span class="s2">.html&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.save_plot-1268"><a href="#TE_Scraper.save_plot-1268"><span class="linenos">1268</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Plot saved as </span><span class="si">{</span><span class="n">save_path</span><span class="si">}{</span><span class="n">fdel</span><span class="si">}{</span><span class="n">filename</span><span class="si">}</span><span class="s2">.html&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.save_plot-1269"><a href="#TE_Scraper.save_plot-1269"><span class="linenos">1269</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="TE_Scraper.save_plot-1270"><a href="#TE_Scraper.save_plot-1270"><span class="linenos">1270</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">write_image</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">save_path</span><span class="si">}{</span><span class="n">fdel</span><span class="si">}{</span><span class="n">filename</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="nb">format</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="nb">format</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">dpi</span><span class="o">/</span><span class="mi">100</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="mi">1400</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="mi">500</span><span class="p">)</span>
</span><span id="TE_Scraper.save_plot-1271"><a href="#TE_Scraper.save_plot-1271"><span class="linenos">1271</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Plot saved as </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.save_plot-1272"><a href="#TE_Scraper.save_plot-1272"><span class="linenos">1272</span></a>        <span class="k">return</span> <span class="kc">True</span>
</span></pre></div>


            <div class="docstring"><p>Save the plot to a file. The plot must be created using the plot_series method. This method will save the plot as a PNG image file.</p>

<p><strong>Parameters</strong></p>

<ul>
<li>filename (str): The name of the file to save the plot to. Default is 'plot.png'.</li>
<li>save_path (str): The directory to save the plot to. Default is the current working directory.</li>
<li>dpi (int): The resolution of the plot in dots per inch. Default is 300.</li>
<li>format (str): The format to save the plot in. Default is 'png'. Other options are: "html", "bmp", "jpeg", "jpg".
Use "html" to save as an interactive plotly plot.</li>
</ul>

<p>:Returns: None</p>
</div>


                            </div>
                            <div id="TE_Scraper.scrape_metadata" class="classattr">
                                        <input id="TE_Scraper.scrape_metadata-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">scrape_metadata</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="TE_Scraper.scrape_metadata-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TE_Scraper.scrape_metadata"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TE_Scraper.scrape_metadata-1275"><a href="#TE_Scraper.scrape_metadata-1275"><span class="linenos">1275</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">scrape_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="TE_Scraper.scrape_metadata-1276"><a href="#TE_Scraper.scrape_metadata-1276"><span class="linenos">1276</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Scrape metadata from the page. This method scrapes metadata from the page and stores it in the &#39;metadata&#39; attribute. The metadata</span>
</span><span id="TE_Scraper.scrape_metadata-1277"><a href="#TE_Scraper.scrape_metadata-1277"><span class="linenos">1277</span></a><span class="sd">        includes the title, indicator, country, length, frequency, source, , original source, id, start date, end date, min value, and max value of the series.</span>
</span><span id="TE_Scraper.scrape_metadata-1278"><a href="#TE_Scraper.scrape_metadata-1278"><span class="linenos">1278</span></a><span class="sd">        It also scrapes a description of the series if available and stores it in the &#39;description&#39; attribute.</span>
</span><span id="TE_Scraper.scrape_metadata-1279"><a href="#TE_Scraper.scrape_metadata-1279"><span class="linenos">1279</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TE_Scraper.scrape_metadata-1280"><a href="#TE_Scraper.scrape_metadata-1280"><span class="linenos">1280</span></a>
</span><span id="TE_Scraper.scrape_metadata-1281"><a href="#TE_Scraper.scrape_metadata-1281"><span class="linenos">1281</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="TE_Scraper.scrape_metadata-1282"><a href="#TE_Scraper.scrape_metadata-1282"><span class="linenos">1282</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Scraping metadata for the series from the page...&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.scrape_metadata-1283"><a href="#TE_Scraper.scrape_metadata-1283"><span class="linenos">1283</span></a>
</span><span id="TE_Scraper.scrape_metadata-1284"><a href="#TE_Scraper.scrape_metadata-1284"><span class="linenos">1284</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="TE_Scraper.scrape_metadata-1285"><a href="#TE_Scraper.scrape_metadata-1285"><span class="linenos">1285</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;units&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_soup</span><span class="o">.</span><span class="n">select_one</span><span class="p">(</span><span class="s1">&#39;#singleIndChartUnit2&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
</span><span id="TE_Scraper.scrape_metadata-1286"><a href="#TE_Scraper.scrape_metadata-1286"><span class="linenos">1286</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="TE_Scraper.scrape_metadata-1287"><a href="#TE_Scraper.scrape_metadata-1287"><span class="linenos">1287</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Units label not found: &quot;</span><span class="p">,</span> <span class="p">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)})</span>
</span><span id="TE_Scraper.scrape_metadata-1288"><a href="#TE_Scraper.scrape_metadata-1288"><span class="linenos">1288</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;units&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;a.u&quot;</span>
</span><span id="TE_Scraper.scrape_metadata-1289"><a href="#TE_Scraper.scrape_metadata-1289"><span class="linenos">1289</span></a>        
</span><span id="TE_Scraper.scrape_metadata-1290"><a href="#TE_Scraper.scrape_metadata-1290"><span class="linenos">1290</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="TE_Scraper.scrape_metadata-1291"><a href="#TE_Scraper.scrape_metadata-1291"><span class="linenos">1291</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;original_source&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_soup</span><span class="o">.</span><span class="n">select_one</span><span class="p">(</span><span class="s1">&#39;#singleIndChartUnit&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
</span><span id="TE_Scraper.scrape_metadata-1292"><a href="#TE_Scraper.scrape_metadata-1292"><span class="linenos">1292</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="TE_Scraper.scrape_metadata-1293"><a href="#TE_Scraper.scrape_metadata-1293"><span class="linenos">1293</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;original_source label not found: &quot;</span><span class="p">,</span> <span class="p">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)})</span>
</span><span id="TE_Scraper.scrape_metadata-1294"><a href="#TE_Scraper.scrape_metadata-1294"><span class="linenos">1294</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;original_source&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;unknown&quot;</span>
</span><span id="TE_Scraper.scrape_metadata-1295"><a href="#TE_Scraper.scrape_metadata-1295"><span class="linenos">1295</span></a>
</span><span id="TE_Scraper.scrape_metadata-1296"><a href="#TE_Scraper.scrape_metadata-1296"><span class="linenos">1296</span></a>        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;page_soup&quot;</span><span class="p">):</span>
</span><span id="TE_Scraper.scrape_metadata-1297"><a href="#TE_Scraper.scrape_metadata-1297"><span class="linenos">1297</span></a>            <span class="n">heads</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">page_soup</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;#ctl00_Head1&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.scrape_metadata-1298"><a href="#TE_Scraper.scrape_metadata-1298"><span class="linenos">1298</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">heads</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="TE_Scraper.scrape_metadata-1299"><a href="#TE_Scraper.scrape_metadata-1299"><span class="linenos">1299</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="TE_Scraper.scrape_metadata-1300"><a href="#TE_Scraper.scrape_metadata-1300"><span class="linenos">1300</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span>  <span class="c1"># Use URL if can&#39;t find the title</span>
</span><span id="TE_Scraper.scrape_metadata-1301"><a href="#TE_Scraper.scrape_metadata-1301"><span class="linenos">1301</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;indicator&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span>  
</span><span id="TE_Scraper.scrape_metadata-1302"><a href="#TE_Scraper.scrape_metadata-1302"><span class="linenos">1302</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;country&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span> 
</span><span id="TE_Scraper.scrape_metadata-1303"><a href="#TE_Scraper.scrape_metadata-1303"><span class="linenos">1303</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;source&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Trading Economics&quot;</span> 
</span><span id="TE_Scraper.scrape_metadata-1304"><a href="#TE_Scraper.scrape_metadata-1304"><span class="linenos">1304</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">last_url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">:])</span>
</span><span id="TE_Scraper.scrape_metadata-1305"><a href="#TE_Scraper.scrape_metadata-1305"><span class="linenos">1305</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Series metadata: </span><span class="se">\n</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.scrape_metadata-1306"><a href="#TE_Scraper.scrape_metadata-1306"><span class="linenos">1306</span></a>
</span><span id="TE_Scraper.scrape_metadata-1307"><a href="#TE_Scraper.scrape_metadata-1307"><span class="linenos">1307</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="TE_Scraper.scrape_metadata-1308"><a href="#TE_Scraper.scrape_metadata-1308"><span class="linenos">1308</span></a>            <span class="n">desc_card</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">page_soup</span><span class="o">.</span><span class="n">select_one</span><span class="p">(</span><span class="s2">&quot;#item_definition&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.scrape_metadata-1309"><a href="#TE_Scraper.scrape_metadata-1309"><span class="linenos">1309</span></a>            <span class="n">header_text</span> <span class="o">=</span> <span class="n">desc_card</span><span class="o">.</span><span class="n">select_one</span><span class="p">(</span><span class="s1">&#39;.card-header&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="TE_Scraper.scrape_metadata-1310"><a href="#TE_Scraper.scrape_metadata-1310"><span class="linenos">1310</span></a>            <span class="k">if</span> <span class="n">header_text</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
</span><span id="TE_Scraper.scrape_metadata-1311"><a href="#TE_Scraper.scrape_metadata-1311"><span class="linenos">1311</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;description&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">desc_card</span><span class="o">.</span><span class="n">select_one</span><span class="p">(</span><span class="s1">&#39;.card-body&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="TE_Scraper.scrape_metadata-1312"><a href="#TE_Scraper.scrape_metadata-1312"><span class="linenos">1312</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="TE_Scraper.scrape_metadata-1313"><a href="#TE_Scraper.scrape_metadata-1313"><span class="linenos">1313</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Description card title does not match series title.&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.scrape_metadata-1314"><a href="#TE_Scraper.scrape_metadata-1314"><span class="linenos">1314</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;description&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Description not found.&quot;</span>
</span><span id="TE_Scraper.scrape_metadata-1315"><a href="#TE_Scraper.scrape_metadata-1315"><span class="linenos">1315</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="TE_Scraper.scrape_metadata-1316"><a href="#TE_Scraper.scrape_metadata-1316"><span class="linenos">1316</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Description card not found: &quot;</span><span class="p">,</span> <span class="p">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)})</span>
</span><span id="TE_Scraper.scrape_metadata-1317"><a href="#TE_Scraper.scrape_metadata-1317"><span class="linenos">1317</span></a>
</span><span id="TE_Scraper.scrape_metadata-1318"><a href="#TE_Scraper.scrape_metadata-1318"><span class="linenos">1318</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">series_metadata</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">)</span>
</span><span id="TE_Scraper.scrape_metadata-1319"><a href="#TE_Scraper.scrape_metadata-1319"><span class="linenos">1319</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TE_Scraper.scrape_metadata-1320"><a href="#TE_Scraper.scrape_metadata-1320"><span class="linenos">1320</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Metadata scraped successfully: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Scrape metadata from the page. This method scrapes metadata from the page and stores it in the 'metadata' attribute. The metadata
includes the title, indicator, country, length, frequency, source, , original source, id, start date, end date, min value, and max value of the series.
It also scrapes a description of the series if available and stores it in the 'description' attribute.</p>
</div>


                            </div>
                            <div id="TE_Scraper.export_data" class="classattr">
                                        <input id="TE_Scraper.export_data-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">export_data</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">savePath</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;/Users/jamesbishop/Documents/Python/Scraping/tedata&#39;</span>,</span><span class="param">	<span class="n">filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="TE_Scraper.export_data-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TE_Scraper.export_data"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TE_Scraper.export_data-1322"><a href="#TE_Scraper.export_data-1322"><span class="linenos">1322</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">export_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">savePath</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="TE_Scraper.export_data-1323"><a href="#TE_Scraper.export_data-1323"><span class="linenos">1323</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; Export the series data to an excel .xlsx file. The series and metadata attributes must be set before running this method.</span>
</span><span id="TE_Scraper.export_data-1324"><a href="#TE_Scraper.export_data-1324"><span class="linenos">1324</span></a><span class="sd">        Only do it after scraping the series data. The metadata will be saved in a separate sheet in the same file.</span>
</span><span id="TE_Scraper.export_data-1325"><a href="#TE_Scraper.export_data-1325"><span class="linenos">1325</span></a><span class="sd">        </span>
</span><span id="TE_Scraper.export_data-1326"><a href="#TE_Scraper.export_data-1326"><span class="linenos">1326</span></a><span class="sd">        **Parameters**</span>
</span><span id="TE_Scraper.export_data-1327"><a href="#TE_Scraper.export_data-1327"><span class="linenos">1327</span></a><span class="sd">        - savePath (str): The directory to save the file to. Default is the current working directory.</span>
</span><span id="TE_Scraper.export_data-1328"><a href="#TE_Scraper.export_data-1328"><span class="linenos">1328</span></a><span class="sd">        - filename (str): The name of the file to save the data to. Default is the name of the series. &quot;&quot;&quot;</span>
</span><span id="TE_Scraper.export_data-1329"><a href="#TE_Scraper.export_data-1329"><span class="linenos">1329</span></a>        
</span><span id="TE_Scraper.export_data-1330"><a href="#TE_Scraper.export_data-1330"><span class="linenos">1330</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;series&quot;</span><span class="p">):</span>
</span><span id="TE_Scraper.export_data-1331"><a href="#TE_Scraper.export_data-1331"><span class="linenos">1331</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No series found. Run the series_from_chart_soup method first.&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.export_data-1332"><a href="#TE_Scraper.export_data-1332"><span class="linenos">1332</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="TE_Scraper.export_data-1333"><a href="#TE_Scraper.export_data-1333"><span class="linenos">1333</span></a>        <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TE_Scraper.export_data-1334"><a href="#TE_Scraper.export_data-1334"><span class="linenos">1334</span></a>            <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">series_name</span>
</span><span id="TE_Scraper.export_data-1335"><a href="#TE_Scraper.export_data-1335"><span class="linenos">1335</span></a>
</span><span id="TE_Scraper.export_data-1336"><a href="#TE_Scraper.export_data-1336"><span class="linenos">1336</span></a>        <span class="k">with</span> <span class="n">pd</span><span class="o">.</span><span class="n">ExcelWriter</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">savePath</span><span class="si">}{</span><span class="n">fdel</span><span class="si">}{</span><span class="n">filename</span><span class="si">}</span><span class="s2">.xlsx&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">writer</span><span class="p">:</span>
</span><span id="TE_Scraper.export_data-1337"><a href="#TE_Scraper.export_data-1337"><span class="linenos">1337</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="s1">&#39;Data&#39;</span><span class="p">)</span>
</span><span id="TE_Scraper.export_data-1338"><a href="#TE_Scraper.export_data-1338"><span class="linenos">1338</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">series_metadata</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="s1">&#39;Metadata&#39;</span><span class="p">)</span>
</span><span id="TE_Scraper.export_data-1339"><a href="#TE_Scraper.export_data-1339"><span class="linenos">1339</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Data exported to </span><span class="si">{</span><span class="n">savePath</span><span class="si">}{</span><span class="n">fdel</span><span class="si">}{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Export the series data to an excel .xlsx file. The series and metadata attributes must be set before running this method.
Only do it after scraping the series data. The metadata will be saved in a separate sheet in the same file.</p>

<p><strong>Parameters</strong></p>

<ul>
<li>savePath (str): The directory to save the file to. Default is the current working directory.</li>
<li>filename (str): The name of the file to save the data to. Default is the name of the series.</li>
</ul>
</div>


                            </div>
                            <div id="TE_Scraper.get_page_source" class="classattr">
                                        <input id="TE_Scraper.get_page_source-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_page_source</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="TE_Scraper.get_page_source-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TE_Scraper.get_page_source"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TE_Scraper.get_page_source-1341"><a href="#TE_Scraper.get_page_source-1341"><span class="linenos">1341</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_page_source</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="TE_Scraper.get_page_source-1342"><a href="#TE_Scraper.get_page_source-1342"><span class="linenos">1342</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get current page source after interactions&quot;&quot;&quot;</span>
</span><span id="TE_Scraper.get_page_source-1343"><a href="#TE_Scraper.get_page_source-1343"><span class="linenos">1343</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">page_source</span>
</span></pre></div>


            <div class="docstring"><p>Get current page source after interactions</p>
</div>


                            </div>
                            <div id="TE_Scraper.close" class="classattr">
                                        <input id="TE_Scraper.close-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">close</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="TE_Scraper.close-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TE_Scraper.close"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TE_Scraper.close-1345"><a href="#TE_Scraper.close-1345"><span class="linenos">1345</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="TE_Scraper.close-1346"><a href="#TE_Scraper.close-1346"><span class="linenos">1346</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Clean up resources completely by closing the WebDriver and removing references&quot;&quot;&quot;</span>
</span><span id="TE_Scraper.close-1347"><a href="#TE_Scraper.close-1347"><span class="linenos">1347</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="TE_Scraper.close-1348"><a href="#TE_Scraper.close-1348"><span class="linenos">1348</span></a>            <span class="c1"># First try graceful close with quitting the driver</span>
</span><span id="TE_Scraper.close-1349"><a href="#TE_Scraper.close-1349"><span class="linenos">1349</span></a>            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;driver&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="p">:</span>
</span><span id="TE_Scraper.close-1350"><a href="#TE_Scraper.close-1350"><span class="linenos">1350</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="TE_Scraper.close-1351"><a href="#TE_Scraper.close-1351"><span class="linenos">1351</span></a>                    <span class="c1"># Close all windows/tabs first</span>
</span><span id="TE_Scraper.close-1352"><a href="#TE_Scraper.close-1352"><span class="linenos">1352</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="TE_Scraper.close-1353"><a href="#TE_Scraper.close-1353"><span class="linenos">1353</span></a>                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="TE_Scraper.close-1354"><a href="#TE_Scraper.close-1354"><span class="linenos">1354</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error closing window: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.close-1355"><a href="#TE_Scraper.close-1355"><span class="linenos">1355</span></a>                    <span class="k">pass</span>
</span><span id="TE_Scraper.close-1356"><a href="#TE_Scraper.close-1356"><span class="linenos">1356</span></a>                
</span><span id="TE_Scraper.close-1357"><a href="#TE_Scraper.close-1357"><span class="linenos">1357</span></a>                <span class="c1"># Then quit the driver completely with error handling for connection issues</span>
</span><span id="TE_Scraper.close-1358"><a href="#TE_Scraper.close-1358"><span class="linenos">1358</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="TE_Scraper.close-1359"><a href="#TE_Scraper.close-1359"><span class="linenos">1359</span></a>                    <span class="kn">from</span><span class="w"> </span><span class="nn">selenium.common.exceptions</span><span class="w"> </span><span class="kn">import</span> <span class="n">WebDriverException</span>
</span><span id="TE_Scraper.close-1360"><a href="#TE_Scraper.close-1360"><span class="linenos">1360</span></a>                    <span class="kn">from</span><span class="w"> </span><span class="nn">urllib3.exceptions</span><span class="w"> </span><span class="kn">import</span> <span class="n">MaxRetryError</span><span class="p">,</span> <span class="n">NewConnectionError</span>
</span><span id="TE_Scraper.close-1361"><a href="#TE_Scraper.close-1361"><span class="linenos">1361</span></a>                    
</span><span id="TE_Scraper.close-1362"><a href="#TE_Scraper.close-1362"><span class="linenos">1362</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="TE_Scraper.close-1363"><a href="#TE_Scraper.close-1363"><span class="linenos">1363</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
</span><span id="TE_Scraper.close-1364"><a href="#TE_Scraper.close-1364"><span class="linenos">1364</span></a>                    <span class="k">except</span> <span class="p">(</span><span class="n">WebDriverException</span><span class="p">,</span> <span class="n">MaxRetryError</span><span class="p">,</span> <span class="n">NewConnectionError</span><span class="p">,</span> <span class="ne">ConnectionRefusedError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="TE_Scraper.close-1365"><a href="#TE_Scraper.close-1365"><span class="linenos">1365</span></a>                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Connection error when quitting driver (this is normal if browser crashed): </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.close-1366"><a href="#TE_Scraper.close-1366"><span class="linenos">1366</span></a>                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="TE_Scraper.close-1367"><a href="#TE_Scraper.close-1367"><span class="linenos">1367</span></a>                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error quitting driver: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.close-1368"><a href="#TE_Scraper.close-1368"><span class="linenos">1368</span></a>                <span class="k">finally</span><span class="p">:</span>
</span><span id="TE_Scraper.close-1369"><a href="#TE_Scraper.close-1369"><span class="linenos">1369</span></a>                    <span class="c1"># Clear the reference regardless of success</span>
</span><span id="TE_Scraper.close-1370"><a href="#TE_Scraper.close-1370"><span class="linenos">1370</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">driver</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="TE_Scraper.close-1371"><a href="#TE_Scraper.close-1371"><span class="linenos">1371</span></a>            
</span><span id="TE_Scraper.close-1372"><a href="#TE_Scraper.close-1372"><span class="linenos">1372</span></a>            <span class="c1"># Also close any tooltip_scraper drivers if they exist</span>
</span><span id="TE_Scraper.close-1373"><a href="#TE_Scraper.close-1373"><span class="linenos">1373</span></a>            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;tooltip_scraper&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">tooltip_scraper</span><span class="p">:</span>
</span><span id="TE_Scraper.close-1374"><a href="#TE_Scraper.close-1374"><span class="linenos">1374</span></a>                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tooltip_scraper</span><span class="p">,</span> <span class="s2">&quot;driver&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">tooltip_scraper</span><span class="o">.</span><span class="n">driver</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">tooltip_scraper</span><span class="o">.</span><span class="n">driver</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="p">:</span>
</span><span id="TE_Scraper.close-1375"><a href="#TE_Scraper.close-1375"><span class="linenos">1375</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="TE_Scraper.close-1376"><a href="#TE_Scraper.close-1376"><span class="linenos">1376</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">tooltip_scraper</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
</span><span id="TE_Scraper.close-1377"><a href="#TE_Scraper.close-1377"><span class="linenos">1377</span></a>                    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="TE_Scraper.close-1378"><a href="#TE_Scraper.close-1378"><span class="linenos">1378</span></a>                        <span class="k">pass</span>
</span><span id="TE_Scraper.close-1379"><a href="#TE_Scraper.close-1379"><span class="linenos">1379</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">tooltip_scraper</span><span class="o">.</span><span class="n">driver</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="TE_Scraper.close-1380"><a href="#TE_Scraper.close-1380"><span class="linenos">1380</span></a>            
</span><span id="TE_Scraper.close-1381"><a href="#TE_Scraper.close-1381"><span class="linenos">1381</span></a>            <span class="c1"># Clear any large data attributes to help garbage collection</span>
</span><span id="TE_Scraper.close-1382"><a href="#TE_Scraper.close-1382"><span class="linenos">1382</span></a>            <span class="n">large_attributes</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;series&quot;</span><span class="p">,</span> <span class="s2">&quot;trace_path_series&quot;</span><span class="p">,</span> <span class="s2">&quot;full_page&quot;</span><span class="p">,</span> <span class="s2">&quot;page_soup&quot;</span><span class="p">,</span> 
</span><span id="TE_Scraper.close-1383"><a href="#TE_Scraper.close-1383"><span class="linenos">1383</span></a>                            <span class="s2">&quot;chart_soup&quot;</span><span class="p">,</span> <span class="s2">&quot;full_chart&quot;</span><span class="p">,</span> <span class="s2">&quot;plot&quot;</span><span class="p">]</span>
</span><span id="TE_Scraper.close-1384"><a href="#TE_Scraper.close-1384"><span class="linenos">1384</span></a>            
</span><span id="TE_Scraper.close-1385"><a href="#TE_Scraper.close-1385"><span class="linenos">1385</span></a>            <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">large_attributes</span><span class="p">:</span>
</span><span id="TE_Scraper.close-1386"><a href="#TE_Scraper.close-1386"><span class="linenos">1386</span></a>                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
</span><span id="TE_Scraper.close-1387"><a href="#TE_Scraper.close-1387"><span class="linenos">1387</span></a>                    <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="TE_Scraper.close-1388"><a href="#TE_Scraper.close-1388"><span class="linenos">1388</span></a>                    
</span><span id="TE_Scraper.close-1389"><a href="#TE_Scraper.close-1389"><span class="linenos">1389</span></a>            <span class="c1"># Force garbage collection</span>
</span><span id="TE_Scraper.close-1390"><a href="#TE_Scraper.close-1390"><span class="linenos">1390</span></a>            <span class="kn">import</span><span class="w"> </span><span class="nn">gc</span>
</span><span id="TE_Scraper.close-1391"><a href="#TE_Scraper.close-1391"><span class="linenos">1391</span></a>            <span class="n">gc</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
</span><span id="TE_Scraper.close-1392"><a href="#TE_Scraper.close-1392"><span class="linenos">1392</span></a>            
</span><span id="TE_Scraper.close-1393"><a href="#TE_Scraper.close-1393"><span class="linenos">1393</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Scraper resources successfully released&quot;</span><span class="p">)</span>
</span><span id="TE_Scraper.close-1394"><a href="#TE_Scraper.close-1394"><span class="linenos">1394</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="TE_Scraper.close-1395"><a href="#TE_Scraper.close-1395"><span class="linenos">1395</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error during cleanup: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Clean up resources completely by closing the WebDriver and removing references</p>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="base.html#Generic_Webdriver">tedata.base.Generic_Webdriver</a></dt>
                                <dd id="TE_Scraper.browser" class="variable"><a href="base.html#Generic_Webdriver.browser">browser</a></dd>
                <dd id="TE_Scraper.headless" class="variable"><a href="base.html#Generic_Webdriver.headless">headless</a></dd>
                <dd id="TE_Scraper.wait" class="variable"><a href="base.html#Generic_Webdriver.wait">wait</a></dd>
                <dd id="TE_Scraper.created_at" class="variable"><a href="base.html#Generic_Webdriver.created_at">created_at</a></dd>

            </div>
            <div><dt><a href="base.html#SharedWebDriverState">tedata.base.SharedWebDriverState</a></dt>
                                <dd id="TE_Scraper.observers" class="variable"><a href="base.html#SharedWebDriverState.observers">observers</a></dd>
                <dd id="TE_Scraper.register" class="function"><a href="base.html#SharedWebDriverState.register">register</a></dd>
                <dd id="TE_Scraper.page_source" class="variable"><a href="base.html#SharedWebDriverState.page_source">page_source</a></dd>
                <dd id="TE_Scraper.page_soup" class="variable"><a href="base.html#SharedWebDriverState.page_soup">page_soup</a></dd>
                <dd id="TE_Scraper.chart_soup" class="variable"><a href="base.html#SharedWebDriverState.chart_soup">chart_soup</a></dd>
                <dd id="TE_Scraper.full_chart" class="variable"><a href="base.html#SharedWebDriverState.full_chart">full_chart</a></dd>
                <dd id="TE_Scraper.date_span" class="variable"><a href="base.html#SharedWebDriverState.date_span">date_span</a></dd>
                <dd id="TE_Scraper.chart_type" class="variable"><a href="base.html#SharedWebDriverState.chart_type">chart_type</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>